{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"themes/volantis/source/css/Readme.md","path":"css/Readme.md","modified":1,"renderable":1},{"_id":"themes/volantis/source/css/first.styl","path":"css/first.styl","modified":1,"renderable":1},{"_id":"themes/volantis/source/css/style.styl","path":"css/style.styl","modified":1,"renderable":1},{"_id":"themes/volantis/source/js/app.js","path":"js/app.js","modified":1,"renderable":1},{"_id":"themes/volantis/source/js/plugins/aplayer.js","path":"js/plugins/aplayer.js","modified":1,"renderable":1},{"_id":"themes/volantis/source/js/plugins/rightMenus.js","path":"js/plugins/rightMenus.js","modified":1,"renderable":1},{"_id":"themes/volantis/source/js/plugins/parallax.js","path":"js/plugins/parallax.js","modified":1,"renderable":1},{"_id":"themes/volantis/source/js/search/algolia.js","path":"js/search/algolia.js","modified":1,"renderable":1},{"_id":"themes/volantis/source/js/search/hexo.js","path":"js/search/hexo.js","modified":1,"renderable":1},{"_id":"themes/volantis/source/js/search/meilisearch.js","path":"js/search/meilisearch.js","modified":1,"renderable":1},{"_id":"themes/volantis/source/js/plugins/tags/contributors.js","path":"js/plugins/tags/contributors.js","modified":1,"renderable":1},{"_id":"themes/volantis/source/js/plugins/tags/friends.js","path":"js/plugins/tags/friends.js","modified":1,"renderable":1},{"_id":"themes/volantis/source/js/plugins/tags/sites.js","path":"js/plugins/tags/sites.js","modified":1,"renderable":1}],"Cache":[{"_id":"source/_posts/2020-09-15-maven引入外部jar包的方式.md","hash":"09cef420c9ab9290c527810b3010ce72ff8b4c99","modified":1670137973030},{"_id":"source/_posts/Arrays$asList()抛UnsupportedOperationException异常.md","hash":"404383ef525d0ca6a4a91ff8f3565fe8f81a176f","modified":1670137564970},{"_id":"source/_posts/Centos安装jdk.md","hash":"b716309537a53dff9a3451e6fb0e83f970d28e99","modified":1670137639363},{"_id":"source/_posts/InnoDB几个索引数据结构的区别.md","hash":"b2c8bc5d08455dc3ee78fa3c5de07f323d430f9e","modified":1670137712216},{"_id":"source/_posts/SpringBoot整合Swagger(spring-boot-starter-swagger).md","hash":"7324d9b7658f43f49278df99d48ff50241408dc5","modified":1670137930236},{"_id":"source/_posts/cad.md","hash":"f86048ae541f0ad52e2d091f02551c0f308fa055","modified":1670137593472},{"_id":"source/_posts/hello-world.md","hash":"95ca6cbdc76019a78161316710e7318ebf8a1270","modified":1670138210418},{"_id":"source/_posts/quick_start_bat.md","hash":"032480496c063cc666ba44ca14d6e72e943776bc","modified":1670137871346},{"_id":"source/_posts/JDK动态代理.md","hash":"fef175e3fe9e6dc3dd680c8329b0f199dcf115c9","modified":1670137826462},{"_id":"source/_posts/reset-git-branch.md","hash":"b9f027d066ecaf37465fc2c84199149ce2458b61","modified":1670137897362},{"_id":"source/_posts/一个聚合浏览器打开的标签的插件.md","hash":"33e73c9de509b4cf330d3ad7013bf603d0e7300d","modified":1670137512756},{"_id":"source/_posts/代码实现单表的分库分表.md","hash":"7ab016178cf89ba997da67a64422eb63abf80ea7","modified":1670136992785},{"_id":"source/_posts/使用ssh登录远程服务器报错.md","hash":"8d67d01eeddee27aed6baaab7f27d72a3728ed44","modified":1670137056664},{"_id":"source/_posts/修改运行中的docker容器端口.md","hash":"d482b353ba33a267c38c284e55b79ff7892fa9b7","modified":1670137445471},{"_id":"source/_posts/数据库连接参数allowMultiQueries的作用.md","hash":"c3239d8eefab662e1c2a0f5e27d7910a22d75783","modified":1670137247962},{"_id":"source/_posts/填上IntegerCache的坑.md","hash":"7312e6fcbfccd8264a81885f465546bb548c38f8","modified":1670137319706},{"_id":"source/_posts/给前端返回long类型造成精度损失.md","hash":"7df965fecdf5541561084856efa5b27dfe1e6277","modified":1670136957489},{"_id":"source/about/index.md","hash":"bcf77cbadb660b56c8b9cdec0766b264faebd7c6","modified":1669569227801},{"_id":"source/blogger/index.md","hash":"e92457d408816f81bc75e97a450258321008cd7e","modified":1669559386656},{"_id":"source/donate/index.md","hash":"db10b44f2181c4f854260e7c25125fff4ee5dac6","modified":1669559396894},{"_id":"source/category/index.md","hash":"d11a4c822a4ce2bfa42681cd896b659c474e43dd","modified":1669569232532},{"_id":"source/friends/index.md","hash":"cd32a69f941ddd9aa76138f9ac21f91088bd4941","modified":1669569237651},{"_id":"source/tag/index.md","hash":"21309427b98fe171f711f2b40f2b53c3e45ec537","modified":1669569235171},{"_id":"source/tagcloud/index.md","hash":"15c81ed6507595349c98e3206afcd6b101294ede","modified":1669559391851},{"_id":"themes/volantis/layout/_partial/_cover/blank.ejs","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1668682143000},{"_id":"themes/volantis/.gitignore","hash":"634017e600d424f2f08082d7f521b73f1089d95f","modified":1668682143000},{"_id":"themes/volantis/.npmignore","hash":"517c3c4cc55122fb3958764c539e94fb2f23bb04","modified":1668682143000},{"_id":"themes/volantis/CHANGELOG.md","hash":"602612b2aad8c74059adc705a589cc71defd7e6a","modified":1668682143000},{"_id":"themes/volantis/LICENSE","hash":"13b0862f4ed1914abe887a47df2c3ca5adfa8f3f","modified":1668682143000},{"_id":"themes/volantis/README.md","hash":"7c43923ced74698b0dfffb0ff1c53a70ad16e6fb","modified":1668682143000},{"_id":"themes/volantis/_cdn.yml","hash":"76cfdb68a148230da10eff099b0b32afb825d172","modified":1668682143000},{"_id":"themes/volantis/_config.yml","hash":"646044b8bf4a854c024cc7776a284c8298bce798","modified":1670139205483},{"_id":"themes/volantis/package.json","hash":"0aa19845b3c6ff00e757d0d79a9017c5578f0c38","modified":1668682143000},{"_id":"themes/volantis/languages/zh-CN.yml","hash":"680da2d4d8eff226f9c7ac2567b5d5b8fe2b3853","modified":1669571030814},{"_id":"themes/volantis/layout/404.ejs","hash":"48e160ad704be637cafc433d2365fc0eb8bab8cb","modified":1668682143000},{"_id":"themes/volantis/layout/archive.ejs","hash":"e9f960ed538f1776e27c5409f1b702c5d3ebe7e4","modified":1668682143000},{"_id":"themes/volantis/layout/friends.ejs","hash":"92021bbd9e585a31838cc60d4a8cfdb2438baa44","modified":1668682143000},{"_id":"themes/volantis/layout/_pre.ejs","hash":"3ac804505c282ff8b16858037c1d2bf9305c3063","modified":1668682143000},{"_id":"themes/volantis/layout/index.ejs","hash":"8ea7d49272b068cd1a4037846c72eb37e9823512","modified":1668682143000},{"_id":"themes/volantis/layout/layout.ejs","hash":"27fd30b7372f231234fe70531ac090c00c6fa2dc","modified":1668682143000},{"_id":"themes/volantis/layout/docs.ejs","hash":"16917af05431c049aa103744a5fb2595d5848d4c","modified":1668682143000},{"_id":"themes/volantis/layout/list.ejs","hash":"a85b2984717ee6d5058ec5635f3f287f45c3d4ba","modified":1668682143000},{"_id":"themes/volantis/layout/category.ejs","hash":"9ee883e5f73c05b3963770b74b63d7bb7e4e1ed5","modified":1668682143000},{"_id":"themes/volantis/layout/page.ejs","hash":"16917af05431c049aa103744a5fb2595d5848d4c","modified":1668682143000},{"_id":"themes/volantis/layout/post.ejs","hash":"16917af05431c049aa103744a5fb2595d5848d4c","modified":1668682143000},{"_id":"themes/volantis/layout/tag.ejs","hash":"696e7b1c70b4438e6a8d925f99cbc4222dd4035d","modified":1668682143000},{"_id":"themes/volantis/layout/_partial/archive.ejs","hash":"d5f776437c108c72c002b11f1d23d30b50e0079a","modified":1668682143000},{"_id":"themes/volantis/layout/_partial/article.ejs","hash":"c07f11240da27f5e1bdea7535d4572771687f572","modified":1668682143000},{"_id":"themes/volantis/layout/_partial/categories.ejs","hash":"c2bc61780cab948ef8ab5076511ebccacab1cd79","modified":1668682143000},{"_id":"themes/volantis/layout/_partial/cover.ejs","hash":"b03a268d75dedeb8d6e29e3e352bd6cdf921545a","modified":1668682143000},{"_id":"themes/volantis/layout/_partial/footer.ejs","hash":"76d374acd67c34343f24cb178567c1ead5feeca0","modified":1670129152120},{"_id":"themes/volantis/layout/_partial/head.ejs","hash":"c289883e82567a54f5d7df9d5275a14c58902dd6","modified":1668682143000},{"_id":"themes/volantis/layout/_partial/header.ejs","hash":"8ac1e8eed1430b953e3cfed348e75a7190351173","modified":1668682143000},{"_id":"themes/volantis/layout/_partial/meta.ejs","hash":"62b8298125ec4e395ec0f7b86a3290b54c84bf52","modified":1668682143000},{"_id":"themes/volantis/layout/_partial/side.ejs","hash":"27f9df84585ffb24e2ba2423761f90f690c65787","modified":1668682143000},{"_id":"themes/volantis/layout/_partial/post.ejs","hash":"7d144c80f2980efaab6198512746c0c5d77f03db","modified":1668682143000},{"_id":"themes/volantis/layout/_meta/author.ejs","hash":"68e8f198c406b6946fbf0a0f756e8a334982ba84","modified":1668682143000},{"_id":"themes/volantis/layout/_meta/artalkcount.ejs","hash":"94c9e591e38ac00d6beafa44de4d29e70680c673","modified":1668682143000},{"_id":"themes/volantis/layout/_meta/category.ejs","hash":"bbf3ca01ebb7bf1e58f32307f8b669af10a36c51","modified":1668682143000},{"_id":"themes/volantis/layout/_meta/date.ejs","hash":"ba6c554dbc6c1870debb2b87c5fa25caa089be8f","modified":1668682143000},{"_id":"themes/volantis/layout/_meta/counter.ejs","hash":"2fbd81d196526059e1a4d43614d4c433ae697bf7","modified":1668682143000},{"_id":"themes/volantis/layout/_meta/music.ejs","hash":"2c1884e59131d47a82d2556ac28ef784b4ddaa10","modified":1668682143000},{"_id":"themes/volantis/layout/_meta/tags.ejs","hash":"3d6812e845b2ec82e43dd4b4563298c19cb48097","modified":1668682143000},{"_id":"themes/volantis/layout/_meta/share.ejs","hash":"0f3b1db92319734baa8da1636340839ed2d37a7b","modified":1668682143000},{"_id":"themes/volantis/layout/_meta/thumbnail.ejs","hash":"60045f2bf695b4be5ad3fd19db46890f1cdee68a","modified":1668682143000},{"_id":"themes/volantis/layout/_meta/updated.ejs","hash":"edf445ad8153419a5dc7c4ec4c8490967cd9d33d","modified":1668682143000},{"_id":"themes/volantis/layout/_meta/walinecount.ejs","hash":"038b1c17a316f4611812c3e1056d7aef91de6910","modified":1668682143000},{"_id":"themes/volantis/layout/_meta/wordcount.ejs","hash":"eebaab3821af95ee64d8d56f33ca6c9c60b9b6f0","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/_pre.ejs","hash":"e435d54f5e049b6411d69317af0f0768e060dec7","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/blogger.ejs","hash":"2e418e70b5f78ce13b95b8f9f49c0425dcccf7dd","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/copyright.ejs","hash":"7510f0cd22bc2687e64423540611a7a84ef38bed","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/category.ejs","hash":"d8e7ad7e1418659208036a0a43cb4db2ee61abd7","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/header.ejs","hash":"b132e332ddf12d1bb1d99480200561d8c38edd04","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/grid.ejs","hash":"c126373ab5524eef84096214498d1c56eadc2ca2","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/lastupdate.ejs","hash":"c311ba4c8b255c45313dc1ab7ddafd99ec7fe8af","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/load.ejs","hash":"f3c68d034cbae2eb983745a1efe5e4220a41b76a","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/group.ejs","hash":"2eed9614049441b51e6819f393f80faf5441870b","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/list.ejs","hash":"3c280bdca54c5c70f9511e8f192fb70b8982d60d","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/music.ejs","hash":"2f560f3168e3811cd1d8d8a6bad9112932be9b04","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/page.ejs","hash":"e6a20fb75a3e835a404dddd929db4d3762a367c0","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/references.ejs","hash":"8be0102cda29802e5517b3b9286fe71ca7c4c6bf","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/qrcode.ejs","hash":"8d266121efc2ded1cbf2e77a0fa9f549055640e9","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/related_posts.ejs","hash":"f7a514d1f3f5ae40c6fb55d61f8b2a0bba13401c","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/tagcloud.ejs","hash":"a68ccb41f7b589f9076a750e77e17f178af3e9d0","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/text.ejs","hash":"eb8049ff26aa6e17b0d01f3ada8d1ecc2143ac32","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/toc.ejs","hash":"200bf0096d8965e5fb7039b261317c848e36be85","modified":1668682143000},{"_id":"themes/volantis/layout/_widget/webinfo.ejs","hash":"f35c0dc4ba93e4b03426e7866986398819bbfccf","modified":1668682143000},{"_id":"themes/volantis/scripts/filters/content-visibility.js","hash":"048a8f1b80e8999d5f7a37bb8c4dabdebbebabdc","modified":1668682143000},{"_id":"themes/volantis/scripts/events/index.js","hash":"af7aaa4431393889671853db03c8b684265eaa50","modified":1668682143000},{"_id":"themes/volantis/scripts/filters/img.js","hash":"160732831bec5baf89fa07a85fec5229c3cb9cd7","modified":1668682143000},{"_id":"themes/volantis/scripts/filters/hexo-blog-encrypt-callback.js","hash":"dd40db85a28bd161d5e665e179abb3a96b8c3d7c","modified":1668682143000},{"_id":"themes/volantis/scripts/filters/replace.js","hash":"aa6fe807d7b24a60475ce8126a1be7b314cd26ba","modified":1668682143000},{"_id":"themes/volantis/scripts/filters/z-lazyload.js","hash":"df6c5b0a6eff5e655d2b8de85c646ba1e5a16535","modified":1668682143000},{"_id":"themes/volantis/scripts/helpers/custom-files.js","hash":"8483fcdc7dbbfde40276dc3daa1ddc5e40380360","modified":1668682143000},{"_id":"themes/volantis/scripts/helpers/first-style.js","hash":"ba2e2325a365704abae3f1d204b058731e21bfbf","modified":1668682143000},{"_id":"themes/volantis/scripts/helpers/related-posts.js","hash":"cab8c291a8ff460b29b3248ac86827c143aca9ee","modified":1668682143000},{"_id":"themes/volantis/scripts/helpers/文章推荐.js","hash":"c1e0466407c487ddfbaf72e54291103af64530e6","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/btn.js","hash":"e9b6e26f106505cf14a72524ab5e8b5bc85f362a","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/checkbox.js","hash":"0798edc6833d5978709ca5ed56aed33cea46e694","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/btns.js","hash":"648671420faa0ac00076a8c7bb011c908b83fd5a","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/contributors.js","hash":"a00573000e7ddf7a9d2f03f29fd62cb8a9752a48","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/dropmenu.js","hash":"19176a6edf7acc6ad31c96961e59da526f200980","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/fancybox.js","hash":"9eac73fa2d7d14ae585b302255270933641a4859","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/folding.js","hash":"a809988c63f358e2ae903d905dc81ed80860bacd","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/frame.js","hash":"e78834c005bda8f80ba86c78911b9db7566b878b","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/friends.js","hash":"63c4a06d7ec617764d5434aa479e2b9319a5d2f6","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/image.js","hash":"63a4b3e1e3d661b6ab2b3fcfcfb657e3b632b9cb","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/ghcard.js","hash":"8a6e80141c789cc0df3809ac64dbf28e6a1254fd","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/inline-labels.js","hash":"08fbdc0ea622270e1236a28778f875c8ad2e5516","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/link.js","hash":"9dec9c65819d1135a7a248adaa26acbf24427cd0","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/md.js","hash":"355d78589b045b9b128a9d100e0ba41e3bce84b9","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/media.js","hash":"fb8d031b48cb3f6174948c2be0bd15fa92d8a6df","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/note.js","hash":"ac86ba50da98d9546522feaca672259620b053d8","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/span.js","hash":"b825115f037386797efa1b0aee3a1df21629f243","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/pandown.js","hash":"4d6f6dab955106ade379d6c55603e1e7eb97a107","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/table.js","hash":"ad82046fc64f932019d8a7b3e9a8ff07973a6c3b","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/site.js","hash":"911c6ac1f6646c1bf47bb3ef1b105fa2919302b5","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/swiper.js","hash":"f0171f07f494c0b0f3f8af265344add15813a676","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/tabs.js","hash":"f0054f1c970cac728b3ad289a3c531c070c06896","modified":1668682143000},{"_id":"themes/volantis/scripts/tags/timeline.js","hash":"9b6b88ada712a8f3a04a825cf73a409f072ed045","modified":1668682143000},{"_id":"themes/volantis/source/css/Readme.md","hash":"cf408308dcbc62f4fc2bd5aa38303b368cc88a7e","modified":1668682143000},{"_id":"themes/volantis/source/css/style.styl","hash":"00892839230a1b05a5f9d9350baacd67d894fc85","modified":1668682143000},{"_id":"themes/volantis/source/css/first.styl","hash":"55fe35847a1d1d831eb71288c0233efb1dd8a630","modified":1668682143000},{"_id":"themes/volantis/source/js/app.js","hash":"af7c0cc26b2c9e103674f3dca8dc96af2c490da8","modified":1668682143000},{"_id":"themes/volantis/layout/_partial/_cover/dock.ejs","hash":"6127655788723099fecd7c6a58212fd48dd8a834","modified":1668682143000},{"_id":"themes/volantis/layout/_partial/_cover/featured.ejs","hash":"6127655788723099fecd7c6a58212fd48dd8a834","modified":1668682143000},{"_id":"themes/volantis/layout/_partial/_cover/search.ejs","hash":"7767c06cd4be45b83b3eab57bb2d0ff170442ea5","modified":1668682143000},{"_id":"themes/volantis/layout/_partial/_cover/focus.ejs","hash":"6127655788723099fecd7c6a58212fd48dd8a834","modified":1668682143000},{"_id":"themes/volantis/layout/_partial/_cover/layout.ejs","hash":"39a463ce33ce6138d40055e72118941515ba2f63","modified":1668682143000},{"_id":"themes/volantis/layout/_partial/scripts/_ctrl.ejs","hash":"ee3f2108e61db024466b08beddb895ad97330f63","modified":1668682143000},{"_id":"themes/volantis/layout/_partial/scripts/config.ejs","hash":"97ba37e69e5a429fc7aa4fe3276be2faeed1496e","modified":1668682143000},{"_id":"themes/volantis/layout/_partial/scripts/global.ejs","hash":"fa3699ee465a171606961519fa89f95f680b02a0","modified":1668682143000},{"_id":"themes/volantis/layout/_partial/scripts/index.ejs","hash":"da05e1f0acdb0963130dcd14eaeaec02ffdf6d9b","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/_page_plugins/index.ejs","hash":"0225c5aa1c5a2b25887fef4354a1a7a253d67f08","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/analytics/script.ejs","hash":"a757c6fd89e11ab3e4cbd3e4cc02091a836fcd70","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/aplayer/layout.ejs","hash":"822212208fbbb4fa189abc503cd14b9b6e385901","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/aplayer/script.ejs","hash":"713182420d0b4eb7e9120f7a2f3e3f08ccde0406","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/chat/index.ejs","hash":"56d2e577fbd08859e118cfb1d1b8d230850a3675","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/comments/index.ejs","hash":"6f0b31b4ddd647523840088a30fdf4aedc295a5e","modified":1670133656975},{"_id":"themes/volantis/layout/_plugins/content-visibility/script.ejs","hash":"8aa467244e0976efbdc80e28dd266b0ac0bd2dc7","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/darkmode/script.ejs","hash":"742f0e0988741e3eb82bb0d99a081447b45a41b1","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/end-of-support/script.ejs","hash":"b415d8e5dfca4a47c199b1adeb220ff57eaec219","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/github-api/script.ejs","hash":"f1ce131994e58894b3afb5f641e9e6dd2a73fafe","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/pace/script.ejs","hash":"631227193e926977313c8fff587791c796a3c812","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/lazyload/script.ejs","hash":"ebecb6e148a03df7bab5a4cf539598a9afe3ae76","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/nodewaves/script.ejs","hash":"72c937530f0a6bef00e225377266752a60f4e083","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/highlight/script.ejs","hash":"06befe70f47454fbfaa95245fe4cdb8d4f6f9f3c","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/parallax/script.ejs","hash":"061b02df9039978ab1e5d2a698781c7d81be07a7","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/pjax/index.ejs","hash":"ee5a8960e0483e16ac520be9509d9762ec969ab5","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/pjax/pdata.ejs","hash":"eb90a00163519e6ed01a4f38380caf4dc2bd5049","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/preload/script.ejs","hash":"f35821683c3bac5e898face2f74135a52bec5254","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/rightmenus/layout.ejs","hash":"de6d7f3d274617edfb8f9f71b652d5dbdaba9bad","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/scrollreveal/script.ejs","hash":"d563e9a451148603f1e7d9482deee6f503ee859a","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/search/script.ejs","hash":"a9e0939ae1c58fc7419eaf2c5e5664be8da6dccb","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/share/layout.ejs","hash":"bc2aeea593ddb818dc7596ca2f34640fbfb7b2f3","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/slow-network/script.ejs","hash":"5a2f3eaadb6dbe4350e6d32094a0bad62ba240bc","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/swiper/script.ejs","hash":"1d0999d6f4dd99b67d6ca977aa57dd1f583270dc","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/toc/script.ejs","hash":"0b887962cc779ea282f0d7b384372b74744edad0","modified":1668682143000},{"_id":"themes/volantis/scripts/events/lib/cdn.js","hash":"adf2a07d3adef7b79ffa33291b843410fe4371fe","modified":1668682143000},{"_id":"themes/volantis/scripts/events/lib/check-configuration.js","hash":"c01c850ca638af1cce1467f516b4f6b8534675cf","modified":1668682143000},{"_id":"themes/volantis/scripts/events/lib/stellar-tag-utils.js","hash":"8d62893faf26d15d2833f8090bd6257a7282f5e2","modified":1668682143000},{"_id":"themes/volantis/scripts/events/lib/render-stylus.js","hash":"36c2f32d2101eaa84041daf70393df6f3a3fa331","modified":1668682143000},{"_id":"themes/volantis/scripts/events/lib/config.js","hash":"501968a736d73e6a34e8ef833c54bfa89d0190e2","modified":1668682143000},{"_id":"themes/volantis/scripts/events/lib/check-environment.js","hash":"9d29a3f34ea715a0dc7cb5c2f76b5713d718e6e6","modified":1668682143000},{"_id":"themes/volantis/scripts/helpers/head/autoCanonical.js","hash":"f3ea74759129c71041371a1d77c687eb6aa88d3a","modified":1668682143000},{"_id":"themes/volantis/scripts/helpers/head/generate_title__keywords__description.js","hash":"179a07b7b2270398216a34d79595d98e30962b22","modified":1668682143000},{"_id":"themes/volantis/scripts/helpers/head/generate_preload_fontfamily.js","hash":"d37dbe38fa9125fdce99b2ef9e92582ed08eea82","modified":1668682143000},{"_id":"themes/volantis/scripts/helpers/head/generate_seo.js","hash":"e0059a60cc5978be6792dcf795a2ece3a509f41a","modified":1668682143000},{"_id":"themes/volantis/scripts/helpers/structured-data/index.js","hash":"bcb770787c77e39cdc156b7fd58cde8e00b79153","modified":1668682143000},{"_id":"themes/volantis/source/css/_first/base_first.styl","hash":"2db7ec30d52473fa40bca89dcd29854498e8ca3e","modified":1668682143000},{"_id":"themes/volantis/source/css/_first/cover_first.styl","hash":"32f0e09eba832607165096c68f70698a75d685b5","modified":1668682143000},{"_id":"themes/volantis/source/css/_first/fontfamily_first.styl","hash":"5024a9162f4787ac4234d5b8549fad40dbecf865","modified":1668682143000},{"_id":"themes/volantis/source/css/_first/dark_first.styl","hash":"bcb419588c1972bd47869309dea43ff319440d33","modified":1668682143000},{"_id":"themes/volantis/source/css/_first/navbar_first.styl","hash":"e268d81dc78fdf9758d314cdc5cc087aec1c70e6","modified":1668682143000},{"_id":"themes/volantis/source/css/_defines/AutoPrefixCSS.styl","hash":"c76f624d332c59b73c1d6b95b30b2afb560976eb","modified":1668682143000},{"_id":"themes/volantis/source/css/_defines/color.styl","hash":"02d9bbe630f33ec2c604cb8acdddbe28431fcb05","modified":1668682143000},{"_id":"themes/volantis/source/css/_defines/Readme.md","hash":"77d9e986d24898b98eba2010185951fd1fb8b95c","modified":1668682143000},{"_id":"themes/volantis/source/css/_defines/effect.styl","hash":"47db4f84182194a8a233931424c9bc79c6cf0117","modified":1668682143000},{"_id":"themes/volantis/source/css/_defines/func.styl","hash":"430adedc7e6f57013e54d15e6f8dce21e9ea2579","modified":1668682143000},{"_id":"themes/volantis/source/css/_first/search_first.styl","hash":"955c9eb68b90b97dba0bd27909347cfc91ce68c5","modified":1668682143000},{"_id":"themes/volantis/source/css/_defines/fonts.styl","hash":"fa199b11b568a6b0d6fc4e87ef12ab36ac254966","modified":1668682143000},{"_id":"themes/volantis/source/css/_defines/layout.styl","hash":"d1bdce2e7974b1feb585adcdf95e36a054a36ec4","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/index.styl","hash":"835b3640c257cd229b20c088536b053b92c9796c","modified":1668682143000},{"_id":"themes/volantis/source/js/plugins/aplayer.js","hash":"95f2e47535c8d37e90cab7726d25845cf01ca477","modified":1668682143000},{"_id":"themes/volantis/source/js/plugins/rightMenus.js","hash":"c2fa67d8feb54d050759172bc0ac71c48e01b1e0","modified":1668682143000},{"_id":"themes/volantis/source/js/plugins/parallax.js","hash":"3c3210bde6e86d7d157c34c14796abe98cb1bbd0","modified":1668682143000},{"_id":"themes/volantis/source/js/search/algolia.js","hash":"e5bf9b2dc0f530d4c40e40371faf66da135391f3","modified":1668682143000},{"_id":"themes/volantis/source/js/search/hexo.js","hash":"7dc583642bc3f437506c4de3e5d0ce569f35bf21","modified":1668682143000},{"_id":"themes/volantis/source/js/search/meilisearch.js","hash":"cb1352e7bdc36438f5e034b645e2a938fe2c6759","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/_page_plugins/bbtalk/index.ejs","hash":"24b2e09f3218fa400c61edd695e212581ddb8561","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/_page_plugins/artitalk/index.ejs","hash":"d6c217fd195c1fef35208774635a3f668f7c36b4","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/_page_plugins/fcircle/index.ejs","hash":"bc7c4482af2dbde062845cec3b8ac05e430c41c7","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/_page_plugins/gitter/index.ejs","hash":"e90bf8daf46f34ca9b37049154dda6d1f155d037","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/_page_plugins/indent/index.ejs","hash":"7d112cde9b8d1785d8c541cde94361e0bfc60f30","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/_page_plugins/katex/index.ejs","hash":"b5a1ce49a0b4e6085cb9f04c9baeb4c4d5a09e38","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/_page_plugins/mathjax/index.ejs","hash":"917593e8966621a9d4c1e739f9b0b1e175d2687f","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/_page_plugins/snackbar/index.ejs","hash":"bddb75f7112d2b438f462a6ebef79810ef5ac291","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/chat/gitter/script.ejs","hash":"e4f06c50c23d433a0e63fc703a35704c336ba090","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/chat/tidio/script.ejs","hash":"bb678b5e8a9fb87fc1c1e48914da3a1a052a8e02","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/comments/artalk/script.ejs","hash":"e56d0e2a75d381c97c11f387ead6d0a835fbd518","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/comments/disqus/script.ejs","hash":"3a67befc560e6d0695f64c05d82c68ee9771a1a7","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/comments/beaudar/script.ejs","hash":"285226000b8bff1f96b8b69da268a0af79d04b98","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/comments/discuss/script.ejs","hash":"c5deffb9a408826e7b1654b21fff00511da53eaf","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/comments/disqusjs/script.ejs","hash":"aa29521a4c1809ce0a2cc98694644070d086090e","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/comments/giscus/script.ejs","hash":"45fe8d3e47d2a990292426d14091cffa46301704","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/comments/gitalk/script.ejs","hash":"d668ebcc90f4c60183174c709bed4a6f323ccd01","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/comments/isso/script.ejs","hash":"aa7c81e6df9b803966efe5eda8edbc85b924f34b","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/comments/livere/script.ejs","hash":"54340ba16d4f46ed4f3c6f67ac7ba1a2e68be67a","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/comments/twikoo/script.ejs","hash":"560b7114e424788243ca2ec69901cfe847ba22af","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/comments/utterances/script.ejs","hash":"afbb35e59b3b3af34627416ee47ecad1d564bdbc","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/comments/hashover/script.ejs","hash":"7ecd8879c66b907da04093a465d346f6569cee83","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/comments/vssue/script.ejs","hash":"e022ad633496f34ecd7117f2082a7a3d1fdc1bdd","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/comments/waline/script.ejs","hash":"af3075f7e056a1c10bd475b8257c1aeb79673530","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/comments/z-custom/script.ejs","hash":"e5cfe25fb88b7a3dd0c68e20b2e17d44eb2a1f04","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/highlight/highlightjs/script.ejs","hash":"3ffdc0dea93efd49b23910fe7a295784c7053b97","modified":1668682143000},{"_id":"themes/volantis/layout/_plugins/highlight/prismjs/script.ejs","hash":"f2b823714c16b9fadd501bc127fc17fca8cad488","modified":1668682143000},{"_id":"themes/volantis/scripts/helpers/structured-data/lib/blogposting.js","hash":"f8543b0460c9a5b23ee43d8ed49e018c1c627439","modified":1668682143000},{"_id":"themes/volantis/scripts/helpers/structured-data/lib/breadcrumblist.js","hash":"df6316082af2df061f16bb01d5b5d3478f98c662","modified":1668682143000},{"_id":"themes/volantis/scripts/helpers/structured-data/lib/config.js","hash":"e4c3c23e58f0bac72010f962d92da641445e748a","modified":1668682143000},{"_id":"themes/volantis/scripts/helpers/structured-data/lib/index.js","hash":"41e4af773dfb4755752cb74a6d70e4b5b0c1ce4d","modified":1668682143000},{"_id":"themes/volantis/scripts/helpers/structured-data/lib/organization.js","hash":"02c08f0362aec5d310b8c7e69823cd88ed49ea5e","modified":1668682143000},{"_id":"themes/volantis/scripts/helpers/structured-data/lib/person.js","hash":"afca448311d62a44566d9471594a43495a6be6db","modified":1668682143000},{"_id":"themes/volantis/scripts/helpers/structured-data/lib/website.js","hash":"556f28164d31b3898d06cb8f76472bc6547bb1db","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_base/fontfamily_async.styl","hash":"48c006682b8f44681662e4b0f8d3ebfdf85add69","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_base/base.styl","hash":"712eb4803dc595eb111ebd89546e6ed3fb1ec7ce","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_layout/article.styl","hash":"de23aac33b178c59531ef45168e98a0d98ad6151","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_layout/archive.styl","hash":"a96709230abbc8d4fc40361b8fc02d4249abb4a1","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_layout/footer.styl","hash":"bb850b4707ee025e267e079fcf85484849cf4f41","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_layout/friends-simpleuser.styl","hash":"07c477e15bf75615faff5587cc82dbc6004a901a","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_layout/friends-traditional.styl","hash":"2da0419cd5874d03d7d5bafdb081beb6cb786608","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_layout/img.styl","hash":"55d79f07b717d3e28515b41401f656d1593be624","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_layout/loading.styl","hash":"56a2b9f46edd5b87e49d11647dc9396b0d833d54","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_layout/main.styl","hash":"92f948df742f3de6d69a180b7653827c7242f1d3","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_layout/pagination.styl","hash":"65dacf95771fc518a06cbf301f4c0b06201d7321","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_layout/md.styl","hash":"d9b25d8199d3d5260c89e8ad84f1a17531b85588","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_layout/search.styl","hash":"fdabe3b9a14040f86c0a715ab48f26bfb8a3f7bc","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_layout/posts.styl","hash":"31cf7bdbb44caa173f3dfd49d98157cb6be85c6f","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_layout/sidebar.styl","hash":"4b75b29b67b88ef5ee365535d521c3ee8256a1ea","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_layout/snackbar.styl","hash":"752a7fea5284a61fd9305d3b0fcaa43f2e64862f","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_layout/toc.styl","hash":"3346fbcbcbc2533997a8bf1fbbf801d9120b03ab","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_layout/video.styl","hash":"680e8cf8fc5d62913dad4ccd06135caad2bb3e92","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/aplayer.styl","hash":"da809e1dde8adb9d1c98f0daeb52a2d920d497f7","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/cursor.styl","hash":"bc055048c7d017be8cf25a3385f516656c96cf66","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/fontcolor.styl","hash":"fa13f91f8be68b62210048d1481c3b23e23f939b","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/mathjax.styl","hash":"11ee86571f31f9aa61dcc48b40977dcd974d76a4","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/gitalk.styl","hash":"c4c9950fd6654f87ca4f481cf3065ca4069fac48","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/index.styl","hash":"088e20899e200b0ed78e2c033384d10361703913","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/message.styl","hash":"995b46084664f2ed2cf025c1a208089ecfe1147e","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/checkbox.styl","hash":"8c62dd38914d939069d9222c54787a24cb5c31f7","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/Readme.md","hash":"51986550e80990e1db23e2ee4165e5e4800e4b9f","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/btns.styl","hash":"bf592cd78c146bb671217f106632b9e5bcc7c145","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/fancybox.styl","hash":"1b4709787f9bda8ce565aa9a4aaf7f1f58751b44","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/dropmenu.styl","hash":"a136ebb90bedef15c1d8b8d75e09b37c3873f5e8","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/folding.styl","hash":"253f13e60218e0d014a1df99933f5cdba507f3b1","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/frame.styl","hash":"6ffbb29514781aa4fa7d7653706554ce33f4525b","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/friends.styl","hash":"8f9e60b94c02197e4555f923d357017742bf8d7b","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/ghcard.styl","hash":"58adb206695a704b1f40df42e2dc10e9e9055aeb","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/image.styl","hash":"bb4b07841602592e421597ba8dd7110edec789d8","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/link.styl","hash":"82cdcc537612eec3e1af40d00edf80b14116c191","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/media.styl","hash":"576c9eede3a8f9ec2ba1a970e92a49154ec3acb3","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/note.styl","hash":"005d3c55c2216d7c88661f79ad466ad89fad4784","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/span.styl","hash":"6e9f8b453244d9241d3fceed0a56e12c86a4b446","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/sites.styl","hash":"01593f3b8a233bc2c3193796707e4ed77df217bb","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/table.styl","hash":"ef07ab4fe8a391ea9039fbe53333aaf58e3ce033","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/swiper.styl","hash":"819385594f1825e26074ade900835a3f4031fe42","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/tabs.styl","hash":"a2366f4fe1d9f06e47a7a994cfc80a1edbf6c535","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/tag.json","hash":"506f87e397f258b097ba24ce16c33b5353bab462","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/text.styl","hash":"b2c2f3946fb611ad052c61d7309098edbf494c86","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_tag-plugins/timeline.styl","hash":"f84f411a3b7dcdbfd4fb19ac4e0f91300c5e19be","modified":1668682143000},{"_id":"themes/volantis/source/js/plugins/tags/contributors.js","hash":"cf1af362cf73c83a28ae2651eb1daafaed2ec91f","modified":1668682143000},{"_id":"themes/volantis/source/js/plugins/tags/friends.js","hash":"7d53cf366638d0e254f7f26de01c8892710d1d23","modified":1668682143000},{"_id":"themes/volantis/source/js/plugins/tags/sites.js","hash":"47b0ff4a3ccea2da9b60023cb4288f979504b0c7","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/_dark/dark_async.styl","hash":"a5da6f0b232a767057321fa51e382fd2d86bd98d","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/_dark/dark_plugins.styl","hash":"c56c2271847809e21e4938d770577622aeb161aa","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/_highlight/index.styl","hash":"6c681c760fa63425e7564c0d68532bb5ac95690a","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/_rightmenu/reading.styl","hash":"cb01065424dbd32c79b973b06fcdbc1c72917bc6","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/_rightmenu/rightmenu.styl","hash":"ef456a92173c303b61015f3581450aa14f0d2b41","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/_highlight/highlightjs/index.styl","hash":"38089b686a0cfdde555539c1c0c5b3fe402afada","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/_highlight/highlightjs/clipboard.styl","hash":"6818ba853fd6a319ff4eb50d228b1d625db9a0fd","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/_highlight/highlightjs/color.styl","hash":"319ccc46d5d387ee14a22e0de1a518288331629b","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/_highlight/highlightjs/language.styl","hash":"4fade2fe067f557d3b420d0b9a9d88d18feb9a72","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/_highlight/prismjs/clipboard.styl","hash":"0f92935e3bb9732b6e1cc7f305577144f1fe99a8","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/_highlight/prismjs/index.styl","hash":"215face68fab1c31cfa8d4c21941c72efe54cb78","modified":1668682143000},{"_id":"themes/volantis/source/css/_style/_plugins/_highlight/prismjs/language.styl","hash":"3af7fae25a0e2c54f0aacb1d8cbe383d5c1e60a5","modified":1668682143000},{"_id":"public/content.json","hash":"d62e433ec23eea0502fb906b75b36ff548194ebf","modified":1670139279766},{"_id":"public/about/index.html","hash":"5d855e48d0423db2fb1c0fc5a040cdf63ed7bb69","modified":1670139279766},{"_id":"public/blogger/index.html","hash":"5633251812c9430c8d83765120f28ab66b41268d","modified":1670139279766},{"_id":"public/category/index.html","hash":"1b8048558818b75b78c14d9d42eaedb2b22fe002","modified":1670139279766},{"_id":"public/donate/index.html","hash":"5001f359acc024b94e08cf34ca59d6198114b7e8","modified":1670139279766},{"_id":"public/friends/index.html","hash":"c09b91d32236a00166fa7b71837a065cf84f2a76","modified":1670139279766},{"_id":"public/tag/index.html","hash":"366774f206de369a8e420e64877a82bd24543986","modified":1670139279766},{"_id":"public/tagcloud/index.html","hash":"441232cf019e1c5831f2130cabf2d532c7a59014","modified":1670139279766},{"_id":"public/2022/12/04/2020-09-15-maven引入外部jar包的方式/index.html","hash":"44bb3708f9cdfa9382912440437982e26ce8f127","modified":1670139279766},{"_id":"public/2022/12/04/Arrays$asList()抛UnsupportedOperationException异常/index.html","hash":"84247e74621c60b393d5d52a63738c65f8b7ccfb","modified":1670139279766},{"_id":"public/2022/12/04/InnoDB几个索引数据结构的区别/index.html","hash":"262ebf61365aac68c43fb1faa883df7136915512","modified":1670139279766},{"_id":"public/2022/12/04/Centos安装jdk/index.html","hash":"c1863e28a3ab81e7a61535d2ac8d93ae83edf705","modified":1670139279766},{"_id":"public/2022/12/04/SpringBoot整合Swagger(spring-boot-starter-swagger)/index.html","hash":"1440b3761f299df04540bbc21452228c01d51dfd","modified":1670139279766},{"_id":"public/2022/12/04/cad/index.html","hash":"04ccf02ae4133c3c0fbf702454c63c98521c1c4c","modified":1670139279766},{"_id":"public/2022/12/04/JDK动态代理/index.html","hash":"ab0dd5735ddd418db2b31781f0f398993403cd33","modified":1670139279766},{"_id":"public/2022/12/04/quick_start_bat/index.html","hash":"a980de52a37e483a0eb756e6b3e28c368bf15827","modified":1670139279766},{"_id":"public/2022/12/04/reset-git-branch/index.html","hash":"991eb600aab4512b62a2b00daf8a4ce44669ece6","modified":1670139279766},{"_id":"public/2022/12/04/一个聚合浏览器打开的标签的插件/index.html","hash":"0f1ad5a011df2a9217e8d4defc748906a211cba1","modified":1670139279766},{"_id":"public/2022/12/04/代码实现单表的分库分表/index.html","hash":"c202e56c309685f659d1f500299da203e8484659","modified":1670139279766},{"_id":"public/2022/12/04/使用ssh登录远程服务器报错/index.html","hash":"e3c3ffb6f116c95c89f53cdfc9b06823f622c0e2","modified":1670139279766},{"_id":"public/2022/12/04/修改运行中的docker容器端口/index.html","hash":"28c945f55e1688c5aa97fbbd4c70bf45429a274b","modified":1670139279766},{"_id":"public/2022/12/04/数据库连接参数allowMultiQueries的作用/index.html","hash":"5a053754ede419e16dfc5606afc82075b0c85df8","modified":1670139279766},{"_id":"public/2022/12/04/填上IntegerCache的坑/index.html","hash":"538d27d87900cf8f552b09201a8a4e3ab5600d8f","modified":1670139279766},{"_id":"public/2022/12/04/给前端返回long类型造成精度损失/index.html","hash":"cf911ead269f2d1958eb6d47803db197d1743122","modified":1670139279766},{"_id":"public/2022/01/01/hello-world/index.html","hash":"52b47a2b6bd9dd056d85be7c9508f78a47404703","modified":1670139279766},{"_id":"public/categories/开发技巧/index.html","hash":"c5d816efbdbc78724a4cce3d48ea42d756c250e4","modified":1670139279766},{"_id":"public/categories/日常踩坑/index.html","hash":"5cf2f189d08552c15d5b23db76315c6395948a69","modified":1670139279766},{"_id":"public/categories/思考总结/index.html","hash":"dfb67ae002d88be7c108fd3f65076a9360bcc2cd","modified":1670139279766},{"_id":"public/categories/运维技巧/index.html","hash":"e40459f0b106ea9973f4aafbfc49ea9184063da2","modified":1670139279766},{"_id":"public/categories/小试牛刀/index.html","hash":"2ce6231902c80ad32ae388c207c6a384cb8ba470","modified":1670139279766},{"_id":"public/categories/生活/index.html","hash":"a7d58724bd71ae91657b43d30ee77a1e6a7fdf64","modified":1670139279766},{"_id":"public/categories/思考总结/jdk源码/index.html","hash":"606c33b81ff39cc3fb53e4c9fa7e1e2468ec6857","modified":1670139279766},{"_id":"public/categories/思考总结/Mysql/index.html","hash":"4061d13a6d58d73cadc56b717176f53aa3c4f70a","modified":1670139279766},{"_id":"public/categories/效率提升/index.html","hash":"314b28a27e085a74ec520fb08a48eebdf5262d3b","modified":1670139279766},{"_id":"public/categories/思考总结/数据库优化/index.html","hash":"b467ab4ab19886272638a6645b15031c6962b807","modified":1670139279766},{"_id":"public/archives/index.html","hash":"8b33670c8d38abe3cbd3df9b31b5239107a289a4","modified":1670139279766},{"_id":"public/archives/page/2/index.html","hash":"11d1fb3594abec6283b4d52716e42301cd35d2cc","modified":1670139279766},{"_id":"public/archives/2022/index.html","hash":"587ffd9074af8f996884c94cca4503c0201676bd","modified":1670139279766},{"_id":"public/archives/2022/page/2/index.html","hash":"4f57daa9c1d0ddb6bdafd50596e08b31e7057e4d","modified":1670139279766},{"_id":"public/archives/2022/01/index.html","hash":"23e151143b74fd4e5e3f2944befe7d34c332d503","modified":1670139279766},{"_id":"public/archives/2022/12/index.html","hash":"9eef0c0a0c5a58591bc9b12a5c23daf8c3e744a9","modified":1670139279766},{"_id":"public/archives/2022/12/page/2/index.html","hash":"9a4df934dd2c2ea01dc353c96354ae88eb5ba422","modified":1670139279766},{"_id":"public/index.html","hash":"3a1100176a600a6ac97756ff686cb99fc10fa24a","modified":1670139279766},{"_id":"public/page/2/index.html","hash":"d06fece962dafddc96cbe5d5102ec33070159d04","modified":1670139279766},{"_id":"public/tags/日常开发/index.html","hash":"c61f23a26cf50e41a3a2ad29dc0916bdabee2a53","modified":1670139279766},{"_id":"public/tags/Arrays/index.html","hash":"a795064ce8a75865d6bced86ef2b74cea2ae10a3","modified":1670139279766},{"_id":"public/tags/视图/index.html","hash":"2edea65878745087622bbc6f09b428b3db3f9606","modified":1670139279766},{"_id":"public/tags/踩坑/index.html","hash":"5716334b630b64156cee35543d39ba56cdd2305b","modified":1670139279766},{"_id":"public/tags/InnoDB索引/index.html","hash":"511b964968320e3586c6d4a5a3b84b2796b0b8ea","modified":1670139279766},{"_id":"public/tags/Mysql/index.html","hash":"dfb52295a35be93c5a92d5aef53973e1988bef85","modified":1670139279766},{"_id":"public/tags/数据结构/index.html","hash":"6bd6b94309f7e4b80cab44f04298df780804b150","modified":1670139279766},{"_id":"public/tags/jdk按照/index.html","hash":"62c651db625357d08c092b0672a8975e3d4844fa","modified":1670139279766},{"_id":"public/tags/centos/index.html","hash":"65558d035b0dd449396d993707b4f21712915da7","modified":1670139279766},{"_id":"public/tags/Swagger/index.html","hash":"0cbaa6eefa496c37035c89b5f8a98221f6e0ce67","modified":1670139279766},{"_id":"public/tags/springboot/index.html","hash":"f4106bbc63e4aa6c12be2e8d49d3436782754b25","modified":1670139279766},{"_id":"public/tags/接口文档/index.html","hash":"d9f6eab11833078c79b3e94dceda4f04147ac580","modified":1670139279766},{"_id":"public/tags/破解软件/index.html","hash":"f75359b8a617027c08588603be4aee428881d514","modified":1670139279766},{"_id":"public/tags/设计模式/index.html","hash":"884847333b23fc226c541e600dfce98b8fe4c03a","modified":1670139279766},{"_id":"public/tags/源码/index.html","hash":"fa2141bace2982eb43f90b18ac3b26fcd2059b1a","modified":1670139279766},{"_id":"public/tags/AOP/index.html","hash":"d2dc445671eaceaab186f4b23ed9017dc8a07d3b","modified":1670139279766},{"_id":"public/tags/bat/index.html","hash":"ed347adc15a1df1f495d0015c9e52797d0d06e1c","modified":1670139279766},{"_id":"public/tags/脚本/index.html","hash":"5b13d0f59326a997d07a487f6f375096813b8412","modified":1670139279766},{"_id":"public/tags/便捷开发/index.html","hash":"a33c18a339721d1125a4384a214e2a9faa0ba069","modified":1670139279766},{"_id":"public/tags/shell/index.html","hash":"d8a98522692e66f475f661b9e1b62177eef71cea","modified":1670139279766},{"_id":"public/tags/git-branch/index.html","hash":"828b6fd4a90e542e10d54ade22963eb635904b71","modified":1670139279766},{"_id":"public/tags/实用功能/index.html","hash":"c1070eab7b52b6a3b642cf8a81e87d0e40d2f255","modified":1670139279766},{"_id":"public/tags/Chrome插件/index.html","hash":"1628ed3d0fcdfa20760063abbeeb24a1022f960a","modified":1670139279766},{"_id":"public/tags/分库分表/index.html","hash":"c63343699ffa663d582d2c7b79d871b08a8aa4f8","modified":1670139279766},{"_id":"public/tags/性能优化/index.html","hash":"6529bf32971b9eeecdf0391cd56103bdab793f8c","modified":1670139279766},{"_id":"public/tags/SHH/index.html","hash":"3561325764b0f7cd1efa531d74d9d3f3b44883df","modified":1670139279766},{"_id":"public/tags/docker容器/index.html","hash":"e13789f790ad049f910f6a94e4083ad8f15b6639","modified":1670139279766},{"_id":"public/tags/数据库/index.html","hash":"5150fed22f0731899022c532b518916b41249aa2","modified":1670139279766},{"_id":"public/tags/Integer/index.html","hash":"e437ce32cd7be518613311a057e3e799022839ac","modified":1670139279766},{"_id":"public/tags/IntegerCache/index.html","hash":"2d996436d81028cb82b32a1e74730e1dd7ecbac8","modified":1670139279766},{"_id":"public/tags/js类型/index.html","hash":"5eff48539d821c6af1baf29a5a4c2a9c99c3a87a","modified":1670139279766},{"_id":"public/css/Readme.html","hash":"c9912722e1c7a72fbc45b4087424f819fa47013a","modified":1670139279766},{"_id":"public/js/plugins/aplayer.js","hash":"95f2e47535c8d37e90cab7726d25845cf01ca477","modified":1670139279766},{"_id":"public/js/plugins/parallax.js","hash":"3c3210bde6e86d7d157c34c14796abe98cb1bbd0","modified":1670139279766},{"_id":"public/js/search/algolia.js","hash":"2ffd94936b985028d77e4be7eaa86bb9d77f1bac","modified":1670139279766},{"_id":"public/js/search/hexo.js","hash":"7dc583642bc3f437506c4de3e5d0ce569f35bf21","modified":1670139279766},{"_id":"public/js/plugins/tags/contributors.js","hash":"cf1af362cf73c83a28ae2651eb1daafaed2ec91f","modified":1670139279766},{"_id":"public/js/search/meilisearch.js","hash":"4dab716aa00bc36133010cb9ca7e85dff42a11cc","modified":1670139279766},{"_id":"public/js/plugins/tags/friends.js","hash":"7d53cf366638d0e254f7f26de01c8892710d1d23","modified":1670139279766},{"_id":"public/js/plugins/tags/sites.js","hash":"47b0ff4a3ccea2da9b60023cb4288f979504b0c7","modified":1670139279766},{"_id":"public/css/style.css","hash":"5b97a59c4348bf3f08943713f70e85666a64e1e1","modified":1670139279766},{"_id":"public/css/first.css","hash":"2a310a9bf33b4b01fe6d83f2a7252f0da7790e5b","modified":1670139279766},{"_id":"public/js/app.js","hash":"af7c0cc26b2c9e103674f3dca8dc96af2c490da8","modified":1670139279766},{"_id":"public/js/plugins/rightMenus.js","hash":"2bc72bb349e2639a730abc794cbaefc3e6e30874","modified":1670139279766}],"Category":[{"name":"开发技巧","_id":"clb91t0lc00079sjn4oqi4tsx"},{"name":"日常踩坑","_id":"clb91t0lg000d9sjn505423wp"},{"name":"思考总结","_id":"clb91t0ll000k9sjn8mozhx3r"},{"name":"运维技巧","_id":"clb91t0ln000p9sjn6xi87ben"},{"name":"小试牛刀","_id":"clb91t0ls000v9sjn1jjfhcsi"},{"name":"生活","_id":"clb91t0lu00119sjng5g92kig"},{"name":"jdk源码","parent":"clb91t0ll000k9sjn8mozhx3r","_id":"clb91t0lw00179sjn2rh45qk8"},{"name":"Mysql","parent":"clb91t0ll000k9sjn8mozhx3r","_id":"clb91t0ly001c9sjn4b001038"},{"name":"效率提升","_id":"clb91t0lz001j9sjn3uhk41ke"},{"name":"数据库优化","parent":"clb91t0ll000k9sjn8mozhx3r","_id":"clb91t0m2001x9sjn4gnebpp7"}],"Data":[],"Page":[{"layout":"docs","seo_title":"关于我","bottom_meta":false,"sidebar":[],"twikoo":{"placeholder":"嗯哼~"},"_content":"","source":"about/index.md","raw":"---\nlayout: docs\nseo_title: 关于我\nbottom_meta: false\nsidebar: []\ntwikoo:\n  placeholder: 嗯哼~\n---","date":"2022-11-27T17:13:47.801Z","updated":"2022-11-27T17:13:47.801Z","path":"about/index.html","title":"","comments":1,"_id":"clb91t0kz00009sjngxleesev","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"blogger","date":"2022-11-27T14:29:46.000Z","_content":"","source":"blogger/index.md","raw":"---\ntitle: blogger\ndate: 2022-11-27 22:29:46\n---\n","updated":"2022-11-27T14:29:46.656Z","path":"blogger/index.html","comments":1,"layout":"page","_id":"clb91t0l600029sjn8nhycexn","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"donate","date":"2022-11-27T14:29:56.000Z","_content":"","source":"donate/index.md","raw":"---\ntitle: donate\ndate: 2022-11-27 22:29:56\n---\n","updated":"2022-11-27T14:29:56.894Z","path":"donate/index.html","comments":1,"layout":"page","_id":"clb91t0lb00059sjn01p03ico","content":"","site":{"data":{}},"excerpt":"","more":""},{"layout":"category","index":true,"title":"分类","_content":"","source":"category/index.md","raw":"---\nlayout: category\nindex: true\ntitle: 分类\n---\n","date":"2022-11-27T17:13:52.532Z","updated":"2022-11-27T17:13:52.532Z","path":"category/index.html","comments":1,"_id":"clb91t0ld00089sjn74e4gb5h","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"","layout":"friends","_content":"O(∩_∩)O\n\n<!--more-->\n暂无\n","source":"friends/index.md","raw":"---\ntitle: \nlayout: friends\n---\nO(∩_∩)O\n\n<!--more-->\n暂无\n","date":"2022-11-27T17:13:57.651Z","updated":"2022-11-27T17:13:57.651Z","path":"friends/index.html","comments":1,"_id":"clb91t0lf000a9sjngzpa02ts","content":"<p>O(∩_∩)O</p>\n<span id=\"more\"></span>\n<p>暂无</p>\n","site":{"data":{}},"excerpt":"<p>O(∩_∩)O</p>","more":"<p>暂无</p>"},{"layout":"tag","index":true,"title":"标签","_content":"","source":"tag/index.md","raw":"---\nlayout: tag\nindex: true\ntitle: 标签\n---\n","date":"2022-11-27T17:13:55.171Z","updated":"2022-11-27T17:13:55.171Z","path":"tag/index.html","comments":1,"_id":"clb91t0lh000f9sjn1c7ec57z","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tagcloud","date":"2022-11-27T14:29:51.000Z","_content":"","source":"tagcloud/index.md","raw":"---\ntitle: tagcloud\ndate: 2022-11-27 22:29:51\n---\n","updated":"2022-11-27T14:29:51.851Z","path":"tagcloud/index.html","comments":1,"layout":"page","_id":"clb91t0lj000h9sjn4rko8tkj","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"Maven引入外部jar包的方式","date":"2022-12-04T06:38:00.000Z","_content":"当我们遇到没有上传到maven仓库中但又需要导入本地项目使用的jar包时，可以参考maven引入外部jar包的方式，在本地开发环境直接引入相关的jar包进行使用，不过部署到生产项目时，不要忘记同时推到私仓里。\n<!-- more -->\n##### 一、dependency 本地jar包\n\n```html\n<dependency>\n    <groupId>com.dataozi</groupId>  <!--自定义-->\n    <artifactId>sdk</artifactId>    <!--自定义-->\n    <version>1.0.0</version> <!--自定义-->\n    <scope>system</scope> <!--system，类似provided，需要显式提供依赖的jar以后，Maven就不会在Repository中查找它-->\n    <systemPath>${libpath}/lib/sdk-1.0.0.jar</systemPath> <!--项目根目录下的lib文件夹下-->\n</dependency> \n```\n\n##### 二、编译阶段指定外部lib\n\n```html\n<plugin>\n     <artifactId>maven-compiler-plugin</artifactId>\n     <version>2.3.2</version>\n     <configuration>\n     <source>1.8</source>\n     <target>1.8</target>\n     <encoding>UTF-8</encoding>\n     <compilerArguments>\n     <extdirs>lib</extdirs><!--指定外部lib-->\n     </compilerArguments>\n     </configuration>\n</plugin>\n```\n\n##### 三、将外部jar打入本地maven仓库(推荐)\n\n使用maven命令在指定maven仓库路径打好jar包\n\n> ```sh\n> mvn install:install-file -Dfile=${jar包路径} -DgroupId=${groupId} -DartifactId=${artifactId} -Dversion=${指定版本} -Dpackaging=${指定打包方式}\n> ```\n\n> ```sh\n> mvn install:install-file -Dfile=test.jar -DgroupId=com.dataozi -DartifactId=sdk -Dversion=1.0.0 -Dpackaging=jar\n> ```\n\n在项目中直接引入jar包\n\n```html\n<dependency>\n     <groupId>com.dataozi</groupId>\n     <artifactId>sdk</artifactId>\n     <version>1.0.0</version>\n</dependency>\n```\n","source":"_posts/2020-09-15-maven引入外部jar包的方式.md","raw":"---\ntitle: Maven引入外部jar包的方式\ndate: 2022-12-04 14:38\ncategories: \n- [开发技巧]\ntags:\n  - 日常开发\n---\n当我们遇到没有上传到maven仓库中但又需要导入本地项目使用的jar包时，可以参考maven引入外部jar包的方式，在本地开发环境直接引入相关的jar包进行使用，不过部署到生产项目时，不要忘记同时推到私仓里。\n<!-- more -->\n##### 一、dependency 本地jar包\n\n```html\n<dependency>\n    <groupId>com.dataozi</groupId>  <!--自定义-->\n    <artifactId>sdk</artifactId>    <!--自定义-->\n    <version>1.0.0</version> <!--自定义-->\n    <scope>system</scope> <!--system，类似provided，需要显式提供依赖的jar以后，Maven就不会在Repository中查找它-->\n    <systemPath>${libpath}/lib/sdk-1.0.0.jar</systemPath> <!--项目根目录下的lib文件夹下-->\n</dependency> \n```\n\n##### 二、编译阶段指定外部lib\n\n```html\n<plugin>\n     <artifactId>maven-compiler-plugin</artifactId>\n     <version>2.3.2</version>\n     <configuration>\n     <source>1.8</source>\n     <target>1.8</target>\n     <encoding>UTF-8</encoding>\n     <compilerArguments>\n     <extdirs>lib</extdirs><!--指定外部lib-->\n     </compilerArguments>\n     </configuration>\n</plugin>\n```\n\n##### 三、将外部jar打入本地maven仓库(推荐)\n\n使用maven命令在指定maven仓库路径打好jar包\n\n> ```sh\n> mvn install:install-file -Dfile=${jar包路径} -DgroupId=${groupId} -DartifactId=${artifactId} -Dversion=${指定版本} -Dpackaging=${指定打包方式}\n> ```\n\n> ```sh\n> mvn install:install-file -Dfile=test.jar -DgroupId=com.dataozi -DartifactId=sdk -Dversion=1.0.0 -Dpackaging=jar\n> ```\n\n在项目中直接引入jar包\n\n```html\n<dependency>\n     <groupId>com.dataozi</groupId>\n     <artifactId>sdk</artifactId>\n     <version>1.0.0</version>\n</dependency>\n```\n","slug":"2020-09-15-maven引入外部jar包的方式","published":1,"updated":"2022-12-04T07:12:53.030Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clb91t0l200019sjnb3z870x5","content":"<p>当我们遇到没有上传到maven仓库中但又需要导入本地项目使用的jar包时，可以参考maven引入外部jar包的方式，在本地开发环境直接引入相关的jar包进行使用，不过部署到生产项目时，不要忘记同时推到私仓里。</p>\n<span id=\"more\"></span>\n<h5 id=\"一、dependency-本地jar包\"><a href=\"#一、dependency-本地jar包\" class=\"headerlink\" title=\"一、dependency 本地jar包\"></a>一、dependency 本地jar包</h5><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.dataozi<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span>  <span class=\"comment\">&lt;!--自定义--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>sdk<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span>    <span class=\"comment\">&lt;!--自定义--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span> <span class=\"comment\">&lt;!--自定义--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span> <span class=\"comment\">&lt;!--system，类似provided，需要显式提供依赖的jar以后，Maven就不会在Repository中查找它--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">systemPath</span>&gt;</span>$&#123;libpath&#125;/lib/sdk-1.0.0.jar<span class=\"tag\">&lt;/<span class=\"name\">systemPath</span>&gt;</span> <span class=\"comment\">&lt;!--项目根目录下的lib文件夹下--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span> </span><br></pre></td></tr></table></figure>\n\n<h5 id=\"二、编译阶段指定外部lib\"><a href=\"#二、编译阶段指定外部lib\" class=\"headerlink\" title=\"二、编译阶段指定外部lib\"></a>二、编译阶段指定外部lib</h5><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.3.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">encoding</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">compilerArguments</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">extdirs</span>&gt;</span>lib<span class=\"tag\">&lt;/<span class=\"name\">extdirs</span>&gt;</span><span class=\"comment\">&lt;!--指定外部lib--&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;/<span class=\"name\">compilerArguments</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"三、将外部jar打入本地maven仓库-推荐\"><a href=\"#三、将外部jar打入本地maven仓库-推荐\" class=\"headerlink\" title=\"三、将外部jar打入本地maven仓库(推荐)\"></a>三、将外部jar打入本地maven仓库(推荐)</h5><p>使用maven命令在指定maven仓库路径打好jar包</p>\n<blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn install:install-file -Dfile=<span class=\"variable\">$&#123;jar包路径&#125;</span> -DgroupId=<span class=\"variable\">$&#123;groupId&#125;</span> -DartifactId=<span class=\"variable\">$&#123;artifactId&#125;</span> -Dversion=<span class=\"variable\">$&#123;指定版本&#125;</span> -Dpackaging=<span class=\"variable\">$&#123;指定打包方式&#125;</span></span><br></pre></td></tr></table></figure>\n</blockquote>\n<blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn install:install-file -Dfile=test.jar -DgroupId=com.dataozi -DartifactId=sdk -Dversion=1.0.0 -Dpackaging=jar</span><br></pre></td></tr></table></figure>\n</blockquote>\n<p>在项目中直接引入jar包</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.dataozi<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>sdk<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>当我们遇到没有上传到maven仓库中但又需要导入本地项目使用的jar包时，可以参考maven引入外部jar包的方式，在本地开发环境直接引入相关的jar包进行使用，不过部署到生产项目时，不要忘记同时推到私仓里。</p>","more":"<h5 id=\"一、dependency-本地jar包\"><a href=\"#一、dependency-本地jar包\" class=\"headerlink\" title=\"一、dependency 本地jar包\"></a>一、dependency 本地jar包</h5><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.dataozi<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span>  <span class=\"comment\">&lt;!--自定义--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>sdk<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span>    <span class=\"comment\">&lt;!--自定义--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span> <span class=\"comment\">&lt;!--自定义--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span> <span class=\"comment\">&lt;!--system，类似provided，需要显式提供依赖的jar以后，Maven就不会在Repository中查找它--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">systemPath</span>&gt;</span>$&#123;libpath&#125;/lib/sdk-1.0.0.jar<span class=\"tag\">&lt;/<span class=\"name\">systemPath</span>&gt;</span> <span class=\"comment\">&lt;!--项目根目录下的lib文件夹下--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span> </span><br></pre></td></tr></table></figure>\n\n<h5 id=\"二、编译阶段指定外部lib\"><a href=\"#二、编译阶段指定外部lib\" class=\"headerlink\" title=\"二、编译阶段指定外部lib\"></a>二、编译阶段指定外部lib</h5><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.3.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">encoding</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">compilerArguments</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">extdirs</span>&gt;</span>lib<span class=\"tag\">&lt;/<span class=\"name\">extdirs</span>&gt;</span><span class=\"comment\">&lt;!--指定外部lib--&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;/<span class=\"name\">compilerArguments</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"三、将外部jar打入本地maven仓库-推荐\"><a href=\"#三、将外部jar打入本地maven仓库-推荐\" class=\"headerlink\" title=\"三、将外部jar打入本地maven仓库(推荐)\"></a>三、将外部jar打入本地maven仓库(推荐)</h5><p>使用maven命令在指定maven仓库路径打好jar包</p>\n<blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn install:install-file -Dfile=<span class=\"variable\">$&#123;jar包路径&#125;</span> -DgroupId=<span class=\"variable\">$&#123;groupId&#125;</span> -DartifactId=<span class=\"variable\">$&#123;artifactId&#125;</span> -Dversion=<span class=\"variable\">$&#123;指定版本&#125;</span> -Dpackaging=<span class=\"variable\">$&#123;指定打包方式&#125;</span></span><br></pre></td></tr></table></figure>\n</blockquote>\n<blockquote>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn install:install-file -Dfile=test.jar -DgroupId=com.dataozi -DartifactId=sdk -Dversion=1.0.0 -Dpackaging=jar</span><br></pre></td></tr></table></figure>\n</blockquote>\n<p>在项目中直接引入jar包</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.dataozi<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>sdk<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sun Dec 04 2022 15:12:53 GMT+0800 (中国标准时间)","title":"Maven引入外部jar包的方式","path":"2022/12/04/2020-09-15-maven引入外部jar包的方式/","eyeCatchImage":null,"excerpt":"<p>当我们遇到没有上传到maven仓库中但又需要导入本地项目使用的jar包时，可以参考maven引入外部jar包的方式，在本地开发环境直接引入相关的jar包进行使用，不过部署到生产项目时，不要忘记同时推到私仓里。</p>","date":{"_isAMomentObject":true,"_i":"2022-12-04T06:38:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-12-04T06:38:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"开发技巧","tags":["日常开发"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"Arrays$asList()抛UnsupportedOperationException异常","date":"2022-12-04T06:38:00.000Z","_content":"\n> 今天写代码时遇到一个很奇怪的问题，我很主观的利用Arrays.asList()方法返回一个List，然后对该List进行了add()方法的调用，结果竟然抛了异常。将问题原因记录一下。\n> <!--more-->\n> **示例代码：**\n\n~~~java\n@org.junit.Test\npublic void test(){\n    List<String> list = Arrays.asList(\"aa\",\"bb\");\n    boolean cc = list.add(\"cc\");\n\n    System.out.println(list);\n}\n~~~\n\n**报错如下：**\n\n~~~java\njava.lang.UnsupportedOperationException\n\tat java.util.AbstractList.add(AbstractList.java:148)\n\tat java.util.AbstractList.add(AbstractList.java:108)\n\tat com.chuangkit.design.center.assist.impl.Test.test(Test.java:19)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n\tat org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)\n\tat org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)\n\tat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)\n\tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)\n\tat org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)\n\tat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)\n\tat org.junit.runners.ParentRunner.run(ParentRunner.java:363)\n\tat org.junit.runner.JUnitCore.run(JUnitCore.java:137)\n\tat com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)\n\tat com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:33)\n\tat com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:221)\n\tat com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:54)\n~~~\n\n#### 1.接下来我们看下源码，排查异常产生的原因\n\n我们点进asList()方法看下源码是怎么实现的。\n\n~~~java\n@SafeVarargs\n@SuppressWarnings(\"varargs\")\npublic static <T> List<T> asList(T... a) {\n    return new ArrayList<>(a);\n}\n~~~\n\n这里发现这不是返回的就是一个new出来的ArrayList集合对象吗，没有什么问题啊，别着急，我们在进到ArrayList看看猫腻。\n\n~~~java\n/**\n     * @serial include\n     */\n    private static class ArrayList<E> extends AbstractList<E>\n        implements RandomAccess, java.io.Serializable\n    {\n        private static final long serialVersionUID = -2764017481108945198L;\n        private final E[] a;\n\n        ArrayList(E[] array) {\n            a = Objects.requireNonNull(array);\n        }\n\n        @Override\n        public int size() {\n            return a.length;\n        }\n\n        @Override\n        public Object[] toArray() {\n            return a.clone();\n        }\n\n        @Override\n        @SuppressWarnings(\"unchecked\")\n        public <T> T[] toArray(T[] a) {\n            int size = size();\n            if (a.length < size)\n                return Arrays.copyOf(this.a, size,\n                                     (Class<? extends T[]>) a.getClass());\n            System.arraycopy(this.a, 0, a, 0, size);\n            if (a.length > size)\n                a[size] = null;\n            return a;\n        }\n\n        @Override\n        public E get(int index) {\n            return a[index];\n        }\n\n        @Override\n        public E set(int index, E element) {\n            E oldValue = a[index];\n            a[index] = element;\n            return oldValue;\n        }\n\n        @Override\n        public int indexOf(Object o) {\n            E[] a = this.a;\n            if (o == null) {\n                for (int i = 0; i < a.length; i++)\n                    if (a[i] == null)\n                        return i;\n            } else {\n                for (int i = 0; i < a.length; i++)\n                    if (o.equals(a[i]))\n                        return i;\n            }\n            return -1;\n        }\n\n        @Override\n        public boolean contains(Object o) {\n            return indexOf(o) != -1;\n        }\n\n        @Override\n        public Spliterator<E> spliterator() {\n            return Spliterators.spliterator(a, Spliterator.ORDERED);\n        }\n\n        @Override\n        public void forEach(Consumer<? super E> action) {\n            Objects.requireNonNull(action);\n            for (E e : a) {\n                action.accept(e);\n            }\n        }\n\n        @Override\n        public void replaceAll(UnaryOperator<E> operator) {\n            Objects.requireNonNull(operator);\n            E[] a = this.a;\n            for (int i = 0; i < a.length; i++) {\n                a[i] = operator.apply(a[i]);\n            }\n        }\n\n        @Override\n        public void sort(Comparator<? super E> c) {\n            Arrays.sort(a, c);\n        }\n    }\n~~~\n\n这时我们发现，此ArrayList并不是我们常用的java.util包下的，而是Arrays类自己实现的一个静态内部类，该内部类继承了AbstractList抽象类，我们知道AbstractList是实现了List接口的，而AbstractList本身也是一个抽象类，并没有对add等方法进行实现，Arrays$ArrayList虽然继承了AbstractList，但是也没有对add等方法进行实现，所以当我们调用该内部类的add方法时就抛出UnsupportedOperationException异常。\n\n~~~java\n// 1.首先我们看ArrayList继承了AbstractList\nprivate static class ArrayList<E> extends AbstractList<E>\n        implements RandomAccess, java.io.Serializable\n    {\n\n// 2.然后AbstractList又实现了List接口\npublic abstract class AbstractList<E> extends AbstractCollection<E> \n\t\timplements List<E> \n\t{\n\n// 3.在List的add方法注释上可以看到如果实现类没有实现add方法就会抛异常\n/**\n  * ...\n  * @throws UnsupportedOperationException if the {@code add} operation\n  *         is not supported by this list\n  * ...\n  */\npublic boolean add(E e) {\n    add(size(), e);\n    return true;\n}\n~~~\n\n#### 2.问题我们找到了，接下来我们想一想为什么Arrays要自己实现一个ArrayList呢\n\n我们先看下源码注释是怎么说的（摘自于asList方法注释）\n\n~~~java\n/**\n  * Returns a fixed-size list backed by the specified array.  (Changes to\n  * the returned list \"write through\" to the array.)  This method acts\n  * as bridge between array-based and collection-based APIs, in\n  * combination with {@link Collection#toArray}.  The returned list is\n  * serializable and implements {@link RandomAccess}.\n  *\n  * <p>This method also provides a convenient way to create a fixed-size\n  * list initialized to contain several elements:\n  * ...\n  * 返回由指定数组支持的固定大小列表。（更改返回的列表“直写”到数组。）\n  * 此方法与 {@link Collection#toArray} 结合，充当基于数组和基于集合的 API 之间的桥梁。\n  * 返回的列表是可序列化的并实现了 {@link RandomAccess}。此方法还提供了一种创建固定大小列表\n  * 的便捷方法，该列表已初始化为包含多个元素。\n  * ...\n  * @return a list view of the specified array\n  * 指定数组的列表视图\n  */\n~~~\n\n* **asList方法返回的是当前数组的的列表视图**，当我们改变原始数组的数据时，这个\"视图\"\n  会自然而然的同步改变，因为它就是当前数组的一个展现形式，如果返回的是java.util包下的ArrayList，无疑会创建一个新的数组来代替当前数组，并且我们新的数据进行修改，原数组的数据也不会发生改变。\n* **asList方法返回的是一个固定大小列表**，也就是说只要数组创建了，我们无法向数组中添加新的元素，只能对现有元素进行替换和查找，并且不能删除元素。这个java.util包下的ArrayList也是无法做到的。\n* **此方法充当基于数组的API和基于集合的API之间的桥梁**，这句话也体现了，asList方法本身就不是一个真正意义上的集合方法，只是在基于两者的API基础上做了一个衔接。\n\n#### 3.总结\n\nArrays$asList()本身并没有创建和返回一个新的集合对象，返回的仍然是描述原数组的视图，也就是该\"集合\"\n只满足对数组的操作，一但声明集合大小不能修改、不能直接删除某个元素等等；也就是说当我们通过asList方法将数组转成集合之后，我们对该集合的操作仅仅满足于对一个数组的操作，那么我们是可以使用这个方法的，如果想要得到的集合满足于一个真实集合对象的使用，那么这个方法是不适用的，我们这时候需要将数组复制到一个新的数组支持集合的创建，比如\n\n~~~java\n@org.junit.Test\npublic void test(){\n    List<String> list = Arrays.asList(\"aa\",\"bb\");\n\n    List<String> temp = new ArrayList<>(list);\n    temp.add(\"cc\");\n\n    System.out.println(temp);\n}\n~~~\n","source":"_posts/Arrays$asList()抛UnsupportedOperationException异常.md","raw":"---\ntitle: Arrays$asList()抛UnsupportedOperationException异常\ndate: 2022-12-04 14:38\ncategories: \n- [日常踩坑]\ntags:\n- Arrays\n- 视图\n- 踩坑\n---\n\n> 今天写代码时遇到一个很奇怪的问题，我很主观的利用Arrays.asList()方法返回一个List，然后对该List进行了add()方法的调用，结果竟然抛了异常。将问题原因记录一下。\n> <!--more-->\n> **示例代码：**\n\n~~~java\n@org.junit.Test\npublic void test(){\n    List<String> list = Arrays.asList(\"aa\",\"bb\");\n    boolean cc = list.add(\"cc\");\n\n    System.out.println(list);\n}\n~~~\n\n**报错如下：**\n\n~~~java\njava.lang.UnsupportedOperationException\n\tat java.util.AbstractList.add(AbstractList.java:148)\n\tat java.util.AbstractList.add(AbstractList.java:108)\n\tat com.chuangkit.design.center.assist.impl.Test.test(Test.java:19)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n\tat org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)\n\tat org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)\n\tat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)\n\tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)\n\tat org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)\n\tat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)\n\tat org.junit.runners.ParentRunner.run(ParentRunner.java:363)\n\tat org.junit.runner.JUnitCore.run(JUnitCore.java:137)\n\tat com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)\n\tat com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:33)\n\tat com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:221)\n\tat com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:54)\n~~~\n\n#### 1.接下来我们看下源码，排查异常产生的原因\n\n我们点进asList()方法看下源码是怎么实现的。\n\n~~~java\n@SafeVarargs\n@SuppressWarnings(\"varargs\")\npublic static <T> List<T> asList(T... a) {\n    return new ArrayList<>(a);\n}\n~~~\n\n这里发现这不是返回的就是一个new出来的ArrayList集合对象吗，没有什么问题啊，别着急，我们在进到ArrayList看看猫腻。\n\n~~~java\n/**\n     * @serial include\n     */\n    private static class ArrayList<E> extends AbstractList<E>\n        implements RandomAccess, java.io.Serializable\n    {\n        private static final long serialVersionUID = -2764017481108945198L;\n        private final E[] a;\n\n        ArrayList(E[] array) {\n            a = Objects.requireNonNull(array);\n        }\n\n        @Override\n        public int size() {\n            return a.length;\n        }\n\n        @Override\n        public Object[] toArray() {\n            return a.clone();\n        }\n\n        @Override\n        @SuppressWarnings(\"unchecked\")\n        public <T> T[] toArray(T[] a) {\n            int size = size();\n            if (a.length < size)\n                return Arrays.copyOf(this.a, size,\n                                     (Class<? extends T[]>) a.getClass());\n            System.arraycopy(this.a, 0, a, 0, size);\n            if (a.length > size)\n                a[size] = null;\n            return a;\n        }\n\n        @Override\n        public E get(int index) {\n            return a[index];\n        }\n\n        @Override\n        public E set(int index, E element) {\n            E oldValue = a[index];\n            a[index] = element;\n            return oldValue;\n        }\n\n        @Override\n        public int indexOf(Object o) {\n            E[] a = this.a;\n            if (o == null) {\n                for (int i = 0; i < a.length; i++)\n                    if (a[i] == null)\n                        return i;\n            } else {\n                for (int i = 0; i < a.length; i++)\n                    if (o.equals(a[i]))\n                        return i;\n            }\n            return -1;\n        }\n\n        @Override\n        public boolean contains(Object o) {\n            return indexOf(o) != -1;\n        }\n\n        @Override\n        public Spliterator<E> spliterator() {\n            return Spliterators.spliterator(a, Spliterator.ORDERED);\n        }\n\n        @Override\n        public void forEach(Consumer<? super E> action) {\n            Objects.requireNonNull(action);\n            for (E e : a) {\n                action.accept(e);\n            }\n        }\n\n        @Override\n        public void replaceAll(UnaryOperator<E> operator) {\n            Objects.requireNonNull(operator);\n            E[] a = this.a;\n            for (int i = 0; i < a.length; i++) {\n                a[i] = operator.apply(a[i]);\n            }\n        }\n\n        @Override\n        public void sort(Comparator<? super E> c) {\n            Arrays.sort(a, c);\n        }\n    }\n~~~\n\n这时我们发现，此ArrayList并不是我们常用的java.util包下的，而是Arrays类自己实现的一个静态内部类，该内部类继承了AbstractList抽象类，我们知道AbstractList是实现了List接口的，而AbstractList本身也是一个抽象类，并没有对add等方法进行实现，Arrays$ArrayList虽然继承了AbstractList，但是也没有对add等方法进行实现，所以当我们调用该内部类的add方法时就抛出UnsupportedOperationException异常。\n\n~~~java\n// 1.首先我们看ArrayList继承了AbstractList\nprivate static class ArrayList<E> extends AbstractList<E>\n        implements RandomAccess, java.io.Serializable\n    {\n\n// 2.然后AbstractList又实现了List接口\npublic abstract class AbstractList<E> extends AbstractCollection<E> \n\t\timplements List<E> \n\t{\n\n// 3.在List的add方法注释上可以看到如果实现类没有实现add方法就会抛异常\n/**\n  * ...\n  * @throws UnsupportedOperationException if the {@code add} operation\n  *         is not supported by this list\n  * ...\n  */\npublic boolean add(E e) {\n    add(size(), e);\n    return true;\n}\n~~~\n\n#### 2.问题我们找到了，接下来我们想一想为什么Arrays要自己实现一个ArrayList呢\n\n我们先看下源码注释是怎么说的（摘自于asList方法注释）\n\n~~~java\n/**\n  * Returns a fixed-size list backed by the specified array.  (Changes to\n  * the returned list \"write through\" to the array.)  This method acts\n  * as bridge between array-based and collection-based APIs, in\n  * combination with {@link Collection#toArray}.  The returned list is\n  * serializable and implements {@link RandomAccess}.\n  *\n  * <p>This method also provides a convenient way to create a fixed-size\n  * list initialized to contain several elements:\n  * ...\n  * 返回由指定数组支持的固定大小列表。（更改返回的列表“直写”到数组。）\n  * 此方法与 {@link Collection#toArray} 结合，充当基于数组和基于集合的 API 之间的桥梁。\n  * 返回的列表是可序列化的并实现了 {@link RandomAccess}。此方法还提供了一种创建固定大小列表\n  * 的便捷方法，该列表已初始化为包含多个元素。\n  * ...\n  * @return a list view of the specified array\n  * 指定数组的列表视图\n  */\n~~~\n\n* **asList方法返回的是当前数组的的列表视图**，当我们改变原始数组的数据时，这个\"视图\"\n  会自然而然的同步改变，因为它就是当前数组的一个展现形式，如果返回的是java.util包下的ArrayList，无疑会创建一个新的数组来代替当前数组，并且我们新的数据进行修改，原数组的数据也不会发生改变。\n* **asList方法返回的是一个固定大小列表**，也就是说只要数组创建了，我们无法向数组中添加新的元素，只能对现有元素进行替换和查找，并且不能删除元素。这个java.util包下的ArrayList也是无法做到的。\n* **此方法充当基于数组的API和基于集合的API之间的桥梁**，这句话也体现了，asList方法本身就不是一个真正意义上的集合方法，只是在基于两者的API基础上做了一个衔接。\n\n#### 3.总结\n\nArrays$asList()本身并没有创建和返回一个新的集合对象，返回的仍然是描述原数组的视图，也就是该\"集合\"\n只满足对数组的操作，一但声明集合大小不能修改、不能直接删除某个元素等等；也就是说当我们通过asList方法将数组转成集合之后，我们对该集合的操作仅仅满足于对一个数组的操作，那么我们是可以使用这个方法的，如果想要得到的集合满足于一个真实集合对象的使用，那么这个方法是不适用的，我们这时候需要将数组复制到一个新的数组支持集合的创建，比如\n\n~~~java\n@org.junit.Test\npublic void test(){\n    List<String> list = Arrays.asList(\"aa\",\"bb\");\n\n    List<String> temp = new ArrayList<>(list);\n    temp.add(\"cc\");\n\n    System.out.println(temp);\n}\n~~~\n","slug":"Arrays$asList()抛UnsupportedOperationException异常","published":1,"updated":"2022-12-04T07:06:04.970Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clb91t0l700039sjn4gjd0a4a","content":"<blockquote>\n<p>今天写代码时遇到一个很奇怪的问题，我很主观的利用Arrays.asList()方法返回一个List，然后对该List进行了add()方法的调用，结果竟然抛了异常。将问题原因记录一下。</p>\n<span id=\"more\"></span>\n<p><strong>示例代码：</strong></p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@org</span>.junit.Test</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">test</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    List&lt;String&gt; list = Arrays.asList(<span class=\"string\">&quot;aa&quot;</span>,<span class=\"string\">&quot;bb&quot;</span>);</span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"variable\">cc</span> <span class=\"operator\">=</span> list.add(<span class=\"string\">&quot;cc&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    System.out.println(list);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>报错如下：</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java.lang.UnsupportedOperationException</span><br><span class=\"line\">\tat java.util.AbstractList.add(AbstractList.java:<span class=\"number\">148</span>)</span><br><span class=\"line\">\tat java.util.AbstractList.add(AbstractList.java:<span class=\"number\">108</span>)</span><br><span class=\"line\">\tat com.chuangkit.design.center.assist.impl.Test.test(Test.java:<span class=\"number\">19</span>)</span><br><span class=\"line\">\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class=\"line\">\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class=\"number\">62</span>)</span><br><span class=\"line\">\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class=\"number\">43</span>)</span><br><span class=\"line\">\tat java.lang.reflect.Method.invoke(Method.java:<span class=\"number\">498</span>)</span><br><span class=\"line\">\tat org.junit.runners.model.FrameworkMethod$<span class=\"number\">1.</span>runReflectiveCall(FrameworkMethod.java:<span class=\"number\">50</span>)</span><br><span class=\"line\">\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:<span class=\"number\">12</span>)</span><br><span class=\"line\">\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:<span class=\"number\">47</span>)</span><br><span class=\"line\">\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:<span class=\"number\">17</span>)</span><br><span class=\"line\">\tat org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:<span class=\"number\">325</span>)</span><br><span class=\"line\">\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:<span class=\"number\">78</span>)</span><br><span class=\"line\">\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:<span class=\"number\">57</span>)</span><br><span class=\"line\">\tat org.junit.runners.ParentRunner$<span class=\"number\">3.</span>run(ParentRunner.java:<span class=\"number\">290</span>)</span><br><span class=\"line\">\tat org.junit.runners.ParentRunner$<span class=\"number\">1.</span>schedule(ParentRunner.java:<span class=\"number\">71</span>)</span><br><span class=\"line\">\tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:<span class=\"number\">288</span>)</span><br><span class=\"line\">\tat org.junit.runners.ParentRunner.access$<span class=\"number\">000</span>(ParentRunner.java:<span class=\"number\">58</span>)</span><br><span class=\"line\">\tat org.junit.runners.ParentRunner$<span class=\"number\">2.</span>evaluate(ParentRunner.java:<span class=\"number\">268</span>)</span><br><span class=\"line\">\tat org.junit.runners.ParentRunner.run(ParentRunner.java:<span class=\"number\">363</span>)</span><br><span class=\"line\">\tat org.junit.runner.JUnitCore.run(JUnitCore.java:<span class=\"number\">137</span>)</span><br><span class=\"line\">\tat com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:<span class=\"number\">69</span>)</span><br><span class=\"line\">\tat com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:<span class=\"number\">33</span>)</span><br><span class=\"line\">\tat com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:<span class=\"number\">221</span>)</span><br><span class=\"line\">\tat com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:<span class=\"number\">54</span>)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"1-接下来我们看下源码，排查异常产生的原因\"><a href=\"#1-接下来我们看下源码，排查异常产生的原因\" class=\"headerlink\" title=\"1.接下来我们看下源码，排查异常产生的原因\"></a>1.接下来我们看下源码，排查异常产生的原因</h4><p>我们点进asList()方法看下源码是怎么实现的。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SafeVarargs</span></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings(&quot;varargs&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> &lt;T&gt; List&lt;T&gt; <span class=\"title function_\">asList</span><span class=\"params\">(T... a)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;(a);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里发现这不是返回的就是一个new出来的ArrayList集合对象吗，没有什么问题啊，别着急，我们在进到ArrayList看看猫腻。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@serial</span> include</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ArrayList</span>&lt;E&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractList</span>&lt;E&gt;</span><br><span class=\"line\">        <span class=\"keyword\">implements</span> <span class=\"title class_\">RandomAccess</span>, java.io.Serializable</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">long</span> <span class=\"variable\">serialVersionUID</span> <span class=\"operator\">=</span> -<span class=\"number\">2764017481108945198L</span>;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> E[] a;</span><br><span class=\"line\"></span><br><span class=\"line\">        ArrayList(E[] array) &#123;</span><br><span class=\"line\">            a = Objects.requireNonNull(array);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">size</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> a.length;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Object[] toArray() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> a.clone();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> &lt;T&gt; T[] toArray(T[] a) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> size();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (a.length &lt; size)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> Arrays.copyOf(<span class=\"built_in\">this</span>.a, size,</span><br><span class=\"line\">                                     (Class&lt;? <span class=\"keyword\">extends</span> <span class=\"title class_\">T</span>[]&gt;) a.getClass());</span><br><span class=\"line\">            System.arraycopy(<span class=\"built_in\">this</span>.a, <span class=\"number\">0</span>, a, <span class=\"number\">0</span>, size);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (a.length &gt; size)</span><br><span class=\"line\">                a[size] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> a;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> E <span class=\"title function_\">get</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> a[index];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> E <span class=\"title function_\">set</span><span class=\"params\">(<span class=\"type\">int</span> index, E element)</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">E</span> <span class=\"variable\">oldValue</span> <span class=\"operator\">=</span> a[index];</span><br><span class=\"line\">            a[index] = element;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">indexOf</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">            E[] a = <span class=\"built_in\">this</span>.a;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (o == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; a.length; i++)</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (a[i] == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> i;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; a.length; i++)</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (o.equals(a[i]))</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> i;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">contains</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> indexOf(o) != -<span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Spliterator&lt;E&gt; <span class=\"title function_\">spliterator</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Spliterators.spliterator(a, Spliterator.ORDERED);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">forEach</span><span class=\"params\">(Consumer&lt;? <span class=\"built_in\">super</span> E&gt; action)</span> &#123;</span><br><span class=\"line\">            Objects.requireNonNull(action);</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (E e : a) &#123;</span><br><span class=\"line\">                action.accept(e);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">replaceAll</span><span class=\"params\">(UnaryOperator&lt;E&gt; operator)</span> &#123;</span><br><span class=\"line\">            Objects.requireNonNull(operator);</span><br><span class=\"line\">            E[] a = <span class=\"built_in\">this</span>.a;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; a.length; i++) &#123;</span><br><span class=\"line\">                a[i] = operator.apply(a[i]);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">sort</span><span class=\"params\">(Comparator&lt;? <span class=\"built_in\">super</span> E&gt; c)</span> &#123;</span><br><span class=\"line\">            Arrays.sort(a, c);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>这时我们发现，此ArrayList并不是我们常用的java.util包下的，而是Arrays类自己实现的一个静态内部类，该内部类继承了AbstractList抽象类，我们知道AbstractList是实现了List接口的，而AbstractList本身也是一个抽象类，并没有对add等方法进行实现，Arrays$ArrayList虽然继承了AbstractList，但是也没有对add等方法进行实现，所以当我们调用该内部类的add方法时就抛出UnsupportedOperationException异常。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1.首先我们看ArrayList继承了AbstractList</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ArrayList</span>&lt;E&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractList</span>&lt;E&gt;</span><br><span class=\"line\">        <span class=\"keyword\">implements</span> <span class=\"title class_\">RandomAccess</span>, java.io.Serializable</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2.然后AbstractList又实现了List接口</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AbstractList</span>&lt;E&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractCollection</span>&lt;E&gt; </span><br><span class=\"line\">\t\t<span class=\"keyword\">implements</span> <span class=\"title class_\">List</span>&lt;E&gt; </span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3.在List的add方法注释上可以看到如果实现类没有实现add方法就会抛异常</span></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * ...</span></span><br><span class=\"line\"><span class=\"comment\">  * <span class=\"doctag\">@throws</span> UnsupportedOperationException if the &#123;<span class=\"doctag\">@code</span> add&#125; operation</span></span><br><span class=\"line\"><span class=\"comment\">  *         is not supported by this list</span></span><br><span class=\"line\"><span class=\"comment\">  * ...</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">add</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    add(size(), e);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-问题我们找到了，接下来我们想一想为什么Arrays要自己实现一个ArrayList呢\"><a href=\"#2-问题我们找到了，接下来我们想一想为什么Arrays要自己实现一个ArrayList呢\" class=\"headerlink\" title=\"2.问题我们找到了，接下来我们想一想为什么Arrays要自己实现一个ArrayList呢\"></a>2.问题我们找到了，接下来我们想一想为什么Arrays要自己实现一个ArrayList呢</h4><p>我们先看下源码注释是怎么说的（摘自于asList方法注释）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * Returns a fixed-size list backed by the specified array.  (Changes to</span></span><br><span class=\"line\"><span class=\"comment\">  * the returned list &quot;write through&quot; to the array.)  This method acts</span></span><br><span class=\"line\"><span class=\"comment\">  * as bridge between array-based and collection-based APIs, in</span></span><br><span class=\"line\"><span class=\"comment\">  * combination with &#123;<span class=\"doctag\">@link</span> Collection#toArray&#125;.  The returned list is</span></span><br><span class=\"line\"><span class=\"comment\">  * serializable and implements &#123;<span class=\"doctag\">@link</span> RandomAccess&#125;.</span></span><br><span class=\"line\"><span class=\"comment\">  *</span></span><br><span class=\"line\"><span class=\"comment\">  * &lt;p&gt;This method also provides a convenient way to create a fixed-size</span></span><br><span class=\"line\"><span class=\"comment\">  * list initialized to contain several elements:</span></span><br><span class=\"line\"><span class=\"comment\">  * ...</span></span><br><span class=\"line\"><span class=\"comment\">  * 返回由指定数组支持的固定大小列表。（更改返回的列表“直写”到数组。）</span></span><br><span class=\"line\"><span class=\"comment\">  * 此方法与 &#123;<span class=\"doctag\">@link</span> Collection#toArray&#125; 结合，充当基于数组和基于集合的 API 之间的桥梁。</span></span><br><span class=\"line\"><span class=\"comment\">  * 返回的列表是可序列化的并实现了 &#123;<span class=\"doctag\">@link</span> RandomAccess&#125;。此方法还提供了一种创建固定大小列表</span></span><br><span class=\"line\"><span class=\"comment\">  * 的便捷方法，该列表已初始化为包含多个元素。</span></span><br><span class=\"line\"><span class=\"comment\">  * ...</span></span><br><span class=\"line\"><span class=\"comment\">  * <span class=\"doctag\">@return</span> a list view of the specified array</span></span><br><span class=\"line\"><span class=\"comment\">  * 指定数组的列表视图</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>asList方法返回的是当前数组的的列表视图</strong>，当我们改变原始数组的数据时，这个”视图”<br>会自然而然的同步改变，因为它就是当前数组的一个展现形式，如果返回的是java.util包下的ArrayList，无疑会创建一个新的数组来代替当前数组，并且我们新的数据进行修改，原数组的数据也不会发生改变。</li>\n<li><strong>asList方法返回的是一个固定大小列表</strong>，也就是说只要数组创建了，我们无法向数组中添加新的元素，只能对现有元素进行替换和查找，并且不能删除元素。这个java.util包下的ArrayList也是无法做到的。</li>\n<li><strong>此方法充当基于数组的API和基于集合的API之间的桥梁</strong>，这句话也体现了，asList方法本身就不是一个真正意义上的集合方法，只是在基于两者的API基础上做了一个衔接。</li>\n</ul>\n<h4 id=\"3-总结\"><a href=\"#3-总结\" class=\"headerlink\" title=\"3.总结\"></a>3.总结</h4><p>Arrays$asList()本身并没有创建和返回一个新的集合对象，返回的仍然是描述原数组的视图，也就是该”集合”<br>只满足对数组的操作，一但声明集合大小不能修改、不能直接删除某个元素等等；也就是说当我们通过asList方法将数组转成集合之后，我们对该集合的操作仅仅满足于对一个数组的操作，那么我们是可以使用这个方法的，如果想要得到的集合满足于一个真实集合对象的使用，那么这个方法是不适用的，我们这时候需要将数组复制到一个新的数组支持集合的创建，比如</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@org</span>.junit.Test</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">test</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    List&lt;String&gt; list = Arrays.asList(<span class=\"string\">&quot;aa&quot;</span>,<span class=\"string\">&quot;bb&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    List&lt;String&gt; temp = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;(list);</span><br><span class=\"line\">    temp.add(<span class=\"string\">&quot;cc&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    System.out.println(temp);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>今天写代码时遇到一个很奇怪的问题，我很主观的利用Arrays.asList()方法返回一个List，然后对该List进行了add()方法的调用，结果竟然抛了异常。将问题原因记录一下。</p>","more":"<p><strong>示例代码：</strong></p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@org</span>.junit.Test</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">test</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    List&lt;String&gt; list = Arrays.asList(<span class=\"string\">&quot;aa&quot;</span>,<span class=\"string\">&quot;bb&quot;</span>);</span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"variable\">cc</span> <span class=\"operator\">=</span> list.add(<span class=\"string\">&quot;cc&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    System.out.println(list);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>报错如下：</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java.lang.UnsupportedOperationException</span><br><span class=\"line\">\tat java.util.AbstractList.add(AbstractList.java:<span class=\"number\">148</span>)</span><br><span class=\"line\">\tat java.util.AbstractList.add(AbstractList.java:<span class=\"number\">108</span>)</span><br><span class=\"line\">\tat com.chuangkit.design.center.assist.impl.Test.test(Test.java:<span class=\"number\">19</span>)</span><br><span class=\"line\">\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class=\"line\">\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class=\"number\">62</span>)</span><br><span class=\"line\">\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class=\"number\">43</span>)</span><br><span class=\"line\">\tat java.lang.reflect.Method.invoke(Method.java:<span class=\"number\">498</span>)</span><br><span class=\"line\">\tat org.junit.runners.model.FrameworkMethod$<span class=\"number\">1.</span>runReflectiveCall(FrameworkMethod.java:<span class=\"number\">50</span>)</span><br><span class=\"line\">\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:<span class=\"number\">12</span>)</span><br><span class=\"line\">\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:<span class=\"number\">47</span>)</span><br><span class=\"line\">\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:<span class=\"number\">17</span>)</span><br><span class=\"line\">\tat org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:<span class=\"number\">325</span>)</span><br><span class=\"line\">\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:<span class=\"number\">78</span>)</span><br><span class=\"line\">\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:<span class=\"number\">57</span>)</span><br><span class=\"line\">\tat org.junit.runners.ParentRunner$<span class=\"number\">3.</span>run(ParentRunner.java:<span class=\"number\">290</span>)</span><br><span class=\"line\">\tat org.junit.runners.ParentRunner$<span class=\"number\">1.</span>schedule(ParentRunner.java:<span class=\"number\">71</span>)</span><br><span class=\"line\">\tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:<span class=\"number\">288</span>)</span><br><span class=\"line\">\tat org.junit.runners.ParentRunner.access$<span class=\"number\">000</span>(ParentRunner.java:<span class=\"number\">58</span>)</span><br><span class=\"line\">\tat org.junit.runners.ParentRunner$<span class=\"number\">2.</span>evaluate(ParentRunner.java:<span class=\"number\">268</span>)</span><br><span class=\"line\">\tat org.junit.runners.ParentRunner.run(ParentRunner.java:<span class=\"number\">363</span>)</span><br><span class=\"line\">\tat org.junit.runner.JUnitCore.run(JUnitCore.java:<span class=\"number\">137</span>)</span><br><span class=\"line\">\tat com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:<span class=\"number\">69</span>)</span><br><span class=\"line\">\tat com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:<span class=\"number\">33</span>)</span><br><span class=\"line\">\tat com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:<span class=\"number\">221</span>)</span><br><span class=\"line\">\tat com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:<span class=\"number\">54</span>)</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"1-接下来我们看下源码，排查异常产生的原因\"><a href=\"#1-接下来我们看下源码，排查异常产生的原因\" class=\"headerlink\" title=\"1.接下来我们看下源码，排查异常产生的原因\"></a>1.接下来我们看下源码，排查异常产生的原因</h4><p>我们点进asList()方法看下源码是怎么实现的。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SafeVarargs</span></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings(&quot;varargs&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> &lt;T&gt; List&lt;T&gt; <span class=\"title function_\">asList</span><span class=\"params\">(T... a)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;(a);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里发现这不是返回的就是一个new出来的ArrayList集合对象吗，没有什么问题啊，别着急，我们在进到ArrayList看看猫腻。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@serial</span> include</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ArrayList</span>&lt;E&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractList</span>&lt;E&gt;</span><br><span class=\"line\">        <span class=\"keyword\">implements</span> <span class=\"title class_\">RandomAccess</span>, java.io.Serializable</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">long</span> <span class=\"variable\">serialVersionUID</span> <span class=\"operator\">=</span> -<span class=\"number\">2764017481108945198L</span>;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> E[] a;</span><br><span class=\"line\"></span><br><span class=\"line\">        ArrayList(E[] array) &#123;</span><br><span class=\"line\">            a = Objects.requireNonNull(array);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">size</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> a.length;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Object[] toArray() &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> a.clone();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> &lt;T&gt; T[] toArray(T[] a) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> size();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (a.length &lt; size)</span><br><span class=\"line\">                <span class=\"keyword\">return</span> Arrays.copyOf(<span class=\"built_in\">this</span>.a, size,</span><br><span class=\"line\">                                     (Class&lt;? <span class=\"keyword\">extends</span> <span class=\"title class_\">T</span>[]&gt;) a.getClass());</span><br><span class=\"line\">            System.arraycopy(<span class=\"built_in\">this</span>.a, <span class=\"number\">0</span>, a, <span class=\"number\">0</span>, size);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (a.length &gt; size)</span><br><span class=\"line\">                a[size] = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> a;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> E <span class=\"title function_\">get</span><span class=\"params\">(<span class=\"type\">int</span> index)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> a[index];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> E <span class=\"title function_\">set</span><span class=\"params\">(<span class=\"type\">int</span> index, E element)</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">E</span> <span class=\"variable\">oldValue</span> <span class=\"operator\">=</span> a[index];</span><br><span class=\"line\">            a[index] = element;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> oldValue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">indexOf</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">            E[] a = <span class=\"built_in\">this</span>.a;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (o == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; a.length; i++)</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (a[i] == <span class=\"literal\">null</span>)</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> i;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; a.length; i++)</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (o.equals(a[i]))</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> i;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">contains</span><span class=\"params\">(Object o)</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> indexOf(o) != -<span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Spliterator&lt;E&gt; <span class=\"title function_\">spliterator</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Spliterators.spliterator(a, Spliterator.ORDERED);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">forEach</span><span class=\"params\">(Consumer&lt;? <span class=\"built_in\">super</span> E&gt; action)</span> &#123;</span><br><span class=\"line\">            Objects.requireNonNull(action);</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (E e : a) &#123;</span><br><span class=\"line\">                action.accept(e);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">replaceAll</span><span class=\"params\">(UnaryOperator&lt;E&gt; operator)</span> &#123;</span><br><span class=\"line\">            Objects.requireNonNull(operator);</span><br><span class=\"line\">            E[] a = <span class=\"built_in\">this</span>.a;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; a.length; i++) &#123;</span><br><span class=\"line\">                a[i] = operator.apply(a[i]);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">sort</span><span class=\"params\">(Comparator&lt;? <span class=\"built_in\">super</span> E&gt; c)</span> &#123;</span><br><span class=\"line\">            Arrays.sort(a, c);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>这时我们发现，此ArrayList并不是我们常用的java.util包下的，而是Arrays类自己实现的一个静态内部类，该内部类继承了AbstractList抽象类，我们知道AbstractList是实现了List接口的，而AbstractList本身也是一个抽象类，并没有对add等方法进行实现，Arrays$ArrayList虽然继承了AbstractList，但是也没有对add等方法进行实现，所以当我们调用该内部类的add方法时就抛出UnsupportedOperationException异常。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 1.首先我们看ArrayList继承了AbstractList</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ArrayList</span>&lt;E&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractList</span>&lt;E&gt;</span><br><span class=\"line\">        <span class=\"keyword\">implements</span> <span class=\"title class_\">RandomAccess</span>, java.io.Serializable</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 2.然后AbstractList又实现了List接口</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AbstractList</span>&lt;E&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractCollection</span>&lt;E&gt; </span><br><span class=\"line\">\t\t<span class=\"keyword\">implements</span> <span class=\"title class_\">List</span>&lt;E&gt; </span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 3.在List的add方法注释上可以看到如果实现类没有实现add方法就会抛异常</span></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * ...</span></span><br><span class=\"line\"><span class=\"comment\">  * <span class=\"doctag\">@throws</span> UnsupportedOperationException if the &#123;<span class=\"doctag\">@code</span> add&#125; operation</span></span><br><span class=\"line\"><span class=\"comment\">  *         is not supported by this list</span></span><br><span class=\"line\"><span class=\"comment\">  * ...</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">add</span><span class=\"params\">(E e)</span> &#123;</span><br><span class=\"line\">    add(size(), e);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-问题我们找到了，接下来我们想一想为什么Arrays要自己实现一个ArrayList呢\"><a href=\"#2-问题我们找到了，接下来我们想一想为什么Arrays要自己实现一个ArrayList呢\" class=\"headerlink\" title=\"2.问题我们找到了，接下来我们想一想为什么Arrays要自己实现一个ArrayList呢\"></a>2.问题我们找到了，接下来我们想一想为什么Arrays要自己实现一个ArrayList呢</h4><p>我们先看下源码注释是怎么说的（摘自于asList方法注释）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * Returns a fixed-size list backed by the specified array.  (Changes to</span></span><br><span class=\"line\"><span class=\"comment\">  * the returned list &quot;write through&quot; to the array.)  This method acts</span></span><br><span class=\"line\"><span class=\"comment\">  * as bridge between array-based and collection-based APIs, in</span></span><br><span class=\"line\"><span class=\"comment\">  * combination with &#123;<span class=\"doctag\">@link</span> Collection#toArray&#125;.  The returned list is</span></span><br><span class=\"line\"><span class=\"comment\">  * serializable and implements &#123;<span class=\"doctag\">@link</span> RandomAccess&#125;.</span></span><br><span class=\"line\"><span class=\"comment\">  *</span></span><br><span class=\"line\"><span class=\"comment\">  * &lt;p&gt;This method also provides a convenient way to create a fixed-size</span></span><br><span class=\"line\"><span class=\"comment\">  * list initialized to contain several elements:</span></span><br><span class=\"line\"><span class=\"comment\">  * ...</span></span><br><span class=\"line\"><span class=\"comment\">  * 返回由指定数组支持的固定大小列表。（更改返回的列表“直写”到数组。）</span></span><br><span class=\"line\"><span class=\"comment\">  * 此方法与 &#123;<span class=\"doctag\">@link</span> Collection#toArray&#125; 结合，充当基于数组和基于集合的 API 之间的桥梁。</span></span><br><span class=\"line\"><span class=\"comment\">  * 返回的列表是可序列化的并实现了 &#123;<span class=\"doctag\">@link</span> RandomAccess&#125;。此方法还提供了一种创建固定大小列表</span></span><br><span class=\"line\"><span class=\"comment\">  * 的便捷方法，该列表已初始化为包含多个元素。</span></span><br><span class=\"line\"><span class=\"comment\">  * ...</span></span><br><span class=\"line\"><span class=\"comment\">  * <span class=\"doctag\">@return</span> a list view of the specified array</span></span><br><span class=\"line\"><span class=\"comment\">  * 指定数组的列表视图</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><strong>asList方法返回的是当前数组的的列表视图</strong>，当我们改变原始数组的数据时，这个”视图”<br>会自然而然的同步改变，因为它就是当前数组的一个展现形式，如果返回的是java.util包下的ArrayList，无疑会创建一个新的数组来代替当前数组，并且我们新的数据进行修改，原数组的数据也不会发生改变。</li>\n<li><strong>asList方法返回的是一个固定大小列表</strong>，也就是说只要数组创建了，我们无法向数组中添加新的元素，只能对现有元素进行替换和查找，并且不能删除元素。这个java.util包下的ArrayList也是无法做到的。</li>\n<li><strong>此方法充当基于数组的API和基于集合的API之间的桥梁</strong>，这句话也体现了，asList方法本身就不是一个真正意义上的集合方法，只是在基于两者的API基础上做了一个衔接。</li>\n</ul>\n<h4 id=\"3-总结\"><a href=\"#3-总结\" class=\"headerlink\" title=\"3.总结\"></a>3.总结</h4><p>Arrays$asList()本身并没有创建和返回一个新的集合对象，返回的仍然是描述原数组的视图，也就是该”集合”<br>只满足对数组的操作，一但声明集合大小不能修改、不能直接删除某个元素等等；也就是说当我们通过asList方法将数组转成集合之后，我们对该集合的操作仅仅满足于对一个数组的操作，那么我们是可以使用这个方法的，如果想要得到的集合满足于一个真实集合对象的使用，那么这个方法是不适用的，我们这时候需要将数组复制到一个新的数组支持集合的创建，比如</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@org</span>.junit.Test</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">test</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    List&lt;String&gt; list = Arrays.asList(<span class=\"string\">&quot;aa&quot;</span>,<span class=\"string\">&quot;bb&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    List&lt;String&gt; temp = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;(list);</span><br><span class=\"line\">    temp.add(<span class=\"string\">&quot;cc&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    System.out.println(temp);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sun Dec 04 2022 15:06:04 GMT+0800 (中国标准时间)","title":"Arrays$asList()抛UnsupportedOperationException异常","path":"2022/12/04/Arrays$asList()抛UnsupportedOperationException异常/","eyeCatchImage":null,"excerpt":"<blockquote>\n<p>今天写代码时遇到一个很奇怪的问题，我很主观的利用Arrays.asList()方法返回一个List，然后对该List进行了add()方法的调用，结果竟然抛了异常。将问题原因记录一下。</p>","date":{"_isAMomentObject":true,"_i":"2022-12-04T06:38:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-12-04T06:38:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"日常踩坑","tags":["Arrays","视图","踩坑"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"InnoDB几个索引数据结构的区别","date":"2022-12-04T06:38:00.000Z","_content":"\n我们知道，MySQL中InnoDB执行引擎的索引实现底层数据结构是B+树，为什么选择B+树，而不选择其它数据，如Hash,二叉树等，我们今天探讨下这个问题\n<!--more-->\n\n# 索引的本质\n\n索引是帮助Mysql高效获取数据的==排好序==的==数据结构==\n\n# 索引数据结构\n\n![](https://img-blog.csdnimg.cn/20210628173241991.png)\n假如有如上一张表，如果想要查询col2=23的那行数据，如果没有索引或者不走索引的话，那么将要查询7次才会查询到，并且这7行数据在磁盘里并不是挨着存储的，查询效率会非常低。\n\n## 二叉树\n\n![](https://img-blog.csdnimg.cn/20210628173314654.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70)\n\n- 如上图，我们可以考虑将col2列放在一个二叉树的数据结构中，同样还是查询col2=23的记录，则只需要查询3次就可以查询到，效率要比没有索引的高得多。\n- 但是二叉树也有弊端，如col1，如果我们把一个按照大小顺序排序的列数据存入二叉树中，我们发现，最终其实会以类似链表的形式进行存储，我们在查询col1=7发现还是需要查询7次，所以对于这种有序的数据，并没有有效的提高查询效率。\n\n## 红黑树\n\n- 红黑树是一种二叉平衡树，可以保证单边叶子节点不超过3，如果超过则会进行自平衡，如图，可以发现它避免了二叉树的弊端。\n-\n但是使用红黑树的话，无法保证树的高度，假如我们表中对应索引行有1000万条数据，那么索引树会有1000万个节点，那么树的高度就是2的n次方=10000万，树的高度会很高，查询效率仍然会受到限制；另外，对于红黑树，每次单边超过3时，都会自平衡，需要成本较高的维护。\n\n## Hash表\n\n### 特点：\n\n对索引的key进行一次hash计算就可以定位出数据存储的位置\n\n很多时候Hash索引要比B+ 树索引更高效\n\n仅能满足 “=”，“IN”，不支持范围查询\n\nhash冲突问题\n![](https://img-blog.csdnimg.cn/20210628173402954.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70)\n\n## B-Tree\n\nB-Tree实际上解决了红黑树高度不可控的问题，B-Tree以数据页的方式存储数据，对于红黑树每个节点只能存储一个索引数据，B-Tree可以存储一页索引数据，每个数据页又可以分叉成n个数据页，这样，每个节点存储的索引数据多了，树的高度就降低了。\n![](https://img-blog.csdnimg.cn/20210628173424117.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70)\n\n### 特点：\n\nB-Tree 叶节点具有相同的深度，叶节点的指针为空 所有索引元素不重复 节点中的数据索引从左到右递增排列。\n\n## B+Tree\n\n### 特点：\n\n非叶子节点不存储data，只存储索引(冗余)，可以放更多的索引 叶子节点包含所有索引字段 叶子节点用指针连接，提高区间访问的性能\n![](https://img-blog.csdnimg.cn/20210628173443567.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70)\n\n##  \n","source":"_posts/InnoDB几个索引数据结构的区别.md","raw":"---\ntitle: InnoDB几个索引数据结构的区别\ndate: 2022-12-04 14:38\ncategories: \n- [思考总结, Mysql]\ntags:\n- InnoDB索引\n- Mysql\n- 数据结构\n---\n\n我们知道，MySQL中InnoDB执行引擎的索引实现底层数据结构是B+树，为什么选择B+树，而不选择其它数据，如Hash,二叉树等，我们今天探讨下这个问题\n<!--more-->\n\n# 索引的本质\n\n索引是帮助Mysql高效获取数据的==排好序==的==数据结构==\n\n# 索引数据结构\n\n![](https://img-blog.csdnimg.cn/20210628173241991.png)\n假如有如上一张表，如果想要查询col2=23的那行数据，如果没有索引或者不走索引的话，那么将要查询7次才会查询到，并且这7行数据在磁盘里并不是挨着存储的，查询效率会非常低。\n\n## 二叉树\n\n![](https://img-blog.csdnimg.cn/20210628173314654.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70)\n\n- 如上图，我们可以考虑将col2列放在一个二叉树的数据结构中，同样还是查询col2=23的记录，则只需要查询3次就可以查询到，效率要比没有索引的高得多。\n- 但是二叉树也有弊端，如col1，如果我们把一个按照大小顺序排序的列数据存入二叉树中，我们发现，最终其实会以类似链表的形式进行存储，我们在查询col1=7发现还是需要查询7次，所以对于这种有序的数据，并没有有效的提高查询效率。\n\n## 红黑树\n\n- 红黑树是一种二叉平衡树，可以保证单边叶子节点不超过3，如果超过则会进行自平衡，如图，可以发现它避免了二叉树的弊端。\n-\n但是使用红黑树的话，无法保证树的高度，假如我们表中对应索引行有1000万条数据，那么索引树会有1000万个节点，那么树的高度就是2的n次方=10000万，树的高度会很高，查询效率仍然会受到限制；另外，对于红黑树，每次单边超过3时，都会自平衡，需要成本较高的维护。\n\n## Hash表\n\n### 特点：\n\n对索引的key进行一次hash计算就可以定位出数据存储的位置\n\n很多时候Hash索引要比B+ 树索引更高效\n\n仅能满足 “=”，“IN”，不支持范围查询\n\nhash冲突问题\n![](https://img-blog.csdnimg.cn/20210628173402954.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70)\n\n## B-Tree\n\nB-Tree实际上解决了红黑树高度不可控的问题，B-Tree以数据页的方式存储数据，对于红黑树每个节点只能存储一个索引数据，B-Tree可以存储一页索引数据，每个数据页又可以分叉成n个数据页，这样，每个节点存储的索引数据多了，树的高度就降低了。\n![](https://img-blog.csdnimg.cn/20210628173424117.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70)\n\n### 特点：\n\nB-Tree 叶节点具有相同的深度，叶节点的指针为空 所有索引元素不重复 节点中的数据索引从左到右递增排列。\n\n## B+Tree\n\n### 特点：\n\n非叶子节点不存储data，只存储索引(冗余)，可以放更多的索引 叶子节点包含所有索引字段 叶子节点用指针连接，提高区间访问的性能\n![](https://img-blog.csdnimg.cn/20210628173443567.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70)\n\n##  \n","slug":"InnoDB几个索引数据结构的区别","published":1,"updated":"2022-12-04T07:08:32.216Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clb91t0lc00069sjn0gx49mzp","content":"<p>我们知道，MySQL中InnoDB执行引擎的索引实现底层数据结构是B+树，为什么选择B+树，而不选择其它数据，如Hash,二叉树等，我们今天探讨下这个问题</p>\n<span id=\"more\"></span>\n\n<h1 id=\"索引的本质\"><a href=\"#索引的本质\" class=\"headerlink\" title=\"索引的本质\"></a>索引的本质</h1><p>索引是帮助Mysql高效获取数据的==排好序==的==数据结构==</p>\n<h1 id=\"索引数据结构\"><a href=\"#索引数据结构\" class=\"headerlink\" title=\"索引数据结构\"></a>索引数据结构</h1><p><img src=\"https://img-blog.csdnimg.cn/20210628173241991.png\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/20210628173241991.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\"><br>假如有如上一张表，如果想要查询col2=23的那行数据，如果没有索引或者不走索引的话，那么将要查询7次才会查询到，并且这7行数据在磁盘里并不是挨着存储的，查询效率会非常低。</p>\n<h2 id=\"二叉树\"><a href=\"#二叉树\" class=\"headerlink\" title=\"二叉树\"></a>二叉树</h2><p><img src=\"https://img-blog.csdnimg.cn/20210628173314654.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/20210628173314654.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\"></p>\n<ul>\n<li>如上图，我们可以考虑将col2列放在一个二叉树的数据结构中，同样还是查询col2=23的记录，则只需要查询3次就可以查询到，效率要比没有索引的高得多。</li>\n<li>但是二叉树也有弊端，如col1，如果我们把一个按照大小顺序排序的列数据存入二叉树中，我们发现，最终其实会以类似链表的形式进行存储，我们在查询col1=7发现还是需要查询7次，所以对于这种有序的数据，并没有有效的提高查询效率。</li>\n</ul>\n<h2 id=\"红黑树\"><a href=\"#红黑树\" class=\"headerlink\" title=\"红黑树\"></a>红黑树</h2><ul>\n<li>红黑树是一种二叉平衡树，可以保证单边叶子节点不超过3，如果超过则会进行自平衡，如图，可以发现它避免了二叉树的弊端。</li>\n<li>但是使用红黑树的话，无法保证树的高度，假如我们表中对应索引行有1000万条数据，那么索引树会有1000万个节点，那么树的高度就是2的n次方=10000万，树的高度会很高，查询效率仍然会受到限制；另外，对于红黑树，每次单边超过3时，都会自平衡，需要成本较高的维护。</li>\n</ul>\n<h2 id=\"Hash表\"><a href=\"#Hash表\" class=\"headerlink\" title=\"Hash表\"></a>Hash表</h2><h3 id=\"特点：\"><a href=\"#特点：\" class=\"headerlink\" title=\"特点：\"></a>特点：</h3><p>对索引的key进行一次hash计算就可以定位出数据存储的位置</p>\n<p>很多时候Hash索引要比B+ 树索引更高效</p>\n<p>仅能满足 “=”，“IN”，不支持范围查询</p>\n<p>hash冲突问题<br><img src=\"https://img-blog.csdnimg.cn/20210628173402954.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/20210628173402954.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\"></p>\n<h2 id=\"B-Tree\"><a href=\"#B-Tree\" class=\"headerlink\" title=\"B-Tree\"></a>B-Tree</h2><p>B-Tree实际上解决了红黑树高度不可控的问题，B-Tree以数据页的方式存储数据，对于红黑树每个节点只能存储一个索引数据，B-Tree可以存储一页索引数据，每个数据页又可以分叉成n个数据页，这样，每个节点存储的索引数据多了，树的高度就降低了。<br><img src=\"https://img-blog.csdnimg.cn/20210628173424117.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/20210628173424117.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\"></p>\n<h3 id=\"特点：-1\"><a href=\"#特点：-1\" class=\"headerlink\" title=\"特点：\"></a>特点：</h3><p>B-Tree 叶节点具有相同的深度，叶节点的指针为空 所有索引元素不重复 节点中的数据索引从左到右递增排列。</p>\n<h2 id=\"B-Tree-1\"><a href=\"#B-Tree-1\" class=\"headerlink\" title=\"B+Tree\"></a>B+Tree</h2><h3 id=\"特点：-2\"><a href=\"#特点：-2\" class=\"headerlink\" title=\"特点：\"></a>特点：</h3><p>非叶子节点不存储data，只存储索引(冗余)，可以放更多的索引 叶子节点包含所有索引字段 叶子节点用指针连接，提高区间访问的性能<br><img src=\"https://img-blog.csdnimg.cn/20210628173443567.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/20210628173443567.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2>","site":{"data":{}},"excerpt":"<p>我们知道，MySQL中InnoDB执行引擎的索引实现底层数据结构是B+树，为什么选择B+树，而不选择其它数据，如Hash,二叉树等，我们今天探讨下这个问题</p>","more":"<h1 id=\"索引的本质\"><a href=\"#索引的本质\" class=\"headerlink\" title=\"索引的本质\"></a>索引的本质</h1><p>索引是帮助Mysql高效获取数据的==排好序==的==数据结构==</p>\n<h1 id=\"索引数据结构\"><a href=\"#索引数据结构\" class=\"headerlink\" title=\"索引数据结构\"></a>索引数据结构</h1><p><img src=\"https://img-blog.csdnimg.cn/20210628173241991.png\"><br>假如有如上一张表，如果想要查询col2=23的那行数据，如果没有索引或者不走索引的话，那么将要查询7次才会查询到，并且这7行数据在磁盘里并不是挨着存储的，查询效率会非常低。</p>\n<h2 id=\"二叉树\"><a href=\"#二叉树\" class=\"headerlink\" title=\"二叉树\"></a>二叉树</h2><p><img src=\"https://img-blog.csdnimg.cn/20210628173314654.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70\"></p>\n<ul>\n<li>如上图，我们可以考虑将col2列放在一个二叉树的数据结构中，同样还是查询col2=23的记录，则只需要查询3次就可以查询到，效率要比没有索引的高得多。</li>\n<li>但是二叉树也有弊端，如col1，如果我们把一个按照大小顺序排序的列数据存入二叉树中，我们发现，最终其实会以类似链表的形式进行存储，我们在查询col1=7发现还是需要查询7次，所以对于这种有序的数据，并没有有效的提高查询效率。</li>\n</ul>\n<h2 id=\"红黑树\"><a href=\"#红黑树\" class=\"headerlink\" title=\"红黑树\"></a>红黑树</h2><ul>\n<li>红黑树是一种二叉平衡树，可以保证单边叶子节点不超过3，如果超过则会进行自平衡，如图，可以发现它避免了二叉树的弊端。</li>\n<li>但是使用红黑树的话，无法保证树的高度，假如我们表中对应索引行有1000万条数据，那么索引树会有1000万个节点，那么树的高度就是2的n次方=10000万，树的高度会很高，查询效率仍然会受到限制；另外，对于红黑树，每次单边超过3时，都会自平衡，需要成本较高的维护。</li>\n</ul>\n<h2 id=\"Hash表\"><a href=\"#Hash表\" class=\"headerlink\" title=\"Hash表\"></a>Hash表</h2><h3 id=\"特点：\"><a href=\"#特点：\" class=\"headerlink\" title=\"特点：\"></a>特点：</h3><p>对索引的key进行一次hash计算就可以定位出数据存储的位置</p>\n<p>很多时候Hash索引要比B+ 树索引更高效</p>\n<p>仅能满足 “=”，“IN”，不支持范围查询</p>\n<p>hash冲突问题<br><img src=\"https://img-blog.csdnimg.cn/20210628173402954.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70\"></p>\n<h2 id=\"B-Tree\"><a href=\"#B-Tree\" class=\"headerlink\" title=\"B-Tree\"></a>B-Tree</h2><p>B-Tree实际上解决了红黑树高度不可控的问题，B-Tree以数据页的方式存储数据，对于红黑树每个节点只能存储一个索引数据，B-Tree可以存储一页索引数据，每个数据页又可以分叉成n个数据页，这样，每个节点存储的索引数据多了，树的高度就降低了。<br><img src=\"https://img-blog.csdnimg.cn/20210628173424117.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70\"></p>\n<h3 id=\"特点：-1\"><a href=\"#特点：-1\" class=\"headerlink\" title=\"特点：\"></a>特点：</h3><p>B-Tree 叶节点具有相同的深度，叶节点的指针为空 所有索引元素不重复 节点中的数据索引从左到右递增排列。</p>\n<h2 id=\"B-Tree-1\"><a href=\"#B-Tree-1\" class=\"headerlink\" title=\"B+Tree\"></a>B+Tree</h2><h3 id=\"特点：-2\"><a href=\"#特点：-2\" class=\"headerlink\" title=\"特点：\"></a>特点：</h3><p>非叶子节点不存储data，只存储索引(冗余)，可以放更多的索引 叶子节点包含所有索引字段 叶子节点用指针连接，提高区间访问的性能<br><img src=\"https://img-blog.csdnimg.cn/20210628173443567.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2>","popularPost_tmp_postPath":true,"eyeCatchImage":"https://img-blog.csdnimg.cn/20210628173241991.png","popularPost_tmp_gaData":{"updated":"Sun Dec 04 2022 15:08:32 GMT+0800 (中国标准时间)","title":"InnoDB几个索引数据结构的区别","path":"2022/12/04/InnoDB几个索引数据结构的区别/","eyeCatchImage":"https://img-blog.csdnimg.cn/20210628173241991.png","excerpt":"<p>我们知道，MySQL中InnoDB执行引擎的索引实现底层数据结构是B+树，为什么选择B+树，而不选择其它数据，如Hash,二叉树等，我们今天探讨下这个问题</p>","date":{"_isAMomentObject":true,"_i":"2022-12-04T06:38:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-12-04T06:38:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"思考总结 > Mysql","tags":["InnoDB索引","Mysql","数据结构"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"Cent os 安装jdk","date":"2022-12-04T06:38:00.000Z","_content":"整理一下cent os安装jdk的方式\n<!--more-->\n### 手动安装\n\n#### 创建安装目录\n\n```sh\n[root@iZ8vb7tm9o88h6ioml28vsZ usr]# cd /usr\n[root@iZ8vb7tm9o88h6ioml28vsZ usr]# mkdir java\n[root@iZ8vb7tm9o88h6ioml28vsZ usr]# cd java\n```\n\n#### 下载jdk 源码包\n\n> [Oracle 官网地址](https://www.oracle.com/java/technologies/javase-downloads.html)\n\n下载之后上传到服务器\n\n如果感觉麻烦的话，也可以使用wget\n\n> 直接使用下载链接获取到的tar包是有问题的，oracle对链接进行了授权校验：wget https://download.oracle.com/otn/java/jdk/8u291-b10/d7fc238d0cbf4b0dac67be84580cfb4b/jdk-8u291-linux-x64.tar.gz\n\n我们需要在下载链接之前加上 --no-cookies --no-check-certificate --header \"Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F;\noraclelicense=accept-securebackup-cookie\" ，如:\n\n```sh\nwget --no-cookies --no-check-certificate --header \"Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie\" \"https://download.oracle.com/otn/java/jdk/8u291-b10/d7fc238d0cbf4b0dac67be84580cfb4b/jdk-8u291-linux-x64.tar.gz\"\n```\n\n#### 解压\n\n```sh\n# 解压包\n[root@iZ8vb7tm9o88h6ioml28vsZ java]# tar -zxvf jdk-8u141-linux-x64.tar.gz\n# 解压完之后会生成一个 jdk1.8.0_141 的文件夹\n[root@iZ8vb7tm9o88h6ioml28vsZ java]# ls\njdk1.8.0_141  jdk-8u141-linux-x64.tar.gz\n[root@iZ8vb7tm9o88h6ioml28vsZ java]# cd jdk1.8.0_141/\n# 获取当前文件夹得绝对路径，配置环境变量时会用\n[root@iZ8vb7tm9o88h6ioml28vsZ jdk1.8.0_141]# pwd\n/usr/java/java/jdk1.8.0_141\n```\n\n#### 配置环境变量\n\n```sh\nvim /etc/profile\n\n在文件最后加上\n# java\nexport JAVA_HOME=/usr/java/java/jdk1.8.0_141 #上步 pwd 命令获取到的路径\nexport PATH=$JAVA_HOME/bin:$PATH\nexport CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib\n```\n\n#### 验证\n\n```sh\n# 使 profile 修改生效\n[root@iZ8vb7tm9o88h6ioml28vsZ java]# source /etc/profile\n# 验证结果\n[root@iZ8vb7tm9o88h6ioml28vsZ java]# java -version\njava version \"1.8.0_291\"\nJava(TM) SE Runtime Environment (build 1.8.0_291-b10)\nJava HotSpot(TM) 64-Bit Server VM (build 25.291-b10, mixed mode)\n```\n\n### yum安装\n\n```sh\n# 搜索可用的jdk安装包\n[root@iZ8vb7tm9o88h6ioml28vsZ java]# yum search java|grep jdk\nldapjdk-javadoc.noarch : Javadoc for ldapjdk\njava-1.6.0-openjdk.x86_64 : OpenJDK Runtime Environment\njava-1.6.0-openjdk-demo.x86_64 : OpenJDK Demos\njava-1.6.0-openjdk-devel.x86_64 : OpenJDK Development Environment\njava-1.6.0-openjdk-javadoc.x86_64 : OpenJDK API Documentation\njava-1.6.0-openjdk-src.x86_64 : OpenJDK Source Bundle\njava-1.7.0-openjdk.x86_64 : OpenJDK Runtime Environment\njava-1.7.0-openjdk-accessibility.x86_64 : OpenJDK accessibility connector\njava-1.7.0-openjdk-demo.x86_64 : OpenJDK Demos\njava-1.7.0-openjdk-devel.x86_64 : OpenJDK Development Environment\njava-1.7.0-openjdk-headless.x86_64 : The OpenJDK runtime environment without\njava-1.7.0-openjdk-javadoc.noarch : OpenJDK API Documentation\njava-1.7.0-openjdk-src.x86_64 : OpenJDK Source Bundle\njava-1.8.0-openjdk.i686 : OpenJDK Runtime Environment 8\njava-1.8.0-openjdk.x86_64 : OpenJDK 8 Runtime Environment\njava-1.8.0-openjdk-accessibility.i686 : OpenJDK accessibility connector\njava-1.8.0-openjdk-accessibility.x86_64 : OpenJDK accessibility connector\njava-1.8.0-openjdk-demo.i686 : OpenJDK Demos 8\njava-1.8.0-openjdk-demo.x86_64 : OpenJDK 8 Demos\njava-1.8.0-openjdk-devel.i686 : OpenJDK Development Environment 8\njava-1.8.0-openjdk-devel.x86_64 : OpenJDK 8 Development Environment\njava-1.8.0-openjdk-headless.i686 : OpenJDK Headless Runtime Environment 8\njava-1.8.0-openjdk-headless.x86_64 : OpenJDK 8 Headless Runtime Environment\njava-1.8.0-openjdk-javadoc.noarch : OpenJDK 8 API documentation\njava-1.8.0-openjdk-javadoc-zip.noarch : OpenJDK 8 API documentation compressed\njava-1.8.0-openjdk-src.i686 : OpenJDK Source Bundle 8\njava-1.8.0-openjdk-src.x86_64 : OpenJDK 8 Source Bundle\njava-11-openjdk.i686 : OpenJDK Runtime Environment 11\njava-11-openjdk.x86_64 : OpenJDK 11 Runtime Environment\njava-11-openjdk-demo.i686 : OpenJDK Demos 11\njava-11-openjdk-demo.x86_64 : OpenJDK 11 Demos\njava-11-openjdk-devel.i686 : OpenJDK Development Environment 11\njava-11-openjdk-devel.x86_64 : OpenJDK 11 Development Environment\njava-11-openjdk-headless.i686 : OpenJDK Headless Runtime Environment 11\njava-11-openjdk-headless.x86_64 : OpenJDK 11 Headless Runtime Environment\njava-11-openjdk-javadoc.i686 : OpenJDK 11 API documentation\njava-11-openjdk-javadoc.x86_64 : OpenJDK 11 API documentation\njava-11-openjdk-javadoc-zip.i686 : OpenJDK 11 API documentation compressed in a\njava-11-openjdk-javadoc-zip.x86_64 : OpenJDK 11 API documentation compressed in\njava-11-openjdk-jmods.i686 : JMods for OpenJDK 11\njava-11-openjdk-jmods.x86_64 : JMods for OpenJDK 11\njava-11-openjdk-src.i686 : OpenJDK Source Bundle 11\njava-11-openjdk-src.x86_64 : OpenJDK 11 Source Bundle\njava-11-openjdk-static-libs.i686 : OpenJDK libraries for static linking 11\njava-11-openjdk-static-libs.x86_64 : OpenJDK 11 libraries for static linking\njava-latest-openjdk.x86_64 : OpenJDK 16 Runtime Environment\njava-latest-openjdk-debug.x86_64 : OpenJDK 16 Runtime Environment with full\njava-latest-openjdk-demo.x86_64 : OpenJDK 16 Demos\njava-latest-openjdk-demo-debug.x86_64 : OpenJDK 16 Demos with full debugging on\njava-latest-openjdk-demo-fastdebug.x86_64 : OpenJDK 16 Demos with minimal\njava-latest-openjdk-devel.x86_64 : OpenJDK 16 Development Environment\njava-latest-openjdk-devel-debug.x86_64 : OpenJDK 16 Development Environment with\njava-latest-openjdk-devel-fastdebug.x86_64 : OpenJDK 16 Development Environment\njava-latest-openjdk-fastdebug.x86_64 : OpenJDK 16 Runtime Environment with\njava-latest-openjdk-headless.x86_64 : OpenJDK 16 Headless Runtime Environment\njava-latest-openjdk-headless-debug.x86_64 : OpenJDK 16 Runtime Environment with\njava-latest-openjdk-headless-fastdebug.x86_64 : OpenJDK 16 Runtime Environment\njava-latest-openjdk-javadoc.x86_64 : OpenJDK 16 API documentation\njava-latest-openjdk-javadoc-zip.x86_64 : OpenJDK 16 API documentation compressed\njava-latest-openjdk-jmods.x86_64 : JMods for OpenJDK 16\njava-latest-openjdk-jmods-debug.x86_64 : JMods for OpenJDK 16 with full\njava-latest-openjdk-jmods-fastdebug.x86_64 : JMods for OpenJDK 16 with minimal\njava-latest-openjdk-src.x86_64 : OpenJDK 16 Source Bundle\njava-latest-openjdk-src-debug.x86_64 : OpenJDK 16 Source Bundle for packages\njava-latest-openjdk-src-fastdebug.x86_64 : OpenJDK 16 Source Bundle\njava-latest-openjdk-static-libs.x86_64 : OpenJDK 16 libraries for static linking\njava-latest-openjdk-static-libs-debug.x86_64 : OpenJDK 16 libraries for static\njava-latest-openjdk-static-libs-fastdebug.x86_64 : OpenJDK 16 libraries for\nldapjdk.noarch : The Mozilla LDAP Java SDK\n# 安装\n[root@iZ8vb7tm9o88h6ioml28vsZ java]# yum install java-1.8.0-openjdk\n# 默认安装在 /usr/lib/jvm 下\n[root@iZ8vb7tm9o88h6ioml28vsZ jvm]# cd /usr/lib/jvm/\n[root@iZ8vb7tm9o88h6ioml28vsZ jvm]# ls -l\ntotal 4\ndrwxr-xr-x 3 root root 4096 Jun 20 18:33 java-1.8.0-openjdk-1.8.0.292.b10-1.el7_9.x86_64\nlrwxrwxrwx 1 root root   21 Jun 20 18:33 jre -> /etc/alternatives/jre\nlrwxrwxrwx 1 root root   27 Jun 20 18:33 jre-1.8.0 -> /etc/alternatives/jre_1.8.0\nlrwxrwxrwx 1 root root   35 Jun 20 18:33 jre-1.8.0-openjdk -> /etc/alternatives/jre_1.8.0_openjdk\nlrwxrwxrwx 1 root root   51 Jun 20 18:33 jre-1.8.0-openjdk-1.8.0.292.b10-1.el7_9.x86_64 -> java-1.8.0-openjdk-1.8.0.292.b10-1.el7_9.x86_64/jre\nlrwxrwxrwx 1 root root   29 Jun 20 18:33 jre-openjdk -> /etc/alternatives/jre_openjdk\n```\n\n安装完之后同样配置环境变量，验证结果。\n","source":"_posts/Centos安装jdk.md","raw":"---\ntitle: Cent os 安装jdk\ndate: 2022-12-04 14:38\ncategories: \n- [运维技巧]\ntags:\n - jdk按照\n - centos\n---\n整理一下cent os安装jdk的方式\n<!--more-->\n### 手动安装\n\n#### 创建安装目录\n\n```sh\n[root@iZ8vb7tm9o88h6ioml28vsZ usr]# cd /usr\n[root@iZ8vb7tm9o88h6ioml28vsZ usr]# mkdir java\n[root@iZ8vb7tm9o88h6ioml28vsZ usr]# cd java\n```\n\n#### 下载jdk 源码包\n\n> [Oracle 官网地址](https://www.oracle.com/java/technologies/javase-downloads.html)\n\n下载之后上传到服务器\n\n如果感觉麻烦的话，也可以使用wget\n\n> 直接使用下载链接获取到的tar包是有问题的，oracle对链接进行了授权校验：wget https://download.oracle.com/otn/java/jdk/8u291-b10/d7fc238d0cbf4b0dac67be84580cfb4b/jdk-8u291-linux-x64.tar.gz\n\n我们需要在下载链接之前加上 --no-cookies --no-check-certificate --header \"Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F;\noraclelicense=accept-securebackup-cookie\" ，如:\n\n```sh\nwget --no-cookies --no-check-certificate --header \"Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie\" \"https://download.oracle.com/otn/java/jdk/8u291-b10/d7fc238d0cbf4b0dac67be84580cfb4b/jdk-8u291-linux-x64.tar.gz\"\n```\n\n#### 解压\n\n```sh\n# 解压包\n[root@iZ8vb7tm9o88h6ioml28vsZ java]# tar -zxvf jdk-8u141-linux-x64.tar.gz\n# 解压完之后会生成一个 jdk1.8.0_141 的文件夹\n[root@iZ8vb7tm9o88h6ioml28vsZ java]# ls\njdk1.8.0_141  jdk-8u141-linux-x64.tar.gz\n[root@iZ8vb7tm9o88h6ioml28vsZ java]# cd jdk1.8.0_141/\n# 获取当前文件夹得绝对路径，配置环境变量时会用\n[root@iZ8vb7tm9o88h6ioml28vsZ jdk1.8.0_141]# pwd\n/usr/java/java/jdk1.8.0_141\n```\n\n#### 配置环境变量\n\n```sh\nvim /etc/profile\n\n在文件最后加上\n# java\nexport JAVA_HOME=/usr/java/java/jdk1.8.0_141 #上步 pwd 命令获取到的路径\nexport PATH=$JAVA_HOME/bin:$PATH\nexport CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib\n```\n\n#### 验证\n\n```sh\n# 使 profile 修改生效\n[root@iZ8vb7tm9o88h6ioml28vsZ java]# source /etc/profile\n# 验证结果\n[root@iZ8vb7tm9o88h6ioml28vsZ java]# java -version\njava version \"1.8.0_291\"\nJava(TM) SE Runtime Environment (build 1.8.0_291-b10)\nJava HotSpot(TM) 64-Bit Server VM (build 25.291-b10, mixed mode)\n```\n\n### yum安装\n\n```sh\n# 搜索可用的jdk安装包\n[root@iZ8vb7tm9o88h6ioml28vsZ java]# yum search java|grep jdk\nldapjdk-javadoc.noarch : Javadoc for ldapjdk\njava-1.6.0-openjdk.x86_64 : OpenJDK Runtime Environment\njava-1.6.0-openjdk-demo.x86_64 : OpenJDK Demos\njava-1.6.0-openjdk-devel.x86_64 : OpenJDK Development Environment\njava-1.6.0-openjdk-javadoc.x86_64 : OpenJDK API Documentation\njava-1.6.0-openjdk-src.x86_64 : OpenJDK Source Bundle\njava-1.7.0-openjdk.x86_64 : OpenJDK Runtime Environment\njava-1.7.0-openjdk-accessibility.x86_64 : OpenJDK accessibility connector\njava-1.7.0-openjdk-demo.x86_64 : OpenJDK Demos\njava-1.7.0-openjdk-devel.x86_64 : OpenJDK Development Environment\njava-1.7.0-openjdk-headless.x86_64 : The OpenJDK runtime environment without\njava-1.7.0-openjdk-javadoc.noarch : OpenJDK API Documentation\njava-1.7.0-openjdk-src.x86_64 : OpenJDK Source Bundle\njava-1.8.0-openjdk.i686 : OpenJDK Runtime Environment 8\njava-1.8.0-openjdk.x86_64 : OpenJDK 8 Runtime Environment\njava-1.8.0-openjdk-accessibility.i686 : OpenJDK accessibility connector\njava-1.8.0-openjdk-accessibility.x86_64 : OpenJDK accessibility connector\njava-1.8.0-openjdk-demo.i686 : OpenJDK Demos 8\njava-1.8.0-openjdk-demo.x86_64 : OpenJDK 8 Demos\njava-1.8.0-openjdk-devel.i686 : OpenJDK Development Environment 8\njava-1.8.0-openjdk-devel.x86_64 : OpenJDK 8 Development Environment\njava-1.8.0-openjdk-headless.i686 : OpenJDK Headless Runtime Environment 8\njava-1.8.0-openjdk-headless.x86_64 : OpenJDK 8 Headless Runtime Environment\njava-1.8.0-openjdk-javadoc.noarch : OpenJDK 8 API documentation\njava-1.8.0-openjdk-javadoc-zip.noarch : OpenJDK 8 API documentation compressed\njava-1.8.0-openjdk-src.i686 : OpenJDK Source Bundle 8\njava-1.8.0-openjdk-src.x86_64 : OpenJDK 8 Source Bundle\njava-11-openjdk.i686 : OpenJDK Runtime Environment 11\njava-11-openjdk.x86_64 : OpenJDK 11 Runtime Environment\njava-11-openjdk-demo.i686 : OpenJDK Demos 11\njava-11-openjdk-demo.x86_64 : OpenJDK 11 Demos\njava-11-openjdk-devel.i686 : OpenJDK Development Environment 11\njava-11-openjdk-devel.x86_64 : OpenJDK 11 Development Environment\njava-11-openjdk-headless.i686 : OpenJDK Headless Runtime Environment 11\njava-11-openjdk-headless.x86_64 : OpenJDK 11 Headless Runtime Environment\njava-11-openjdk-javadoc.i686 : OpenJDK 11 API documentation\njava-11-openjdk-javadoc.x86_64 : OpenJDK 11 API documentation\njava-11-openjdk-javadoc-zip.i686 : OpenJDK 11 API documentation compressed in a\njava-11-openjdk-javadoc-zip.x86_64 : OpenJDK 11 API documentation compressed in\njava-11-openjdk-jmods.i686 : JMods for OpenJDK 11\njava-11-openjdk-jmods.x86_64 : JMods for OpenJDK 11\njava-11-openjdk-src.i686 : OpenJDK Source Bundle 11\njava-11-openjdk-src.x86_64 : OpenJDK 11 Source Bundle\njava-11-openjdk-static-libs.i686 : OpenJDK libraries for static linking 11\njava-11-openjdk-static-libs.x86_64 : OpenJDK 11 libraries for static linking\njava-latest-openjdk.x86_64 : OpenJDK 16 Runtime Environment\njava-latest-openjdk-debug.x86_64 : OpenJDK 16 Runtime Environment with full\njava-latest-openjdk-demo.x86_64 : OpenJDK 16 Demos\njava-latest-openjdk-demo-debug.x86_64 : OpenJDK 16 Demos with full debugging on\njava-latest-openjdk-demo-fastdebug.x86_64 : OpenJDK 16 Demos with minimal\njava-latest-openjdk-devel.x86_64 : OpenJDK 16 Development Environment\njava-latest-openjdk-devel-debug.x86_64 : OpenJDK 16 Development Environment with\njava-latest-openjdk-devel-fastdebug.x86_64 : OpenJDK 16 Development Environment\njava-latest-openjdk-fastdebug.x86_64 : OpenJDK 16 Runtime Environment with\njava-latest-openjdk-headless.x86_64 : OpenJDK 16 Headless Runtime Environment\njava-latest-openjdk-headless-debug.x86_64 : OpenJDK 16 Runtime Environment with\njava-latest-openjdk-headless-fastdebug.x86_64 : OpenJDK 16 Runtime Environment\njava-latest-openjdk-javadoc.x86_64 : OpenJDK 16 API documentation\njava-latest-openjdk-javadoc-zip.x86_64 : OpenJDK 16 API documentation compressed\njava-latest-openjdk-jmods.x86_64 : JMods for OpenJDK 16\njava-latest-openjdk-jmods-debug.x86_64 : JMods for OpenJDK 16 with full\njava-latest-openjdk-jmods-fastdebug.x86_64 : JMods for OpenJDK 16 with minimal\njava-latest-openjdk-src.x86_64 : OpenJDK 16 Source Bundle\njava-latest-openjdk-src-debug.x86_64 : OpenJDK 16 Source Bundle for packages\njava-latest-openjdk-src-fastdebug.x86_64 : OpenJDK 16 Source Bundle\njava-latest-openjdk-static-libs.x86_64 : OpenJDK 16 libraries for static linking\njava-latest-openjdk-static-libs-debug.x86_64 : OpenJDK 16 libraries for static\njava-latest-openjdk-static-libs-fastdebug.x86_64 : OpenJDK 16 libraries for\nldapjdk.noarch : The Mozilla LDAP Java SDK\n# 安装\n[root@iZ8vb7tm9o88h6ioml28vsZ java]# yum install java-1.8.0-openjdk\n# 默认安装在 /usr/lib/jvm 下\n[root@iZ8vb7tm9o88h6ioml28vsZ jvm]# cd /usr/lib/jvm/\n[root@iZ8vb7tm9o88h6ioml28vsZ jvm]# ls -l\ntotal 4\ndrwxr-xr-x 3 root root 4096 Jun 20 18:33 java-1.8.0-openjdk-1.8.0.292.b10-1.el7_9.x86_64\nlrwxrwxrwx 1 root root   21 Jun 20 18:33 jre -> /etc/alternatives/jre\nlrwxrwxrwx 1 root root   27 Jun 20 18:33 jre-1.8.0 -> /etc/alternatives/jre_1.8.0\nlrwxrwxrwx 1 root root   35 Jun 20 18:33 jre-1.8.0-openjdk -> /etc/alternatives/jre_1.8.0_openjdk\nlrwxrwxrwx 1 root root   51 Jun 20 18:33 jre-1.8.0-openjdk-1.8.0.292.b10-1.el7_9.x86_64 -> java-1.8.0-openjdk-1.8.0.292.b10-1.el7_9.x86_64/jre\nlrwxrwxrwx 1 root root   29 Jun 20 18:33 jre-openjdk -> /etc/alternatives/jre_openjdk\n```\n\n安装完之后同样配置环境变量，验证结果。\n","slug":"Centos安装jdk","published":1,"updated":"2022-12-04T07:07:19.363Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clb91t0le00099sjn7ojx2bwb","content":"<p>整理一下cent os安装jdk的方式</p>\n<span id=\"more\"></span>\n<h3 id=\"手动安装\"><a href=\"#手动安装\" class=\"headerlink\" title=\"手动安装\"></a>手动安装</h3><h4 id=\"创建安装目录\"><a href=\"#创建安装目录\" class=\"headerlink\" title=\"创建安装目录\"></a>创建安装目录</h4><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ usr]<span class=\"comment\"># cd /usr</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ usr]<span class=\"comment\"># mkdir java</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ usr]<span class=\"comment\"># cd java</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"下载jdk-源码包\"><a href=\"#下载jdk-源码包\" class=\"headerlink\" title=\"下载jdk 源码包\"></a>下载jdk 源码包</h4><blockquote>\n<p><a href=\"https://www.oracle.com/java/technologies/javase-downloads.html\">Oracle 官网地址</a></p>\n</blockquote>\n<p>下载之后上传到服务器</p>\n<p>如果感觉麻烦的话，也可以使用wget</p>\n<blockquote>\n<p>直接使用下载链接获取到的tar包是有问题的，oracle对链接进行了授权校验：wget <a href=\"https://download.oracle.com/otn/java/jdk/8u291-b10/d7fc238d0cbf4b0dac67be84580cfb4b/jdk-8u291-linux-x64.tar.gz\">https://download.oracle.com/otn/java/jdk/8u291-b10/d7fc238d0cbf4b0dac67be84580cfb4b/jdk-8u291-linux-x64.tar.gz</a></p>\n</blockquote>\n<p>我们需要在下载链接之前加上 –no-cookies –no-check-certificate –header “Cookie: gpw_e24=http%3A%2F%2F<a href=\"http://www.oracle.com%2F\">www.oracle.com%2F</a>;<br>oraclelicense=accept-securebackup-cookie” ，如:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget --no-cookies --no-check-certificate --header <span class=\"string\">&quot;Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie&quot;</span> <span class=\"string\">&quot;https://download.oracle.com/otn/java/jdk/8u291-b10/d7fc238d0cbf4b0dac67be84580cfb4b/jdk-8u291-linux-x64.tar.gz&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"解压\"><a href=\"#解压\" class=\"headerlink\" title=\"解压\"></a>解压</h4><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 解压包</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ java]<span class=\"comment\"># tar -zxvf jdk-8u141-linux-x64.tar.gz</span></span><br><span class=\"line\"><span class=\"comment\"># 解压完之后会生成一个 jdk1.8.0_141 的文件夹</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ java]<span class=\"comment\"># ls</span></span><br><span class=\"line\">jdk1.8.0_141  jdk-8u141-linux-x64.tar.gz</span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ java]<span class=\"comment\"># cd jdk1.8.0_141/</span></span><br><span class=\"line\"><span class=\"comment\"># 获取当前文件夹得绝对路径，配置环境变量时会用</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ jdk1.8.0_141]<span class=\"comment\"># pwd</span></span><br><span class=\"line\">/usr/java/java/jdk1.8.0_141</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置环境变量\"><a href=\"#配置环境变量\" class=\"headerlink\" title=\"配置环境变量\"></a>配置环境变量</h4><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/profile</span><br><span class=\"line\"></span><br><span class=\"line\">在文件最后加上</span><br><span class=\"line\"><span class=\"comment\"># java</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> JAVA_HOME=/usr/java/java/jdk1.8.0_141 <span class=\"comment\">#上步 pwd 命令获取到的路径</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$JAVA_HOME</span>/bin:<span class=\"variable\">$PATH</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> CLASSPATH=.:<span class=\"variable\">$JAVA_HOME</span>/lib/dt.jar:<span class=\"variable\">$JAVA_HOME</span>/lib</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"验证\"><a href=\"#验证\" class=\"headerlink\" title=\"验证\"></a>验证</h4><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使 profile 修改生效</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ java]<span class=\"comment\"># source /etc/profile</span></span><br><span class=\"line\"><span class=\"comment\"># 验证结果</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ java]<span class=\"comment\"># java -version</span></span><br><span class=\"line\">java version <span class=\"string\">&quot;1.8.0_291&quot;</span></span><br><span class=\"line\">Java(TM) SE Runtime Environment (build 1.8.0_291-b10)</span><br><span class=\"line\">Java HotSpot(TM) 64-Bit Server VM (build 25.291-b10, mixed mode)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"yum安装\"><a href=\"#yum安装\" class=\"headerlink\" title=\"yum安装\"></a>yum安装</h3><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 搜索可用的jdk安装包</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ java]<span class=\"comment\"># yum search java|grep jdk</span></span><br><span class=\"line\">ldapjdk-javadoc.noarch : Javadoc <span class=\"keyword\">for</span> ldapjdk</span><br><span class=\"line\">java-1.6.0-openjdk.x86_64 : OpenJDK Runtime Environment</span><br><span class=\"line\">java-1.6.0-openjdk-demo.x86_64 : OpenJDK Demos</span><br><span class=\"line\">java-1.6.0-openjdk-devel.x86_64 : OpenJDK Development Environment</span><br><span class=\"line\">java-1.6.0-openjdk-javadoc.x86_64 : OpenJDK API Documentation</span><br><span class=\"line\">java-1.6.0-openjdk-src.x86_64 : OpenJDK Source Bundle</span><br><span class=\"line\">java-1.7.0-openjdk.x86_64 : OpenJDK Runtime Environment</span><br><span class=\"line\">java-1.7.0-openjdk-accessibility.x86_64 : OpenJDK accessibility connector</span><br><span class=\"line\">java-1.7.0-openjdk-demo.x86_64 : OpenJDK Demos</span><br><span class=\"line\">java-1.7.0-openjdk-devel.x86_64 : OpenJDK Development Environment</span><br><span class=\"line\">java-1.7.0-openjdk-headless.x86_64 : The OpenJDK runtime environment without</span><br><span class=\"line\">java-1.7.0-openjdk-javadoc.noarch : OpenJDK API Documentation</span><br><span class=\"line\">java-1.7.0-openjdk-src.x86_64 : OpenJDK Source Bundle</span><br><span class=\"line\">java-1.8.0-openjdk.i686 : OpenJDK Runtime Environment 8</span><br><span class=\"line\">java-1.8.0-openjdk.x86_64 : OpenJDK 8 Runtime Environment</span><br><span class=\"line\">java-1.8.0-openjdk-accessibility.i686 : OpenJDK accessibility connector</span><br><span class=\"line\">java-1.8.0-openjdk-accessibility.x86_64 : OpenJDK accessibility connector</span><br><span class=\"line\">java-1.8.0-openjdk-demo.i686 : OpenJDK Demos 8</span><br><span class=\"line\">java-1.8.0-openjdk-demo.x86_64 : OpenJDK 8 Demos</span><br><span class=\"line\">java-1.8.0-openjdk-devel.i686 : OpenJDK Development Environment 8</span><br><span class=\"line\">java-1.8.0-openjdk-devel.x86_64 : OpenJDK 8 Development Environment</span><br><span class=\"line\">java-1.8.0-openjdk-headless.i686 : OpenJDK Headless Runtime Environment 8</span><br><span class=\"line\">java-1.8.0-openjdk-headless.x86_64 : OpenJDK 8 Headless Runtime Environment</span><br><span class=\"line\">java-1.8.0-openjdk-javadoc.noarch : OpenJDK 8 API documentation</span><br><span class=\"line\">java-1.8.0-openjdk-javadoc-zip.noarch : OpenJDK 8 API documentation compressed</span><br><span class=\"line\">java-1.8.0-openjdk-src.i686 : OpenJDK Source Bundle 8</span><br><span class=\"line\">java-1.8.0-openjdk-src.x86_64 : OpenJDK 8 Source Bundle</span><br><span class=\"line\">java-11-openjdk.i686 : OpenJDK Runtime Environment 11</span><br><span class=\"line\">java-11-openjdk.x86_64 : OpenJDK 11 Runtime Environment</span><br><span class=\"line\">java-11-openjdk-demo.i686 : OpenJDK Demos 11</span><br><span class=\"line\">java-11-openjdk-demo.x86_64 : OpenJDK 11 Demos</span><br><span class=\"line\">java-11-openjdk-devel.i686 : OpenJDK Development Environment 11</span><br><span class=\"line\">java-11-openjdk-devel.x86_64 : OpenJDK 11 Development Environment</span><br><span class=\"line\">java-11-openjdk-headless.i686 : OpenJDK Headless Runtime Environment 11</span><br><span class=\"line\">java-11-openjdk-headless.x86_64 : OpenJDK 11 Headless Runtime Environment</span><br><span class=\"line\">java-11-openjdk-javadoc.i686 : OpenJDK 11 API documentation</span><br><span class=\"line\">java-11-openjdk-javadoc.x86_64 : OpenJDK 11 API documentation</span><br><span class=\"line\">java-11-openjdk-javadoc-zip.i686 : OpenJDK 11 API documentation compressed <span class=\"keyword\">in</span> a</span><br><span class=\"line\">java-11-openjdk-javadoc-zip.x86_64 : OpenJDK 11 API documentation compressed <span class=\"keyword\">in</span></span><br><span class=\"line\">java-11-openjdk-jmods.i686 : JMods <span class=\"keyword\">for</span> OpenJDK 11</span><br><span class=\"line\">java-11-openjdk-jmods.x86_64 : JMods <span class=\"keyword\">for</span> OpenJDK 11</span><br><span class=\"line\">java-11-openjdk-src.i686 : OpenJDK Source Bundle 11</span><br><span class=\"line\">java-11-openjdk-src.x86_64 : OpenJDK 11 Source Bundle</span><br><span class=\"line\">java-11-openjdk-static-libs.i686 : OpenJDK libraries <span class=\"keyword\">for</span> static linking 11</span><br><span class=\"line\">java-11-openjdk-static-libs.x86_64 : OpenJDK 11 libraries <span class=\"keyword\">for</span> static linking</span><br><span class=\"line\">java-latest-openjdk.x86_64 : OpenJDK 16 Runtime Environment</span><br><span class=\"line\">java-latest-openjdk-debug.x86_64 : OpenJDK 16 Runtime Environment with full</span><br><span class=\"line\">java-latest-openjdk-demo.x86_64 : OpenJDK 16 Demos</span><br><span class=\"line\">java-latest-openjdk-demo-debug.x86_64 : OpenJDK 16 Demos with full debugging on</span><br><span class=\"line\">java-latest-openjdk-demo-fastdebug.x86_64 : OpenJDK 16 Demos with minimal</span><br><span class=\"line\">java-latest-openjdk-devel.x86_64 : OpenJDK 16 Development Environment</span><br><span class=\"line\">java-latest-openjdk-devel-debug.x86_64 : OpenJDK 16 Development Environment with</span><br><span class=\"line\">java-latest-openjdk-devel-fastdebug.x86_64 : OpenJDK 16 Development Environment</span><br><span class=\"line\">java-latest-openjdk-fastdebug.x86_64 : OpenJDK 16 Runtime Environment with</span><br><span class=\"line\">java-latest-openjdk-headless.x86_64 : OpenJDK 16 Headless Runtime Environment</span><br><span class=\"line\">java-latest-openjdk-headless-debug.x86_64 : OpenJDK 16 Runtime Environment with</span><br><span class=\"line\">java-latest-openjdk-headless-fastdebug.x86_64 : OpenJDK 16 Runtime Environment</span><br><span class=\"line\">java-latest-openjdk-javadoc.x86_64 : OpenJDK 16 API documentation</span><br><span class=\"line\">java-latest-openjdk-javadoc-zip.x86_64 : OpenJDK 16 API documentation compressed</span><br><span class=\"line\">java-latest-openjdk-jmods.x86_64 : JMods <span class=\"keyword\">for</span> OpenJDK 16</span><br><span class=\"line\">java-latest-openjdk-jmods-debug.x86_64 : JMods <span class=\"keyword\">for</span> OpenJDK 16 with full</span><br><span class=\"line\">java-latest-openjdk-jmods-fastdebug.x86_64 : JMods <span class=\"keyword\">for</span> OpenJDK 16 with minimal</span><br><span class=\"line\">java-latest-openjdk-src.x86_64 : OpenJDK 16 Source Bundle</span><br><span class=\"line\">java-latest-openjdk-src-debug.x86_64 : OpenJDK 16 Source Bundle <span class=\"keyword\">for</span> packages</span><br><span class=\"line\">java-latest-openjdk-src-fastdebug.x86_64 : OpenJDK 16 Source Bundle</span><br><span class=\"line\">java-latest-openjdk-static-libs.x86_64 : OpenJDK 16 libraries <span class=\"keyword\">for</span> static linking</span><br><span class=\"line\">java-latest-openjdk-static-libs-debug.x86_64 : OpenJDK 16 libraries <span class=\"keyword\">for</span> static</span><br><span class=\"line\">java-latest-openjdk-static-libs-fastdebug.x86_64 : OpenJDK 16 libraries <span class=\"keyword\">for</span></span><br><span class=\"line\">ldapjdk.noarch : The Mozilla LDAP Java SDK</span><br><span class=\"line\"><span class=\"comment\"># 安装</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ java]<span class=\"comment\"># yum install java-1.8.0-openjdk</span></span><br><span class=\"line\"><span class=\"comment\"># 默认安装在 /usr/lib/jvm 下</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ jvm]<span class=\"comment\"># cd /usr/lib/jvm/</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ jvm]<span class=\"comment\"># ls -l</span></span><br><span class=\"line\">total 4</span><br><span class=\"line\">drwxr-xr-x 3 root root 4096 Jun 20 18:33 java-1.8.0-openjdk-1.8.0.292.b10-1.el7_9.x86_64</span><br><span class=\"line\">lrwxrwxrwx 1 root root   21 Jun 20 18:33 jre -&gt; /etc/alternatives/jre</span><br><span class=\"line\">lrwxrwxrwx 1 root root   27 Jun 20 18:33 jre-1.8.0 -&gt; /etc/alternatives/jre_1.8.0</span><br><span class=\"line\">lrwxrwxrwx 1 root root   35 Jun 20 18:33 jre-1.8.0-openjdk -&gt; /etc/alternatives/jre_1.8.0_openjdk</span><br><span class=\"line\">lrwxrwxrwx 1 root root   51 Jun 20 18:33 jre-1.8.0-openjdk-1.8.0.292.b10-1.el7_9.x86_64 -&gt; java-1.8.0-openjdk-1.8.0.292.b10-1.el7_9.x86_64/jre</span><br><span class=\"line\">lrwxrwxrwx 1 root root   29 Jun 20 18:33 jre-openjdk -&gt; /etc/alternatives/jre_openjdk</span><br></pre></td></tr></table></figure>\n\n<p>安装完之后同样配置环境变量，验证结果。</p>\n","site":{"data":{}},"excerpt":"<p>整理一下cent os安装jdk的方式</p>","more":"<h3 id=\"手动安装\"><a href=\"#手动安装\" class=\"headerlink\" title=\"手动安装\"></a>手动安装</h3><h4 id=\"创建安装目录\"><a href=\"#创建安装目录\" class=\"headerlink\" title=\"创建安装目录\"></a>创建安装目录</h4><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ usr]<span class=\"comment\"># cd /usr</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ usr]<span class=\"comment\"># mkdir java</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ usr]<span class=\"comment\"># cd java</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"下载jdk-源码包\"><a href=\"#下载jdk-源码包\" class=\"headerlink\" title=\"下载jdk 源码包\"></a>下载jdk 源码包</h4><blockquote>\n<p><a href=\"https://www.oracle.com/java/technologies/javase-downloads.html\">Oracle 官网地址</a></p>\n</blockquote>\n<p>下载之后上传到服务器</p>\n<p>如果感觉麻烦的话，也可以使用wget</p>\n<blockquote>\n<p>直接使用下载链接获取到的tar包是有问题的，oracle对链接进行了授权校验：wget <a href=\"https://download.oracle.com/otn/java/jdk/8u291-b10/d7fc238d0cbf4b0dac67be84580cfb4b/jdk-8u291-linux-x64.tar.gz\">https://download.oracle.com/otn/java/jdk/8u291-b10/d7fc238d0cbf4b0dac67be84580cfb4b/jdk-8u291-linux-x64.tar.gz</a></p>\n</blockquote>\n<p>我们需要在下载链接之前加上 –no-cookies –no-check-certificate –header “Cookie: gpw_e24=http%3A%2F%2F<a href=\"http://www.oracle.com%2F\">www.oracle.com%2F</a>;<br>oraclelicense=accept-securebackup-cookie” ，如:</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget --no-cookies --no-check-certificate --header <span class=\"string\">&quot;Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie&quot;</span> <span class=\"string\">&quot;https://download.oracle.com/otn/java/jdk/8u291-b10/d7fc238d0cbf4b0dac67be84580cfb4b/jdk-8u291-linux-x64.tar.gz&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"解压\"><a href=\"#解压\" class=\"headerlink\" title=\"解压\"></a>解压</h4><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 解压包</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ java]<span class=\"comment\"># tar -zxvf jdk-8u141-linux-x64.tar.gz</span></span><br><span class=\"line\"><span class=\"comment\"># 解压完之后会生成一个 jdk1.8.0_141 的文件夹</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ java]<span class=\"comment\"># ls</span></span><br><span class=\"line\">jdk1.8.0_141  jdk-8u141-linux-x64.tar.gz</span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ java]<span class=\"comment\"># cd jdk1.8.0_141/</span></span><br><span class=\"line\"><span class=\"comment\"># 获取当前文件夹得绝对路径，配置环境变量时会用</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ jdk1.8.0_141]<span class=\"comment\"># pwd</span></span><br><span class=\"line\">/usr/java/java/jdk1.8.0_141</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置环境变量\"><a href=\"#配置环境变量\" class=\"headerlink\" title=\"配置环境变量\"></a>配置环境变量</h4><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/profile</span><br><span class=\"line\"></span><br><span class=\"line\">在文件最后加上</span><br><span class=\"line\"><span class=\"comment\"># java</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> JAVA_HOME=/usr/java/java/jdk1.8.0_141 <span class=\"comment\">#上步 pwd 命令获取到的路径</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$JAVA_HOME</span>/bin:<span class=\"variable\">$PATH</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> CLASSPATH=.:<span class=\"variable\">$JAVA_HOME</span>/lib/dt.jar:<span class=\"variable\">$JAVA_HOME</span>/lib</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"验证\"><a href=\"#验证\" class=\"headerlink\" title=\"验证\"></a>验证</h4><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 使 profile 修改生效</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ java]<span class=\"comment\"># source /etc/profile</span></span><br><span class=\"line\"><span class=\"comment\"># 验证结果</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ java]<span class=\"comment\"># java -version</span></span><br><span class=\"line\">java version <span class=\"string\">&quot;1.8.0_291&quot;</span></span><br><span class=\"line\">Java(TM) SE Runtime Environment (build 1.8.0_291-b10)</span><br><span class=\"line\">Java HotSpot(TM) 64-Bit Server VM (build 25.291-b10, mixed mode)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"yum安装\"><a href=\"#yum安装\" class=\"headerlink\" title=\"yum安装\"></a>yum安装</h3><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 搜索可用的jdk安装包</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ java]<span class=\"comment\"># yum search java|grep jdk</span></span><br><span class=\"line\">ldapjdk-javadoc.noarch : Javadoc <span class=\"keyword\">for</span> ldapjdk</span><br><span class=\"line\">java-1.6.0-openjdk.x86_64 : OpenJDK Runtime Environment</span><br><span class=\"line\">java-1.6.0-openjdk-demo.x86_64 : OpenJDK Demos</span><br><span class=\"line\">java-1.6.0-openjdk-devel.x86_64 : OpenJDK Development Environment</span><br><span class=\"line\">java-1.6.0-openjdk-javadoc.x86_64 : OpenJDK API Documentation</span><br><span class=\"line\">java-1.6.0-openjdk-src.x86_64 : OpenJDK Source Bundle</span><br><span class=\"line\">java-1.7.0-openjdk.x86_64 : OpenJDK Runtime Environment</span><br><span class=\"line\">java-1.7.0-openjdk-accessibility.x86_64 : OpenJDK accessibility connector</span><br><span class=\"line\">java-1.7.0-openjdk-demo.x86_64 : OpenJDK Demos</span><br><span class=\"line\">java-1.7.0-openjdk-devel.x86_64 : OpenJDK Development Environment</span><br><span class=\"line\">java-1.7.0-openjdk-headless.x86_64 : The OpenJDK runtime environment without</span><br><span class=\"line\">java-1.7.0-openjdk-javadoc.noarch : OpenJDK API Documentation</span><br><span class=\"line\">java-1.7.0-openjdk-src.x86_64 : OpenJDK Source Bundle</span><br><span class=\"line\">java-1.8.0-openjdk.i686 : OpenJDK Runtime Environment 8</span><br><span class=\"line\">java-1.8.0-openjdk.x86_64 : OpenJDK 8 Runtime Environment</span><br><span class=\"line\">java-1.8.0-openjdk-accessibility.i686 : OpenJDK accessibility connector</span><br><span class=\"line\">java-1.8.0-openjdk-accessibility.x86_64 : OpenJDK accessibility connector</span><br><span class=\"line\">java-1.8.0-openjdk-demo.i686 : OpenJDK Demos 8</span><br><span class=\"line\">java-1.8.0-openjdk-demo.x86_64 : OpenJDK 8 Demos</span><br><span class=\"line\">java-1.8.0-openjdk-devel.i686 : OpenJDK Development Environment 8</span><br><span class=\"line\">java-1.8.0-openjdk-devel.x86_64 : OpenJDK 8 Development Environment</span><br><span class=\"line\">java-1.8.0-openjdk-headless.i686 : OpenJDK Headless Runtime Environment 8</span><br><span class=\"line\">java-1.8.0-openjdk-headless.x86_64 : OpenJDK 8 Headless Runtime Environment</span><br><span class=\"line\">java-1.8.0-openjdk-javadoc.noarch : OpenJDK 8 API documentation</span><br><span class=\"line\">java-1.8.0-openjdk-javadoc-zip.noarch : OpenJDK 8 API documentation compressed</span><br><span class=\"line\">java-1.8.0-openjdk-src.i686 : OpenJDK Source Bundle 8</span><br><span class=\"line\">java-1.8.0-openjdk-src.x86_64 : OpenJDK 8 Source Bundle</span><br><span class=\"line\">java-11-openjdk.i686 : OpenJDK Runtime Environment 11</span><br><span class=\"line\">java-11-openjdk.x86_64 : OpenJDK 11 Runtime Environment</span><br><span class=\"line\">java-11-openjdk-demo.i686 : OpenJDK Demos 11</span><br><span class=\"line\">java-11-openjdk-demo.x86_64 : OpenJDK 11 Demos</span><br><span class=\"line\">java-11-openjdk-devel.i686 : OpenJDK Development Environment 11</span><br><span class=\"line\">java-11-openjdk-devel.x86_64 : OpenJDK 11 Development Environment</span><br><span class=\"line\">java-11-openjdk-headless.i686 : OpenJDK Headless Runtime Environment 11</span><br><span class=\"line\">java-11-openjdk-headless.x86_64 : OpenJDK 11 Headless Runtime Environment</span><br><span class=\"line\">java-11-openjdk-javadoc.i686 : OpenJDK 11 API documentation</span><br><span class=\"line\">java-11-openjdk-javadoc.x86_64 : OpenJDK 11 API documentation</span><br><span class=\"line\">java-11-openjdk-javadoc-zip.i686 : OpenJDK 11 API documentation compressed <span class=\"keyword\">in</span> a</span><br><span class=\"line\">java-11-openjdk-javadoc-zip.x86_64 : OpenJDK 11 API documentation compressed <span class=\"keyword\">in</span></span><br><span class=\"line\">java-11-openjdk-jmods.i686 : JMods <span class=\"keyword\">for</span> OpenJDK 11</span><br><span class=\"line\">java-11-openjdk-jmods.x86_64 : JMods <span class=\"keyword\">for</span> OpenJDK 11</span><br><span class=\"line\">java-11-openjdk-src.i686 : OpenJDK Source Bundle 11</span><br><span class=\"line\">java-11-openjdk-src.x86_64 : OpenJDK 11 Source Bundle</span><br><span class=\"line\">java-11-openjdk-static-libs.i686 : OpenJDK libraries <span class=\"keyword\">for</span> static linking 11</span><br><span class=\"line\">java-11-openjdk-static-libs.x86_64 : OpenJDK 11 libraries <span class=\"keyword\">for</span> static linking</span><br><span class=\"line\">java-latest-openjdk.x86_64 : OpenJDK 16 Runtime Environment</span><br><span class=\"line\">java-latest-openjdk-debug.x86_64 : OpenJDK 16 Runtime Environment with full</span><br><span class=\"line\">java-latest-openjdk-demo.x86_64 : OpenJDK 16 Demos</span><br><span class=\"line\">java-latest-openjdk-demo-debug.x86_64 : OpenJDK 16 Demos with full debugging on</span><br><span class=\"line\">java-latest-openjdk-demo-fastdebug.x86_64 : OpenJDK 16 Demos with minimal</span><br><span class=\"line\">java-latest-openjdk-devel.x86_64 : OpenJDK 16 Development Environment</span><br><span class=\"line\">java-latest-openjdk-devel-debug.x86_64 : OpenJDK 16 Development Environment with</span><br><span class=\"line\">java-latest-openjdk-devel-fastdebug.x86_64 : OpenJDK 16 Development Environment</span><br><span class=\"line\">java-latest-openjdk-fastdebug.x86_64 : OpenJDK 16 Runtime Environment with</span><br><span class=\"line\">java-latest-openjdk-headless.x86_64 : OpenJDK 16 Headless Runtime Environment</span><br><span class=\"line\">java-latest-openjdk-headless-debug.x86_64 : OpenJDK 16 Runtime Environment with</span><br><span class=\"line\">java-latest-openjdk-headless-fastdebug.x86_64 : OpenJDK 16 Runtime Environment</span><br><span class=\"line\">java-latest-openjdk-javadoc.x86_64 : OpenJDK 16 API documentation</span><br><span class=\"line\">java-latest-openjdk-javadoc-zip.x86_64 : OpenJDK 16 API documentation compressed</span><br><span class=\"line\">java-latest-openjdk-jmods.x86_64 : JMods <span class=\"keyword\">for</span> OpenJDK 16</span><br><span class=\"line\">java-latest-openjdk-jmods-debug.x86_64 : JMods <span class=\"keyword\">for</span> OpenJDK 16 with full</span><br><span class=\"line\">java-latest-openjdk-jmods-fastdebug.x86_64 : JMods <span class=\"keyword\">for</span> OpenJDK 16 with minimal</span><br><span class=\"line\">java-latest-openjdk-src.x86_64 : OpenJDK 16 Source Bundle</span><br><span class=\"line\">java-latest-openjdk-src-debug.x86_64 : OpenJDK 16 Source Bundle <span class=\"keyword\">for</span> packages</span><br><span class=\"line\">java-latest-openjdk-src-fastdebug.x86_64 : OpenJDK 16 Source Bundle</span><br><span class=\"line\">java-latest-openjdk-static-libs.x86_64 : OpenJDK 16 libraries <span class=\"keyword\">for</span> static linking</span><br><span class=\"line\">java-latest-openjdk-static-libs-debug.x86_64 : OpenJDK 16 libraries <span class=\"keyword\">for</span> static</span><br><span class=\"line\">java-latest-openjdk-static-libs-fastdebug.x86_64 : OpenJDK 16 libraries <span class=\"keyword\">for</span></span><br><span class=\"line\">ldapjdk.noarch : The Mozilla LDAP Java SDK</span><br><span class=\"line\"><span class=\"comment\"># 安装</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ java]<span class=\"comment\"># yum install java-1.8.0-openjdk</span></span><br><span class=\"line\"><span class=\"comment\"># 默认安装在 /usr/lib/jvm 下</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ jvm]<span class=\"comment\"># cd /usr/lib/jvm/</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ jvm]<span class=\"comment\"># ls -l</span></span><br><span class=\"line\">total 4</span><br><span class=\"line\">drwxr-xr-x 3 root root 4096 Jun 20 18:33 java-1.8.0-openjdk-1.8.0.292.b10-1.el7_9.x86_64</span><br><span class=\"line\">lrwxrwxrwx 1 root root   21 Jun 20 18:33 jre -&gt; /etc/alternatives/jre</span><br><span class=\"line\">lrwxrwxrwx 1 root root   27 Jun 20 18:33 jre-1.8.0 -&gt; /etc/alternatives/jre_1.8.0</span><br><span class=\"line\">lrwxrwxrwx 1 root root   35 Jun 20 18:33 jre-1.8.0-openjdk -&gt; /etc/alternatives/jre_1.8.0_openjdk</span><br><span class=\"line\">lrwxrwxrwx 1 root root   51 Jun 20 18:33 jre-1.8.0-openjdk-1.8.0.292.b10-1.el7_9.x86_64 -&gt; java-1.8.0-openjdk-1.8.0.292.b10-1.el7_9.x86_64/jre</span><br><span class=\"line\">lrwxrwxrwx 1 root root   29 Jun 20 18:33 jre-openjdk -&gt; /etc/alternatives/jre_openjdk</span><br></pre></td></tr></table></figure>\n\n<p>安装完之后同样配置环境变量，验证结果。</p>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sun Dec 04 2022 15:07:19 GMT+0800 (中国标准时间)","title":"Cent os 安装jdk","path":"2022/12/04/Centos安装jdk/","eyeCatchImage":null,"excerpt":"<p>整理一下cent os安装jdk的方式</p>","date":{"_isAMomentObject":true,"_i":"2022-12-04T06:38:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-12-04T06:38:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"运维技巧","tags":["jdk按照","centos"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"SpringBoot整合Swagger(spring-boot-starter-swagger)","date":"2022-12-04T06:38:00.000Z","summary":"SpringBoot整合Swagger(spring-boot-starter-swagger)","_content":"> 我们在使用swagger时，需要配置config配置类，spring-boot-starter-swagger则利用Spring Boot的自动化配置特性来实现快速的将swagger2引入spring boot应用来生成API文档，简化原生使用swagger2的整合代码。\n<!--more-->\n\n* [GitHub地址](https://github.com/SpringForAll/spring-boot-starter-swagger)\n\n#### 一、引入pom\n\n~~~ xml\n<dependency>\n\t<groupId>com.spring4all</groupId>\n\t<artifactId>swagger-spring-boot-starter</artifactId>\n\t<version>1.9.1.RELEASE</version>\n</dependency>\n~~~\n\n#### 二、项目启动类添加 @EnableSwagger2Doc\n\n~~~java\n@EnableSwagger2Doc\n@SpringBootApplication\npublic class SpringbootSwaggerSpring4allApplication {\n\n\tpublic static void main(String[] args) {\n\t\tSpringApplication.run(SpringbootSwaggerSpring4allApplication.class, args);\n\t}\n\n}\n~~~\n\n#### 三、在项目配置文件中配置参数\n\n~~~ shell\n# 是否启用swagger，默认：true\nswagger.enabled=true\n# 需要处理的基础URL规则，默认：/**\nswagger.base-path=/**\n# 扫描的基础包，默认：全扫描\nswagger.base-package=com.wangxt.springbootswaggerspring4all.controller\n# 标题\nswagger.title=springboot-swagger-spring4all\n# 描述\nswagger.description=swagger-spring4all-demo\n# 版本\nswagger.version=2.9.2\n# 维护人\nswagger.contact.name=wangxt\n# 维护人URL\nswagger.contact.url=https://wangxt.online\n# 维护人email\nswagger.contact.email=1471520488@qq.com\n~~~\n\n#### 四、写个接口看看效果\n\n##### Controller\n\n~~~java\npackage com.wangxt.springbootswaggerspring4all.controller;\n\nimport com.wangxt.springbootswaggerspring4all.domain.po.DemoPo;\nimport com.wangxt.springbootswaggerspring4all.domain.response.ResponseInfo;\nimport com.wangxt.springbootswaggerspring4all.domain.vo.DemoVo;\nimport com.wangxt.springbootswaggerspring4all.service.DemoService;\nimport io.swagger.annotations.Api;\nimport io.swagger.annotations.ApiOperation;\nimport io.swagger.annotations.ApiParam;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n/**\n *\n * 示例 controller\n * @author wangxt\n * @date 2021/7/30 10:11\n */\n@Api(tags = \"示例 controller\")\n\n@RestController\n@RequestMapping(\"/demo/\")\npublic class DemoController {\n\n    @Autowired\n    private DemoService demoService;\n\n    /**\n     *\n     * 参数为普通参数示例方法\n     * @author wangxt\n     * @date 2021/7/30 10:53\n     * @return ResponseInfo\n     */\n    @ApiOperation(value = \"参数为普通参数示例方法\")\n    @GetMapping(\"demo\")\n    public ResponseInfo<DemoVo> demo(@ApiParam(name = \"用户ID\", required = true, example = \"1\") Integer userId){\n        return demoService.demo(userId);\n    }\n\n    /**\n     *\n     * 参数为对象示例方法\n     * @author wangxt\n     * @date 2021/7/30 10:53\n     * @return ResponseInfo\n     */\n    @ApiOperation(value = \"参数为对象示例方法\")\n    @GetMapping(\"demo4Po\")\n    public ResponseInfo<DemoVo> demo4Po(@ApiParam(name = \"参数\", required = true) @RequestBody DemoPo demoPo){\n        return demoService.demo4Po(demoPo);\n    }\n}\n\n~~~\n\n##### Po\n\n~~~java\npackage com.wangxt.springbootswaggerspring4all.domain.po;\n\nimport io.swagger.annotations.ApiModel;\nimport io.swagger.annotations.ApiModelProperty;\nimport lombok.Data;\n\n/**\n *\n * 示例入参 Po\n * @author wangxt\n * @date 2021/7/30 10:43\n */\n@ApiModel(\"示例 Po\")\n@Data\npublic class DemoPo {\n    @ApiModelProperty(value = \"用户ID\", required = true, example = \"1\")\n    private Integer userId;\n}\n~~~\n\n##### Vo\n\n~~~java\npackage com.wangxt.springbootswaggerspring4all.domain.vo;\n\nimport io.swagger.annotations.ApiModel;\nimport io.swagger.annotations.ApiModelProperty;\nimport lombok.Data;\n\nimport java.time.LocalDateTime;\nimport java.util.List;\n\n/**\n *\n * 示例 Vo\n * @author wangxt\n * @date 2021/7/30 10:33\n */\n@ApiModel(\"示例 Vo\")\n@Data\npublic class DemoVo {\n\n    @ApiModelProperty(value = \"用户ID\", required = true, example = \"1\")\n    private Integer userId;\n    @ApiModelProperty(value = \"用户名\", required = true, example = \"wangxt\")\n    private String username;\n    @ApiModelProperty(value = \"网站\", required = false, example = \"wangxt.online\")\n    private String website;\n    @ApiModelProperty(value = \"年龄\", required = false, example = \"18\", name = \"userAge\")\n    private Integer age;\n    @ApiModelProperty(value = \"生日\", required = false, example = \"8888-88-88\", dataType = \"string\")\n    private LocalDateTime birthday;\n    @ApiModelProperty(value = \"朋友\", required = false, example = \"[\\\"A\\\",\\\"B\\\",\\\"C\\\"]\")\n    private List<String> friends;\n}\n~~~\n\n#### 启动项目，访问页面\n\n默认页面地址：http://{ip}:{port}/swagger-ui.html\n\n[我的示例地址查看](http://gh9d59.natappfree.cc/swagger-ui.html)（地址是内网穿透到我本机的，大概率访问不通（斜眼笑））\n\n##### 页面截图\n\n![在这里插入图片描述](https://img-blog.csdnimg.cn/693c2b53044542a3a974088cd831c8b6.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70)\n\n#### 示例项目源码\n\n[点我查看](https://github.com/wxt1471520488/springboot-swagger-spring4all)\n\n#### 总结\n\n到此，springboot项目整合swagger就完成了，整体配置相对原生的swagger2确实简单一些，只需要填写配置文件的参数即可，使用起来没有太大差别。默认的页面主题还是有些不友好（个人感觉）可以自己找个好看的ui换上，下篇换主题。\n\n#### 插曲\n\n第一次启动项目时报错，报错日志\n\n~~~java\njava.lang.IllegalStateException: Failed to load ApplicationContext\nCaused by: org.springframework.context.ApplicationContextException: Failed to start bean 'documentationPluginsBootstrapper'; nested exception is com.google.common.util.concurrent.ExecutionError: com.google.common.util.concurrent.ExecutionError: java.lang.NoClassDefFoundError: javax/validation/constraints/Min\nCaused by: com.google.common.util.concurrent.ExecutionError: com.google.common.util.concurrent.ExecutionError: java.lang.NoClassDefFoundError: javax/validation/constraints/Min\nCaused by: com.google.common.util.concurrent.ExecutionError: java.lang.NoClassDefFoundError: javax/validation/constraints/Min\nCaused by: java.lang.NoClassDefFoundError: javax/validation/constraints/Min\nCaused by: java.lang.ClassNotFoundException: javax.validation.constraints.Min\n~~~\n\n原因是swagger引用到了javax.validation包下的类，但是我新建的springboot项目并没有集成这个包，所以引下pom就行了\n\n~~~xml\n<dependency>\n\t<groupId>org.springframework.boot</groupId>\n\t<artifactId>spring-boot-starter-validation</artifactId>\n</dependency>\n~~~\n","source":"_posts/SpringBoot整合Swagger(spring-boot-starter-swagger).md","raw":"---\ntitle: SpringBoot整合Swagger(spring-boot-starter-swagger)\ndate: 2022-12-04 14:38\nsummary: SpringBoot整合Swagger(spring-boot-starter-swagger)\ncategories: \n- [小试牛刀]\ntags:\n- Swagger\n- springboot\n- 接口文档\n---\n> 我们在使用swagger时，需要配置config配置类，spring-boot-starter-swagger则利用Spring Boot的自动化配置特性来实现快速的将swagger2引入spring boot应用来生成API文档，简化原生使用swagger2的整合代码。\n<!--more-->\n\n* [GitHub地址](https://github.com/SpringForAll/spring-boot-starter-swagger)\n\n#### 一、引入pom\n\n~~~ xml\n<dependency>\n\t<groupId>com.spring4all</groupId>\n\t<artifactId>swagger-spring-boot-starter</artifactId>\n\t<version>1.9.1.RELEASE</version>\n</dependency>\n~~~\n\n#### 二、项目启动类添加 @EnableSwagger2Doc\n\n~~~java\n@EnableSwagger2Doc\n@SpringBootApplication\npublic class SpringbootSwaggerSpring4allApplication {\n\n\tpublic static void main(String[] args) {\n\t\tSpringApplication.run(SpringbootSwaggerSpring4allApplication.class, args);\n\t}\n\n}\n~~~\n\n#### 三、在项目配置文件中配置参数\n\n~~~ shell\n# 是否启用swagger，默认：true\nswagger.enabled=true\n# 需要处理的基础URL规则，默认：/**\nswagger.base-path=/**\n# 扫描的基础包，默认：全扫描\nswagger.base-package=com.wangxt.springbootswaggerspring4all.controller\n# 标题\nswagger.title=springboot-swagger-spring4all\n# 描述\nswagger.description=swagger-spring4all-demo\n# 版本\nswagger.version=2.9.2\n# 维护人\nswagger.contact.name=wangxt\n# 维护人URL\nswagger.contact.url=https://wangxt.online\n# 维护人email\nswagger.contact.email=1471520488@qq.com\n~~~\n\n#### 四、写个接口看看效果\n\n##### Controller\n\n~~~java\npackage com.wangxt.springbootswaggerspring4all.controller;\n\nimport com.wangxt.springbootswaggerspring4all.domain.po.DemoPo;\nimport com.wangxt.springbootswaggerspring4all.domain.response.ResponseInfo;\nimport com.wangxt.springbootswaggerspring4all.domain.vo.DemoVo;\nimport com.wangxt.springbootswaggerspring4all.service.DemoService;\nimport io.swagger.annotations.Api;\nimport io.swagger.annotations.ApiOperation;\nimport io.swagger.annotations.ApiParam;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\n\n/**\n *\n * 示例 controller\n * @author wangxt\n * @date 2021/7/30 10:11\n */\n@Api(tags = \"示例 controller\")\n\n@RestController\n@RequestMapping(\"/demo/\")\npublic class DemoController {\n\n    @Autowired\n    private DemoService demoService;\n\n    /**\n     *\n     * 参数为普通参数示例方法\n     * @author wangxt\n     * @date 2021/7/30 10:53\n     * @return ResponseInfo\n     */\n    @ApiOperation(value = \"参数为普通参数示例方法\")\n    @GetMapping(\"demo\")\n    public ResponseInfo<DemoVo> demo(@ApiParam(name = \"用户ID\", required = true, example = \"1\") Integer userId){\n        return demoService.demo(userId);\n    }\n\n    /**\n     *\n     * 参数为对象示例方法\n     * @author wangxt\n     * @date 2021/7/30 10:53\n     * @return ResponseInfo\n     */\n    @ApiOperation(value = \"参数为对象示例方法\")\n    @GetMapping(\"demo4Po\")\n    public ResponseInfo<DemoVo> demo4Po(@ApiParam(name = \"参数\", required = true) @RequestBody DemoPo demoPo){\n        return demoService.demo4Po(demoPo);\n    }\n}\n\n~~~\n\n##### Po\n\n~~~java\npackage com.wangxt.springbootswaggerspring4all.domain.po;\n\nimport io.swagger.annotations.ApiModel;\nimport io.swagger.annotations.ApiModelProperty;\nimport lombok.Data;\n\n/**\n *\n * 示例入参 Po\n * @author wangxt\n * @date 2021/7/30 10:43\n */\n@ApiModel(\"示例 Po\")\n@Data\npublic class DemoPo {\n    @ApiModelProperty(value = \"用户ID\", required = true, example = \"1\")\n    private Integer userId;\n}\n~~~\n\n##### Vo\n\n~~~java\npackage com.wangxt.springbootswaggerspring4all.domain.vo;\n\nimport io.swagger.annotations.ApiModel;\nimport io.swagger.annotations.ApiModelProperty;\nimport lombok.Data;\n\nimport java.time.LocalDateTime;\nimport java.util.List;\n\n/**\n *\n * 示例 Vo\n * @author wangxt\n * @date 2021/7/30 10:33\n */\n@ApiModel(\"示例 Vo\")\n@Data\npublic class DemoVo {\n\n    @ApiModelProperty(value = \"用户ID\", required = true, example = \"1\")\n    private Integer userId;\n    @ApiModelProperty(value = \"用户名\", required = true, example = \"wangxt\")\n    private String username;\n    @ApiModelProperty(value = \"网站\", required = false, example = \"wangxt.online\")\n    private String website;\n    @ApiModelProperty(value = \"年龄\", required = false, example = \"18\", name = \"userAge\")\n    private Integer age;\n    @ApiModelProperty(value = \"生日\", required = false, example = \"8888-88-88\", dataType = \"string\")\n    private LocalDateTime birthday;\n    @ApiModelProperty(value = \"朋友\", required = false, example = \"[\\\"A\\\",\\\"B\\\",\\\"C\\\"]\")\n    private List<String> friends;\n}\n~~~\n\n#### 启动项目，访问页面\n\n默认页面地址：http://{ip}:{port}/swagger-ui.html\n\n[我的示例地址查看](http://gh9d59.natappfree.cc/swagger-ui.html)（地址是内网穿透到我本机的，大概率访问不通（斜眼笑））\n\n##### 页面截图\n\n![在这里插入图片描述](https://img-blog.csdnimg.cn/693c2b53044542a3a974088cd831c8b6.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70)\n\n#### 示例项目源码\n\n[点我查看](https://github.com/wxt1471520488/springboot-swagger-spring4all)\n\n#### 总结\n\n到此，springboot项目整合swagger就完成了，整体配置相对原生的swagger2确实简单一些，只需要填写配置文件的参数即可，使用起来没有太大差别。默认的页面主题还是有些不友好（个人感觉）可以自己找个好看的ui换上，下篇换主题。\n\n#### 插曲\n\n第一次启动项目时报错，报错日志\n\n~~~java\njava.lang.IllegalStateException: Failed to load ApplicationContext\nCaused by: org.springframework.context.ApplicationContextException: Failed to start bean 'documentationPluginsBootstrapper'; nested exception is com.google.common.util.concurrent.ExecutionError: com.google.common.util.concurrent.ExecutionError: java.lang.NoClassDefFoundError: javax/validation/constraints/Min\nCaused by: com.google.common.util.concurrent.ExecutionError: com.google.common.util.concurrent.ExecutionError: java.lang.NoClassDefFoundError: javax/validation/constraints/Min\nCaused by: com.google.common.util.concurrent.ExecutionError: java.lang.NoClassDefFoundError: javax/validation/constraints/Min\nCaused by: java.lang.NoClassDefFoundError: javax/validation/constraints/Min\nCaused by: java.lang.ClassNotFoundException: javax.validation.constraints.Min\n~~~\n\n原因是swagger引用到了javax.validation包下的类，但是我新建的springboot项目并没有集成这个包，所以引下pom就行了\n\n~~~xml\n<dependency>\n\t<groupId>org.springframework.boot</groupId>\n\t<artifactId>spring-boot-starter-validation</artifactId>\n</dependency>\n~~~\n","slug":"SpringBoot整合Swagger(spring-boot-starter-swagger)","published":1,"updated":"2022-12-04T07:12:10.236Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clb91t0lf000b9sjn32gug5ne","content":"<blockquote>\n<p>我们在使用swagger时，需要配置config配置类，spring-boot-starter-swagger则利用Spring Boot的自动化配置特性来实现快速的将swagger2引入spring boot应用来生成API文档，简化原生使用swagger2的整合代码。</p>\n</blockquote>\n<span id=\"more\"></span>\n\n<ul>\n<li><a href=\"https://github.com/SpringForAll/spring-boot-starter-swagger\">GitHub地址</a></li>\n</ul>\n<h4 id=\"一、引入pom\"><a href=\"#一、引入pom\" class=\"headerlink\" title=\"一、引入pom\"></a>一、引入pom</h4><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.spring4all<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>swagger-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.9.1.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"二、项目启动类添加-EnableSwagger2Doc\"><a href=\"#二、项目启动类添加-EnableSwagger2Doc\" class=\"headerlink\" title=\"二、项目启动类添加 @EnableSwagger2Doc\"></a>二、项目启动类添加 @EnableSwagger2Doc</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@EnableSwagger2Doc</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringbootSwaggerSpring4allApplication</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">\t\tSpringApplication.run(SpringbootSwaggerSpring4allApplication.class, args);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"三、在项目配置文件中配置参数\"><a href=\"#三、在项目配置文件中配置参数\" class=\"headerlink\" title=\"三、在项目配置文件中配置参数\"></a>三、在项目配置文件中配置参数</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">是否启用swagger，默认：<span class=\"literal\">true</span></span></span><br><span class=\"line\">swagger.enabled=true</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">需要处理的基础URL规则，默认：/**</span></span><br><span class=\"line\">swagger.base-path=/**</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">扫描的基础包，默认：全扫描</span></span><br><span class=\"line\">swagger.base-package=com.wangxt.springbootswaggerspring4all.controller</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">标题</span></span><br><span class=\"line\">swagger.title=springboot-swagger-spring4all</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">描述</span></span><br><span class=\"line\">swagger.description=swagger-spring4all-demo</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">版本</span></span><br><span class=\"line\">swagger.version=2.9.2</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">维护人</span></span><br><span class=\"line\">swagger.contact.name=wangxt</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">维护人URL</span></span><br><span class=\"line\">swagger.contact.url=https://wangxt.online</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">维护人email</span></span><br><span class=\"line\">swagger.contact.email=1471520488@qq.com</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"四、写个接口看看效果\"><a href=\"#四、写个接口看看效果\" class=\"headerlink\" title=\"四、写个接口看看效果\"></a>四、写个接口看看效果</h4><h5 id=\"Controller\"><a href=\"#Controller\" class=\"headerlink\" title=\"Controller\"></a>Controller</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.wangxt.springbootswaggerspring4all.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.wangxt.springbootswaggerspring4all.domain.po.DemoPo;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.wangxt.springbootswaggerspring4all.domain.response.ResponseInfo;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.wangxt.springbootswaggerspring4all.domain.vo.DemoVo;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.wangxt.springbootswaggerspring4all.service.DemoService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.swagger.annotations.Api;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.swagger.annotations.ApiOperation;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.swagger.annotations.ApiParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 示例 controller</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> wangxt</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021/7/30 10:11</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Api(tags = &quot;示例 controller&quot;)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/demo/&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DemoController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> DemoService demoService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 参数为普通参数示例方法</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@author</span> wangxt</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@date</span> 2021/7/30 10:53</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> ResponseInfo</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@ApiOperation(value = &quot;参数为普通参数示例方法&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;demo&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ResponseInfo&lt;DemoVo&gt; <span class=\"title function_\">demo</span><span class=\"params\">(<span class=\"meta\">@ApiParam(name = &quot;用户ID&quot;, required = true, example = &quot;1&quot;)</span> Integer userId)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> demoService.demo(userId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 参数为对象示例方法</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@author</span> wangxt</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@date</span> 2021/7/30 10:53</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> ResponseInfo</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@ApiOperation(value = &quot;参数为对象示例方法&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;demo4Po&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ResponseInfo&lt;DemoVo&gt; <span class=\"title function_\">demo4Po</span><span class=\"params\">(<span class=\"meta\">@ApiParam(name = &quot;参数&quot;, required = true)</span> <span class=\"meta\">@RequestBody</span> DemoPo demoPo)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> demoService.demo4Po(demoPo);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"Po\"><a href=\"#Po\" class=\"headerlink\" title=\"Po\"></a>Po</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.wangxt.springbootswaggerspring4all.domain.po;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> io.swagger.annotations.ApiModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 示例入参 Po</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> wangxt</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021/7/30 10:43</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@ApiModel(&quot;示例 Po&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DemoPo</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@ApiModelProperty(value = &quot;用户ID&quot;, required = true, example = &quot;1&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer userId;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"Vo\"><a href=\"#Vo\" class=\"headerlink\" title=\"Vo\"></a>Vo</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.wangxt.springbootswaggerspring4all.domain.vo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> io.swagger.annotations.ApiModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.time.LocalDateTime;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 示例 Vo</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> wangxt</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021/7/30 10:33</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@ApiModel(&quot;示例 Vo&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DemoVo</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@ApiModelProperty(value = &quot;用户ID&quot;, required = true, example = &quot;1&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer userId;</span><br><span class=\"line\">    <span class=\"meta\">@ApiModelProperty(value = &quot;用户名&quot;, required = true, example = &quot;wangxt&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String username;</span><br><span class=\"line\">    <span class=\"meta\">@ApiModelProperty(value = &quot;网站&quot;, required = false, example = &quot;wangxt.online&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String website;</span><br><span class=\"line\">    <span class=\"meta\">@ApiModelProperty(value = &quot;年龄&quot;, required = false, example = &quot;18&quot;, name = &quot;userAge&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer age;</span><br><span class=\"line\">    <span class=\"meta\">@ApiModelProperty(value = &quot;生日&quot;, required = false, example = &quot;8888-88-88&quot;, dataType = &quot;string&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> LocalDateTime birthday;</span><br><span class=\"line\">    <span class=\"meta\">@ApiModelProperty(value = &quot;朋友&quot;, required = false, example = &quot;[\\&quot;A\\&quot;,\\&quot;B\\&quot;,\\&quot;C\\&quot;]&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> List&lt;String&gt; friends;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"启动项目，访问页面\"><a href=\"#启动项目，访问页面\" class=\"headerlink\" title=\"启动项目，访问页面\"></a>启动项目，访问页面</h4><p>默认页面地址：http://{ip}:{port}/swagger-ui.html</p>\n<p><a href=\"http://gh9d59.natappfree.cc/swagger-ui.html\">我的示例地址查看</a>（地址是内网穿透到我本机的，大概率访问不通（斜眼笑））</p>\n<h5 id=\"页面截图\"><a href=\"#页面截图\" class=\"headerlink\" title=\"页面截图\"></a>页面截图</h5><p><img src=\"https://img-blog.csdnimg.cn/693c2b53044542a3a974088cd831c8b6.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/693c2b53044542a3a974088cd831c8b6.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"在这里插入图片描述\"></p>\n<h4 id=\"示例项目源码\"><a href=\"#示例项目源码\" class=\"headerlink\" title=\"示例项目源码\"></a>示例项目源码</h4><p><a href=\"https://github.com/wxt1471520488/springboot-swagger-spring4all\">点我查看</a></p>\n<h4 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h4><p>到此，springboot项目整合swagger就完成了，整体配置相对原生的swagger2确实简单一些，只需要填写配置文件的参数即可，使用起来没有太大差别。默认的页面主题还是有些不友好（个人感觉）可以自己找个好看的ui换上，下篇换主题。</p>\n<h4 id=\"插曲\"><a href=\"#插曲\" class=\"headerlink\" title=\"插曲\"></a>插曲</h4><p>第一次启动项目时报错，报错日志</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java.lang.IllegalStateException: Failed to load ApplicationContext</span><br><span class=\"line\">Caused by: org.springframework.context.ApplicationContextException: Failed to start bean <span class=\"string\">&#x27;documentationPluginsBootstrapper&#x27;</span>; nested exception is com.google.common.util.concurrent.ExecutionError: com.google.common.util.concurrent.ExecutionError: java.lang.NoClassDefFoundError: javax/validation/constraints/Min</span><br><span class=\"line\">Caused by: com.google.common.util.concurrent.ExecutionError: com.google.common.util.concurrent.ExecutionError: java.lang.NoClassDefFoundError: javax/validation/constraints/Min</span><br><span class=\"line\">Caused by: com.google.common.util.concurrent.ExecutionError: java.lang.NoClassDefFoundError: javax/validation/constraints/Min</span><br><span class=\"line\">Caused by: java.lang.NoClassDefFoundError: javax/validation/constraints/Min</span><br><span class=\"line\">Caused by: java.lang.ClassNotFoundException: javax.validation.constraints.Min</span><br></pre></td></tr></table></figure>\n\n<p>原因是swagger引用到了javax.validation包下的类，但是我新建的springboot项目并没有集成这个包，所以引下pom就行了</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-validation<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>我们在使用swagger时，需要配置config配置类，spring-boot-starter-swagger则利用Spring Boot的自动化配置特性来实现快速的将swagger2引入spring boot应用来生成API文档，简化原生使用swagger2的整合代码。</p>\n</blockquote>","more":"<ul>\n<li><a href=\"https://github.com/SpringForAll/spring-boot-starter-swagger\">GitHub地址</a></li>\n</ul>\n<h4 id=\"一、引入pom\"><a href=\"#一、引入pom\" class=\"headerlink\" title=\"一、引入pom\"></a>一、引入pom</h4><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.spring4all<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>swagger-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.9.1.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"二、项目启动类添加-EnableSwagger2Doc\"><a href=\"#二、项目启动类添加-EnableSwagger2Doc\" class=\"headerlink\" title=\"二、项目启动类添加 @EnableSwagger2Doc\"></a>二、项目启动类添加 @EnableSwagger2Doc</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@EnableSwagger2Doc</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringbootSwaggerSpring4allApplication</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">\t\tSpringApplication.run(SpringbootSwaggerSpring4allApplication.class, args);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"三、在项目配置文件中配置参数\"><a href=\"#三、在项目配置文件中配置参数\" class=\"headerlink\" title=\"三、在项目配置文件中配置参数\"></a>三、在项目配置文件中配置参数</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">是否启用swagger，默认：<span class=\"literal\">true</span></span></span><br><span class=\"line\">swagger.enabled=true</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">需要处理的基础URL规则，默认：/**</span></span><br><span class=\"line\">swagger.base-path=/**</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">扫描的基础包，默认：全扫描</span></span><br><span class=\"line\">swagger.base-package=com.wangxt.springbootswaggerspring4all.controller</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">标题</span></span><br><span class=\"line\">swagger.title=springboot-swagger-spring4all</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">描述</span></span><br><span class=\"line\">swagger.description=swagger-spring4all-demo</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">版本</span></span><br><span class=\"line\">swagger.version=2.9.2</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">维护人</span></span><br><span class=\"line\">swagger.contact.name=wangxt</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">维护人URL</span></span><br><span class=\"line\">swagger.contact.url=https://wangxt.online</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">维护人email</span></span><br><span class=\"line\">swagger.contact.email=1471520488@qq.com</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"四、写个接口看看效果\"><a href=\"#四、写个接口看看效果\" class=\"headerlink\" title=\"四、写个接口看看效果\"></a>四、写个接口看看效果</h4><h5 id=\"Controller\"><a href=\"#Controller\" class=\"headerlink\" title=\"Controller\"></a>Controller</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.wangxt.springbootswaggerspring4all.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.wangxt.springbootswaggerspring4all.domain.po.DemoPo;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.wangxt.springbootswaggerspring4all.domain.response.ResponseInfo;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.wangxt.springbootswaggerspring4all.domain.vo.DemoVo;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.wangxt.springbootswaggerspring4all.service.DemoService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.swagger.annotations.Api;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.swagger.annotations.ApiOperation;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.swagger.annotations.ApiParam;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 示例 controller</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> wangxt</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021/7/30 10:11</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Api(tags = &quot;示例 controller&quot;)</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(&quot;/demo/&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DemoController</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> DemoService demoService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 参数为普通参数示例方法</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@author</span> wangxt</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@date</span> 2021/7/30 10:53</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> ResponseInfo</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@ApiOperation(value = &quot;参数为普通参数示例方法&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;demo&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ResponseInfo&lt;DemoVo&gt; <span class=\"title function_\">demo</span><span class=\"params\">(<span class=\"meta\">@ApiParam(name = &quot;用户ID&quot;, required = true, example = &quot;1&quot;)</span> Integer userId)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> demoService.demo(userId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * 参数为对象示例方法</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@author</span> wangxt</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@date</span> 2021/7/30 10:53</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> ResponseInfo</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@ApiOperation(value = &quot;参数为对象示例方法&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;demo4Po&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ResponseInfo&lt;DemoVo&gt; <span class=\"title function_\">demo4Po</span><span class=\"params\">(<span class=\"meta\">@ApiParam(name = &quot;参数&quot;, required = true)</span> <span class=\"meta\">@RequestBody</span> DemoPo demoPo)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> demoService.demo4Po(demoPo);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"Po\"><a href=\"#Po\" class=\"headerlink\" title=\"Po\"></a>Po</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.wangxt.springbootswaggerspring4all.domain.po;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> io.swagger.annotations.ApiModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 示例入参 Po</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> wangxt</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021/7/30 10:43</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@ApiModel(&quot;示例 Po&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DemoPo</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@ApiModelProperty(value = &quot;用户ID&quot;, required = true, example = &quot;1&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer userId;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"Vo\"><a href=\"#Vo\" class=\"headerlink\" title=\"Vo\"></a>Vo</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.wangxt.springbootswaggerspring4all.domain.vo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> io.swagger.annotations.ApiModel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.time.LocalDateTime;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * 示例 Vo</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> wangxt</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2021/7/30 10:33</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@ApiModel(&quot;示例 Vo&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DemoVo</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@ApiModelProperty(value = &quot;用户ID&quot;, required = true, example = &quot;1&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer userId;</span><br><span class=\"line\">    <span class=\"meta\">@ApiModelProperty(value = &quot;用户名&quot;, required = true, example = &quot;wangxt&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String username;</span><br><span class=\"line\">    <span class=\"meta\">@ApiModelProperty(value = &quot;网站&quot;, required = false, example = &quot;wangxt.online&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String website;</span><br><span class=\"line\">    <span class=\"meta\">@ApiModelProperty(value = &quot;年龄&quot;, required = false, example = &quot;18&quot;, name = &quot;userAge&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer age;</span><br><span class=\"line\">    <span class=\"meta\">@ApiModelProperty(value = &quot;生日&quot;, required = false, example = &quot;8888-88-88&quot;, dataType = &quot;string&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> LocalDateTime birthday;</span><br><span class=\"line\">    <span class=\"meta\">@ApiModelProperty(value = &quot;朋友&quot;, required = false, example = &quot;[\\&quot;A\\&quot;,\\&quot;B\\&quot;,\\&quot;C\\&quot;]&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> List&lt;String&gt; friends;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"启动项目，访问页面\"><a href=\"#启动项目，访问页面\" class=\"headerlink\" title=\"启动项目，访问页面\"></a>启动项目，访问页面</h4><p>默认页面地址：http://{ip}:{port}/swagger-ui.html</p>\n<p><a href=\"http://gh9d59.natappfree.cc/swagger-ui.html\">我的示例地址查看</a>（地址是内网穿透到我本机的，大概率访问不通（斜眼笑））</p>\n<h5 id=\"页面截图\"><a href=\"#页面截图\" class=\"headerlink\" title=\"页面截图\"></a>页面截图</h5><p><img src=\"https://img-blog.csdnimg.cn/693c2b53044542a3a974088cd831c8b6.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70\" alt=\"在这里插入图片描述\"></p>\n<h4 id=\"示例项目源码\"><a href=\"#示例项目源码\" class=\"headerlink\" title=\"示例项目源码\"></a>示例项目源码</h4><p><a href=\"https://github.com/wxt1471520488/springboot-swagger-spring4all\">点我查看</a></p>\n<h4 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h4><p>到此，springboot项目整合swagger就完成了，整体配置相对原生的swagger2确实简单一些，只需要填写配置文件的参数即可，使用起来没有太大差别。默认的页面主题还是有些不友好（个人感觉）可以自己找个好看的ui换上，下篇换主题。</p>\n<h4 id=\"插曲\"><a href=\"#插曲\" class=\"headerlink\" title=\"插曲\"></a>插曲</h4><p>第一次启动项目时报错，报错日志</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java.lang.IllegalStateException: Failed to load ApplicationContext</span><br><span class=\"line\">Caused by: org.springframework.context.ApplicationContextException: Failed to start bean <span class=\"string\">&#x27;documentationPluginsBootstrapper&#x27;</span>; nested exception is com.google.common.util.concurrent.ExecutionError: com.google.common.util.concurrent.ExecutionError: java.lang.NoClassDefFoundError: javax/validation/constraints/Min</span><br><span class=\"line\">Caused by: com.google.common.util.concurrent.ExecutionError: com.google.common.util.concurrent.ExecutionError: java.lang.NoClassDefFoundError: javax/validation/constraints/Min</span><br><span class=\"line\">Caused by: com.google.common.util.concurrent.ExecutionError: java.lang.NoClassDefFoundError: javax/validation/constraints/Min</span><br><span class=\"line\">Caused by: java.lang.NoClassDefFoundError: javax/validation/constraints/Min</span><br><span class=\"line\">Caused by: java.lang.ClassNotFoundException: javax.validation.constraints.Min</span><br></pre></td></tr></table></figure>\n\n<p>原因是swagger引用到了javax.validation包下的类，但是我新建的springboot项目并没有集成这个包，所以引下pom就行了</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-validation<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>","popularPost_tmp_postPath":true,"eyeCatchImage":"https://img-blog.csdnimg.cn/693c2b53044542a3a974088cd831c8b6.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70","popularPost_tmp_gaData":{"updated":"Sun Dec 04 2022 15:12:10 GMT+0800 (中国标准时间)","title":"SpringBoot整合Swagger(spring-boot-starter-swagger)","path":"2022/12/04/SpringBoot整合Swagger(spring-boot-starter-swagger)/","eyeCatchImage":"https://img-blog.csdnimg.cn/693c2b53044542a3a974088cd831c8b6.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70","excerpt":"<blockquote>\n<p>我们在使用swagger时，需要配置config配置类，spring-boot-starter-swagger则利用Spring Boot的自动化配置特性来实现快速的将swagger2引入spring boot应用来生成API文档，简化原生使用swagger2的整合代码。</p>\n</blockquote>","date":{"_isAMomentObject":true,"_i":"2022-12-04T06:38:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-12-04T06:38:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"小试牛刀","tags":["Swagger","springboot","接口文档"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"cad破解","date":"2022-12-04T06:38:00.000Z","_content":"\n由于对象是工程专业，需要用到cad软件，奈何公司也不给补助购买正版，那咱只能使用破解版了，整理了一下cad2020的破解步骤，其它版本也基本类似，做个备份\n<!--more-->\n\n> 软件下载地址 ：链接：https://pan.baidu.com/s/100omUwKALn63KugkmDdWUQ \n>\n#### 1.解压压缩包\n\n![成功下载CAD2020压缩包后鼠标右击解压到文件](https://img-blog.csdnimg.cn/79e8577a3fe54a16bb8720370fe9f543.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 2.运行安装CAD2020\n\n![打开解压出来的文件夹，右击管理员运行CAD2020.exe](https://img-blog.csdnimg.cn/e877504d59b84627b80b80b9b2024b44.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 3.解压安装程序\n\n![点击更改，选择其它盘，选择一个文件夹，点确定即可](https://img-blog.csdnimg.cn/09f5248ddc67425faea95798ad4e346f.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 4.正在解压安装程序\n\n![安装程序正在解压，耐心等待](https://img-blog.csdnimg.cn/46693ab24b7c474582bf3875b87bb126.png)\n\n#### 5.点击安装\n\n![解压成功后，点击安装](https://img-blog.csdnimg.cn/6562fce585cf4d19ad2e9fae1648c073.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 6.我接受，下一步\n\n![勾选我接受，点击下一步](https://img-blog.csdnimg.cn/9c17c205ac684936bfba0926b7616fd8.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 7.选择安装路径\n\n![点击浏览，选择其它盘，选择一个文件夹，点击安装](https://img-blog.csdnimg.cn/f0cc3f2f8ef8409c914e38b56866505b.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 8.正在安装\n\n![CAD2020正在安装，耐心等待片刻](https://img-blog.csdnimg.cn/077b470ec0e14e50b5697b3e603a22e3.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 9.忽略资源管理器\n\n![如果安装过程中弹出这个，点击忽略即可,没有不管](https://img-blog.csdnimg.cn/706223d6db2b4b169bfe4eac020bfbc6.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 10.安装成功\n\n![耐心等待片刻后成功安装，点击完成](https://img-blog.csdnimg.cn/ce3710d9f1e943cba77b3b2085f6fe1c.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 11.重新启动\n\n![如果弹出让你重新启动计算机，点击否,没有弹忽略](https://img-blog.csdnimg.cn/df2e92615fa24b0696d86fada960e728.png)\n\n#### 12.输入序列号\n\n![返回桌面启动CAD2020，弹出这个点击输入序列号按钮](https://img-blog.csdnimg.cn/9b251bf99f974fa7b8ca9189dcb1a291.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 13.我同意\n\n![这一步直接点击我同意即可](https://img-blog.csdnimg.cn/0d942a2025bb47daa5c3d645b2e4f571.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 14.点击激活\n\n![弹出激活页面，点击激活](https://img-blog.csdnimg.cn/9cb400e780c0425baf16dbe582735302.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 15.输入序列号【666-69696969】\n\n![这里输入序列号（666-69696969），点击下一步](https://img-blog.csdnimg.cn/aa94204b219544b2abeef9c23a2d7413.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 16.关闭页面\n\n![如果弹出这个页面直接点击关闭即可。（没有弹出这个页面即可忽略这一步）](https://img-blog.csdnimg.cn/662c37fb78684e9e9d8183a9e68b2436.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 17.再次点击激活\n\n![重新到这个页面，再次点击激活](https://img-blog.csdnimg.cn/f0c61e0842434fc7ab1a4dce15ce3ae3.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 18.再次输入序列号【666-69696969】\n\n![再次输入序列号（666-69696969），点击下一步](https://img-blog.csdnimg.cn/e056395062bb4d7bad75a4d84803b103.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 19.点击我具有激活码\n\n![点击勾选下面的我具有Autodesk激活码](https://img-blog.csdnimg.cn/8320615752af41dc867afd2e36a5f825.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 20.运行注册机\n\n![返回解压包打开2020注册机文件夹，右击注册机管理员运行](https://img-blog.csdnimg.cn/bc7634736c2741dc80e55bfa1232fd69.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 21.修补注册机\n\n![这一步直接点击Patch，弹出小框，点击确定](https://img-blog.csdnimg.cn/29f2ef1989834538973a35f2bcfb8749.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 22.复制申请号\n\n![返回CAD 界面全选申请号，Ctrl+C复制](https://img-blog.csdnimg.cn/0d9c2d596270498583ec65ebfc41b712.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 23.粘贴申请号\n\n![将申请号Ctrl+V粘贴到注册机第一行。（注册机原有的英文删掉）](https://img-blog.csdnimg.cn/f0d0f653f9de4a8db9378df47c077ef8.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 24.生成激活码\n\n![先点击Generate生成出来下面的激活码，然后在全选激活码，Ctrl+C复制](https://img-blog.csdnimg.cn/4506cc615af4478ebba2dbc83267dcc5.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 25.粘贴激活码\n\n![返回CAD页面点击最前面的小框，然后Ctrl+V将激活码粘贴进来](https://img-blog.csdnimg.cn/072b8cca9b3142eea7dceea59924296d.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 26.点击下一步\n\n![](https://img-blog.csdnimg.cn/1e5ab754db1d42cb8621f7453793c118.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 27.许可激活成功\n\n![就此CAD2020成功激活，点击完成即可](https://img-blog.csdnimg.cn/bd336ae2536a4f5cb88e7215b42bc9ed.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n","source":"_posts/cad.md","raw":"---\ntitle: cad破解\ndate: 2022-12-04 14:38\ncategories: \n- [生活]\ntags:\n- 破解软件\n\n---\n\n由于对象是工程专业，需要用到cad软件，奈何公司也不给补助购买正版，那咱只能使用破解版了，整理了一下cad2020的破解步骤，其它版本也基本类似，做个备份\n<!--more-->\n\n> 软件下载地址 ：链接：https://pan.baidu.com/s/100omUwKALn63KugkmDdWUQ \n>\n#### 1.解压压缩包\n\n![成功下载CAD2020压缩包后鼠标右击解压到文件](https://img-blog.csdnimg.cn/79e8577a3fe54a16bb8720370fe9f543.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 2.运行安装CAD2020\n\n![打开解压出来的文件夹，右击管理员运行CAD2020.exe](https://img-blog.csdnimg.cn/e877504d59b84627b80b80b9b2024b44.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 3.解压安装程序\n\n![点击更改，选择其它盘，选择一个文件夹，点确定即可](https://img-blog.csdnimg.cn/09f5248ddc67425faea95798ad4e346f.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 4.正在解压安装程序\n\n![安装程序正在解压，耐心等待](https://img-blog.csdnimg.cn/46693ab24b7c474582bf3875b87bb126.png)\n\n#### 5.点击安装\n\n![解压成功后，点击安装](https://img-blog.csdnimg.cn/6562fce585cf4d19ad2e9fae1648c073.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 6.我接受，下一步\n\n![勾选我接受，点击下一步](https://img-blog.csdnimg.cn/9c17c205ac684936bfba0926b7616fd8.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 7.选择安装路径\n\n![点击浏览，选择其它盘，选择一个文件夹，点击安装](https://img-blog.csdnimg.cn/f0cc3f2f8ef8409c914e38b56866505b.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 8.正在安装\n\n![CAD2020正在安装，耐心等待片刻](https://img-blog.csdnimg.cn/077b470ec0e14e50b5697b3e603a22e3.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 9.忽略资源管理器\n\n![如果安装过程中弹出这个，点击忽略即可,没有不管](https://img-blog.csdnimg.cn/706223d6db2b4b169bfe4eac020bfbc6.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 10.安装成功\n\n![耐心等待片刻后成功安装，点击完成](https://img-blog.csdnimg.cn/ce3710d9f1e943cba77b3b2085f6fe1c.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 11.重新启动\n\n![如果弹出让你重新启动计算机，点击否,没有弹忽略](https://img-blog.csdnimg.cn/df2e92615fa24b0696d86fada960e728.png)\n\n#### 12.输入序列号\n\n![返回桌面启动CAD2020，弹出这个点击输入序列号按钮](https://img-blog.csdnimg.cn/9b251bf99f974fa7b8ca9189dcb1a291.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 13.我同意\n\n![这一步直接点击我同意即可](https://img-blog.csdnimg.cn/0d942a2025bb47daa5c3d645b2e4f571.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 14.点击激活\n\n![弹出激活页面，点击激活](https://img-blog.csdnimg.cn/9cb400e780c0425baf16dbe582735302.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 15.输入序列号【666-69696969】\n\n![这里输入序列号（666-69696969），点击下一步](https://img-blog.csdnimg.cn/aa94204b219544b2abeef9c23a2d7413.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 16.关闭页面\n\n![如果弹出这个页面直接点击关闭即可。（没有弹出这个页面即可忽略这一步）](https://img-blog.csdnimg.cn/662c37fb78684e9e9d8183a9e68b2436.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 17.再次点击激活\n\n![重新到这个页面，再次点击激活](https://img-blog.csdnimg.cn/f0c61e0842434fc7ab1a4dce15ce3ae3.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 18.再次输入序列号【666-69696969】\n\n![再次输入序列号（666-69696969），点击下一步](https://img-blog.csdnimg.cn/e056395062bb4d7bad75a4d84803b103.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 19.点击我具有激活码\n\n![点击勾选下面的我具有Autodesk激活码](https://img-blog.csdnimg.cn/8320615752af41dc867afd2e36a5f825.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 20.运行注册机\n\n![返回解压包打开2020注册机文件夹，右击注册机管理员运行](https://img-blog.csdnimg.cn/bc7634736c2741dc80e55bfa1232fd69.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 21.修补注册机\n\n![这一步直接点击Patch，弹出小框，点击确定](https://img-blog.csdnimg.cn/29f2ef1989834538973a35f2bcfb8749.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 22.复制申请号\n\n![返回CAD 界面全选申请号，Ctrl+C复制](https://img-blog.csdnimg.cn/0d9c2d596270498583ec65ebfc41b712.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 23.粘贴申请号\n\n![将申请号Ctrl+V粘贴到注册机第一行。（注册机原有的英文删掉）](https://img-blog.csdnimg.cn/f0d0f653f9de4a8db9378df47c077ef8.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 24.生成激活码\n\n![先点击Generate生成出来下面的激活码，然后在全选激活码，Ctrl+C复制](https://img-blog.csdnimg.cn/4506cc615af4478ebba2dbc83267dcc5.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 25.粘贴激活码\n\n![返回CAD页面点击最前面的小框，然后Ctrl+V将激活码粘贴进来](https://img-blog.csdnimg.cn/072b8cca9b3142eea7dceea59924296d.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 26.点击下一步\n\n![](https://img-blog.csdnimg.cn/1e5ab754db1d42cb8621f7453793c118.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n\n#### 27.许可激活成功\n\n![就此CAD2020成功激活，点击完成即可](https://img-blog.csdnimg.cn/bd336ae2536a4f5cb88e7215b42bc9ed.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16)\n","slug":"cad","published":1,"updated":"2022-12-04T07:06:33.472Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clb91t0li000g9sjnep556msb","content":"<p>由于对象是工程专业，需要用到cad软件，奈何公司也不给补助购买正版，那咱只能使用破解版了，整理了一下cad2020的破解步骤，其它版本也基本类似，做个备份</p>\n<span id=\"more\"></span>\n\n<blockquote>\n<p>软件下载地址 ：链接：<a href=\"https://pan.baidu.com/s/100omUwKALn63KugkmDdWUQ\">https://pan.baidu.com/s/100omUwKALn63KugkmDdWUQ</a> </p>\n</blockquote>\n<h4 id=\"1-解压压缩包\"><a href=\"#1-解压压缩包\" class=\"headerlink\" title=\"1.解压压缩包\"></a>1.解压压缩包</h4><p><img src=\"https://img-blog.csdnimg.cn/79e8577a3fe54a16bb8720370fe9f543.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/79e8577a3fe54a16bb8720370fe9f543.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"成功下载CAD2020压缩包后鼠标右击解压到文件\"></p>\n<h4 id=\"2-运行安装CAD2020\"><a href=\"#2-运行安装CAD2020\" class=\"headerlink\" title=\"2.运行安装CAD2020\"></a>2.运行安装CAD2020</h4><p><img src=\"https://img-blog.csdnimg.cn/e877504d59b84627b80b80b9b2024b44.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/e877504d59b84627b80b80b9b2024b44.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"打开解压出来的文件夹，右击管理员运行CAD2020.exe\"></p>\n<h4 id=\"3-解压安装程序\"><a href=\"#3-解压安装程序\" class=\"headerlink\" title=\"3.解压安装程序\"></a>3.解压安装程序</h4><p><img src=\"https://img-blog.csdnimg.cn/09f5248ddc67425faea95798ad4e346f.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/09f5248ddc67425faea95798ad4e346f.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"点击更改，选择其它盘，选择一个文件夹，点确定即可\"></p>\n<h4 id=\"4-正在解压安装程序\"><a href=\"#4-正在解压安装程序\" class=\"headerlink\" title=\"4.正在解压安装程序\"></a>4.正在解压安装程序</h4><p><img src=\"https://img-blog.csdnimg.cn/46693ab24b7c474582bf3875b87bb126.png\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/46693ab24b7c474582bf3875b87bb126.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"安装程序正在解压，耐心等待\"></p>\n<h4 id=\"5-点击安装\"><a href=\"#5-点击安装\" class=\"headerlink\" title=\"5.点击安装\"></a>5.点击安装</h4><p><img src=\"https://img-blog.csdnimg.cn/6562fce585cf4d19ad2e9fae1648c073.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/6562fce585cf4d19ad2e9fae1648c073.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"解压成功后，点击安装\"></p>\n<h4 id=\"6-我接受，下一步\"><a href=\"#6-我接受，下一步\" class=\"headerlink\" title=\"6.我接受，下一步\"></a>6.我接受，下一步</h4><p><img src=\"https://img-blog.csdnimg.cn/9c17c205ac684936bfba0926b7616fd8.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/9c17c205ac684936bfba0926b7616fd8.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"勾选我接受，点击下一步\"></p>\n<h4 id=\"7-选择安装路径\"><a href=\"#7-选择安装路径\" class=\"headerlink\" title=\"7.选择安装路径\"></a>7.选择安装路径</h4><p><img src=\"https://img-blog.csdnimg.cn/f0cc3f2f8ef8409c914e38b56866505b.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/f0cc3f2f8ef8409c914e38b56866505b.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"点击浏览，选择其它盘，选择一个文件夹，点击安装\"></p>\n<h4 id=\"8-正在安装\"><a href=\"#8-正在安装\" class=\"headerlink\" title=\"8.正在安装\"></a>8.正在安装</h4><p><img src=\"https://img-blog.csdnimg.cn/077b470ec0e14e50b5697b3e603a22e3.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/077b470ec0e14e50b5697b3e603a22e3.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"CAD2020正在安装，耐心等待片刻\"></p>\n<h4 id=\"9-忽略资源管理器\"><a href=\"#9-忽略资源管理器\" class=\"headerlink\" title=\"9.忽略资源管理器\"></a>9.忽略资源管理器</h4><p><img src=\"https://img-blog.csdnimg.cn/706223d6db2b4b169bfe4eac020bfbc6.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/706223d6db2b4b169bfe4eac020bfbc6.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"如果安装过程中弹出这个，点击忽略即可,没有不管\"></p>\n<h4 id=\"10-安装成功\"><a href=\"#10-安装成功\" class=\"headerlink\" title=\"10.安装成功\"></a>10.安装成功</h4><p><img src=\"https://img-blog.csdnimg.cn/ce3710d9f1e943cba77b3b2085f6fe1c.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/ce3710d9f1e943cba77b3b2085f6fe1c.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"耐心等待片刻后成功安装，点击完成\"></p>\n<h4 id=\"11-重新启动\"><a href=\"#11-重新启动\" class=\"headerlink\" title=\"11.重新启动\"></a>11.重新启动</h4><p><img src=\"https://img-blog.csdnimg.cn/df2e92615fa24b0696d86fada960e728.png\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/df2e92615fa24b0696d86fada960e728.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"如果弹出让你重新启动计算机，点击否,没有弹忽略\"></p>\n<h4 id=\"12-输入序列号\"><a href=\"#12-输入序列号\" class=\"headerlink\" title=\"12.输入序列号\"></a>12.输入序列号</h4><p><img src=\"https://img-blog.csdnimg.cn/9b251bf99f974fa7b8ca9189dcb1a291.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/9b251bf99f974fa7b8ca9189dcb1a291.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"返回桌面启动CAD2020，弹出这个点击输入序列号按钮\"></p>\n<h4 id=\"13-我同意\"><a href=\"#13-我同意\" class=\"headerlink\" title=\"13.我同意\"></a>13.我同意</h4><p><img src=\"https://img-blog.csdnimg.cn/0d942a2025bb47daa5c3d645b2e4f571.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/0d942a2025bb47daa5c3d645b2e4f571.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"这一步直接点击我同意即可\"></p>\n<h4 id=\"14-点击激活\"><a href=\"#14-点击激活\" class=\"headerlink\" title=\"14.点击激活\"></a>14.点击激活</h4><p><img src=\"https://img-blog.csdnimg.cn/9cb400e780c0425baf16dbe582735302.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/9cb400e780c0425baf16dbe582735302.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"弹出激活页面，点击激活\"></p>\n<h4 id=\"15-输入序列号【666-69696969】\"><a href=\"#15-输入序列号【666-69696969】\" class=\"headerlink\" title=\"15.输入序列号【666-69696969】\"></a>15.输入序列号【666-69696969】</h4><p><img src=\"https://img-blog.csdnimg.cn/aa94204b219544b2abeef9c23a2d7413.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/aa94204b219544b2abeef9c23a2d7413.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"这里输入序列号（666-69696969），点击下一步\"></p>\n<h4 id=\"16-关闭页面\"><a href=\"#16-关闭页面\" class=\"headerlink\" title=\"16.关闭页面\"></a>16.关闭页面</h4><p><img src=\"https://img-blog.csdnimg.cn/662c37fb78684e9e9d8183a9e68b2436.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/662c37fb78684e9e9d8183a9e68b2436.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"如果弹出这个页面直接点击关闭即可。（没有弹出这个页面即可忽略这一步）\"></p>\n<h4 id=\"17-再次点击激活\"><a href=\"#17-再次点击激活\" class=\"headerlink\" title=\"17.再次点击激活\"></a>17.再次点击激活</h4><p><img src=\"https://img-blog.csdnimg.cn/f0c61e0842434fc7ab1a4dce15ce3ae3.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/f0c61e0842434fc7ab1a4dce15ce3ae3.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"重新到这个页面，再次点击激活\"></p>\n<h4 id=\"18-再次输入序列号【666-69696969】\"><a href=\"#18-再次输入序列号【666-69696969】\" class=\"headerlink\" title=\"18.再次输入序列号【666-69696969】\"></a>18.再次输入序列号【666-69696969】</h4><p><img src=\"https://img-blog.csdnimg.cn/e056395062bb4d7bad75a4d84803b103.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/e056395062bb4d7bad75a4d84803b103.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"再次输入序列号（666-69696969），点击下一步\"></p>\n<h4 id=\"19-点击我具有激活码\"><a href=\"#19-点击我具有激活码\" class=\"headerlink\" title=\"19.点击我具有激活码\"></a>19.点击我具有激活码</h4><p><img src=\"https://img-blog.csdnimg.cn/8320615752af41dc867afd2e36a5f825.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/8320615752af41dc867afd2e36a5f825.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"点击勾选下面的我具有Autodesk激活码\"></p>\n<h4 id=\"20-运行注册机\"><a href=\"#20-运行注册机\" class=\"headerlink\" title=\"20.运行注册机\"></a>20.运行注册机</h4><p><img src=\"https://img-blog.csdnimg.cn/bc7634736c2741dc80e55bfa1232fd69.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/bc7634736c2741dc80e55bfa1232fd69.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"返回解压包打开2020注册机文件夹，右击注册机管理员运行\"></p>\n<h4 id=\"21-修补注册机\"><a href=\"#21-修补注册机\" class=\"headerlink\" title=\"21.修补注册机\"></a>21.修补注册机</h4><p><img src=\"https://img-blog.csdnimg.cn/29f2ef1989834538973a35f2bcfb8749.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/29f2ef1989834538973a35f2bcfb8749.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"这一步直接点击Patch，弹出小框，点击确定\"></p>\n<h4 id=\"22-复制申请号\"><a href=\"#22-复制申请号\" class=\"headerlink\" title=\"22.复制申请号\"></a>22.复制申请号</h4><p><img src=\"https://img-blog.csdnimg.cn/0d9c2d596270498583ec65ebfc41b712.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/0d9c2d596270498583ec65ebfc41b712.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"返回CAD 界面全选申请号，Ctrl+C复制\"></p>\n<h4 id=\"23-粘贴申请号\"><a href=\"#23-粘贴申请号\" class=\"headerlink\" title=\"23.粘贴申请号\"></a>23.粘贴申请号</h4><p><img src=\"https://img-blog.csdnimg.cn/f0d0f653f9de4a8db9378df47c077ef8.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/f0d0f653f9de4a8db9378df47c077ef8.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"将申请号Ctrl+V粘贴到注册机第一行。（注册机原有的英文删掉）\"></p>\n<h4 id=\"24-生成激活码\"><a href=\"#24-生成激活码\" class=\"headerlink\" title=\"24.生成激活码\"></a>24.生成激活码</h4><p><img src=\"https://img-blog.csdnimg.cn/4506cc615af4478ebba2dbc83267dcc5.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/4506cc615af4478ebba2dbc83267dcc5.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"先点击Generate生成出来下面的激活码，然后在全选激活码，Ctrl+C复制\"></p>\n<h4 id=\"25-粘贴激活码\"><a href=\"#25-粘贴激活码\" class=\"headerlink\" title=\"25.粘贴激活码\"></a>25.粘贴激活码</h4><p><img src=\"https://img-blog.csdnimg.cn/072b8cca9b3142eea7dceea59924296d.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/072b8cca9b3142eea7dceea59924296d.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"返回CAD页面点击最前面的小框，然后Ctrl+V将激活码粘贴进来\"></p>\n<h4 id=\"26-点击下一步\"><a href=\"#26-点击下一步\" class=\"headerlink\" title=\"26.点击下一步\"></a>26.点击下一步</h4><p><img src=\"https://img-blog.csdnimg.cn/1e5ab754db1d42cb8621f7453793c118.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/1e5ab754db1d42cb8621f7453793c118.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\"></p>\n<h4 id=\"27-许可激活成功\"><a href=\"#27-许可激活成功\" class=\"headerlink\" title=\"27.许可激活成功\"></a>27.许可激活成功</h4><p><img src=\"https://img-blog.csdnimg.cn/bd336ae2536a4f5cb88e7215b42bc9ed.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/bd336ae2536a4f5cb88e7215b42bc9ed.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"就此CAD2020成功激活，点击完成即可\"></p>\n","site":{"data":{}},"excerpt":"<p>由于对象是工程专业，需要用到cad软件，奈何公司也不给补助购买正版，那咱只能使用破解版了，整理了一下cad2020的破解步骤，其它版本也基本类似，做个备份</p>","more":"<blockquote>\n<p>软件下载地址 ：链接：<a href=\"https://pan.baidu.com/s/100omUwKALn63KugkmDdWUQ\">https://pan.baidu.com/s/100omUwKALn63KugkmDdWUQ</a> </p>\n</blockquote>\n<h4 id=\"1-解压压缩包\"><a href=\"#1-解压压缩包\" class=\"headerlink\" title=\"1.解压压缩包\"></a>1.解压压缩包</h4><p><img src=\"https://img-blog.csdnimg.cn/79e8577a3fe54a16bb8720370fe9f543.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"成功下载CAD2020压缩包后鼠标右击解压到文件\"></p>\n<h4 id=\"2-运行安装CAD2020\"><a href=\"#2-运行安装CAD2020\" class=\"headerlink\" title=\"2.运行安装CAD2020\"></a>2.运行安装CAD2020</h4><p><img src=\"https://img-blog.csdnimg.cn/e877504d59b84627b80b80b9b2024b44.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"打开解压出来的文件夹，右击管理员运行CAD2020.exe\"></p>\n<h4 id=\"3-解压安装程序\"><a href=\"#3-解压安装程序\" class=\"headerlink\" title=\"3.解压安装程序\"></a>3.解压安装程序</h4><p><img src=\"https://img-blog.csdnimg.cn/09f5248ddc67425faea95798ad4e346f.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"点击更改，选择其它盘，选择一个文件夹，点确定即可\"></p>\n<h4 id=\"4-正在解压安装程序\"><a href=\"#4-正在解压安装程序\" class=\"headerlink\" title=\"4.正在解压安装程序\"></a>4.正在解压安装程序</h4><p><img src=\"https://img-blog.csdnimg.cn/46693ab24b7c474582bf3875b87bb126.png\" alt=\"安装程序正在解压，耐心等待\"></p>\n<h4 id=\"5-点击安装\"><a href=\"#5-点击安装\" class=\"headerlink\" title=\"5.点击安装\"></a>5.点击安装</h4><p><img src=\"https://img-blog.csdnimg.cn/6562fce585cf4d19ad2e9fae1648c073.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"解压成功后，点击安装\"></p>\n<h4 id=\"6-我接受，下一步\"><a href=\"#6-我接受，下一步\" class=\"headerlink\" title=\"6.我接受，下一步\"></a>6.我接受，下一步</h4><p><img src=\"https://img-blog.csdnimg.cn/9c17c205ac684936bfba0926b7616fd8.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"勾选我接受，点击下一步\"></p>\n<h4 id=\"7-选择安装路径\"><a href=\"#7-选择安装路径\" class=\"headerlink\" title=\"7.选择安装路径\"></a>7.选择安装路径</h4><p><img src=\"https://img-blog.csdnimg.cn/f0cc3f2f8ef8409c914e38b56866505b.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"点击浏览，选择其它盘，选择一个文件夹，点击安装\"></p>\n<h4 id=\"8-正在安装\"><a href=\"#8-正在安装\" class=\"headerlink\" title=\"8.正在安装\"></a>8.正在安装</h4><p><img src=\"https://img-blog.csdnimg.cn/077b470ec0e14e50b5697b3e603a22e3.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"CAD2020正在安装，耐心等待片刻\"></p>\n<h4 id=\"9-忽略资源管理器\"><a href=\"#9-忽略资源管理器\" class=\"headerlink\" title=\"9.忽略资源管理器\"></a>9.忽略资源管理器</h4><p><img src=\"https://img-blog.csdnimg.cn/706223d6db2b4b169bfe4eac020bfbc6.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"如果安装过程中弹出这个，点击忽略即可,没有不管\"></p>\n<h4 id=\"10-安装成功\"><a href=\"#10-安装成功\" class=\"headerlink\" title=\"10.安装成功\"></a>10.安装成功</h4><p><img src=\"https://img-blog.csdnimg.cn/ce3710d9f1e943cba77b3b2085f6fe1c.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"耐心等待片刻后成功安装，点击完成\"></p>\n<h4 id=\"11-重新启动\"><a href=\"#11-重新启动\" class=\"headerlink\" title=\"11.重新启动\"></a>11.重新启动</h4><p><img src=\"https://img-blog.csdnimg.cn/df2e92615fa24b0696d86fada960e728.png\" alt=\"如果弹出让你重新启动计算机，点击否,没有弹忽略\"></p>\n<h4 id=\"12-输入序列号\"><a href=\"#12-输入序列号\" class=\"headerlink\" title=\"12.输入序列号\"></a>12.输入序列号</h4><p><img src=\"https://img-blog.csdnimg.cn/9b251bf99f974fa7b8ca9189dcb1a291.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"返回桌面启动CAD2020，弹出这个点击输入序列号按钮\"></p>\n<h4 id=\"13-我同意\"><a href=\"#13-我同意\" class=\"headerlink\" title=\"13.我同意\"></a>13.我同意</h4><p><img src=\"https://img-blog.csdnimg.cn/0d942a2025bb47daa5c3d645b2e4f571.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"这一步直接点击我同意即可\"></p>\n<h4 id=\"14-点击激活\"><a href=\"#14-点击激活\" class=\"headerlink\" title=\"14.点击激活\"></a>14.点击激活</h4><p><img src=\"https://img-blog.csdnimg.cn/9cb400e780c0425baf16dbe582735302.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"弹出激活页面，点击激活\"></p>\n<h4 id=\"15-输入序列号【666-69696969】\"><a href=\"#15-输入序列号【666-69696969】\" class=\"headerlink\" title=\"15.输入序列号【666-69696969】\"></a>15.输入序列号【666-69696969】</h4><p><img src=\"https://img-blog.csdnimg.cn/aa94204b219544b2abeef9c23a2d7413.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"这里输入序列号（666-69696969），点击下一步\"></p>\n<h4 id=\"16-关闭页面\"><a href=\"#16-关闭页面\" class=\"headerlink\" title=\"16.关闭页面\"></a>16.关闭页面</h4><p><img src=\"https://img-blog.csdnimg.cn/662c37fb78684e9e9d8183a9e68b2436.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"如果弹出这个页面直接点击关闭即可。（没有弹出这个页面即可忽略这一步）\"></p>\n<h4 id=\"17-再次点击激活\"><a href=\"#17-再次点击激活\" class=\"headerlink\" title=\"17.再次点击激活\"></a>17.再次点击激活</h4><p><img src=\"https://img-blog.csdnimg.cn/f0c61e0842434fc7ab1a4dce15ce3ae3.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"重新到这个页面，再次点击激活\"></p>\n<h4 id=\"18-再次输入序列号【666-69696969】\"><a href=\"#18-再次输入序列号【666-69696969】\" class=\"headerlink\" title=\"18.再次输入序列号【666-69696969】\"></a>18.再次输入序列号【666-69696969】</h4><p><img src=\"https://img-blog.csdnimg.cn/e056395062bb4d7bad75a4d84803b103.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"再次输入序列号（666-69696969），点击下一步\"></p>\n<h4 id=\"19-点击我具有激活码\"><a href=\"#19-点击我具有激活码\" class=\"headerlink\" title=\"19.点击我具有激活码\"></a>19.点击我具有激活码</h4><p><img src=\"https://img-blog.csdnimg.cn/8320615752af41dc867afd2e36a5f825.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"点击勾选下面的我具有Autodesk激活码\"></p>\n<h4 id=\"20-运行注册机\"><a href=\"#20-运行注册机\" class=\"headerlink\" title=\"20.运行注册机\"></a>20.运行注册机</h4><p><img src=\"https://img-blog.csdnimg.cn/bc7634736c2741dc80e55bfa1232fd69.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"返回解压包打开2020注册机文件夹，右击注册机管理员运行\"></p>\n<h4 id=\"21-修补注册机\"><a href=\"#21-修补注册机\" class=\"headerlink\" title=\"21.修补注册机\"></a>21.修补注册机</h4><p><img src=\"https://img-blog.csdnimg.cn/29f2ef1989834538973a35f2bcfb8749.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"这一步直接点击Patch，弹出小框，点击确定\"></p>\n<h4 id=\"22-复制申请号\"><a href=\"#22-复制申请号\" class=\"headerlink\" title=\"22.复制申请号\"></a>22.复制申请号</h4><p><img src=\"https://img-blog.csdnimg.cn/0d9c2d596270498583ec65ebfc41b712.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"返回CAD 界面全选申请号，Ctrl+C复制\"></p>\n<h4 id=\"23-粘贴申请号\"><a href=\"#23-粘贴申请号\" class=\"headerlink\" title=\"23.粘贴申请号\"></a>23.粘贴申请号</h4><p><img src=\"https://img-blog.csdnimg.cn/f0d0f653f9de4a8db9378df47c077ef8.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"将申请号Ctrl+V粘贴到注册机第一行。（注册机原有的英文删掉）\"></p>\n<h4 id=\"24-生成激活码\"><a href=\"#24-生成激活码\" class=\"headerlink\" title=\"24.生成激活码\"></a>24.生成激活码</h4><p><img src=\"https://img-blog.csdnimg.cn/4506cc615af4478ebba2dbc83267dcc5.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"先点击Generate生成出来下面的激活码，然后在全选激活码，Ctrl+C复制\"></p>\n<h4 id=\"25-粘贴激活码\"><a href=\"#25-粘贴激活码\" class=\"headerlink\" title=\"25.粘贴激活码\"></a>25.粘贴激活码</h4><p><img src=\"https://img-blog.csdnimg.cn/072b8cca9b3142eea7dceea59924296d.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"返回CAD页面点击最前面的小框，然后Ctrl+V将激活码粘贴进来\"></p>\n<h4 id=\"26-点击下一步\"><a href=\"#26-点击下一步\" class=\"headerlink\" title=\"26.点击下一步\"></a>26.点击下一步</h4><p><img src=\"https://img-blog.csdnimg.cn/1e5ab754db1d42cb8621f7453793c118.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\"></p>\n<h4 id=\"27-许可激活成功\"><a href=\"#27-许可激活成功\" class=\"headerlink\" title=\"27.许可激活成功\"></a>27.许可激活成功</h4><p><img src=\"https://img-blog.csdnimg.cn/bd336ae2536a4f5cb88e7215b42bc9ed.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16\" alt=\"就此CAD2020成功激活，点击完成即可\"></p>","popularPost_tmp_postPath":true,"eyeCatchImage":"https://img-blog.csdnimg.cn/79e8577a3fe54a16bb8720370fe9f543.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16","popularPost_tmp_gaData":{"updated":"Sun Dec 04 2022 15:06:33 GMT+0800 (中国标准时间)","title":"cad破解","path":"2022/12/04/cad/","eyeCatchImage":"https://img-blog.csdnimg.cn/79e8577a3fe54a16bb8720370fe9f543.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_Q1NETiBA5ZGA77yB6IOW5q275oiR566X5LqG,size_14,color_FFFFFF,t_70,g_se,x_16","excerpt":"<p>由于对象是工程专业，需要用到cad软件，奈何公司也不给补助购买正版，那咱只能使用破解版了，整理了一下cad2020的破解步骤，其它版本也基本类似，做个备份</p>","date":{"_isAMomentObject":true,"_i":"2022-12-04T06:38:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-12-04T06:38:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"生活","tags":["破解软件"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"Hexo文章Front-matter示例","date":"2021-12-31T16:00:00.000Z","updated":"2021-12-31T16:00:01.000Z","seo_title":"这是seo标题","keywords":"测试 关键词 展示","description":"这是测试hexo的文章格式页面","pin":false,"archive":false,"references":[{"title":"某篇文章1","url":"https://aaa.com"},{"title":"某篇文章2","url":"https://bbb.com"}],"_content":"\n这是摘要\n<!-- more -->\n\n这是正文\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hexo文章Front-matter示例\ndate: 2022-01-01 00:00:00\nupdated: 2022-01-01 00:00:01\n\nseo_title: 这是seo标题\nkeywords: 测试 关键词 展示\ndescription: 这是测试hexo的文章格式页面\n\npin: false\narchive: false\n\nreferences:\n  - title: 某篇文章1\n    url: https://aaa.com\n  - title: 某篇文章2\n    url: https://bbb.com\n---\n\n这是摘要\n<!-- more -->\n\n这是正文\n","slug":"hello-world","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"clb91t0lk000i9sjnebnnh6bz","content":"<p>这是摘要</p>\n<span id=\"more\"></span>\n\n<p>这是正文</p>\n","site":{"data":{}},"excerpt":"<p>这是摘要</p>","more":"<p>这是正文</p>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sat Jan 01 2022 00:00:01 GMT+0800 (中国标准时间)","title":"Hexo文章Front-matter示例","path":"2022/01/01/hello-world/","eyeCatchImage":null,"excerpt":"这是测试hexo的文章格式页面","date":{"_isAMomentObject":true,"_i":"2021-12-31T16:00:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2021-12-31T16:00:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"","tags":[],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"JDK动态代理详解","description":"JDK动态代理的源码，JDK动态代理为什么不能代理实现类，JDK动态代理为什么只能代理接口","keywords":"JDK动态代理,JDK动态代理源码,JDK动态代理原理","date":"2022-12-04T06:38:00.000Z","_content":"\n## 使用\n\n创建接口\n\n~~~java\npublic interface Father {\n    void eat();\n}\n~~~\n\n创建实现类\n\n~~~ java\npublic class Son implements Father{\n\n    @Override\n    public void eat() {\n        System.out.println(\"吃饭\");\n    }\n}\n~~~\n\n测试\n\n~~~java\npublic class ProxyTest {\n\n    public static void main(String[] args) {\n        ProxyTest test = new ProxyTest();\n        test.jdkProxy();\n    }\n\n    private void jdkProxy(){\n        Father son = new Son();\n        \n        Father proxySon = (Father) Proxy.newProxyInstance(son.getClass().getClassLoader(), son.getClass().getInterfaces(), new InvocationHandler() {\n            @Override\n            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n                System.out.println(\"做饭\");\n\n                Object invoke = method.invoke(son, args);\n\n                System.out.println(\"洗碗\");\n\n                return invoke;\n            }\n        });\n\n        proxySon.eat();\n    }\n~~~\n\n输出结果\n\n~~~java\n做饭\n吃饭\n洗碗\n~~~\n\n如上，是一个使用JDK动态代理的简单例子，通过Proxy类的静态方法newProxyInstance可以生成目标类的代理类，这里有几个疑问：\n\n* 为什么要使用实例对象的ClassLoader和Interfaces，使用其实例对象的行不行，使用类的行不行\n* 为什么被代理类非要实现接口\n* newProxyInstance返回的代理类是什么类型，强转成实现类（Father proxySon = (Son) Proxy.newProxyInstance(...)）会不会报错\n\n我们带着这几个问题看看源码\n\n## 源码\n\n### java.lang.reflect.Proxy\n\n```java\npublic static Object newProxyInstance(ClassLoader loader,\n                                      Class<?>[] interfaces,\n                                      InvocationHandler h)\n    throws IllegalArgumentException\n{\n    Objects.requireNonNull(h);\n    // 克隆被代理类的接口Class对象\n    final Class<?>[] intfs = interfaces.clone();\n    // 使用Java安全管理器校验程序，防止恶心代码\n    final SecurityManager sm = System.getSecurityManager();\n    if (sm != null) {\n        checkProxyAccess(Reflection.getCallerClass(), loader, intfs);\n    }\n\n    /*\n     * Look up or generate the designated proxy class.\n     * 查找或生成指定的代理类。这里会使用缓存，缓存里没有就创建代理类，放放到缓存中\n     * 接下来我们进入这个方法看看\n     */\n    Class<?> cl = getProxyClass0(loader, intfs);\n\n    /*\n     * Invoke its constructor with the designated invocation handler.\n     * 使用指定的调用处理程序调用其构造函数。\n     */\n    try {\n        if (sm != null) {\n            checkNewProxyPermission(Reflection.getCallerClass(), cl);\n        }\n\n        // 获取代理类的构造器，这里会生成一个入参为InvocationHandler.class的构造器\n        final Constructor<?> cons = cl.getConstructor(constructorParams);\n        final InvocationHandler ih = h;\n        if (!Modifier.isPublic(cl.getModifiers())) {\n            AccessController.doPrivileged(new PrivilegedAction<Void>() {\n                public Void run() {\n                    cons.setAccessible(true);\n                    return null;\n                }\n            });\n        }\n        // 通过反射使用构造方法（带有InvocationHandler入参的构造方法）创建代理类的实例对象\n        return cons.newInstance(new Object[]{h});\n    } catch (IllegalAccessException|InstantiationException e) {\n        throw new InternalError(e.toString(), e);\n    } catch (InvocationTargetException e) {\n        Throwable t = e.getCause();\n        if (t instanceof RuntimeException) {\n            throw (RuntimeException) t;\n        } else {\n            throw new InternalError(t.toString(), t);\n        }\n    } catch (NoSuchMethodException e) {\n        throw new InternalError(e.toString(), e);\n    }\n}\n```\n\n~~~java\nprivate static Class<?> getProxyClass0(ClassLoader loader,\n                                           Class<?>... interfaces) {\n    \t// 这里为什么是65535？\n        if (interfaces.length > 65535) {\n            throw new IllegalArgumentException(\"interface limit exceeded\");\n        }\n\n        // If the proxy class defined by the given loader implementing\n        // the given interfaces exists, this will simply return the cached copy;\n        // otherwise, it will create the proxy class via the ProxyClassFactory\n    \t/**\n    \t* 如果给定加载器定义的代理类实现,给定的接口存在，这将简单地返回缓存的副本；否则，它将通过 ProxyClassFactory 创建代理类\n    \t* 在进入这个方法看看\n\t\t/\n        return proxyClassCache.get(loader, interfaces);\n    }\n~~~\n###  java.lang.reflect.WeakCache\n~~~java\npublic V get(K key, P parameter) {\n        Objects.requireNonNull(parameter);\n\n        expungeStaleEntries();\n\n        Object cacheKey = CacheKey.valueOf(key, refQueue);\n\n        // lazily install the 2nd level valuesMap for the particular cacheKey\n        ConcurrentMap<Object, Supplier<V>> valuesMap = map.get(cacheKey);\n        if (valuesMap == null) {\n            ConcurrentMap<Object, Supplier<V>> oldValuesMap\n                = map.putIfAbsent(cacheKey,\n                                  valuesMap = new ConcurrentHashMap<>());\n            if (oldValuesMap != null) {\n                valuesMap = oldValuesMap;\n            }\n        }\n\n        // create subKey and retrieve the possible Supplier<V> stored by that\n        // subKey from valuesMap\n    \t// 其它代码先不关注，这里的apply方法会调用$ProxyClassFactory的apply方法\n        Object subKey = Objects.requireNonNull(subKeyFactory.apply(key, parameter));\n        Supplier<V> supplier = valuesMap.get(subKey);\n        Factory factory = null;\n\n        ...\n    }\n~~~\n###  java.lang.reflect.Proxy\n~~~java\nprivate static final class ProxyClassFactory\n        implements BiFunction<ClassLoader, Class<?>[], Class<?>>\n    {\n        // prefix for all proxy class names\n    \t// 代理类名前缀\n        private static final String proxyClassNamePrefix = \"$Proxy\";\n\n        // next number to use for generation of unique proxy class names\n        private static final AtomicLong nextUniqueNumber = new AtomicLong();\n\n        @Override\n        public Class<?> apply(ClassLoader loader, Class<?>[] interfaces) {\n\n            Map<Class<?>, Boolean> interfaceSet = new IdentityHashMap<>(interfaces.length);\n            for (Class<?> intf : interfaces) {\n                /*\n                 * Verify that the class loader resolves the name of this\n                 * interface to the same Class object.\n                 */\n                Class<?> interfaceClass = null;\n                try {\n                    // 循环获取被代理类的接口结合的Class对象\n                    interfaceClass = Class.forName(intf.getName(), false, loader);\n                } catch (ClassNotFoundException e) {\n                }\n                if (interfaceClass != intf) {\n                    throw new IllegalArgumentException(\n                        intf + \" is not visible from class loader\");\n                }\n                /*\n                 * Verify that the Class object actually represents an\n                 * interface.\n                 */\n                if (!interfaceClass.isInterface()) {\n                    throw new IllegalArgumentException(\n                        interfaceClass.getName() + \" is not an interface\");\n                }\n                /*\n                 * Verify that this interface is not a duplicate.\n                 */\n                if (interfaceSet.put(interfaceClass, Boolean.TRUE) != null) {\n                    throw new IllegalArgumentException(\n                        \"repeated interface: \" + interfaceClass.getName());\n                }\n            }\n\n            String proxyPkg = null;     // package to define proxy class in\n            int accessFlags = Modifier.PUBLIC | Modifier.FINAL;\n\n            /*\n             * Record the package of a non-public proxy interface so that the\n             * proxy class will be defined in the same package.  Verify that\n             * all non-public proxy interfaces are in the same package.\n             */\n            for (Class<?> intf : interfaces) {\n                int flags = intf.getModifiers();\n                if (!Modifier.isPublic(flags)) {\n                    accessFlags = Modifier.FINAL;\n                    String name = intf.getName();\n                    int n = name.lastIndexOf('.');\n                    String pkg = ((n == -1) ? \"\" : name.substring(0, n + 1));\n                    if (proxyPkg == null) {\n                        proxyPkg = pkg;\n                    } else if (!pkg.equals(proxyPkg)) {\n                        throw new IllegalArgumentException(\n                            \"non-public interfaces from different packages\");\n                    }\n                }\n            }\n\n            if (proxyPkg == null) {\n                // if no non-public proxy interfaces, use com.sun.proxy package\n                proxyPkg = ReflectUtil.PROXY_PACKAGE + \".\";\n            }\n\n            /*\n             * Choose a name for the proxy class to generate.\n             */\n            long num = nextUniqueNumber.getAndIncrement();\n            // com.sun.proxy.  +  $Proxy   + 0\n            String proxyName = proxyPkg + proxyClassNamePrefix + num;\n\n            /*\n             * Generate the specified proxy class.\n             * 生成指定的代理类文件，并判断是否需要持久化，这里只是普通的文件字节数组，jvm并不认识\n             */\n            byte[] proxyClassFile = ProxyGenerator.generateProxyClass(\n                proxyName, interfaces, accessFlags);\n            try {\n                // 定义代理类，加载到jvm中，生成真正可以使用的运行时代理类的Class对象，\n                return defineClass0(loader, proxyName,\n                                    proxyClassFile, 0, proxyClassFile.length);\n            } catch (ClassFormatError e) {\n                /*\n                 * A ClassFormatError here means that (barring bugs in the\n                 * proxy class generation code) there was some other\n                 * invalid aspect of the arguments supplied to the proxy\n                 * class creation (such as virtual machine limitations\n                 * exceeded).\n                 */\n                throw new IllegalArgumentException(e.toString());\n            }\n        }\n    }\n~~~\n\n## 分析\n\nbyte[] proxyClassFile = ProxyGenerator.generateProxyClass(proxyName, interfaces, accessFlags);这块代码可以生成代理类的字节数组，那么我们是不是可以看看生成的代理类到底长什么样呢？写个测试方法看看\n\n~~~java\nprivate void write(){\n        Father father = new Son();\n\n        byte[] proxyArr = ProxyGenerator.generateProxyClass(\"$Proxy0\", father.getClass().getInterfaces());\n\n        try {\n            Files.write(Paths.get(\"C:\\\\Users\\\\wxt\\\\Desktop\\\\test.class\"), proxyArr);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n~~~\n\n文件内容\n\n~~~java\n// 代理类默认继承了Proxy类，实现了被代理类的接口\npublic final class $Proxy0 extends Proxy implements Father {\n    private static Method m1;\n    private static Method m3;\n    private static Method m2;\n    private static Method m0;\n    \n    static {\n        try {\n            // 这里初始化4个成员变量\n            m1 = Class.forName(\"java.lang.Object\").getMethod(\"equals\", Class.forName(\"java.lang.Object\"));\n            m3 = Class.forName(\"com.wangxt.wxt.design.patterns.proxy.dynamic.Father\").getMethod(\"eat\");\n            m2 = Class.forName(\"java.lang.Object\").getMethod(\"toString\");\n            m0 = Class.forName(\"java.lang.Object\").getMethod(\"hashCode\");\n        } catch (NoSuchMethodException var2) {\n            throw new NoSuchMethodError(var2.getMessage());\n        } catch (ClassNotFoundException var3) {\n            throw new NoClassDefFoundError(var3.getMessage());\n        }\n    }\n\n    public $Proxy0(InvocationHandler var1) throws  {\n        // 这里会调用父类的构造，并把InvocationHandler传递\n        super(var1);\n    }\n    \n    // 这里是我们自定义的方法，其它方法道理相同\n    public final void eat() throws  {\n        try {\n            // 可以看到，当我们调用代理类的方法时，实际上会调用父类的h(InvocationHandler)的invoke方法\n            // @Override\n            // public Object invoke(Object proxy, Method method, Object[] args) throws Throwable\n            // 所以我们重写InvocationHandler的invoke方法时传入的就是这几个参数\n            super.h.invoke(this, m3, (Object[])null);\n        } catch (RuntimeException | Error var2) {\n            throw var2;\n        } catch (Throwable var3) {\n            throw new UndeclaredThrowableException(var3);\n        }\n    }\n\n    ...\n}\n~~~\n\n好了，到这里基本信息都看完了，我们做个总结\n\n* 准备代理类的描述数据\n\n* 创建代理类（实现接口）的字节码文件\n* 通过ClassLoader将代理类的字节数组加载到JVM中\n* 创建代理类的实例对象，执行对象的目标方法\n\n我们回过头来，在想想最开始的3个问题：\n\n* 为什么要使用实例对象的ClassLoader和Interfaces，使用其实例对象的行不行，使用类的行不行\n  * 因为我们要代理的接口是应用类加载器加载的，所以理论上只要应用类加载器加的类都可以\n  * 但是interface肯定是需要实例对象(son.getClass())或者代理类(Son.class)，因为我们要对其的接口进行代理\n* 为什么被代理类非要实现接口\n  * 因为代理类已经继承了Proxy类，所以只能实现接口\n* newProxyInstance返回的代理类是什么类型，强转成实现类（Father proxySon = (Son) Proxy.newProxyInstance(...)）会不会报错\n  * 返回的是实现了接口继承了Proxy的代理类，所以强转成Son会报错\n\n## 总结\n\n![image](https://cdn.jsdelivr.net/gh/wxt1471520488/images@main/hexo/JDK动态代理/020691d7-f74f-471b-8249-3e02b5286431.png)\n因为JDK动态代理生成的代理对象默认继承了Proxy类，又因为Java中是单继承多实现，所以导致了JDK动态代理无法代理实现类，只能代理接口；而且我们通过观察Proxy类，维护了InvocationHandler h成员变量并提供了相应的方法，然后通过子类对InvocationHandler进行透传，Proxy对其进行方法执行，其实理论上只要我们把InvocationHandler提出来，不由Proxy进行维护，也就不需要继承Proxy类，就可以对实现类进行代理，可能作者基于面向接口开发的实际场景，以及抽象思维才这么进行设计的吧。\n","source":"_posts/JDK动态代理.md","raw":"---\ntitle: JDK动态代理详解\ndescription: JDK动态代理的源码，JDK动态代理为什么不能代理实现类，JDK动态代理为什么只能代理接口\nkeywords: JDK动态代理,JDK动态代理源码,JDK动态代理原理\ndate: 2022-12-04 14:38\ncategories: \n- [思考总结, jdk源码]\ntags:\n - 设计模式\n - 源码\n - AOP\n---\n\n## 使用\n\n创建接口\n\n~~~java\npublic interface Father {\n    void eat();\n}\n~~~\n\n创建实现类\n\n~~~ java\npublic class Son implements Father{\n\n    @Override\n    public void eat() {\n        System.out.println(\"吃饭\");\n    }\n}\n~~~\n\n测试\n\n~~~java\npublic class ProxyTest {\n\n    public static void main(String[] args) {\n        ProxyTest test = new ProxyTest();\n        test.jdkProxy();\n    }\n\n    private void jdkProxy(){\n        Father son = new Son();\n        \n        Father proxySon = (Father) Proxy.newProxyInstance(son.getClass().getClassLoader(), son.getClass().getInterfaces(), new InvocationHandler() {\n            @Override\n            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n                System.out.println(\"做饭\");\n\n                Object invoke = method.invoke(son, args);\n\n                System.out.println(\"洗碗\");\n\n                return invoke;\n            }\n        });\n\n        proxySon.eat();\n    }\n~~~\n\n输出结果\n\n~~~java\n做饭\n吃饭\n洗碗\n~~~\n\n如上，是一个使用JDK动态代理的简单例子，通过Proxy类的静态方法newProxyInstance可以生成目标类的代理类，这里有几个疑问：\n\n* 为什么要使用实例对象的ClassLoader和Interfaces，使用其实例对象的行不行，使用类的行不行\n* 为什么被代理类非要实现接口\n* newProxyInstance返回的代理类是什么类型，强转成实现类（Father proxySon = (Son) Proxy.newProxyInstance(...)）会不会报错\n\n我们带着这几个问题看看源码\n\n## 源码\n\n### java.lang.reflect.Proxy\n\n```java\npublic static Object newProxyInstance(ClassLoader loader,\n                                      Class<?>[] interfaces,\n                                      InvocationHandler h)\n    throws IllegalArgumentException\n{\n    Objects.requireNonNull(h);\n    // 克隆被代理类的接口Class对象\n    final Class<?>[] intfs = interfaces.clone();\n    // 使用Java安全管理器校验程序，防止恶心代码\n    final SecurityManager sm = System.getSecurityManager();\n    if (sm != null) {\n        checkProxyAccess(Reflection.getCallerClass(), loader, intfs);\n    }\n\n    /*\n     * Look up or generate the designated proxy class.\n     * 查找或生成指定的代理类。这里会使用缓存，缓存里没有就创建代理类，放放到缓存中\n     * 接下来我们进入这个方法看看\n     */\n    Class<?> cl = getProxyClass0(loader, intfs);\n\n    /*\n     * Invoke its constructor with the designated invocation handler.\n     * 使用指定的调用处理程序调用其构造函数。\n     */\n    try {\n        if (sm != null) {\n            checkNewProxyPermission(Reflection.getCallerClass(), cl);\n        }\n\n        // 获取代理类的构造器，这里会生成一个入参为InvocationHandler.class的构造器\n        final Constructor<?> cons = cl.getConstructor(constructorParams);\n        final InvocationHandler ih = h;\n        if (!Modifier.isPublic(cl.getModifiers())) {\n            AccessController.doPrivileged(new PrivilegedAction<Void>() {\n                public Void run() {\n                    cons.setAccessible(true);\n                    return null;\n                }\n            });\n        }\n        // 通过反射使用构造方法（带有InvocationHandler入参的构造方法）创建代理类的实例对象\n        return cons.newInstance(new Object[]{h});\n    } catch (IllegalAccessException|InstantiationException e) {\n        throw new InternalError(e.toString(), e);\n    } catch (InvocationTargetException e) {\n        Throwable t = e.getCause();\n        if (t instanceof RuntimeException) {\n            throw (RuntimeException) t;\n        } else {\n            throw new InternalError(t.toString(), t);\n        }\n    } catch (NoSuchMethodException e) {\n        throw new InternalError(e.toString(), e);\n    }\n}\n```\n\n~~~java\nprivate static Class<?> getProxyClass0(ClassLoader loader,\n                                           Class<?>... interfaces) {\n    \t// 这里为什么是65535？\n        if (interfaces.length > 65535) {\n            throw new IllegalArgumentException(\"interface limit exceeded\");\n        }\n\n        // If the proxy class defined by the given loader implementing\n        // the given interfaces exists, this will simply return the cached copy;\n        // otherwise, it will create the proxy class via the ProxyClassFactory\n    \t/**\n    \t* 如果给定加载器定义的代理类实现,给定的接口存在，这将简单地返回缓存的副本；否则，它将通过 ProxyClassFactory 创建代理类\n    \t* 在进入这个方法看看\n\t\t/\n        return proxyClassCache.get(loader, interfaces);\n    }\n~~~\n###  java.lang.reflect.WeakCache\n~~~java\npublic V get(K key, P parameter) {\n        Objects.requireNonNull(parameter);\n\n        expungeStaleEntries();\n\n        Object cacheKey = CacheKey.valueOf(key, refQueue);\n\n        // lazily install the 2nd level valuesMap for the particular cacheKey\n        ConcurrentMap<Object, Supplier<V>> valuesMap = map.get(cacheKey);\n        if (valuesMap == null) {\n            ConcurrentMap<Object, Supplier<V>> oldValuesMap\n                = map.putIfAbsent(cacheKey,\n                                  valuesMap = new ConcurrentHashMap<>());\n            if (oldValuesMap != null) {\n                valuesMap = oldValuesMap;\n            }\n        }\n\n        // create subKey and retrieve the possible Supplier<V> stored by that\n        // subKey from valuesMap\n    \t// 其它代码先不关注，这里的apply方法会调用$ProxyClassFactory的apply方法\n        Object subKey = Objects.requireNonNull(subKeyFactory.apply(key, parameter));\n        Supplier<V> supplier = valuesMap.get(subKey);\n        Factory factory = null;\n\n        ...\n    }\n~~~\n###  java.lang.reflect.Proxy\n~~~java\nprivate static final class ProxyClassFactory\n        implements BiFunction<ClassLoader, Class<?>[], Class<?>>\n    {\n        // prefix for all proxy class names\n    \t// 代理类名前缀\n        private static final String proxyClassNamePrefix = \"$Proxy\";\n\n        // next number to use for generation of unique proxy class names\n        private static final AtomicLong nextUniqueNumber = new AtomicLong();\n\n        @Override\n        public Class<?> apply(ClassLoader loader, Class<?>[] interfaces) {\n\n            Map<Class<?>, Boolean> interfaceSet = new IdentityHashMap<>(interfaces.length);\n            for (Class<?> intf : interfaces) {\n                /*\n                 * Verify that the class loader resolves the name of this\n                 * interface to the same Class object.\n                 */\n                Class<?> interfaceClass = null;\n                try {\n                    // 循环获取被代理类的接口结合的Class对象\n                    interfaceClass = Class.forName(intf.getName(), false, loader);\n                } catch (ClassNotFoundException e) {\n                }\n                if (interfaceClass != intf) {\n                    throw new IllegalArgumentException(\n                        intf + \" is not visible from class loader\");\n                }\n                /*\n                 * Verify that the Class object actually represents an\n                 * interface.\n                 */\n                if (!interfaceClass.isInterface()) {\n                    throw new IllegalArgumentException(\n                        interfaceClass.getName() + \" is not an interface\");\n                }\n                /*\n                 * Verify that this interface is not a duplicate.\n                 */\n                if (interfaceSet.put(interfaceClass, Boolean.TRUE) != null) {\n                    throw new IllegalArgumentException(\n                        \"repeated interface: \" + interfaceClass.getName());\n                }\n            }\n\n            String proxyPkg = null;     // package to define proxy class in\n            int accessFlags = Modifier.PUBLIC | Modifier.FINAL;\n\n            /*\n             * Record the package of a non-public proxy interface so that the\n             * proxy class will be defined in the same package.  Verify that\n             * all non-public proxy interfaces are in the same package.\n             */\n            for (Class<?> intf : interfaces) {\n                int flags = intf.getModifiers();\n                if (!Modifier.isPublic(flags)) {\n                    accessFlags = Modifier.FINAL;\n                    String name = intf.getName();\n                    int n = name.lastIndexOf('.');\n                    String pkg = ((n == -1) ? \"\" : name.substring(0, n + 1));\n                    if (proxyPkg == null) {\n                        proxyPkg = pkg;\n                    } else if (!pkg.equals(proxyPkg)) {\n                        throw new IllegalArgumentException(\n                            \"non-public interfaces from different packages\");\n                    }\n                }\n            }\n\n            if (proxyPkg == null) {\n                // if no non-public proxy interfaces, use com.sun.proxy package\n                proxyPkg = ReflectUtil.PROXY_PACKAGE + \".\";\n            }\n\n            /*\n             * Choose a name for the proxy class to generate.\n             */\n            long num = nextUniqueNumber.getAndIncrement();\n            // com.sun.proxy.  +  $Proxy   + 0\n            String proxyName = proxyPkg + proxyClassNamePrefix + num;\n\n            /*\n             * Generate the specified proxy class.\n             * 生成指定的代理类文件，并判断是否需要持久化，这里只是普通的文件字节数组，jvm并不认识\n             */\n            byte[] proxyClassFile = ProxyGenerator.generateProxyClass(\n                proxyName, interfaces, accessFlags);\n            try {\n                // 定义代理类，加载到jvm中，生成真正可以使用的运行时代理类的Class对象，\n                return defineClass0(loader, proxyName,\n                                    proxyClassFile, 0, proxyClassFile.length);\n            } catch (ClassFormatError e) {\n                /*\n                 * A ClassFormatError here means that (barring bugs in the\n                 * proxy class generation code) there was some other\n                 * invalid aspect of the arguments supplied to the proxy\n                 * class creation (such as virtual machine limitations\n                 * exceeded).\n                 */\n                throw new IllegalArgumentException(e.toString());\n            }\n        }\n    }\n~~~\n\n## 分析\n\nbyte[] proxyClassFile = ProxyGenerator.generateProxyClass(proxyName, interfaces, accessFlags);这块代码可以生成代理类的字节数组，那么我们是不是可以看看生成的代理类到底长什么样呢？写个测试方法看看\n\n~~~java\nprivate void write(){\n        Father father = new Son();\n\n        byte[] proxyArr = ProxyGenerator.generateProxyClass(\"$Proxy0\", father.getClass().getInterfaces());\n\n        try {\n            Files.write(Paths.get(\"C:\\\\Users\\\\wxt\\\\Desktop\\\\test.class\"), proxyArr);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n~~~\n\n文件内容\n\n~~~java\n// 代理类默认继承了Proxy类，实现了被代理类的接口\npublic final class $Proxy0 extends Proxy implements Father {\n    private static Method m1;\n    private static Method m3;\n    private static Method m2;\n    private static Method m0;\n    \n    static {\n        try {\n            // 这里初始化4个成员变量\n            m1 = Class.forName(\"java.lang.Object\").getMethod(\"equals\", Class.forName(\"java.lang.Object\"));\n            m3 = Class.forName(\"com.wangxt.wxt.design.patterns.proxy.dynamic.Father\").getMethod(\"eat\");\n            m2 = Class.forName(\"java.lang.Object\").getMethod(\"toString\");\n            m0 = Class.forName(\"java.lang.Object\").getMethod(\"hashCode\");\n        } catch (NoSuchMethodException var2) {\n            throw new NoSuchMethodError(var2.getMessage());\n        } catch (ClassNotFoundException var3) {\n            throw new NoClassDefFoundError(var3.getMessage());\n        }\n    }\n\n    public $Proxy0(InvocationHandler var1) throws  {\n        // 这里会调用父类的构造，并把InvocationHandler传递\n        super(var1);\n    }\n    \n    // 这里是我们自定义的方法，其它方法道理相同\n    public final void eat() throws  {\n        try {\n            // 可以看到，当我们调用代理类的方法时，实际上会调用父类的h(InvocationHandler)的invoke方法\n            // @Override\n            // public Object invoke(Object proxy, Method method, Object[] args) throws Throwable\n            // 所以我们重写InvocationHandler的invoke方法时传入的就是这几个参数\n            super.h.invoke(this, m3, (Object[])null);\n        } catch (RuntimeException | Error var2) {\n            throw var2;\n        } catch (Throwable var3) {\n            throw new UndeclaredThrowableException(var3);\n        }\n    }\n\n    ...\n}\n~~~\n\n好了，到这里基本信息都看完了，我们做个总结\n\n* 准备代理类的描述数据\n\n* 创建代理类（实现接口）的字节码文件\n* 通过ClassLoader将代理类的字节数组加载到JVM中\n* 创建代理类的实例对象，执行对象的目标方法\n\n我们回过头来，在想想最开始的3个问题：\n\n* 为什么要使用实例对象的ClassLoader和Interfaces，使用其实例对象的行不行，使用类的行不行\n  * 因为我们要代理的接口是应用类加载器加载的，所以理论上只要应用类加载器加的类都可以\n  * 但是interface肯定是需要实例对象(son.getClass())或者代理类(Son.class)，因为我们要对其的接口进行代理\n* 为什么被代理类非要实现接口\n  * 因为代理类已经继承了Proxy类，所以只能实现接口\n* newProxyInstance返回的代理类是什么类型，强转成实现类（Father proxySon = (Son) Proxy.newProxyInstance(...)）会不会报错\n  * 返回的是实现了接口继承了Proxy的代理类，所以强转成Son会报错\n\n## 总结\n\n![image](https://cdn.jsdelivr.net/gh/wxt1471520488/images@main/hexo/JDK动态代理/020691d7-f74f-471b-8249-3e02b5286431.png)\n因为JDK动态代理生成的代理对象默认继承了Proxy类，又因为Java中是单继承多实现，所以导致了JDK动态代理无法代理实现类，只能代理接口；而且我们通过观察Proxy类，维护了InvocationHandler h成员变量并提供了相应的方法，然后通过子类对InvocationHandler进行透传，Proxy对其进行方法执行，其实理论上只要我们把InvocationHandler提出来，不由Proxy进行维护，也就不需要继承Proxy类，就可以对实现类进行代理，可能作者基于面向接口开发的实际场景，以及抽象思维才这么进行设计的吧。\n","slug":"JDK动态代理","published":1,"updated":"2022-12-04T07:10:26.462Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clb91t0ll000l9sjnhfdv3i4m","content":"<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p>创建接口</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Father</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">eat</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>创建实现类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Father</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">eat</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;吃饭&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>测试</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ProxyTest</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ProxyTest</span> <span class=\"variable\">test</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ProxyTest</span>();</span><br><span class=\"line\">        test.jdkProxy();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">jdkProxy</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">Father</span> <span class=\"variable\">son</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Son</span>();</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"type\">Father</span> <span class=\"variable\">proxySon</span> <span class=\"operator\">=</span> (Father) Proxy.newProxyInstance(son.getClass().getClassLoader(), son.getClass().getInterfaces(), <span class=\"keyword\">new</span> <span class=\"title class_\">InvocationHandler</span>() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> Object <span class=\"title function_\">invoke</span><span class=\"params\">(Object proxy, Method method, Object[] args)</span> <span class=\"keyword\">throws</span> Throwable &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;做饭&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"type\">Object</span> <span class=\"variable\">invoke</span> <span class=\"operator\">=</span> method.invoke(son, args);</span><br><span class=\"line\"></span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗碗&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">return</span> invoke;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        proxySon.eat();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出结果</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">做饭</span><br><span class=\"line\">吃饭</span><br><span class=\"line\">洗碗</span><br></pre></td></tr></table></figure>\n\n<p>如上，是一个使用JDK动态代理的简单例子，通过Proxy类的静态方法newProxyInstance可以生成目标类的代理类，这里有几个疑问：</p>\n<ul>\n<li>为什么要使用实例对象的ClassLoader和Interfaces，使用其实例对象的行不行，使用类的行不行</li>\n<li>为什么被代理类非要实现接口</li>\n<li>newProxyInstance返回的代理类是什么类型，强转成实现类（Father proxySon = (Son) Proxy.newProxyInstance(…)）会不会报错</li>\n</ul>\n<p>我们带着这几个问题看看源码</p>\n<h2 id=\"源码\"><a href=\"#源码\" class=\"headerlink\" title=\"源码\"></a>源码</h2><h3 id=\"java-lang-reflect-Proxy\"><a href=\"#java-lang-reflect-Proxy\" class=\"headerlink\" title=\"java.lang.reflect.Proxy\"></a>java.lang.reflect.Proxy</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Object <span class=\"title function_\">newProxyInstance</span><span class=\"params\">(ClassLoader loader,</span></span><br><span class=\"line\"><span class=\"params\">                                      Class&lt;?&gt;[] interfaces,</span></span><br><span class=\"line\"><span class=\"params\">                                      InvocationHandler h)</span></span><br><span class=\"line\">    <span class=\"keyword\">throws</span> IllegalArgumentException</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Objects.requireNonNull(h);</span><br><span class=\"line\">    <span class=\"comment\">// 克隆被代理类的接口Class对象</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Class&lt;?&gt;[] intfs = interfaces.clone();</span><br><span class=\"line\">    <span class=\"comment\">// 使用Java安全管理器校验程序，防止恶心代码</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"type\">SecurityManager</span> <span class=\"variable\">sm</span> <span class=\"operator\">=</span> System.getSecurityManager();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (sm != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        checkProxyAccess(Reflection.getCallerClass(), loader, intfs);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * Look up or generate the designated proxy class.</span></span><br><span class=\"line\"><span class=\"comment\">     * 查找或生成指定的代理类。这里会使用缓存，缓存里没有就创建代理类，放放到缓存中</span></span><br><span class=\"line\"><span class=\"comment\">     * 接下来我们进入这个方法看看</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    Class&lt;?&gt; cl = getProxyClass0(loader, intfs);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * Invoke its constructor with the designated invocation handler.</span></span><br><span class=\"line\"><span class=\"comment\">     * 使用指定的调用处理程序调用其构造函数。</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (sm != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            checkNewProxyPermission(Reflection.getCallerClass(), cl);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 获取代理类的构造器，这里会生成一个入参为InvocationHandler.class的构造器</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams);</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">InvocationHandler</span> <span class=\"variable\">ih</span> <span class=\"operator\">=</span> h;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!Modifier.isPublic(cl.getModifiers())) &#123;</span><br><span class=\"line\">            AccessController.doPrivileged(<span class=\"keyword\">new</span> <span class=\"title class_\">PrivilegedAction</span>&lt;Void&gt;() &#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> Void <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                    cons.setAccessible(<span class=\"literal\">true</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 通过反射使用构造方法（带有InvocationHandler入参的构造方法）创建代理类的实例对象</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> cons.newInstance(<span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>[]&#123;h&#125;);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (IllegalAccessException|InstantiationException e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InternalError</span>(e.toString(), e);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (InvocationTargetException e) &#123;</span><br><span class=\"line\">        <span class=\"type\">Throwable</span> <span class=\"variable\">t</span> <span class=\"operator\">=</span> e.getCause();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t <span class=\"keyword\">instanceof</span> RuntimeException) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> (RuntimeException) t;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InternalError</span>(t.toString(), t);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (NoSuchMethodException e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InternalError</span>(e.toString(), e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Class&lt;?&gt; getProxyClass0(ClassLoader loader,</span><br><span class=\"line\">                                           Class&lt;?&gt;... interfaces) &#123;</span><br><span class=\"line\">    \t<span class=\"comment\">// 这里为什么是65535？</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (interfaces.length &gt; <span class=\"number\">65535</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;interface limit exceeded&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// If the proxy class defined by the given loader implementing</span></span><br><span class=\"line\">        <span class=\"comment\">// the given interfaces exists, this will simply return the cached copy;</span></span><br><span class=\"line\">        <span class=\"comment\">// otherwise, it will create the proxy class via the ProxyClassFactory</span></span><br><span class=\"line\">    \t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    \t* 如果给定加载器定义的代理类实现,给定的接口存在，这将简单地返回缓存的副本；否则，它将通过 ProxyClassFactory 创建代理类</span></span><br><span class=\"line\"><span class=\"comment\">    \t* 在进入这个方法看看</span></span><br><span class=\"line\"><span class=\"comment\">\t\t/</span></span><br><span class=\"line\"><span class=\"comment\">        return proxyClassCache.get(loader, interfaces);</span></span><br><span class=\"line\"><span class=\"comment\">    &#125;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"java-lang-reflect-WeakCache\"><a href=\"#java-lang-reflect-WeakCache\" class=\"headerlink\" title=\"java.lang.reflect.WeakCache\"></a>java.lang.reflect.WeakCache</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> V <span class=\"title function_\">get</span><span class=\"params\">(K key, P parameter)</span> &#123;</span><br><span class=\"line\">        Objects.requireNonNull(parameter);</span><br><span class=\"line\"></span><br><span class=\"line\">        expungeStaleEntries();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">cacheKey</span> <span class=\"operator\">=</span> CacheKey.valueOf(key, refQueue);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// lazily install the 2nd level valuesMap for the particular cacheKey</span></span><br><span class=\"line\">        ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; valuesMap = map.get(cacheKey);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (valuesMap == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; oldValuesMap</span><br><span class=\"line\">                = map.putIfAbsent(cacheKey,</span><br><span class=\"line\">                                  valuesMap = <span class=\"keyword\">new</span> <span class=\"title class_\">ConcurrentHashMap</span>&lt;&gt;());</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (oldValuesMap != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                valuesMap = oldValuesMap;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// create subKey and retrieve the possible Supplier&lt;V&gt; stored by that</span></span><br><span class=\"line\">        <span class=\"comment\">// subKey from valuesMap</span></span><br><span class=\"line\">    \t<span class=\"comment\">// 其它代码先不关注，这里的apply方法会调用$ProxyClassFactory的apply方法</span></span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">subKey</span> <span class=\"operator\">=</span> Objects.requireNonNull(subKeyFactory.apply(key, parameter));</span><br><span class=\"line\">        Supplier&lt;V&gt; supplier = valuesMap.get(subKey);</span><br><span class=\"line\">        <span class=\"type\">Factory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"java-lang-reflect-Proxy-1\"><a href=\"#java-lang-reflect-Proxy-1\" class=\"headerlink\" title=\"java.lang.reflect.Proxy\"></a>java.lang.reflect.Proxy</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ProxyClassFactory</span></span><br><span class=\"line\">        <span class=\"keyword\">implements</span> <span class=\"title class_\">BiFunction</span>&lt;ClassLoader, Class&lt;?&gt;[], Class&lt;?&gt;&gt;</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">// prefix for all proxy class names</span></span><br><span class=\"line\">    \t<span class=\"comment\">// 代理类名前缀</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">proxyClassNamePrefix</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;$Proxy&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// next number to use for generation of unique proxy class names</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">AtomicLong</span> <span class=\"variable\">nextUniqueNumber</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicLong</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Class&lt;?&gt; apply(ClassLoader loader, Class&lt;?&gt;[] interfaces) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            Map&lt;Class&lt;?&gt;, Boolean&gt; interfaceSet = <span class=\"keyword\">new</span> <span class=\"title class_\">IdentityHashMap</span>&lt;&gt;(interfaces.length);</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Class&lt;?&gt; intf : interfaces) &#123;</span><br><span class=\"line\">                <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">                 * Verify that the class loader resolves the name of this</span></span><br><span class=\"line\"><span class=\"comment\">                 * interface to the same Class object.</span></span><br><span class=\"line\"><span class=\"comment\">                 */</span></span><br><span class=\"line\">                Class&lt;?&gt; interfaceClass = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 循环获取被代理类的接口结合的Class对象</span></span><br><span class=\"line\">                    interfaceClass = Class.forName(intf.getName(), <span class=\"literal\">false</span>, loader);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (ClassNotFoundException e) &#123;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (interfaceClass != intf) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(</span><br><span class=\"line\">                        intf + <span class=\"string\">&quot; is not visible from class loader&quot;</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">                 * Verify that the Class object actually represents an</span></span><br><span class=\"line\"><span class=\"comment\">                 * interface.</span></span><br><span class=\"line\"><span class=\"comment\">                 */</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!interfaceClass.isInterface()) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(</span><br><span class=\"line\">                        interfaceClass.getName() + <span class=\"string\">&quot; is not an interface&quot;</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">                 * Verify that this interface is not a duplicate.</span></span><br><span class=\"line\"><span class=\"comment\">                 */</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (interfaceSet.put(interfaceClass, Boolean.TRUE) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(</span><br><span class=\"line\">                        <span class=\"string\">&quot;repeated interface: &quot;</span> + interfaceClass.getName());</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">proxyPkg</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;     <span class=\"comment\">// package to define proxy class in</span></span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">accessFlags</span> <span class=\"operator\">=</span> Modifier.PUBLIC | Modifier.FINAL;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">             * Record the package of a non-public proxy interface so that the</span></span><br><span class=\"line\"><span class=\"comment\">             * proxy class will be defined in the same package.  Verify that</span></span><br><span class=\"line\"><span class=\"comment\">             * all non-public proxy interfaces are in the same package.</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Class&lt;?&gt; intf : interfaces) &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">flags</span> <span class=\"operator\">=</span> intf.getModifiers();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!Modifier.isPublic(flags)) &#123;</span><br><span class=\"line\">                    accessFlags = Modifier.FINAL;</span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">name</span> <span class=\"operator\">=</span> intf.getName();</span><br><span class=\"line\">                    <span class=\"type\">int</span> <span class=\"variable\">n</span> <span class=\"operator\">=</span> name.lastIndexOf(<span class=\"string\">&#x27;.&#x27;</span>);</span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">pkg</span> <span class=\"operator\">=</span> ((n == -<span class=\"number\">1</span>) ? <span class=\"string\">&quot;&quot;</span> : name.substring(<span class=\"number\">0</span>, n + <span class=\"number\">1</span>));</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (proxyPkg == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        proxyPkg = pkg;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!pkg.equals(proxyPkg)) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(</span><br><span class=\"line\">                            <span class=\"string\">&quot;non-public interfaces from different packages&quot;</span>);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (proxyPkg == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// if no non-public proxy interfaces, use com.sun.proxy package</span></span><br><span class=\"line\">                proxyPkg = ReflectUtil.PROXY_PACKAGE + <span class=\"string\">&quot;.&quot;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">             * Choose a name for the proxy class to generate.</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">num</span> <span class=\"operator\">=</span> nextUniqueNumber.getAndIncrement();</span><br><span class=\"line\">            <span class=\"comment\">// com.sun.proxy.  +  $Proxy   + 0</span></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">proxyName</span> <span class=\"operator\">=</span> proxyPkg + proxyClassNamePrefix + num;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">             * Generate the specified proxy class.</span></span><br><span class=\"line\"><span class=\"comment\">             * 生成指定的代理类文件，并判断是否需要持久化，这里只是普通的文件字节数组，jvm并不认识</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            <span class=\"type\">byte</span>[] proxyClassFile = ProxyGenerator.generateProxyClass(</span><br><span class=\"line\">                proxyName, interfaces, accessFlags);</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 定义代理类，加载到jvm中，生成真正可以使用的运行时代理类的Class对象，</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> defineClass0(loader, proxyName,</span><br><span class=\"line\">                                    proxyClassFile, <span class=\"number\">0</span>, proxyClassFile.length);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (ClassFormatError e) &#123;</span><br><span class=\"line\">                <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">                 * A ClassFormatError here means that (barring bugs in the</span></span><br><span class=\"line\"><span class=\"comment\">                 * proxy class generation code) there was some other</span></span><br><span class=\"line\"><span class=\"comment\">                 * invalid aspect of the arguments supplied to the proxy</span></span><br><span class=\"line\"><span class=\"comment\">                 * class creation (such as virtual machine limitations</span></span><br><span class=\"line\"><span class=\"comment\">                 * exceeded).</span></span><br><span class=\"line\"><span class=\"comment\">                 */</span></span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(e.toString());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"分析\"><a href=\"#分析\" class=\"headerlink\" title=\"分析\"></a>分析</h2><p>byte[] proxyClassFile = ProxyGenerator.generateProxyClass(proxyName, interfaces, accessFlags);这块代码可以生成代理类的字节数组，那么我们是不是可以看看生成的代理类到底长什么样呢？写个测试方法看看</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">write</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">Father</span> <span class=\"variable\">father</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Son</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">byte</span>[] proxyArr = ProxyGenerator.generateProxyClass(<span class=\"string\">&quot;$Proxy0&quot;</span>, father.getClass().getInterfaces());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Files.write(Paths.get(<span class=\"string\">&quot;C:\\\\Users\\\\wxt\\\\Desktop\\\\test.class&quot;</span>), proxyArr);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>文件内容</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 代理类默认继承了Proxy类，实现了被代理类的接口</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">$Proxy0</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Proxy</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Father</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Method m1;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Method m3;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Method m2;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Method m0;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 这里初始化4个成员变量</span></span><br><span class=\"line\">            m1 = Class.forName(<span class=\"string\">&quot;java.lang.Object&quot;</span>).getMethod(<span class=\"string\">&quot;equals&quot;</span>, Class.forName(<span class=\"string\">&quot;java.lang.Object&quot;</span>));</span><br><span class=\"line\">            m3 = Class.forName(<span class=\"string\">&quot;com.wangxt.wxt.design.patterns.proxy.dynamic.Father&quot;</span>).getMethod(<span class=\"string\">&quot;eat&quot;</span>);</span><br><span class=\"line\">            m2 = Class.forName(<span class=\"string\">&quot;java.lang.Object&quot;</span>).getMethod(<span class=\"string\">&quot;toString&quot;</span>);</span><br><span class=\"line\">            m0 = Class.forName(<span class=\"string\">&quot;java.lang.Object&quot;</span>).getMethod(<span class=\"string\">&quot;hashCode&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (NoSuchMethodException var2) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NoSuchMethodError</span>(var2.getMessage());</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (ClassNotFoundException var3) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NoClassDefFoundError</span>(var3.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> $Proxy0(InvocationHandler var1) <span class=\"keyword\">throws</span>  &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 这里会调用父类的构造，并把InvocationHandler传递</span></span><br><span class=\"line\">        <span class=\"built_in\">super</span>(var1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 这里是我们自定义的方法，其它方法道理相同</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">eat</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span>  &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 可以看到，当我们调用代理类的方法时，实际上会调用父类的h(InvocationHandler)的invoke方法</span></span><br><span class=\"line\">            <span class=\"comment\">// @Override</span></span><br><span class=\"line\">            <span class=\"comment\">// public Object invoke(Object proxy, Method method, Object[] args) throws Throwable</span></span><br><span class=\"line\">            <span class=\"comment\">// 所以我们重写InvocationHandler的invoke方法时传入的就是这几个参数</span></span><br><span class=\"line\">            <span class=\"built_in\">super</span>.h.invoke(<span class=\"built_in\">this</span>, m3, (Object[])<span class=\"literal\">null</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> var2;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Throwable var3) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">UndeclaredThrowableException</span>(var3);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>好了，到这里基本信息都看完了，我们做个总结</p>\n<ul>\n<li><p>准备代理类的描述数据</p>\n</li>\n<li><p>创建代理类（实现接口）的字节码文件</p>\n</li>\n<li><p>通过ClassLoader将代理类的字节数组加载到JVM中</p>\n</li>\n<li><p>创建代理类的实例对象，执行对象的目标方法</p>\n</li>\n</ul>\n<p>我们回过头来，在想想最开始的3个问题：</p>\n<ul>\n<li>为什么要使用实例对象的ClassLoader和Interfaces，使用其实例对象的行不行，使用类的行不行<ul>\n<li>因为我们要代理的接口是应用类加载器加载的，所以理论上只要应用类加载器加的类都可以</li>\n<li>但是interface肯定是需要实例对象(son.getClass())或者代理类(Son.class)，因为我们要对其的接口进行代理</li>\n</ul>\n</li>\n<li>为什么被代理类非要实现接口<ul>\n<li>因为代理类已经继承了Proxy类，所以只能实现接口</li>\n</ul>\n</li>\n<li>newProxyInstance返回的代理类是什么类型，强转成实现类（Father proxySon = (Son) Proxy.newProxyInstance(…)）会不会报错<ul>\n<li>返回的是实现了接口继承了Proxy的代理类，所以强转成Son会报错</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p><img src=\"https://cdn.jsdelivr.net/gh/wxt1471520488/images@main/hexo/JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/020691d7-f74f-471b-8249-3e02b5286431.png\" class=\"lazyload\" data-srcset=\"https://cdn.jsdelivr.net/gh/wxt1471520488/images@main/hexo/JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/020691d7-f74f-471b-8249-3e02b5286431.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"image\"><br>因为JDK动态代理生成的代理对象默认继承了Proxy类，又因为Java中是单继承多实现，所以导致了JDK动态代理无法代理实现类，只能代理接口；而且我们通过观察Proxy类，维护了InvocationHandler h成员变量并提供了相应的方法，然后通过子类对InvocationHandler进行透传，Proxy对其进行方法执行，其实理论上只要我们把InvocationHandler提出来，不由Proxy进行维护，也就不需要继承Proxy类，就可以对实现类进行代理，可能作者基于面向接口开发的实际场景，以及抽象思维才这么进行设计的吧。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p>创建接口</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Father</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">eat</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>创建实现类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Son</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Father</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">eat</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;吃饭&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>测试</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ProxyTest</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ProxyTest</span> <span class=\"variable\">test</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ProxyTest</span>();</span><br><span class=\"line\">        test.jdkProxy();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">jdkProxy</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">Father</span> <span class=\"variable\">son</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Son</span>();</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"type\">Father</span> <span class=\"variable\">proxySon</span> <span class=\"operator\">=</span> (Father) Proxy.newProxyInstance(son.getClass().getClassLoader(), son.getClass().getInterfaces(), <span class=\"keyword\">new</span> <span class=\"title class_\">InvocationHandler</span>() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> Object <span class=\"title function_\">invoke</span><span class=\"params\">(Object proxy, Method method, Object[] args)</span> <span class=\"keyword\">throws</span> Throwable &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;做饭&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"type\">Object</span> <span class=\"variable\">invoke</span> <span class=\"operator\">=</span> method.invoke(son, args);</span><br><span class=\"line\"></span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;洗碗&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">return</span> invoke;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        proxySon.eat();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出结果</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">做饭</span><br><span class=\"line\">吃饭</span><br><span class=\"line\">洗碗</span><br></pre></td></tr></table></figure>\n\n<p>如上，是一个使用JDK动态代理的简单例子，通过Proxy类的静态方法newProxyInstance可以生成目标类的代理类，这里有几个疑问：</p>\n<ul>\n<li>为什么要使用实例对象的ClassLoader和Interfaces，使用其实例对象的行不行，使用类的行不行</li>\n<li>为什么被代理类非要实现接口</li>\n<li>newProxyInstance返回的代理类是什么类型，强转成实现类（Father proxySon = (Son) Proxy.newProxyInstance(…)）会不会报错</li>\n</ul>\n<p>我们带着这几个问题看看源码</p>\n<h2 id=\"源码\"><a href=\"#源码\" class=\"headerlink\" title=\"源码\"></a>源码</h2><h3 id=\"java-lang-reflect-Proxy\"><a href=\"#java-lang-reflect-Proxy\" class=\"headerlink\" title=\"java.lang.reflect.Proxy\"></a>java.lang.reflect.Proxy</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Object <span class=\"title function_\">newProxyInstance</span><span class=\"params\">(ClassLoader loader,</span></span><br><span class=\"line\"><span class=\"params\">                                      Class&lt;?&gt;[] interfaces,</span></span><br><span class=\"line\"><span class=\"params\">                                      InvocationHandler h)</span></span><br><span class=\"line\">    <span class=\"keyword\">throws</span> IllegalArgumentException</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Objects.requireNonNull(h);</span><br><span class=\"line\">    <span class=\"comment\">// 克隆被代理类的接口Class对象</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Class&lt;?&gt;[] intfs = interfaces.clone();</span><br><span class=\"line\">    <span class=\"comment\">// 使用Java安全管理器校验程序，防止恶心代码</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"type\">SecurityManager</span> <span class=\"variable\">sm</span> <span class=\"operator\">=</span> System.getSecurityManager();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (sm != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        checkProxyAccess(Reflection.getCallerClass(), loader, intfs);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * Look up or generate the designated proxy class.</span></span><br><span class=\"line\"><span class=\"comment\">     * 查找或生成指定的代理类。这里会使用缓存，缓存里没有就创建代理类，放放到缓存中</span></span><br><span class=\"line\"><span class=\"comment\">     * 接下来我们进入这个方法看看</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    Class&lt;?&gt; cl = getProxyClass0(loader, intfs);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">     * Invoke its constructor with the designated invocation handler.</span></span><br><span class=\"line\"><span class=\"comment\">     * 使用指定的调用处理程序调用其构造函数。</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (sm != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            checkNewProxyPermission(Reflection.getCallerClass(), cl);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 获取代理类的构造器，这里会生成一个入参为InvocationHandler.class的构造器</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams);</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">InvocationHandler</span> <span class=\"variable\">ih</span> <span class=\"operator\">=</span> h;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!Modifier.isPublic(cl.getModifiers())) &#123;</span><br><span class=\"line\">            AccessController.doPrivileged(<span class=\"keyword\">new</span> <span class=\"title class_\">PrivilegedAction</span>&lt;Void&gt;() &#123;</span><br><span class=\"line\">                <span class=\"keyword\">public</span> Void <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                    cons.setAccessible(<span class=\"literal\">true</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 通过反射使用构造方法（带有InvocationHandler入参的构造方法）创建代理类的实例对象</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> cons.newInstance(<span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>[]&#123;h&#125;);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (IllegalAccessException|InstantiationException e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InternalError</span>(e.toString(), e);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (InvocationTargetException e) &#123;</span><br><span class=\"line\">        <span class=\"type\">Throwable</span> <span class=\"variable\">t</span> <span class=\"operator\">=</span> e.getCause();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t <span class=\"keyword\">instanceof</span> RuntimeException) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> (RuntimeException) t;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InternalError</span>(t.toString(), t);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (NoSuchMethodException e) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InternalError</span>(e.toString(), e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Class&lt;?&gt; getProxyClass0(ClassLoader loader,</span><br><span class=\"line\">                                           Class&lt;?&gt;... interfaces) &#123;</span><br><span class=\"line\">    \t<span class=\"comment\">// 这里为什么是65535？</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (interfaces.length &gt; <span class=\"number\">65535</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(<span class=\"string\">&quot;interface limit exceeded&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// If the proxy class defined by the given loader implementing</span></span><br><span class=\"line\">        <span class=\"comment\">// the given interfaces exists, this will simply return the cached copy;</span></span><br><span class=\"line\">        <span class=\"comment\">// otherwise, it will create the proxy class via the ProxyClassFactory</span></span><br><span class=\"line\">    \t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    \t* 如果给定加载器定义的代理类实现,给定的接口存在，这将简单地返回缓存的副本；否则，它将通过 ProxyClassFactory 创建代理类</span></span><br><span class=\"line\"><span class=\"comment\">    \t* 在进入这个方法看看</span></span><br><span class=\"line\"><span class=\"comment\">\t\t/</span></span><br><span class=\"line\"><span class=\"comment\">        return proxyClassCache.get(loader, interfaces);</span></span><br><span class=\"line\"><span class=\"comment\">    &#125;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"java-lang-reflect-WeakCache\"><a href=\"#java-lang-reflect-WeakCache\" class=\"headerlink\" title=\"java.lang.reflect.WeakCache\"></a>java.lang.reflect.WeakCache</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> V <span class=\"title function_\">get</span><span class=\"params\">(K key, P parameter)</span> &#123;</span><br><span class=\"line\">        Objects.requireNonNull(parameter);</span><br><span class=\"line\"></span><br><span class=\"line\">        expungeStaleEntries();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">cacheKey</span> <span class=\"operator\">=</span> CacheKey.valueOf(key, refQueue);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// lazily install the 2nd level valuesMap for the particular cacheKey</span></span><br><span class=\"line\">        ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; valuesMap = map.get(cacheKey);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (valuesMap == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; oldValuesMap</span><br><span class=\"line\">                = map.putIfAbsent(cacheKey,</span><br><span class=\"line\">                                  valuesMap = <span class=\"keyword\">new</span> <span class=\"title class_\">ConcurrentHashMap</span>&lt;&gt;());</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (oldValuesMap != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                valuesMap = oldValuesMap;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// create subKey and retrieve the possible Supplier&lt;V&gt; stored by that</span></span><br><span class=\"line\">        <span class=\"comment\">// subKey from valuesMap</span></span><br><span class=\"line\">    \t<span class=\"comment\">// 其它代码先不关注，这里的apply方法会调用$ProxyClassFactory的apply方法</span></span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">subKey</span> <span class=\"operator\">=</span> Objects.requireNonNull(subKeyFactory.apply(key, parameter));</span><br><span class=\"line\">        Supplier&lt;V&gt; supplier = valuesMap.get(subKey);</span><br><span class=\"line\">        <span class=\"type\">Factory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"java-lang-reflect-Proxy-1\"><a href=\"#java-lang-reflect-Proxy-1\" class=\"headerlink\" title=\"java.lang.reflect.Proxy\"></a>java.lang.reflect.Proxy</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ProxyClassFactory</span></span><br><span class=\"line\">        <span class=\"keyword\">implements</span> <span class=\"title class_\">BiFunction</span>&lt;ClassLoader, Class&lt;?&gt;[], Class&lt;?&gt;&gt;</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">// prefix for all proxy class names</span></span><br><span class=\"line\">    \t<span class=\"comment\">// 代理类名前缀</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">proxyClassNamePrefix</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;$Proxy&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// next number to use for generation of unique proxy class names</span></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">AtomicLong</span> <span class=\"variable\">nextUniqueNumber</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicLong</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> Class&lt;?&gt; apply(ClassLoader loader, Class&lt;?&gt;[] interfaces) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            Map&lt;Class&lt;?&gt;, Boolean&gt; interfaceSet = <span class=\"keyword\">new</span> <span class=\"title class_\">IdentityHashMap</span>&lt;&gt;(interfaces.length);</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Class&lt;?&gt; intf : interfaces) &#123;</span><br><span class=\"line\">                <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">                 * Verify that the class loader resolves the name of this</span></span><br><span class=\"line\"><span class=\"comment\">                 * interface to the same Class object.</span></span><br><span class=\"line\"><span class=\"comment\">                 */</span></span><br><span class=\"line\">                Class&lt;?&gt; interfaceClass = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 循环获取被代理类的接口结合的Class对象</span></span><br><span class=\"line\">                    interfaceClass = Class.forName(intf.getName(), <span class=\"literal\">false</span>, loader);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (ClassNotFoundException e) &#123;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (interfaceClass != intf) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(</span><br><span class=\"line\">                        intf + <span class=\"string\">&quot; is not visible from class loader&quot;</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">                 * Verify that the Class object actually represents an</span></span><br><span class=\"line\"><span class=\"comment\">                 * interface.</span></span><br><span class=\"line\"><span class=\"comment\">                 */</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!interfaceClass.isInterface()) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(</span><br><span class=\"line\">                        interfaceClass.getName() + <span class=\"string\">&quot; is not an interface&quot;</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">                 * Verify that this interface is not a duplicate.</span></span><br><span class=\"line\"><span class=\"comment\">                 */</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (interfaceSet.put(interfaceClass, Boolean.TRUE) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(</span><br><span class=\"line\">                        <span class=\"string\">&quot;repeated interface: &quot;</span> + interfaceClass.getName());</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">proxyPkg</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;     <span class=\"comment\">// package to define proxy class in</span></span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">accessFlags</span> <span class=\"operator\">=</span> Modifier.PUBLIC | Modifier.FINAL;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">             * Record the package of a non-public proxy interface so that the</span></span><br><span class=\"line\"><span class=\"comment\">             * proxy class will be defined in the same package.  Verify that</span></span><br><span class=\"line\"><span class=\"comment\">             * all non-public proxy interfaces are in the same package.</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (Class&lt;?&gt; intf : interfaces) &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">flags</span> <span class=\"operator\">=</span> intf.getModifiers();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!Modifier.isPublic(flags)) &#123;</span><br><span class=\"line\">                    accessFlags = Modifier.FINAL;</span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">name</span> <span class=\"operator\">=</span> intf.getName();</span><br><span class=\"line\">                    <span class=\"type\">int</span> <span class=\"variable\">n</span> <span class=\"operator\">=</span> name.lastIndexOf(<span class=\"string\">&#x27;.&#x27;</span>);</span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">pkg</span> <span class=\"operator\">=</span> ((n == -<span class=\"number\">1</span>) ? <span class=\"string\">&quot;&quot;</span> : name.substring(<span class=\"number\">0</span>, n + <span class=\"number\">1</span>));</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (proxyPkg == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        proxyPkg = pkg;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!pkg.equals(proxyPkg)) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(</span><br><span class=\"line\">                            <span class=\"string\">&quot;non-public interfaces from different packages&quot;</span>);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (proxyPkg == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// if no non-public proxy interfaces, use com.sun.proxy package</span></span><br><span class=\"line\">                proxyPkg = ReflectUtil.PROXY_PACKAGE + <span class=\"string\">&quot;.&quot;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">             * Choose a name for the proxy class to generate.</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            <span class=\"type\">long</span> <span class=\"variable\">num</span> <span class=\"operator\">=</span> nextUniqueNumber.getAndIncrement();</span><br><span class=\"line\">            <span class=\"comment\">// com.sun.proxy.  +  $Proxy   + 0</span></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">proxyName</span> <span class=\"operator\">=</span> proxyPkg + proxyClassNamePrefix + num;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">             * Generate the specified proxy class.</span></span><br><span class=\"line\"><span class=\"comment\">             * 生成指定的代理类文件，并判断是否需要持久化，这里只是普通的文件字节数组，jvm并不认识</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            <span class=\"type\">byte</span>[] proxyClassFile = ProxyGenerator.generateProxyClass(</span><br><span class=\"line\">                proxyName, interfaces, accessFlags);</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 定义代理类，加载到jvm中，生成真正可以使用的运行时代理类的Class对象，</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> defineClass0(loader, proxyName,</span><br><span class=\"line\">                                    proxyClassFile, <span class=\"number\">0</span>, proxyClassFile.length);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (ClassFormatError e) &#123;</span><br><span class=\"line\">                <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">                 * A ClassFormatError here means that (barring bugs in the</span></span><br><span class=\"line\"><span class=\"comment\">                 * proxy class generation code) there was some other</span></span><br><span class=\"line\"><span class=\"comment\">                 * invalid aspect of the arguments supplied to the proxy</span></span><br><span class=\"line\"><span class=\"comment\">                 * class creation (such as virtual machine limitations</span></span><br><span class=\"line\"><span class=\"comment\">                 * exceeded).</span></span><br><span class=\"line\"><span class=\"comment\">                 */</span></span><br><span class=\"line\">                <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IllegalArgumentException</span>(e.toString());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"分析\"><a href=\"#分析\" class=\"headerlink\" title=\"分析\"></a>分析</h2><p>byte[] proxyClassFile = ProxyGenerator.generateProxyClass(proxyName, interfaces, accessFlags);这块代码可以生成代理类的字节数组，那么我们是不是可以看看生成的代理类到底长什么样呢？写个测试方法看看</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">write</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">Father</span> <span class=\"variable\">father</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Son</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">byte</span>[] proxyArr = ProxyGenerator.generateProxyClass(<span class=\"string\">&quot;$Proxy0&quot;</span>, father.getClass().getInterfaces());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            Files.write(Paths.get(<span class=\"string\">&quot;C:\\\\Users\\\\wxt\\\\Desktop\\\\test.class&quot;</span>), proxyArr);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>文件内容</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 代理类默认继承了Proxy类，实现了被代理类的接口</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">$Proxy0</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Proxy</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Father</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Method m1;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Method m3;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Method m2;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Method m0;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 这里初始化4个成员变量</span></span><br><span class=\"line\">            m1 = Class.forName(<span class=\"string\">&quot;java.lang.Object&quot;</span>).getMethod(<span class=\"string\">&quot;equals&quot;</span>, Class.forName(<span class=\"string\">&quot;java.lang.Object&quot;</span>));</span><br><span class=\"line\">            m3 = Class.forName(<span class=\"string\">&quot;com.wangxt.wxt.design.patterns.proxy.dynamic.Father&quot;</span>).getMethod(<span class=\"string\">&quot;eat&quot;</span>);</span><br><span class=\"line\">            m2 = Class.forName(<span class=\"string\">&quot;java.lang.Object&quot;</span>).getMethod(<span class=\"string\">&quot;toString&quot;</span>);</span><br><span class=\"line\">            m0 = Class.forName(<span class=\"string\">&quot;java.lang.Object&quot;</span>).getMethod(<span class=\"string\">&quot;hashCode&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (NoSuchMethodException var2) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NoSuchMethodError</span>(var2.getMessage());</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (ClassNotFoundException var3) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NoClassDefFoundError</span>(var3.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> $Proxy0(InvocationHandler var1) <span class=\"keyword\">throws</span>  &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 这里会调用父类的构造，并把InvocationHandler传递</span></span><br><span class=\"line\">        <span class=\"built_in\">super</span>(var1);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 这里是我们自定义的方法，其它方法道理相同</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">void</span> <span class=\"title function_\">eat</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span>  &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 可以看到，当我们调用代理类的方法时，实际上会调用父类的h(InvocationHandler)的invoke方法</span></span><br><span class=\"line\">            <span class=\"comment\">// @Override</span></span><br><span class=\"line\">            <span class=\"comment\">// public Object invoke(Object proxy, Method method, Object[] args) throws Throwable</span></span><br><span class=\"line\">            <span class=\"comment\">// 所以我们重写InvocationHandler的invoke方法时传入的就是这几个参数</span></span><br><span class=\"line\">            <span class=\"built_in\">super</span>.h.invoke(<span class=\"built_in\">this</span>, m3, (Object[])<span class=\"literal\">null</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> var2;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Throwable var3) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">UndeclaredThrowableException</span>(var3);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>好了，到这里基本信息都看完了，我们做个总结</p>\n<ul>\n<li><p>准备代理类的描述数据</p>\n</li>\n<li><p>创建代理类（实现接口）的字节码文件</p>\n</li>\n<li><p>通过ClassLoader将代理类的字节数组加载到JVM中</p>\n</li>\n<li><p>创建代理类的实例对象，执行对象的目标方法</p>\n</li>\n</ul>\n<p>我们回过头来，在想想最开始的3个问题：</p>\n<ul>\n<li>为什么要使用实例对象的ClassLoader和Interfaces，使用其实例对象的行不行，使用类的行不行<ul>\n<li>因为我们要代理的接口是应用类加载器加载的，所以理论上只要应用类加载器加的类都可以</li>\n<li>但是interface肯定是需要实例对象(son.getClass())或者代理类(Son.class)，因为我们要对其的接口进行代理</li>\n</ul>\n</li>\n<li>为什么被代理类非要实现接口<ul>\n<li>因为代理类已经继承了Proxy类，所以只能实现接口</li>\n</ul>\n</li>\n<li>newProxyInstance返回的代理类是什么类型，强转成实现类（Father proxySon = (Son) Proxy.newProxyInstance(…)）会不会报错<ul>\n<li>返回的是实现了接口继承了Proxy的代理类，所以强转成Son会报错</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p><img src=\"https://cdn.jsdelivr.net/gh/wxt1471520488/images@main/hexo/JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/020691d7-f74f-471b-8249-3e02b5286431.png\" alt=\"image\"><br>因为JDK动态代理生成的代理对象默认继承了Proxy类，又因为Java中是单继承多实现，所以导致了JDK动态代理无法代理实现类，只能代理接口；而且我们通过观察Proxy类，维护了InvocationHandler h成员变量并提供了相应的方法，然后通过子类对InvocationHandler进行透传，Proxy对其进行方法执行，其实理论上只要我们把InvocationHandler提出来，不由Proxy进行维护，也就不需要继承Proxy类，就可以对实现类进行代理，可能作者基于面向接口开发的实际场景，以及抽象思维才这么进行设计的吧。</p>\n","popularPost_tmp_postPath":true,"eyeCatchImage":"https://cdn.jsdelivr.net/gh/wxt1471520488/images@main/hexo/JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/020691d7-f74f-471b-8249-3e02b5286431.png","popularPost_tmp_gaData":{"updated":"Sun Dec 04 2022 15:10:26 GMT+0800 (中国标准时间)","title":"JDK动态代理详解","path":"2022/12/04/JDK动态代理/","eyeCatchImage":"https://cdn.jsdelivr.net/gh/wxt1471520488/images@main/hexo/JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/020691d7-f74f-471b-8249-3e02b5286431.png","excerpt":"JDK动态代理的源码，JDK动态代理为什么不能代理实现类，JDK动态代理为什么只能代理接口","date":{"_isAMomentObject":true,"_i":"2022-12-04T06:38:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-12-04T06:38:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"思考总结 > jdk源码","tags":["设计模式","源码","AOP"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"windows 批量启动软件脚本","date":"2022-12-04T06:38:00.000Z","_content":"> 公司预备使用的是windows系统主机办公，每天早上来了第一件事就是开机，启动软件，启动软件，启动...，个人不太喜欢使用软件的开机自启动，于是有了这个脚本。\n<!--more-->\n## 代码\n\n~~~ shell\n@echo off\ntitle quick start\nstart /d \"D:\\software\\WeChat\\\" WeChat.exe\necho starting weChat\nchoice /t 3 /d y /n >nul\nstart /d \"D:\\software\\WXWork\\\" WXWork.exe\necho starting wxWork\nchoice /t 3 /d y /n >nul\nstart /d \"D:\\software\\Clash for Windows\\\" Clash.exe\necho starting clash\nchoice /t 3 /d y /n >nul\necho start over bye~\n~~~\n\n## 使用\n\n* 新建一个start.txt文件，修改文件后缀名为start.bat\n* 右击软件，右击选择编辑，将代码复制过去\n* 将代码中的路径和软件名称替换成你自己的\n\n**注意**\n\n软件名称不要有空格，否则会报错\n","source":"_posts/quick_start_bat.md","raw":"---\ntitle: windows 批量启动软件脚本\ndate: 2022-12-04 14:38\ncategories: \n- [效率提升]\ntags:\n  - bat\n  - 脚本\n  - 便捷开发\n---\n> 公司预备使用的是windows系统主机办公，每天早上来了第一件事就是开机，启动软件，启动软件，启动...，个人不太喜欢使用软件的开机自启动，于是有了这个脚本。\n<!--more-->\n## 代码\n\n~~~ shell\n@echo off\ntitle quick start\nstart /d \"D:\\software\\WeChat\\\" WeChat.exe\necho starting weChat\nchoice /t 3 /d y /n >nul\nstart /d \"D:\\software\\WXWork\\\" WXWork.exe\necho starting wxWork\nchoice /t 3 /d y /n >nul\nstart /d \"D:\\software\\Clash for Windows\\\" Clash.exe\necho starting clash\nchoice /t 3 /d y /n >nul\necho start over bye~\n~~~\n\n## 使用\n\n* 新建一个start.txt文件，修改文件后缀名为start.bat\n* 右击软件，右击选择编辑，将代码复制过去\n* 将代码中的路径和软件名称替换成你自己的\n\n**注意**\n\n软件名称不要有空格，否则会报错\n","slug":"quick_start_bat","published":1,"updated":"2022-12-04T07:11:11.346Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clb91t0lm000n9sjn2jog555o","content":"<blockquote>\n<p>公司预备使用的是windows系统主机办公，每天早上来了第一件事就是开机，启动软件，启动软件，启动…，个人不太喜欢使用软件的开机自启动，于是有了这个脚本。</p>\n</blockquote>\n<span id=\"more\"></span>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@echo off</span><br><span class=\"line\">title quick start</span><br><span class=\"line\">start /d &quot;D:\\software\\WeChat\\&quot; WeChat.exe</span><br><span class=\"line\">echo starting weChat</span><br><span class=\"line\">choice /t 3 /d y /n &gt;nul</span><br><span class=\"line\">start /d &quot;D:\\software\\WXWork\\&quot; WXWork.exe</span><br><span class=\"line\">echo starting wxWork</span><br><span class=\"line\">choice /t 3 /d y /n &gt;nul</span><br><span class=\"line\">start /d &quot;D:\\software\\Clash for Windows\\&quot; Clash.exe</span><br><span class=\"line\">echo starting clash</span><br><span class=\"line\">choice /t 3 /d y /n &gt;nul</span><br><span class=\"line\">echo start over bye~</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><ul>\n<li>新建一个start.txt文件，修改文件后缀名为start.bat</li>\n<li>右击软件，右击选择编辑，将代码复制过去</li>\n<li>将代码中的路径和软件名称替换成你自己的</li>\n</ul>\n<p><strong>注意</strong></p>\n<p>软件名称不要有空格，否则会报错</p>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>公司预备使用的是windows系统主机办公，每天早上来了第一件事就是开机，启动软件，启动软件，启动…，个人不太喜欢使用软件的开机自启动，于是有了这个脚本。</p>\n</blockquote>","more":"<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@echo off</span><br><span class=\"line\">title quick start</span><br><span class=\"line\">start /d &quot;D:\\software\\WeChat\\&quot; WeChat.exe</span><br><span class=\"line\">echo starting weChat</span><br><span class=\"line\">choice /t 3 /d y /n &gt;nul</span><br><span class=\"line\">start /d &quot;D:\\software\\WXWork\\&quot; WXWork.exe</span><br><span class=\"line\">echo starting wxWork</span><br><span class=\"line\">choice /t 3 /d y /n &gt;nul</span><br><span class=\"line\">start /d &quot;D:\\software\\Clash for Windows\\&quot; Clash.exe</span><br><span class=\"line\">echo starting clash</span><br><span class=\"line\">choice /t 3 /d y /n &gt;nul</span><br><span class=\"line\">echo start over bye~</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><ul>\n<li>新建一个start.txt文件，修改文件后缀名为start.bat</li>\n<li>右击软件，右击选择编辑，将代码复制过去</li>\n<li>将代码中的路径和软件名称替换成你自己的</li>\n</ul>\n<p><strong>注意</strong></p>\n<p>软件名称不要有空格，否则会报错</p>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sun Dec 04 2022 15:11:11 GMT+0800 (中国标准时间)","title":"windows 批量启动软件脚本","path":"2022/12/04/quick_start_bat/","eyeCatchImage":null,"excerpt":"<blockquote>\n<p>公司预备使用的是windows系统主机办公，每天早上来了第一件事就是开机，启动软件，启动软件，启动…，个人不太喜欢使用软件的开机自启动，于是有了这个脚本。</p>\n</blockquote>","date":{"_isAMomentObject":true,"_i":"2022-12-04T06:38:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-12-04T06:38:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"效率提升","tags":["bat","脚本","便捷开发"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"一键重置git分支脚本","date":"2022-12-04T06:38:00.000Z","summary":"一键重置git分支脚本","_content":"> 由于公司的上线封版机制，每个上线窗口结束之后，需要将qa和develop分支切换成上个窗口的beta灰度分支，虽然逻辑很简单，但是处理起来还有有点小繁琐，所以写了一个脚本干这个事，其实就是将用到的git命令打包，叫脚本去执行了自己本该执行的git命令，简单记录一下\n<!--more-->\n~~~sh\n#!/usr/bin/env bash\nif [ $# -le 3 ]\n  then\n    echo \"参数有误({源分支},{重置分支},{本地项目根目录},{项目名称(api/www)}) 举例：\"\n\techo \"8.29.1.0 qa D:/wangxt-git api\"\n    exit\nfi\nif [ -z $2 ]\n  then\n    LIST=(qa,develop)\n  else\n    LIST=($2)\nfi\nif [ -z $3 ]\n  then\n    WORK_PATH=D:/wangxt-git\n  else\n    WORK_PATH=$3\nfi\nif [ \"api\" = $4 ]\n  then\n    P_NAME=/api\n\tF_NAME=/framework\n  else\n    P_NAME=/www\n\tF_NAME=/framework\nfi\necho \"===============================================================\"\necho \"=     项目名称:         \"$P_NAME\"             \"\necho \"=                       \"$F_NAME\"             \"\necho \"=     源分支:           \"$1\"                  \"\necho \"=     要重置的分支:     \"$LIST\"               \"\necho \"=     你的项目绝对路径: \"$3\"                  \"\necho \"===============================================================\"\necho \"以上信息，确定正确码？请输入序号\"\nselect yn in \"正确,开始执行\" \"错误,退出程序\"; do\n   case $yn in\n       正确,开始执行 ) \n\t   echo \"!!!!准备进入\"$3\"目录\"\n\t\tcd WORK_PATH\n\t\techo \"当前工作目录：\"`pwd`\n\t\techo \"-------- api-framework 开始 -------\"\n\t\tcd $WORK_PATH$F_NAME\n\t\techo \"当前工作目录：\"`pwd`\n\t\tgit checkout -b $1.temp4shell remotes/origin/$1\n\t\t\tfor i in $LIST\n\t\t\tdo   \n\t\t\t\techo \"!!!!尝试删除本地分支：\"$i\n\t\t\t\tgit checkout -b $1.temp4shell\n\t\t\t\tgit pull\n\t\t\t\tgit branch -D $i\n\t\t\t\techo \"!!!!忽略上边报错\"\n\t\t\t\tgit checkout -b $i remotes/origin/$i\n\t\t\t\techo \"!!!!重新检出分支：\"$i\n\t\t\t\tgit branch -D $i\n\t\t\t\tgit push origin --Delete $i\n\t\t\t\techo \"!!!! \"$i\" 分支删除完毕\"\n\t\t\t\tgit checkout -b $1 remotes/origin/$1\n\t\t\t\tgit pull\n\t\t\t\tgit checkout -b $i\n\t\t\t\tgit push -u origin $i\n\t\t\t\techo \"!!!! \"$i\" 分支已从 \"$1\" 分支检出\" \n\t\t\tdone\n\t\tgit branch -D $1.temp4shell\n\t\tgit push origin --Delete $1.temp4shell\n\t\techo \"------- api-framework 结束 -------\"\n\t\techo \"=================================\"\n\t\techo \"--------- api 开始 ---------\"\n\t\tcd $WORK_PATH$P_NAME\n\t\techo \"当前工作目录：\"`pwd`\n\t\tgit checkout -b $1.temp4shell remotes/origin/$1\n\t\t\tfor i in $LIST\n\t\t\tdo   \n\t\t\t\techo \"!!!!尝试删除本地分支：\"$i\n\t\t\t\tgit checkout -b $1.temp4shell\n\t\t\t\tgit pull\n\t\t\t\tgit branch -D $i\n\t\t\t\techo \"!!!!忽略上边报错\"\n\t\t\t\tgit checkout -b $i remotes/origin/$i\n\t\t\t\techo \"!!!!重新检出分支：\"$i\n\t\t\t\tgit branch -D $i\n\t\t\t\tgit push origin --Delete $i\n\t\t\t\techo \"!!!! \"$i\" 分支删除完毕\"\n\t\t\t\tgit checkout -b $1 remotes/origin/$1\n\t\t\t\tgit pull\n\t\t\t\tgit checkout -b $i\n\t\t\t\tgit push -u origin $i\n\t\t\t\techo \"!!!! \"$i\" 分支已从 \"$1\" 分支检出\" \n\t\t\tdone\n\t\tgit branch -D $1.temp4shell\n\t\tgit push origin --Delete $1.temp4shell\n\t\techo \"-------- api end --------\"\n\t\techo \"理论上 \"$4\" 项目的 \"$LIST\" 已重置完成，请到 gitlab 验收结果!!!\"\n\t\techo \"\"\n\t\techo \"Bye~\"; break;;\n       错误,退出程序 ) echo \"Bye~\";exit;;\n   esac\ndone\n~~~\n\n","source":"_posts/reset-git-branch.md","raw":"---\ntitle: 一键重置git分支脚本\ndate: 2022-12-04 14:38\nsummary: 一键重置git分支脚本\ncategories: \n- [效率提升]\ntags:\n- shell\n- git branch\n---\n> 由于公司的上线封版机制，每个上线窗口结束之后，需要将qa和develop分支切换成上个窗口的beta灰度分支，虽然逻辑很简单，但是处理起来还有有点小繁琐，所以写了一个脚本干这个事，其实就是将用到的git命令打包，叫脚本去执行了自己本该执行的git命令，简单记录一下\n<!--more-->\n~~~sh\n#!/usr/bin/env bash\nif [ $# -le 3 ]\n  then\n    echo \"参数有误({源分支},{重置分支},{本地项目根目录},{项目名称(api/www)}) 举例：\"\n\techo \"8.29.1.0 qa D:/wangxt-git api\"\n    exit\nfi\nif [ -z $2 ]\n  then\n    LIST=(qa,develop)\n  else\n    LIST=($2)\nfi\nif [ -z $3 ]\n  then\n    WORK_PATH=D:/wangxt-git\n  else\n    WORK_PATH=$3\nfi\nif [ \"api\" = $4 ]\n  then\n    P_NAME=/api\n\tF_NAME=/framework\n  else\n    P_NAME=/www\n\tF_NAME=/framework\nfi\necho \"===============================================================\"\necho \"=     项目名称:         \"$P_NAME\"             \"\necho \"=                       \"$F_NAME\"             \"\necho \"=     源分支:           \"$1\"                  \"\necho \"=     要重置的分支:     \"$LIST\"               \"\necho \"=     你的项目绝对路径: \"$3\"                  \"\necho \"===============================================================\"\necho \"以上信息，确定正确码？请输入序号\"\nselect yn in \"正确,开始执行\" \"错误,退出程序\"; do\n   case $yn in\n       正确,开始执行 ) \n\t   echo \"!!!!准备进入\"$3\"目录\"\n\t\tcd WORK_PATH\n\t\techo \"当前工作目录：\"`pwd`\n\t\techo \"-------- api-framework 开始 -------\"\n\t\tcd $WORK_PATH$F_NAME\n\t\techo \"当前工作目录：\"`pwd`\n\t\tgit checkout -b $1.temp4shell remotes/origin/$1\n\t\t\tfor i in $LIST\n\t\t\tdo   \n\t\t\t\techo \"!!!!尝试删除本地分支：\"$i\n\t\t\t\tgit checkout -b $1.temp4shell\n\t\t\t\tgit pull\n\t\t\t\tgit branch -D $i\n\t\t\t\techo \"!!!!忽略上边报错\"\n\t\t\t\tgit checkout -b $i remotes/origin/$i\n\t\t\t\techo \"!!!!重新检出分支：\"$i\n\t\t\t\tgit branch -D $i\n\t\t\t\tgit push origin --Delete $i\n\t\t\t\techo \"!!!! \"$i\" 分支删除完毕\"\n\t\t\t\tgit checkout -b $1 remotes/origin/$1\n\t\t\t\tgit pull\n\t\t\t\tgit checkout -b $i\n\t\t\t\tgit push -u origin $i\n\t\t\t\techo \"!!!! \"$i\" 分支已从 \"$1\" 分支检出\" \n\t\t\tdone\n\t\tgit branch -D $1.temp4shell\n\t\tgit push origin --Delete $1.temp4shell\n\t\techo \"------- api-framework 结束 -------\"\n\t\techo \"=================================\"\n\t\techo \"--------- api 开始 ---------\"\n\t\tcd $WORK_PATH$P_NAME\n\t\techo \"当前工作目录：\"`pwd`\n\t\tgit checkout -b $1.temp4shell remotes/origin/$1\n\t\t\tfor i in $LIST\n\t\t\tdo   \n\t\t\t\techo \"!!!!尝试删除本地分支：\"$i\n\t\t\t\tgit checkout -b $1.temp4shell\n\t\t\t\tgit pull\n\t\t\t\tgit branch -D $i\n\t\t\t\techo \"!!!!忽略上边报错\"\n\t\t\t\tgit checkout -b $i remotes/origin/$i\n\t\t\t\techo \"!!!!重新检出分支：\"$i\n\t\t\t\tgit branch -D $i\n\t\t\t\tgit push origin --Delete $i\n\t\t\t\techo \"!!!! \"$i\" 分支删除完毕\"\n\t\t\t\tgit checkout -b $1 remotes/origin/$1\n\t\t\t\tgit pull\n\t\t\t\tgit checkout -b $i\n\t\t\t\tgit push -u origin $i\n\t\t\t\techo \"!!!! \"$i\" 分支已从 \"$1\" 分支检出\" \n\t\t\tdone\n\t\tgit branch -D $1.temp4shell\n\t\tgit push origin --Delete $1.temp4shell\n\t\techo \"-------- api end --------\"\n\t\techo \"理论上 \"$4\" 项目的 \"$LIST\" 已重置完成，请到 gitlab 验收结果!!!\"\n\t\techo \"\"\n\t\techo \"Bye~\"; break;;\n       错误,退出程序 ) echo \"Bye~\";exit;;\n   esac\ndone\n~~~\n\n","slug":"reset-git-branch","published":1,"updated":"2022-12-04T07:11:37.362Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clb91t0lo000q9sjnh7nq8eyk","content":"<blockquote>\n<p>由于公司的上线封版机制，每个上线窗口结束之后，需要将qa和develop分支切换成上个窗口的beta灰度分支，虽然逻辑很简单，但是处理起来还有有点小繁琐，所以写了一个脚本干这个事，其实就是将用到的git命令打包，叫脚本去执行了自己本该执行的git命令，简单记录一下</p>\n</blockquote>\n<span id=\"more\"></span>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env bash</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$#</span> -le 3 ]</span><br><span class=\"line\">  <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;参数有误(&#123;源分支&#125;,&#123;重置分支&#125;,&#123;本地项目根目录&#125;,&#123;项目名称(api/www)&#125;) 举例：&quot;</span></span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;8.29.1.0 qa D:/wangxt-git api&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"variable\">$2</span> ]</span><br><span class=\"line\">  <span class=\"keyword\">then</span></span><br><span class=\"line\">    LIST=(qa,develop)</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    LIST=(<span class=\"variable\">$2</span>)</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"variable\">$3</span> ]</span><br><span class=\"line\">  <span class=\"keyword\">then</span></span><br><span class=\"line\">    WORK_PATH=D:/wangxt-git</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    WORK_PATH=<span class=\"variable\">$3</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;api&quot;</span> = <span class=\"variable\">$4</span> ]</span><br><span class=\"line\">  <span class=\"keyword\">then</span></span><br><span class=\"line\">    P_NAME=/api</span><br><span class=\"line\">\tF_NAME=/framework</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    P_NAME=/www</span><br><span class=\"line\">\tF_NAME=/framework</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;===============================================================&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;=     项目名称:         &quot;</span><span class=\"variable\">$P_NAME</span><span class=\"string\">&quot;             &quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;=                       &quot;</span><span class=\"variable\">$F_NAME</span><span class=\"string\">&quot;             &quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;=     源分支:           &quot;</span><span class=\"variable\">$1</span><span class=\"string\">&quot;                  &quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;=     要重置的分支:     &quot;</span><span class=\"variable\">$LIST</span><span class=\"string\">&quot;               &quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;=     你的项目绝对路径: &quot;</span><span class=\"variable\">$3</span><span class=\"string\">&quot;                  &quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;===============================================================&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;以上信息，确定正确码？请输入序号&quot;</span></span><br><span class=\"line\">select yn <span class=\"keyword\">in</span> <span class=\"string\">&quot;正确,开始执行&quot;</span> <span class=\"string\">&quot;错误,退出程序&quot;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">   <span class=\"keyword\">case</span> <span class=\"variable\">$yn</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">       正确,开始执行 ) </span><br><span class=\"line\">\t   <span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!!准备进入&quot;</span><span class=\"variable\">$3</span><span class=\"string\">&quot;目录&quot;</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">cd</span> WORK_PATH</span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;当前工作目录：&quot;</span>`<span class=\"built_in\">pwd</span>`</span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;-------- api-framework 开始 -------&quot;</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">cd</span> $WORK_PATH<span class=\"variable\">$F_NAME</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;当前工作目录：&quot;</span>`<span class=\"built_in\">pwd</span>`</span><br><span class=\"line\">\t\tgit checkout -b <span class=\"variable\">$1</span>.temp4shell remotes/origin/<span class=\"variable\">$1</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"variable\">$LIST</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">do</span>   </span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!!尝试删除本地分支：&quot;</span><span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\tgit checkout -b <span class=\"variable\">$1</span>.temp4shell</span><br><span class=\"line\">\t\t\t\tgit pull</span><br><span class=\"line\">\t\t\t\tgit branch -D <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!!忽略上边报错&quot;</span></span><br><span class=\"line\">\t\t\t\tgit checkout -b <span class=\"variable\">$i</span> remotes/origin/<span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!!重新检出分支：&quot;</span><span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\tgit branch -D <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\tgit push origin --Delete <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!! &quot;</span><span class=\"variable\">$i</span><span class=\"string\">&quot; 分支删除完毕&quot;</span></span><br><span class=\"line\">\t\t\t\tgit checkout -b <span class=\"variable\">$1</span> remotes/origin/<span class=\"variable\">$1</span></span><br><span class=\"line\">\t\t\t\tgit pull</span><br><span class=\"line\">\t\t\t\tgit checkout -b <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\tgit push -u origin <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!! &quot;</span><span class=\"variable\">$i</span><span class=\"string\">&quot; 分支已从 &quot;</span><span class=\"variable\">$1</span><span class=\"string\">&quot; 分支检出&quot;</span> </span><br><span class=\"line\">\t\t\t<span class=\"keyword\">done</span></span><br><span class=\"line\">\t\tgit branch -D <span class=\"variable\">$1</span>.temp4shell</span><br><span class=\"line\">\t\tgit push origin --Delete <span class=\"variable\">$1</span>.temp4shell</span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;------- api-framework 结束 -------&quot;</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;=================================&quot;</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;--------- api 开始 ---------&quot;</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">cd</span> $WORK_PATH<span class=\"variable\">$P_NAME</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;当前工作目录：&quot;</span>`<span class=\"built_in\">pwd</span>`</span><br><span class=\"line\">\t\tgit checkout -b <span class=\"variable\">$1</span>.temp4shell remotes/origin/<span class=\"variable\">$1</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"variable\">$LIST</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">do</span>   </span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!!尝试删除本地分支：&quot;</span><span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\tgit checkout -b <span class=\"variable\">$1</span>.temp4shell</span><br><span class=\"line\">\t\t\t\tgit pull</span><br><span class=\"line\">\t\t\t\tgit branch -D <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!!忽略上边报错&quot;</span></span><br><span class=\"line\">\t\t\t\tgit checkout -b <span class=\"variable\">$i</span> remotes/origin/<span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!!重新检出分支：&quot;</span><span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\tgit branch -D <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\tgit push origin --Delete <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!! &quot;</span><span class=\"variable\">$i</span><span class=\"string\">&quot; 分支删除完毕&quot;</span></span><br><span class=\"line\">\t\t\t\tgit checkout -b <span class=\"variable\">$1</span> remotes/origin/<span class=\"variable\">$1</span></span><br><span class=\"line\">\t\t\t\tgit pull</span><br><span class=\"line\">\t\t\t\tgit checkout -b <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\tgit push -u origin <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!! &quot;</span><span class=\"variable\">$i</span><span class=\"string\">&quot; 分支已从 &quot;</span><span class=\"variable\">$1</span><span class=\"string\">&quot; 分支检出&quot;</span> </span><br><span class=\"line\">\t\t\t<span class=\"keyword\">done</span></span><br><span class=\"line\">\t\tgit branch -D <span class=\"variable\">$1</span>.temp4shell</span><br><span class=\"line\">\t\tgit push origin --Delete <span class=\"variable\">$1</span>.temp4shell</span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;-------- api end --------&quot;</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;理论上 &quot;</span><span class=\"variable\">$4</span><span class=\"string\">&quot; 项目的 &quot;</span><span class=\"variable\">$LIST</span><span class=\"string\">&quot; 已重置完成，请到 gitlab 验收结果!!!&quot;</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;Bye~&quot;</span>; <span class=\"built_in\">break</span>;;</span><br><span class=\"line\">       错误,退出程序 ) <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Bye~&quot;</span>;<span class=\"built_in\">exit</span>;;</span><br><span class=\"line\">   <span class=\"keyword\">esac</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>由于公司的上线封版机制，每个上线窗口结束之后，需要将qa和develop分支切换成上个窗口的beta灰度分支，虽然逻辑很简单，但是处理起来还有有点小繁琐，所以写了一个脚本干这个事，其实就是将用到的git命令打包，叫脚本去执行了自己本该执行的git命令，简单记录一下</p>\n</blockquote>","more":"<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/usr/bin/env bash</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$#</span> -le 3 ]</span><br><span class=\"line\">  <span class=\"keyword\">then</span></span><br><span class=\"line\">    <span class=\"built_in\">echo</span> <span class=\"string\">&quot;参数有误(&#123;源分支&#125;,&#123;重置分支&#125;,&#123;本地项目根目录&#125;,&#123;项目名称(api/www)&#125;) 举例：&quot;</span></span><br><span class=\"line\">\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;8.29.1.0 qa D:/wangxt-git api&quot;</span></span><br><span class=\"line\">    <span class=\"built_in\">exit</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"variable\">$2</span> ]</span><br><span class=\"line\">  <span class=\"keyword\">then</span></span><br><span class=\"line\">    LIST=(qa,develop)</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    LIST=(<span class=\"variable\">$2</span>)</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"variable\">$3</span> ]</span><br><span class=\"line\">  <span class=\"keyword\">then</span></span><br><span class=\"line\">    WORK_PATH=D:/wangxt-git</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    WORK_PATH=<span class=\"variable\">$3</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;api&quot;</span> = <span class=\"variable\">$4</span> ]</span><br><span class=\"line\">  <span class=\"keyword\">then</span></span><br><span class=\"line\">    P_NAME=/api</span><br><span class=\"line\">\tF_NAME=/framework</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    P_NAME=/www</span><br><span class=\"line\">\tF_NAME=/framework</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;===============================================================&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;=     项目名称:         &quot;</span><span class=\"variable\">$P_NAME</span><span class=\"string\">&quot;             &quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;=                       &quot;</span><span class=\"variable\">$F_NAME</span><span class=\"string\">&quot;             &quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;=     源分支:           &quot;</span><span class=\"variable\">$1</span><span class=\"string\">&quot;                  &quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;=     要重置的分支:     &quot;</span><span class=\"variable\">$LIST</span><span class=\"string\">&quot;               &quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;=     你的项目绝对路径: &quot;</span><span class=\"variable\">$3</span><span class=\"string\">&quot;                  &quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;===============================================================&quot;</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;以上信息，确定正确码？请输入序号&quot;</span></span><br><span class=\"line\">select yn <span class=\"keyword\">in</span> <span class=\"string\">&quot;正确,开始执行&quot;</span> <span class=\"string\">&quot;错误,退出程序&quot;</span>; <span class=\"keyword\">do</span></span><br><span class=\"line\">   <span class=\"keyword\">case</span> <span class=\"variable\">$yn</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">       正确,开始执行 ) </span><br><span class=\"line\">\t   <span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!!准备进入&quot;</span><span class=\"variable\">$3</span><span class=\"string\">&quot;目录&quot;</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">cd</span> WORK_PATH</span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;当前工作目录：&quot;</span>`<span class=\"built_in\">pwd</span>`</span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;-------- api-framework 开始 -------&quot;</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">cd</span> $WORK_PATH<span class=\"variable\">$F_NAME</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;当前工作目录：&quot;</span>`<span class=\"built_in\">pwd</span>`</span><br><span class=\"line\">\t\tgit checkout -b <span class=\"variable\">$1</span>.temp4shell remotes/origin/<span class=\"variable\">$1</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"variable\">$LIST</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">do</span>   </span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!!尝试删除本地分支：&quot;</span><span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\tgit checkout -b <span class=\"variable\">$1</span>.temp4shell</span><br><span class=\"line\">\t\t\t\tgit pull</span><br><span class=\"line\">\t\t\t\tgit branch -D <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!!忽略上边报错&quot;</span></span><br><span class=\"line\">\t\t\t\tgit checkout -b <span class=\"variable\">$i</span> remotes/origin/<span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!!重新检出分支：&quot;</span><span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\tgit branch -D <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\tgit push origin --Delete <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!! &quot;</span><span class=\"variable\">$i</span><span class=\"string\">&quot; 分支删除完毕&quot;</span></span><br><span class=\"line\">\t\t\t\tgit checkout -b <span class=\"variable\">$1</span> remotes/origin/<span class=\"variable\">$1</span></span><br><span class=\"line\">\t\t\t\tgit pull</span><br><span class=\"line\">\t\t\t\tgit checkout -b <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\tgit push -u origin <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!! &quot;</span><span class=\"variable\">$i</span><span class=\"string\">&quot; 分支已从 &quot;</span><span class=\"variable\">$1</span><span class=\"string\">&quot; 分支检出&quot;</span> </span><br><span class=\"line\">\t\t\t<span class=\"keyword\">done</span></span><br><span class=\"line\">\t\tgit branch -D <span class=\"variable\">$1</span>.temp4shell</span><br><span class=\"line\">\t\tgit push origin --Delete <span class=\"variable\">$1</span>.temp4shell</span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;------- api-framework 结束 -------&quot;</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;=================================&quot;</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;--------- api 开始 ---------&quot;</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">cd</span> $WORK_PATH<span class=\"variable\">$P_NAME</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;当前工作目录：&quot;</span>`<span class=\"built_in\">pwd</span>`</span><br><span class=\"line\">\t\tgit checkout -b <span class=\"variable\">$1</span>.temp4shell remotes/origin/<span class=\"variable\">$1</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"variable\">$LIST</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">do</span>   </span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!!尝试删除本地分支：&quot;</span><span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\tgit checkout -b <span class=\"variable\">$1</span>.temp4shell</span><br><span class=\"line\">\t\t\t\tgit pull</span><br><span class=\"line\">\t\t\t\tgit branch -D <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!!忽略上边报错&quot;</span></span><br><span class=\"line\">\t\t\t\tgit checkout -b <span class=\"variable\">$i</span> remotes/origin/<span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!!重新检出分支：&quot;</span><span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\tgit branch -D <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\tgit push origin --Delete <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!! &quot;</span><span class=\"variable\">$i</span><span class=\"string\">&quot; 分支删除完毕&quot;</span></span><br><span class=\"line\">\t\t\t\tgit checkout -b <span class=\"variable\">$1</span> remotes/origin/<span class=\"variable\">$1</span></span><br><span class=\"line\">\t\t\t\tgit pull</span><br><span class=\"line\">\t\t\t\tgit checkout -b <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\tgit push -u origin <span class=\"variable\">$i</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;!!!! &quot;</span><span class=\"variable\">$i</span><span class=\"string\">&quot; 分支已从 &quot;</span><span class=\"variable\">$1</span><span class=\"string\">&quot; 分支检出&quot;</span> </span><br><span class=\"line\">\t\t\t<span class=\"keyword\">done</span></span><br><span class=\"line\">\t\tgit branch -D <span class=\"variable\">$1</span>.temp4shell</span><br><span class=\"line\">\t\tgit push origin --Delete <span class=\"variable\">$1</span>.temp4shell</span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;-------- api end --------&quot;</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;理论上 &quot;</span><span class=\"variable\">$4</span><span class=\"string\">&quot; 项目的 &quot;</span><span class=\"variable\">$LIST</span><span class=\"string\">&quot; 已重置完成，请到 gitlab 验收结果!!!&quot;</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">echo</span> <span class=\"string\">&quot;Bye~&quot;</span>; <span class=\"built_in\">break</span>;;</span><br><span class=\"line\">       错误,退出程序 ) <span class=\"built_in\">echo</span> <span class=\"string\">&quot;Bye~&quot;</span>;<span class=\"built_in\">exit</span>;;</span><br><span class=\"line\">   <span class=\"keyword\">esac</span></span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sun Dec 04 2022 15:11:37 GMT+0800 (中国标准时间)","title":"一键重置git分支脚本","path":"2022/12/04/reset-git-branch/","eyeCatchImage":null,"excerpt":"<blockquote>\n<p>由于公司的上线封版机制，每个上线窗口结束之后，需要将qa和develop分支切换成上个窗口的beta灰度分支，虽然逻辑很简单，但是处理起来还有有点小繁琐，所以写了一个脚本干这个事，其实就是将用到的git命令打包，叫脚本去执行了自己本该执行的git命令，简单记录一下</p>\n</blockquote>","date":{"_isAMomentObject":true,"_i":"2022-12-04T06:38:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-12-04T06:38:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"效率提升","tags":["shell","git branch"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"一个聚合浏览器打开的标签的插件","date":"2022-12-04T06:38:00.000Z","_content":"> 前言：对于我们这些面向google编程的程序猿来说，浏览器会时常打开超多的标签页，当我们想回到某个标签页时很麻烦，很不好找，所以搞了这个浏览器插件 -- 一步\n<!--more-->\n\n## 用法\n\n### 克隆项目\n\n~~~ java\ngit clone https://github.com/wxt1471520488/one-step.git\n~~~\n\n### 在浏览器插件中引用\n\n![image](https://user-images.githubusercontent.com/30682144/144027747-d832f5fa-1154-49e4-b078-8ab121239c49.png)\n\n### 使用\n\n![image](https://user-images.githubusercontent.com/30682144/144028017-a62866ec-cdb9-46be-9c95-9ee98447b8a5.png)\n","source":"_posts/一个聚合浏览器打开的标签的插件.md","raw":"---\ntitle: 一个聚合浏览器打开的标签的插件\ndate: 2022-12-04 14:38\ncategories:\n- [效率提升]\ntags:\n- 实用功能\n- Chrome插件\n---\n> 前言：对于我们这些面向google编程的程序猿来说，浏览器会时常打开超多的标签页，当我们想回到某个标签页时很麻烦，很不好找，所以搞了这个浏览器插件 -- 一步\n<!--more-->\n\n## 用法\n\n### 克隆项目\n\n~~~ java\ngit clone https://github.com/wxt1471520488/one-step.git\n~~~\n\n### 在浏览器插件中引用\n\n![image](https://user-images.githubusercontent.com/30682144/144027747-d832f5fa-1154-49e4-b078-8ab121239c49.png)\n\n### 使用\n\n![image](https://user-images.githubusercontent.com/30682144/144028017-a62866ec-cdb9-46be-9c95-9ee98447b8a5.png)\n","slug":"一个聚合浏览器打开的标签的插件","published":1,"updated":"2022-12-04T07:05:12.756Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clb91t0lo000s9sjngyave15o","content":"<blockquote>\n<p>前言：对于我们这些面向google编程的程序猿来说，浏览器会时常打开超多的标签页，当我们想回到某个标签页时很麻烦，很不好找，所以搞了这个浏览器插件 – 一步</p>\n</blockquote>\n<span id=\"more\"></span>\n\n<h2 id=\"用法\"><a href=\"#用法\" class=\"headerlink\" title=\"用法\"></a>用法</h2><h3 id=\"克隆项目\"><a href=\"#克隆项目\" class=\"headerlink\" title=\"克隆项目\"></a>克隆项目</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https:<span class=\"comment\">//github.com/wxt1471520488/one-step.git</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在浏览器插件中引用\"><a href=\"#在浏览器插件中引用\" class=\"headerlink\" title=\"在浏览器插件中引用\"></a>在浏览器插件中引用</h3><p><img src=\"https://user-images.githubusercontent.com/30682144/144027747-d832f5fa-1154-49e4-b078-8ab121239c49.png\" class=\"lazyload\" data-srcset=\"https://user-images.githubusercontent.com/30682144/144027747-d832f5fa-1154-49e4-b078-8ab121239c49.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"image\"></p>\n<h3 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h3><p><img src=\"https://user-images.githubusercontent.com/30682144/144028017-a62866ec-cdb9-46be-9c95-9ee98447b8a5.png\" class=\"lazyload\" data-srcset=\"https://user-images.githubusercontent.com/30682144/144028017-a62866ec-cdb9-46be-9c95-9ee98447b8a5.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"image\"></p>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>前言：对于我们这些面向google编程的程序猿来说，浏览器会时常打开超多的标签页，当我们想回到某个标签页时很麻烦，很不好找，所以搞了这个浏览器插件 – 一步</p>\n</blockquote>","more":"<h2 id=\"用法\"><a href=\"#用法\" class=\"headerlink\" title=\"用法\"></a>用法</h2><h3 id=\"克隆项目\"><a href=\"#克隆项目\" class=\"headerlink\" title=\"克隆项目\"></a>克隆项目</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https:<span class=\"comment\">//github.com/wxt1471520488/one-step.git</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在浏览器插件中引用\"><a href=\"#在浏览器插件中引用\" class=\"headerlink\" title=\"在浏览器插件中引用\"></a>在浏览器插件中引用</h3><p><img src=\"https://user-images.githubusercontent.com/30682144/144027747-d832f5fa-1154-49e4-b078-8ab121239c49.png\" alt=\"image\"></p>\n<h3 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h3><p><img src=\"https://user-images.githubusercontent.com/30682144/144028017-a62866ec-cdb9-46be-9c95-9ee98447b8a5.png\" alt=\"image\"></p>","popularPost_tmp_postPath":true,"eyeCatchImage":"https://user-images.githubusercontent.com/30682144/144027747-d832f5fa-1154-49e4-b078-8ab121239c49.png","popularPost_tmp_gaData":{"updated":"Sun Dec 04 2022 15:05:12 GMT+0800 (中国标准时间)","title":"一个聚合浏览器打开的标签的插件","path":"2022/12/04/一个聚合浏览器打开的标签的插件/","eyeCatchImage":"https://user-images.githubusercontent.com/30682144/144027747-d832f5fa-1154-49e4-b078-8ab121239c49.png","excerpt":"<blockquote>\n<p>前言：对于我们这些面向google编程的程序猿来说，浏览器会时常打开超多的标签页，当我们想回到某个标签页时很麻烦，很不好找，所以搞了这个浏览器插件 – 一步</p>\n</blockquote>","date":{"_isAMomentObject":true,"_i":"2022-12-04T06:38:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-12-04T06:38:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"效率提升","tags":["实用功能","Chrome插件"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"代码实现单表的分库分表","date":"2022-12-04T06:38:00.000Z","_content":"线上业务上由于单表的数据量越来越大，并且随着用户的增长，表数据量的增长率可能还会增高，所以想着对单表进行分表，然后将整个分表的缘由以及分表方案的确定记录一下\n<!--more-->\n### 啥叫分库分表？\n\n简单点说就是当我们遇到访问极为频繁且数据量巨大的库表的时候，我们首先想到的就是减少单库单表的数据量，以便减少数据查询所需要的时间，提高数据库的吞吐，这就是所谓的分库分表。\n\n### 为什么要都开始考虑起来分库分表？\n\n\n当我们在开发一些用户量小的系统时，比如公司自用的后台系统，相对是比较轻松的，因为你无需特别专注的考虑高并发，高访问，大数据量等问题，所以对于数据库乃至一些表的设计，对当用户量比较小时还可以跑的通，但是随着量越来越大，动不动就上千万，上亿的数据，光靠加索引或对sql往死里优化还是远远不够的，这时候我们就该考虑是否到了对数据库需要进行分库分表的时候了，当然决定了一定要速战速决，因为数据量增长的速度比你犹豫的速度要快的多。\n\n### 如何进行分库分表？\n\n 对于分库分表，现在基本都是*水平分*和*垂直分*：(1)水平分就是根据一定规则，例如按照时间或业务唯一ID等对数据进行的拆分。比如根据年份来拆分不同的数据库。每个数据库结构一致，但是数据会平均，从而提升性能；(2)\n垂直分就是按照业务进行划分，例如将用户相关的放一个库，订单相关的放一个库。\n\n#### 1.分库：\n\n 先来讨论下分库，很多项目一开始基本都是一个库，各种业务的表都在一起，随着表越来越多，变得越来越来不好维护，老表新表掺杂在一起，一些废弃的表也没有及时做清理(我真的要吐了，所以文档是多么的重要)\n。对于分库，我现在使用较多的是垂直分，按照业务分，比如我们将和用户端无用的一些用于统计的表单独放在一个库里，这样做好处是这些统计表不会参与用户测相关表的join查询操作，并且对于统计表进行需要进行大量计算，这样其实可以更放心的去查数据算数据不用担心影响到用户测的业务，所以对于类似的表进行垂直分库是完全没有问题的。对于水平分库目前没有实践，只是懂一些原理，就....\n\n简单点说就是当我们遇到访问极为频繁且数据量巨大的库表的时候，我们首先想到的就是减少单库单表的数据量，以便减少数据查询所需要的时间，提高数据库的吞吐，这就是所谓的分库分表。\n\n#### 2.分表：\n\n(1)对于向用户ID这样的数值类型我们可以对要分的表的数量取余(userId % count)来进行分表，根据这个路由策略，可以将记录根据userId路由到不同的表中，达到分表的母的。路由帮助方法示例代码：\n\n```java\n    // 分表基数\n    private static final Integer COUNT = 20;\n\n    /**\n     * @desc 根据用户ID获取分表后缀\n     * @author dataozi\n     * @date 2020/4/11 15:22\n     * @param userId 用户ID\n     * @return 表后缀\n     * @throws RuntimeException 用户ID参数异常\n     */\n    public static String getSuffixByUserId(Long userId){\n        if(Objects.isNull(userId) || userId <= 0){\n            throw new RuntimeException(String.format(\"用户ID有误 , userId : %s\", userId));\n        }\n\n        return String.format(\"_g0_p%s\", userId % COUNT);\n    }\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)可能大家有疑问，为什么表后缀是\"_g0_p0\"\n，这样目的是为了以后可能会再次进行分表，因为这种方式最大的弊端就是我们需要预先确定下表的数量，但是随着量的增长，及时现在分了，以后还是会有再次达到记录阈值的那天；以后如果需要再次进行分表的话，我可以修改为\"_g1\"再次实现分表。\n\n(2)上边是定表，不定单表记录量的，我们还可以讨论下定表记录数，不行表的。就是我们规定每张表最大数据量假如为100w，那么当第一张表数据量达到后自动开始向下张表存数据。如何实现呢，其实思想大同小异，我们可以维护一个全局的记录总数，每次获取表后缀时判断是否需要取新的表，路由帮助方法示例代码：\n\n```java\n    // 单张表记录的最大数量\n    private static final long COUNT = 1000000L;\n\n    /**\n     * @desc 获取表的坐标\n     * @author dataozi\n     * @date 2020/4/11 16:15\n     * @param count 当前记录数\n     * @return 表坐标\n     * @throws RuntimeException 记录数参数异常\n     */\n    public static int getTableIndexVal(long count){\n        if (count <= 0) {\n            throw new RuntimeException(\"记录数有误\");\n        }\n        long index = count % COUNT == 0 ? count / COUNT - 1 : count / COUNT;\n        return (int) index;\n    }\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n需要注意的是一定要在业务记录量达到阈值之前创建新表，我们可以起个定时任务，在表记录达到90w时就创建下张表，预先创建表。\n\n(3)对于向UUID这样的我们可以取UUID的最后一位或最后两位进行分表，以最后一位举例，我们知道UUID是一个数字和字母组成的伪随机字段串，这样的话最后一位就是0-9a-z(26 + 10)，可以建立36张表，同上，表后缀可以是\"_g0_pa\"，大家没有问题吧。哈哈，坑来了，强调一下，UUID 是由一组32位数的**16进制数字**所构成，所以不是26个字母只有a-f，所以即使按照这种方式创建了表，也是永远用不到的，所以每个小知识点都要熟透啊，我就是对UUID没怎么真正了解，结果...；话说回来，这样的方式确实表的量是死的，那么怎么也变成稍微活一点呢?\n\n(4)我们取UUID的hashcode，这样我们又得到了一个数值类型的唯一标识，同理我们可以这样做，路由帮助方法示例代码：\n\n```java\n    // 分表基数\n    private static final Integer COUNT = 20;\n\n    /**\n     * @desc 根据uuid获取表后缀\n     * @author dataozi\n     * @date 2020/4/11 15:41\n     * @param uuid uuid\n     * @return 表后缀\n     * @throws RuntimeException uuid参数异常\n     */\n    public static String getSuffixByUserId(String uuid){\n        if (StringUtils.isBlank(uuid)) {\n            throw new RuntimeException(\"designID 为空\");\n        }\n\n        // 取uuid的hashcode绝对值对20取模的值\n        int code = uuid.toLowerCase().hashCode();\n        return String.format(\"_g0_p%s\", Math.abs(code) % COUNT);\n    }\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)(5)除了上边这种通过唯一标识进行水平分的，我们还可以通过日期进行分表，比如上边提到的一些统计数据表，表本身没有什么业务逻辑，只需要按照日期定期进行数据统计，那我们通过日期进行分表再好不过了；我们按照季度进行分表，一年4张统计数据表，这样分表最好定个闹铃，每个月提醒建表，或者你一次性建个几十年的，O(\n∩_∩)O哈哈~，路由帮助方法示例代码：\n\n```java\n    // 临时年份值\n    private static int tempYearByYearAndSeason;\n    // 临时月份值\n    private static Month tempMonthByYearAndSeason;\n    // 临时表名称后缀\n    private static String tempNameSuffixByYearAndSeason;\n\n    /**\n     * @desc 获取表后缀\n     * @author dataozi\n     * @date 2020/4/11 15:49\n     * @param year 年\n     * @param month 月\n     * @return 表后缀\n     */\n    public static String calcNameSuffix(int year, Month month) {\n        // 计算当前属于那个季度，从0开始\n        int quarterCount = 0;\n        switch (month) {\n            case JANUARY:\n            case FEBRUARY:\n            case MARCH:\n                break;\n            case APRIL:\n            case MAY:\n            case JUNE:\n                quarterCount += 1;\n                break;\n            case JULY:\n            case AUGUST:\n            case SEPTEMBER:\n                quarterCount += 2;\n                break;\n            case OCTOBER:\n            case NOVEMBER:\n            case DECEMBER:\n                quarterCount += 3;\n                break;\n            default:\n                throw new RuntimeException(\"system error\");\n        }\n        return String.format(\"_g%s_p%s\", year, quarterCount);\n    }\n\n    /*\n      设置初始值\n     */\n    static {\n        LocalDate now = LocalDate.now();\n        tempNameSuffixByYearAndSeason = calcNameSuffix(now.getYear(), now.getMonth());\n        tempYearByYearAndSeason = now.getYear();\n        tempMonthByYearAndSeason = now.getMonth();\n    }\n\n    /**\n     * @desc 获取表后缀\n     * @author dataozi\n     * @date 2020/4/11 15:51\n     * @return 表后缀\n     */\n    public static String getNameSuffixByYearAndSeason() {\n        LocalDate now = LocalDate.now();\n        int year = now.getYear();\n        Month month = now.getMonth();\n        // 当年月份交替时需要重置静态数据\n        if (year == tempYearByYearAndSeason && month.equals(tempMonthByYearAndSeason)) {\n            return Objects.requireNonNull(tempNameSuffixByYearAndSeason);\n        }\n\n        tempNameSuffixByYearAndSeason = calcNameSuffix(year, month);\n        tempYearByYearAndSeason = year;\n        tempMonthByYearAndSeason = month;\n        return tempNameSuffixByYearAndSeason;\n    }\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n### 分库分表之后，主键ID该怎么维护？\n\n上边我们通过简单的代码，基本已经实现了分库分表，不要高兴太早，原来单表时，我们是有主键ID的，一般都是自增ID，那么进行分表之后，每张表都会有各自的主键自增ID，那么怎么维护一个全局的主键ID呢，下面我们在讨论一下这个问题：\n\n​      (1)利用数据库本身。我们可以在单独创建一张ID表，每次在新增数据时，先向ID表中插入一条数据，获取最新主键ID之后再向分表中插入业务数据；基本这只是一个思路，面临获取ID的性能、ID表记录会无限多等问题不考虑线上使用\n\n​      (2)利用Redis。利用redis的incr命令，每次在插入数据之前，先从redis获取到id，下次获取自动累计，达到自增的作用。示例代码：\n\n```java\n    // redis存储全局自增主键ID的key\n    private static final String TABLE_RECORD_COUNT_KEY = \"xxx-table.primary-key.record\";\n\n    /**\n     * @desc 获取主键ID\n     * @author dataozi\n     * @date 2020/4/11 16:20\n     * @return 数量\n     */\n    public static long incr() {\n        // cache是我们封装的jedis帮助类\n        if (cache == null) {\n            // 这里加锁，防止多个线程同时设置\n            synchronized (XXXX.class) {\n                if (cache == null) {\n                    cache = cacheDef.getCACHE19();\n                }\n            }\n        }\n        return cache.incr(TABLE_RECORD_COUNT_KEY);\n    }\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n(3)其它一些较成熟的自增id的类库，因为没线上实践过，所以...略过\n\n### 如何对已有表进行分表？\n\n对于一些新表好说，我们可以都设计好了在去上线使用，但是我们实际在分表时，有很多是已经在业务使用的表，已经使用的表如何分表呢？这里讨论的是怎么实现由老表向新表的过渡。\n\n(1)停止服务\n\n告诉用户我们要大更新，晚上几点到几点暂停运营，然后在这期间老表没有了新数据的插入，我们可以很方便将历史数据同步到新表，在部署代码，充分测试上线。看似没有任何问题是吧，最大的问题就是方案本身的问题，我们停止了服务，举个不恰当的例子，你怎么判断你的电脑有没有网，是不是打开百度或google随便搜个啥东西，从另外一个方面体现出人家的服务是多么的稳定，所以只要有其它方案，我们绝不考虑停机去干一些事情。\n\n(2)双向同步\n\n不停机我们怎么实现新老表的平滑过渡呢，我们需要先在老表插入数据的地方同步向新表插入并上线，这样入口打通了，然后是历史数据，在搞个定时任务去同步历史数据，等历史数据同步完之后，新表数据和老表就完全一致了，因为历史数据有了，并且新数据会同步向新老表插入，最后一步就是修改查询，将所有从老表查询的地方改为从新表查询，同时去掉向老表插入数据的代码上线，这样老表没有任何使用的地方，任由处置。\n","source":"_posts/代码实现单表的分库分表.md","raw":"---\ntitle: 代码实现单表的分库分表\ndate: 2022-12-04 14:38\ncategories:\n- [思考总结, 数据库优化]\ntags:\n- 分库分表\n- 性能优化\n---\n线上业务上由于单表的数据量越来越大，并且随着用户的增长，表数据量的增长率可能还会增高，所以想着对单表进行分表，然后将整个分表的缘由以及分表方案的确定记录一下\n<!--more-->\n### 啥叫分库分表？\n\n简单点说就是当我们遇到访问极为频繁且数据量巨大的库表的时候，我们首先想到的就是减少单库单表的数据量，以便减少数据查询所需要的时间，提高数据库的吞吐，这就是所谓的分库分表。\n\n### 为什么要都开始考虑起来分库分表？\n\n\n当我们在开发一些用户量小的系统时，比如公司自用的后台系统，相对是比较轻松的，因为你无需特别专注的考虑高并发，高访问，大数据量等问题，所以对于数据库乃至一些表的设计，对当用户量比较小时还可以跑的通，但是随着量越来越大，动不动就上千万，上亿的数据，光靠加索引或对sql往死里优化还是远远不够的，这时候我们就该考虑是否到了对数据库需要进行分库分表的时候了，当然决定了一定要速战速决，因为数据量增长的速度比你犹豫的速度要快的多。\n\n### 如何进行分库分表？\n\n 对于分库分表，现在基本都是*水平分*和*垂直分*：(1)水平分就是根据一定规则，例如按照时间或业务唯一ID等对数据进行的拆分。比如根据年份来拆分不同的数据库。每个数据库结构一致，但是数据会平均，从而提升性能；(2)\n垂直分就是按照业务进行划分，例如将用户相关的放一个库，订单相关的放一个库。\n\n#### 1.分库：\n\n 先来讨论下分库，很多项目一开始基本都是一个库，各种业务的表都在一起，随着表越来越多，变得越来越来不好维护，老表新表掺杂在一起，一些废弃的表也没有及时做清理(我真的要吐了，所以文档是多么的重要)\n。对于分库，我现在使用较多的是垂直分，按照业务分，比如我们将和用户端无用的一些用于统计的表单独放在一个库里，这样做好处是这些统计表不会参与用户测相关表的join查询操作，并且对于统计表进行需要进行大量计算，这样其实可以更放心的去查数据算数据不用担心影响到用户测的业务，所以对于类似的表进行垂直分库是完全没有问题的。对于水平分库目前没有实践，只是懂一些原理，就....\n\n简单点说就是当我们遇到访问极为频繁且数据量巨大的库表的时候，我们首先想到的就是减少单库单表的数据量，以便减少数据查询所需要的时间，提高数据库的吞吐，这就是所谓的分库分表。\n\n#### 2.分表：\n\n(1)对于向用户ID这样的数值类型我们可以对要分的表的数量取余(userId % count)来进行分表，根据这个路由策略，可以将记录根据userId路由到不同的表中，达到分表的母的。路由帮助方法示例代码：\n\n```java\n    // 分表基数\n    private static final Integer COUNT = 20;\n\n    /**\n     * @desc 根据用户ID获取分表后缀\n     * @author dataozi\n     * @date 2020/4/11 15:22\n     * @param userId 用户ID\n     * @return 表后缀\n     * @throws RuntimeException 用户ID参数异常\n     */\n    public static String getSuffixByUserId(Long userId){\n        if(Objects.isNull(userId) || userId <= 0){\n            throw new RuntimeException(String.format(\"用户ID有误 , userId : %s\", userId));\n        }\n\n        return String.format(\"_g0_p%s\", userId % COUNT);\n    }\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)可能大家有疑问，为什么表后缀是\"_g0_p0\"\n，这样目的是为了以后可能会再次进行分表，因为这种方式最大的弊端就是我们需要预先确定下表的数量，但是随着量的增长，及时现在分了，以后还是会有再次达到记录阈值的那天；以后如果需要再次进行分表的话，我可以修改为\"_g1\"再次实现分表。\n\n(2)上边是定表，不定单表记录量的，我们还可以讨论下定表记录数，不行表的。就是我们规定每张表最大数据量假如为100w，那么当第一张表数据量达到后自动开始向下张表存数据。如何实现呢，其实思想大同小异，我们可以维护一个全局的记录总数，每次获取表后缀时判断是否需要取新的表，路由帮助方法示例代码：\n\n```java\n    // 单张表记录的最大数量\n    private static final long COUNT = 1000000L;\n\n    /**\n     * @desc 获取表的坐标\n     * @author dataozi\n     * @date 2020/4/11 16:15\n     * @param count 当前记录数\n     * @return 表坐标\n     * @throws RuntimeException 记录数参数异常\n     */\n    public static int getTableIndexVal(long count){\n        if (count <= 0) {\n            throw new RuntimeException(\"记录数有误\");\n        }\n        long index = count % COUNT == 0 ? count / COUNT - 1 : count / COUNT;\n        return (int) index;\n    }\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n需要注意的是一定要在业务记录量达到阈值之前创建新表，我们可以起个定时任务，在表记录达到90w时就创建下张表，预先创建表。\n\n(3)对于向UUID这样的我们可以取UUID的最后一位或最后两位进行分表，以最后一位举例，我们知道UUID是一个数字和字母组成的伪随机字段串，这样的话最后一位就是0-9a-z(26 + 10)，可以建立36张表，同上，表后缀可以是\"_g0_pa\"，大家没有问题吧。哈哈，坑来了，强调一下，UUID 是由一组32位数的**16进制数字**所构成，所以不是26个字母只有a-f，所以即使按照这种方式创建了表，也是永远用不到的，所以每个小知识点都要熟透啊，我就是对UUID没怎么真正了解，结果...；话说回来，这样的方式确实表的量是死的，那么怎么也变成稍微活一点呢?\n\n(4)我们取UUID的hashcode，这样我们又得到了一个数值类型的唯一标识，同理我们可以这样做，路由帮助方法示例代码：\n\n```java\n    // 分表基数\n    private static final Integer COUNT = 20;\n\n    /**\n     * @desc 根据uuid获取表后缀\n     * @author dataozi\n     * @date 2020/4/11 15:41\n     * @param uuid uuid\n     * @return 表后缀\n     * @throws RuntimeException uuid参数异常\n     */\n    public static String getSuffixByUserId(String uuid){\n        if (StringUtils.isBlank(uuid)) {\n            throw new RuntimeException(\"designID 为空\");\n        }\n\n        // 取uuid的hashcode绝对值对20取模的值\n        int code = uuid.toLowerCase().hashCode();\n        return String.format(\"_g0_p%s\", Math.abs(code) % COUNT);\n    }\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)(5)除了上边这种通过唯一标识进行水平分的，我们还可以通过日期进行分表，比如上边提到的一些统计数据表，表本身没有什么业务逻辑，只需要按照日期定期进行数据统计，那我们通过日期进行分表再好不过了；我们按照季度进行分表，一年4张统计数据表，这样分表最好定个闹铃，每个月提醒建表，或者你一次性建个几十年的，O(\n∩_∩)O哈哈~，路由帮助方法示例代码：\n\n```java\n    // 临时年份值\n    private static int tempYearByYearAndSeason;\n    // 临时月份值\n    private static Month tempMonthByYearAndSeason;\n    // 临时表名称后缀\n    private static String tempNameSuffixByYearAndSeason;\n\n    /**\n     * @desc 获取表后缀\n     * @author dataozi\n     * @date 2020/4/11 15:49\n     * @param year 年\n     * @param month 月\n     * @return 表后缀\n     */\n    public static String calcNameSuffix(int year, Month month) {\n        // 计算当前属于那个季度，从0开始\n        int quarterCount = 0;\n        switch (month) {\n            case JANUARY:\n            case FEBRUARY:\n            case MARCH:\n                break;\n            case APRIL:\n            case MAY:\n            case JUNE:\n                quarterCount += 1;\n                break;\n            case JULY:\n            case AUGUST:\n            case SEPTEMBER:\n                quarterCount += 2;\n                break;\n            case OCTOBER:\n            case NOVEMBER:\n            case DECEMBER:\n                quarterCount += 3;\n                break;\n            default:\n                throw new RuntimeException(\"system error\");\n        }\n        return String.format(\"_g%s_p%s\", year, quarterCount);\n    }\n\n    /*\n      设置初始值\n     */\n    static {\n        LocalDate now = LocalDate.now();\n        tempNameSuffixByYearAndSeason = calcNameSuffix(now.getYear(), now.getMonth());\n        tempYearByYearAndSeason = now.getYear();\n        tempMonthByYearAndSeason = now.getMonth();\n    }\n\n    /**\n     * @desc 获取表后缀\n     * @author dataozi\n     * @date 2020/4/11 15:51\n     * @return 表后缀\n     */\n    public static String getNameSuffixByYearAndSeason() {\n        LocalDate now = LocalDate.now();\n        int year = now.getYear();\n        Month month = now.getMonth();\n        // 当年月份交替时需要重置静态数据\n        if (year == tempYearByYearAndSeason && month.equals(tempMonthByYearAndSeason)) {\n            return Objects.requireNonNull(tempNameSuffixByYearAndSeason);\n        }\n\n        tempNameSuffixByYearAndSeason = calcNameSuffix(year, month);\n        tempYearByYearAndSeason = year;\n        tempMonthByYearAndSeason = month;\n        return tempNameSuffixByYearAndSeason;\n    }\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n### 分库分表之后，主键ID该怎么维护？\n\n上边我们通过简单的代码，基本已经实现了分库分表，不要高兴太早，原来单表时，我们是有主键ID的，一般都是自增ID，那么进行分表之后，每张表都会有各自的主键自增ID，那么怎么维护一个全局的主键ID呢，下面我们在讨论一下这个问题：\n\n​      (1)利用数据库本身。我们可以在单独创建一张ID表，每次在新增数据时，先向ID表中插入一条数据，获取最新主键ID之后再向分表中插入业务数据；基本这只是一个思路，面临获取ID的性能、ID表记录会无限多等问题不考虑线上使用\n\n​      (2)利用Redis。利用redis的incr命令，每次在插入数据之前，先从redis获取到id，下次获取自动累计，达到自增的作用。示例代码：\n\n```java\n    // redis存储全局自增主键ID的key\n    private static final String TABLE_RECORD_COUNT_KEY = \"xxx-table.primary-key.record\";\n\n    /**\n     * @desc 获取主键ID\n     * @author dataozi\n     * @date 2020/4/11 16:20\n     * @return 数量\n     */\n    public static long incr() {\n        // cache是我们封装的jedis帮助类\n        if (cache == null) {\n            // 这里加锁，防止多个线程同时设置\n            synchronized (XXXX.class) {\n                if (cache == null) {\n                    cache = cacheDef.getCACHE19();\n                }\n            }\n        }\n        return cache.incr(TABLE_RECORD_COUNT_KEY);\n    }\n```\n\n![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)\n\n(3)其它一些较成熟的自增id的类库，因为没线上实践过，所以...略过\n\n### 如何对已有表进行分表？\n\n对于一些新表好说，我们可以都设计好了在去上线使用，但是我们实际在分表时，有很多是已经在业务使用的表，已经使用的表如何分表呢？这里讨论的是怎么实现由老表向新表的过渡。\n\n(1)停止服务\n\n告诉用户我们要大更新，晚上几点到几点暂停运营，然后在这期间老表没有了新数据的插入，我们可以很方便将历史数据同步到新表，在部署代码，充分测试上线。看似没有任何问题是吧，最大的问题就是方案本身的问题，我们停止了服务，举个不恰当的例子，你怎么判断你的电脑有没有网，是不是打开百度或google随便搜个啥东西，从另外一个方面体现出人家的服务是多么的稳定，所以只要有其它方案，我们绝不考虑停机去干一些事情。\n\n(2)双向同步\n\n不停机我们怎么实现新老表的平滑过渡呢，我们需要先在老表插入数据的地方同步向新表插入并上线，这样入口打通了，然后是历史数据，在搞个定时任务去同步历史数据，等历史数据同步完之后，新表数据和老表就完全一致了，因为历史数据有了，并且新数据会同步向新老表插入，最后一步就是修改查询，将所有从老表查询的地方改为从新表查询，同时去掉向老表插入数据的代码上线，这样老表没有任何使用的地方，任由处置。\n","slug":"代码实现单表的分库分表","published":1,"updated":"2022-12-04T06:56:32.785Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clb91t0lr000u9sjncjemeotc","content":"<p>线上业务上由于单表的数据量越来越大，并且随着用户的增长，表数据量的增长率可能还会增高，所以想着对单表进行分表，然后将整个分表的缘由以及分表方案的确定记录一下</p>\n<span id=\"more\"></span>\n<h3 id=\"啥叫分库分表？\"><a href=\"#啥叫分库分表？\" class=\"headerlink\" title=\"啥叫分库分表？\"></a>啥叫分库分表？</h3><p>简单点说就是当我们遇到访问极为频繁且数据量巨大的库表的时候，我们首先想到的就是减少单库单表的数据量，以便减少数据查询所需要的时间，提高数据库的吞吐，这就是所谓的分库分表。</p>\n<h3 id=\"为什么要都开始考虑起来分库分表？\"><a href=\"#为什么要都开始考虑起来分库分表？\" class=\"headerlink\" title=\"为什么要都开始考虑起来分库分表？\"></a>为什么要都开始考虑起来分库分表？</h3><p>当我们在开发一些用户量小的系统时，比如公司自用的后台系统，相对是比较轻松的，因为你无需特别专注的考虑高并发，高访问，大数据量等问题，所以对于数据库乃至一些表的设计，对当用户量比较小时还可以跑的通，但是随着量越来越大，动不动就上千万，上亿的数据，光靠加索引或对sql往死里优化还是远远不够的，这时候我们就该考虑是否到了对数据库需要进行分库分表的时候了，当然决定了一定要速战速决，因为数据量增长的速度比你犹豫的速度要快的多。</p>\n<h3 id=\"如何进行分库分表？\"><a href=\"#如何进行分库分表？\" class=\"headerlink\" title=\"如何进行分库分表？\"></a>如何进行分库分表？</h3><p> 对于分库分表，现在基本都是<em>水平分</em>和<em>垂直分</em>：(1)水平分就是根据一定规则，例如按照时间或业务唯一ID等对数据进行的拆分。比如根据年份来拆分不同的数据库。每个数据库结构一致，但是数据会平均，从而提升性能；(2)<br>垂直分就是按照业务进行划分，例如将用户相关的放一个库，订单相关的放一个库。</p>\n<h4 id=\"1-分库：\"><a href=\"#1-分库：\" class=\"headerlink\" title=\"1.分库：\"></a>1.分库：</h4><p> 先来讨论下分库，很多项目一开始基本都是一个库，各种业务的表都在一起，随着表越来越多，变得越来越来不好维护，老表新表掺杂在一起，一些废弃的表也没有及时做清理(我真的要吐了，所以文档是多么的重要)<br>。对于分库，我现在使用较多的是垂直分，按照业务分，比如我们将和用户端无用的一些用于统计的表单独放在一个库里，这样做好处是这些统计表不会参与用户测相关表的join查询操作，并且对于统计表进行需要进行大量计算，这样其实可以更放心的去查数据算数据不用担心影响到用户测的业务，所以对于类似的表进行垂直分库是完全没有问题的。对于水平分库目前没有实践，只是懂一些原理，就….</p>\n<p>简单点说就是当我们遇到访问极为频繁且数据量巨大的库表的时候，我们首先想到的就是减少单库单表的数据量，以便减少数据查询所需要的时间，提高数据库的吞吐，这就是所谓的分库分表。</p>\n<h4 id=\"2-分表：\"><a href=\"#2-分表：\" class=\"headerlink\" title=\"2.分表：\"></a>2.分表：</h4><p>(1)对于向用户ID这样的数值类型我们可以对要分的表的数量取余(userId % count)来进行分表，根据这个路由策略，可以将记录根据userId路由到不同的表中，达到分表的母的。路由帮助方法示例代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 分表基数</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">Integer</span> <span class=\"variable\">COUNT</span> <span class=\"operator\">=</span> <span class=\"number\">20</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@desc</span> 根据用户ID获取分表后缀</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> dataozi</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2020/4/11 15:22</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> userId 用户ID</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> 表后缀</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> RuntimeException 用户ID参数异常</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">getSuffixByUserId</span><span class=\"params\">(Long userId)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(Objects.isNull(userId) || userId &lt;= <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(String.format(<span class=\"string\">&quot;用户ID有误 , userId : %s&quot;</span>, userId));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> String.format(<span class=\"string\">&quot;_g0_p%s&quot;</span>, userId % COUNT);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==\" alt=\"点击并拖拽以移动\">可能大家有疑问，为什么表后缀是”_g0_p0”<br>，这样目的是为了以后可能会再次进行分表，因为这种方式最大的弊端就是我们需要预先确定下表的数量，但是随着量的增长，及时现在分了，以后还是会有再次达到记录阈值的那天；以后如果需要再次进行分表的话，我可以修改为”_g1”再次实现分表。</p>\n<p>(2)上边是定表，不定单表记录量的，我们还可以讨论下定表记录数，不行表的。就是我们规定每张表最大数据量假如为100w，那么当第一张表数据量达到后自动开始向下张表存数据。如何实现呢，其实思想大同小异，我们可以维护一个全局的记录总数，每次获取表后缀时判断是否需要取新的表，路由帮助方法示例代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 单张表记录的最大数量</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">long</span> <span class=\"variable\">COUNT</span> <span class=\"operator\">=</span> <span class=\"number\">1000000L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@desc</span> 获取表的坐标</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> dataozi</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2020/4/11 16:15</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> count 当前记录数</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> 表坐标</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> RuntimeException 记录数参数异常</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">getTableIndexVal</span><span class=\"params\">(<span class=\"type\">long</span> count)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (count &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(<span class=\"string\">&quot;记录数有误&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">long</span> <span class=\"variable\">index</span> <span class=\"operator\">=</span> count % COUNT == <span class=\"number\">0</span> ? count / COUNT - <span class=\"number\">1</span> : count / COUNT;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (<span class=\"type\">int</span>) index;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==\" alt=\"点击并拖拽以移动\"></p>\n<p>需要注意的是一定要在业务记录量达到阈值之前创建新表，我们可以起个定时任务，在表记录达到90w时就创建下张表，预先创建表。</p>\n<p>(3)对于向UUID这样的我们可以取UUID的最后一位或最后两位进行分表，以最后一位举例，我们知道UUID是一个数字和字母组成的伪随机字段串，这样的话最后一位就是0-9a-z(26 + 10)，可以建立36张表，同上，表后缀可以是”_g0_pa”，大家没有问题吧。哈哈，坑来了，强调一下，UUID 是由一组32位数的<strong>16进制数字</strong>所构成，所以不是26个字母只有a-f，所以即使按照这种方式创建了表，也是永远用不到的，所以每个小知识点都要熟透啊，我就是对UUID没怎么真正了解，结果…；话说回来，这样的方式确实表的量是死的，那么怎么也变成稍微活一点呢?</p>\n<p>(4)我们取UUID的hashcode，这样我们又得到了一个数值类型的唯一标识，同理我们可以这样做，路由帮助方法示例代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 分表基数</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">Integer</span> <span class=\"variable\">COUNT</span> <span class=\"operator\">=</span> <span class=\"number\">20</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@desc</span> 根据uuid获取表后缀</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> dataozi</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2020/4/11 15:41</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> uuid uuid</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> 表后缀</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> RuntimeException uuid参数异常</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">getSuffixByUserId</span><span class=\"params\">(String uuid)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (StringUtils.isBlank(uuid)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(<span class=\"string\">&quot;designID 为空&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 取uuid的hashcode绝对值对20取模的值</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">code</span> <span class=\"operator\">=</span> uuid.toLowerCase().hashCode();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> String.format(<span class=\"string\">&quot;_g0_p%s&quot;</span>, Math.abs(code) % COUNT);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==\" alt=\"点击并拖拽以移动\">(5)除了上边这种通过唯一标识进行水平分的，我们还可以通过日期进行分表，比如上边提到的一些统计数据表，表本身没有什么业务逻辑，只需要按照日期定期进行数据统计，那我们通过日期进行分表再好不过了；我们按照季度进行分表，一年4张统计数据表，这样分表最好定个闹铃，每个月提醒建表，或者你一次性建个几十年的，O(<br>∩_∩)O哈哈~，路由帮助方法示例代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 临时年份值</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> tempYearByYearAndSeason;</span><br><span class=\"line\"><span class=\"comment\">// 临时月份值</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Month tempMonthByYearAndSeason;</span><br><span class=\"line\"><span class=\"comment\">// 临时表名称后缀</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String tempNameSuffixByYearAndSeason;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@desc</span> 获取表后缀</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> dataozi</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2020/4/11 15:49</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> year 年</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> month 月</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> 表后缀</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">calcNameSuffix</span><span class=\"params\">(<span class=\"type\">int</span> year, Month month)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 计算当前属于那个季度，从0开始</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">quarterCount</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (month) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> JANUARY:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> FEBRUARY:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> MARCH:</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> APRIL:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> MAY:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> JUNE:</span><br><span class=\"line\">            quarterCount += <span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> JULY:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> AUGUST:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> SEPTEMBER:</span><br><span class=\"line\">            quarterCount += <span class=\"number\">2</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> OCTOBER:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> NOVEMBER:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> DECEMBER:</span><br><span class=\"line\">            quarterCount += <span class=\"number\">3</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(<span class=\"string\">&quot;system error&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> String.format(<span class=\"string\">&quot;_g%s_p%s&quot;</span>, year, quarterCount);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  设置初始值</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">LocalDate</span> <span class=\"variable\">now</span> <span class=\"operator\">=</span> LocalDate.now();</span><br><span class=\"line\">    tempNameSuffixByYearAndSeason = calcNameSuffix(now.getYear(), now.getMonth());</span><br><span class=\"line\">    tempYearByYearAndSeason = now.getYear();</span><br><span class=\"line\">    tempMonthByYearAndSeason = now.getMonth();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@desc</span> 获取表后缀</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> dataozi</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2020/4/11 15:51</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> 表后缀</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">getNameSuffixByYearAndSeason</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">LocalDate</span> <span class=\"variable\">now</span> <span class=\"operator\">=</span> LocalDate.now();</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">year</span> <span class=\"operator\">=</span> now.getYear();</span><br><span class=\"line\">    <span class=\"type\">Month</span> <span class=\"variable\">month</span> <span class=\"operator\">=</span> now.getMonth();</span><br><span class=\"line\">    <span class=\"comment\">// 当年月份交替时需要重置静态数据</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (year == tempYearByYearAndSeason &amp;&amp; month.equals(tempMonthByYearAndSeason)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Objects.requireNonNull(tempNameSuffixByYearAndSeason);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    tempNameSuffixByYearAndSeason = calcNameSuffix(year, month);</span><br><span class=\"line\">    tempYearByYearAndSeason = year;</span><br><span class=\"line\">    tempMonthByYearAndSeason = month;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> tempNameSuffixByYearAndSeason;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==\" alt=\"点击并拖拽以移动\"></p>\n<h3 id=\"分库分表之后，主键ID该怎么维护？\"><a href=\"#分库分表之后，主键ID该怎么维护？\" class=\"headerlink\" title=\"分库分表之后，主键ID该怎么维护？\"></a>分库分表之后，主键ID该怎么维护？</h3><p>上边我们通过简单的代码，基本已经实现了分库分表，不要高兴太早，原来单表时，我们是有主键ID的，一般都是自增ID，那么进行分表之后，每张表都会有各自的主键自增ID，那么怎么维护一个全局的主键ID呢，下面我们在讨论一下这个问题：</p>\n<p>​      (1)利用数据库本身。我们可以在单独创建一张ID表，每次在新增数据时，先向ID表中插入一条数据，获取最新主键ID之后再向分表中插入业务数据；基本这只是一个思路，面临获取ID的性能、ID表记录会无限多等问题不考虑线上使用</p>\n<p>​      (2)利用Redis。利用redis的incr命令，每次在插入数据之前，先从redis获取到id，下次获取自动累计，达到自增的作用。示例代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// redis存储全局自增主键ID的key</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">TABLE_RECORD_COUNT_KEY</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;xxx-table.primary-key.record&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@desc</span> 获取主键ID</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> dataozi</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2020/4/11 16:20</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> 数量</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">long</span> <span class=\"title function_\">incr</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// cache是我们封装的jedis帮助类</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cache == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 这里加锁，防止多个线程同时设置</span></span><br><span class=\"line\">        <span class=\"keyword\">synchronized</span> (XXXX.class) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (cache == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                cache = cacheDef.getCACHE19();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> cache.incr(TABLE_RECORD_COUNT_KEY);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==\" alt=\"点击并拖拽以移动\"></p>\n<p>(3)其它一些较成熟的自增id的类库，因为没线上实践过，所以…略过</p>\n<h3 id=\"如何对已有表进行分表？\"><a href=\"#如何对已有表进行分表？\" class=\"headerlink\" title=\"如何对已有表进行分表？\"></a>如何对已有表进行分表？</h3><p>对于一些新表好说，我们可以都设计好了在去上线使用，但是我们实际在分表时，有很多是已经在业务使用的表，已经使用的表如何分表呢？这里讨论的是怎么实现由老表向新表的过渡。</p>\n<p>(1)停止服务</p>\n<p>告诉用户我们要大更新，晚上几点到几点暂停运营，然后在这期间老表没有了新数据的插入，我们可以很方便将历史数据同步到新表，在部署代码，充分测试上线。看似没有任何问题是吧，最大的问题就是方案本身的问题，我们停止了服务，举个不恰当的例子，你怎么判断你的电脑有没有网，是不是打开百度或google随便搜个啥东西，从另外一个方面体现出人家的服务是多么的稳定，所以只要有其它方案，我们绝不考虑停机去干一些事情。</p>\n<p>(2)双向同步</p>\n<p>不停机我们怎么实现新老表的平滑过渡呢，我们需要先在老表插入数据的地方同步向新表插入并上线，这样入口打通了，然后是历史数据，在搞个定时任务去同步历史数据，等历史数据同步完之后，新表数据和老表就完全一致了，因为历史数据有了，并且新数据会同步向新老表插入，最后一步就是修改查询，将所有从老表查询的地方改为从新表查询，同时去掉向老表插入数据的代码上线，这样老表没有任何使用的地方，任由处置。</p>\n","site":{"data":{}},"excerpt":"<p>线上业务上由于单表的数据量越来越大，并且随着用户的增长，表数据量的增长率可能还会增高，所以想着对单表进行分表，然后将整个分表的缘由以及分表方案的确定记录一下</p>","more":"<h3 id=\"啥叫分库分表？\"><a href=\"#啥叫分库分表？\" class=\"headerlink\" title=\"啥叫分库分表？\"></a>啥叫分库分表？</h3><p>简单点说就是当我们遇到访问极为频繁且数据量巨大的库表的时候，我们首先想到的就是减少单库单表的数据量，以便减少数据查询所需要的时间，提高数据库的吞吐，这就是所谓的分库分表。</p>\n<h3 id=\"为什么要都开始考虑起来分库分表？\"><a href=\"#为什么要都开始考虑起来分库分表？\" class=\"headerlink\" title=\"为什么要都开始考虑起来分库分表？\"></a>为什么要都开始考虑起来分库分表？</h3><p>当我们在开发一些用户量小的系统时，比如公司自用的后台系统，相对是比较轻松的，因为你无需特别专注的考虑高并发，高访问，大数据量等问题，所以对于数据库乃至一些表的设计，对当用户量比较小时还可以跑的通，但是随着量越来越大，动不动就上千万，上亿的数据，光靠加索引或对sql往死里优化还是远远不够的，这时候我们就该考虑是否到了对数据库需要进行分库分表的时候了，当然决定了一定要速战速决，因为数据量增长的速度比你犹豫的速度要快的多。</p>\n<h3 id=\"如何进行分库分表？\"><a href=\"#如何进行分库分表？\" class=\"headerlink\" title=\"如何进行分库分表？\"></a>如何进行分库分表？</h3><p> 对于分库分表，现在基本都是<em>水平分</em>和<em>垂直分</em>：(1)水平分就是根据一定规则，例如按照时间或业务唯一ID等对数据进行的拆分。比如根据年份来拆分不同的数据库。每个数据库结构一致，但是数据会平均，从而提升性能；(2)<br>垂直分就是按照业务进行划分，例如将用户相关的放一个库，订单相关的放一个库。</p>\n<h4 id=\"1-分库：\"><a href=\"#1-分库：\" class=\"headerlink\" title=\"1.分库：\"></a>1.分库：</h4><p> 先来讨论下分库，很多项目一开始基本都是一个库，各种业务的表都在一起，随着表越来越多，变得越来越来不好维护，老表新表掺杂在一起，一些废弃的表也没有及时做清理(我真的要吐了，所以文档是多么的重要)<br>。对于分库，我现在使用较多的是垂直分，按照业务分，比如我们将和用户端无用的一些用于统计的表单独放在一个库里，这样做好处是这些统计表不会参与用户测相关表的join查询操作，并且对于统计表进行需要进行大量计算，这样其实可以更放心的去查数据算数据不用担心影响到用户测的业务，所以对于类似的表进行垂直分库是完全没有问题的。对于水平分库目前没有实践，只是懂一些原理，就….</p>\n<p>简单点说就是当我们遇到访问极为频繁且数据量巨大的库表的时候，我们首先想到的就是减少单库单表的数据量，以便减少数据查询所需要的时间，提高数据库的吞吐，这就是所谓的分库分表。</p>\n<h4 id=\"2-分表：\"><a href=\"#2-分表：\" class=\"headerlink\" title=\"2.分表：\"></a>2.分表：</h4><p>(1)对于向用户ID这样的数值类型我们可以对要分的表的数量取余(userId % count)来进行分表，根据这个路由策略，可以将记录根据userId路由到不同的表中，达到分表的母的。路由帮助方法示例代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 分表基数</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">Integer</span> <span class=\"variable\">COUNT</span> <span class=\"operator\">=</span> <span class=\"number\">20</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@desc</span> 根据用户ID获取分表后缀</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> dataozi</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2020/4/11 15:22</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> userId 用户ID</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> 表后缀</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> RuntimeException 用户ID参数异常</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">getSuffixByUserId</span><span class=\"params\">(Long userId)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(Objects.isNull(userId) || userId &lt;= <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(String.format(<span class=\"string\">&quot;用户ID有误 , userId : %s&quot;</span>, userId));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> String.format(<span class=\"string\">&quot;_g0_p%s&quot;</span>, userId % COUNT);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==\" alt=\"点击并拖拽以移动\">可能大家有疑问，为什么表后缀是”_g0_p0”<br>，这样目的是为了以后可能会再次进行分表，因为这种方式最大的弊端就是我们需要预先确定下表的数量，但是随着量的增长，及时现在分了，以后还是会有再次达到记录阈值的那天；以后如果需要再次进行分表的话，我可以修改为”_g1”再次实现分表。</p>\n<p>(2)上边是定表，不定单表记录量的，我们还可以讨论下定表记录数，不行表的。就是我们规定每张表最大数据量假如为100w，那么当第一张表数据量达到后自动开始向下张表存数据。如何实现呢，其实思想大同小异，我们可以维护一个全局的记录总数，每次获取表后缀时判断是否需要取新的表，路由帮助方法示例代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 单张表记录的最大数量</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">long</span> <span class=\"variable\">COUNT</span> <span class=\"operator\">=</span> <span class=\"number\">1000000L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@desc</span> 获取表的坐标</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> dataozi</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2020/4/11 16:15</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> count 当前记录数</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> 表坐标</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> RuntimeException 记录数参数异常</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">getTableIndexVal</span><span class=\"params\">(<span class=\"type\">long</span> count)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (count &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(<span class=\"string\">&quot;记录数有误&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">long</span> <span class=\"variable\">index</span> <span class=\"operator\">=</span> count % COUNT == <span class=\"number\">0</span> ? count / COUNT - <span class=\"number\">1</span> : count / COUNT;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (<span class=\"type\">int</span>) index;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==\" alt=\"点击并拖拽以移动\"></p>\n<p>需要注意的是一定要在业务记录量达到阈值之前创建新表，我们可以起个定时任务，在表记录达到90w时就创建下张表，预先创建表。</p>\n<p>(3)对于向UUID这样的我们可以取UUID的最后一位或最后两位进行分表，以最后一位举例，我们知道UUID是一个数字和字母组成的伪随机字段串，这样的话最后一位就是0-9a-z(26 + 10)，可以建立36张表，同上，表后缀可以是”_g0_pa”，大家没有问题吧。哈哈，坑来了，强调一下，UUID 是由一组32位数的<strong>16进制数字</strong>所构成，所以不是26个字母只有a-f，所以即使按照这种方式创建了表，也是永远用不到的，所以每个小知识点都要熟透啊，我就是对UUID没怎么真正了解，结果…；话说回来，这样的方式确实表的量是死的，那么怎么也变成稍微活一点呢?</p>\n<p>(4)我们取UUID的hashcode，这样我们又得到了一个数值类型的唯一标识，同理我们可以这样做，路由帮助方法示例代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 分表基数</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">Integer</span> <span class=\"variable\">COUNT</span> <span class=\"operator\">=</span> <span class=\"number\">20</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@desc</span> 根据uuid获取表后缀</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> dataozi</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2020/4/11 15:41</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> uuid uuid</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> 表后缀</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@throws</span> RuntimeException uuid参数异常</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">getSuffixByUserId</span><span class=\"params\">(String uuid)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (StringUtils.isBlank(uuid)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(<span class=\"string\">&quot;designID 为空&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 取uuid的hashcode绝对值对20取模的值</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">code</span> <span class=\"operator\">=</span> uuid.toLowerCase().hashCode();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> String.format(<span class=\"string\">&quot;_g0_p%s&quot;</span>, Math.abs(code) % COUNT);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==\" alt=\"点击并拖拽以移动\">(5)除了上边这种通过唯一标识进行水平分的，我们还可以通过日期进行分表，比如上边提到的一些统计数据表，表本身没有什么业务逻辑，只需要按照日期定期进行数据统计，那我们通过日期进行分表再好不过了；我们按照季度进行分表，一年4张统计数据表，这样分表最好定个闹铃，每个月提醒建表，或者你一次性建个几十年的，O(<br>∩_∩)O哈哈~，路由帮助方法示例代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 临时年份值</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> tempYearByYearAndSeason;</span><br><span class=\"line\"><span class=\"comment\">// 临时月份值</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Month tempMonthByYearAndSeason;</span><br><span class=\"line\"><span class=\"comment\">// 临时表名称后缀</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String tempNameSuffixByYearAndSeason;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@desc</span> 获取表后缀</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> dataozi</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2020/4/11 15:49</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> year 年</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> month 月</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> 表后缀</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">calcNameSuffix</span><span class=\"params\">(<span class=\"type\">int</span> year, Month month)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 计算当前属于那个季度，从0开始</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">quarterCount</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (month) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> JANUARY:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> FEBRUARY:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> MARCH:</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> APRIL:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> MAY:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> JUNE:</span><br><span class=\"line\">            quarterCount += <span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> JULY:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> AUGUST:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> SEPTEMBER:</span><br><span class=\"line\">            quarterCount += <span class=\"number\">2</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> OCTOBER:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> NOVEMBER:</span><br><span class=\"line\">        <span class=\"keyword\">case</span> DECEMBER:</span><br><span class=\"line\">            quarterCount += <span class=\"number\">3</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">default</span>:</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(<span class=\"string\">&quot;system error&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> String.format(<span class=\"string\">&quot;_g%s_p%s&quot;</span>, year, quarterCount);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  设置初始值</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">LocalDate</span> <span class=\"variable\">now</span> <span class=\"operator\">=</span> LocalDate.now();</span><br><span class=\"line\">    tempNameSuffixByYearAndSeason = calcNameSuffix(now.getYear(), now.getMonth());</span><br><span class=\"line\">    tempYearByYearAndSeason = now.getYear();</span><br><span class=\"line\">    tempMonthByYearAndSeason = now.getMonth();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@desc</span> 获取表后缀</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> dataozi</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2020/4/11 15:51</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> 表后缀</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">getNameSuffixByYearAndSeason</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">LocalDate</span> <span class=\"variable\">now</span> <span class=\"operator\">=</span> LocalDate.now();</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">year</span> <span class=\"operator\">=</span> now.getYear();</span><br><span class=\"line\">    <span class=\"type\">Month</span> <span class=\"variable\">month</span> <span class=\"operator\">=</span> now.getMonth();</span><br><span class=\"line\">    <span class=\"comment\">// 当年月份交替时需要重置静态数据</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (year == tempYearByYearAndSeason &amp;&amp; month.equals(tempMonthByYearAndSeason)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Objects.requireNonNull(tempNameSuffixByYearAndSeason);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    tempNameSuffixByYearAndSeason = calcNameSuffix(year, month);</span><br><span class=\"line\">    tempYearByYearAndSeason = year;</span><br><span class=\"line\">    tempMonthByYearAndSeason = month;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> tempNameSuffixByYearAndSeason;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==\" alt=\"点击并拖拽以移动\"></p>\n<h3 id=\"分库分表之后，主键ID该怎么维护？\"><a href=\"#分库分表之后，主键ID该怎么维护？\" class=\"headerlink\" title=\"分库分表之后，主键ID该怎么维护？\"></a>分库分表之后，主键ID该怎么维护？</h3><p>上边我们通过简单的代码，基本已经实现了分库分表，不要高兴太早，原来单表时，我们是有主键ID的，一般都是自增ID，那么进行分表之后，每张表都会有各自的主键自增ID，那么怎么维护一个全局的主键ID呢，下面我们在讨论一下这个问题：</p>\n<p>​      (1)利用数据库本身。我们可以在单独创建一张ID表，每次在新增数据时，先向ID表中插入一条数据，获取最新主键ID之后再向分表中插入业务数据；基本这只是一个思路，面临获取ID的性能、ID表记录会无限多等问题不考虑线上使用</p>\n<p>​      (2)利用Redis。利用redis的incr命令，每次在插入数据之前，先从redis获取到id，下次获取自动累计，达到自增的作用。示例代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// redis存储全局自增主键ID的key</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">TABLE_RECORD_COUNT_KEY</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;xxx-table.primary-key.record&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@desc</span> 获取主键ID</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> dataozi</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2020/4/11 16:20</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> 数量</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">long</span> <span class=\"title function_\">incr</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// cache是我们封装的jedis帮助类</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cache == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 这里加锁，防止多个线程同时设置</span></span><br><span class=\"line\">        <span class=\"keyword\">synchronized</span> (XXXX.class) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (cache == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                cache = cacheDef.getCACHE19();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> cache.incr(TABLE_RECORD_COUNT_KEY);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==\" alt=\"点击并拖拽以移动\"></p>\n<p>(3)其它一些较成熟的自增id的类库，因为没线上实践过，所以…略过</p>\n<h3 id=\"如何对已有表进行分表？\"><a href=\"#如何对已有表进行分表？\" class=\"headerlink\" title=\"如何对已有表进行分表？\"></a>如何对已有表进行分表？</h3><p>对于一些新表好说，我们可以都设计好了在去上线使用，但是我们实际在分表时，有很多是已经在业务使用的表，已经使用的表如何分表呢？这里讨论的是怎么实现由老表向新表的过渡。</p>\n<p>(1)停止服务</p>\n<p>告诉用户我们要大更新，晚上几点到几点暂停运营，然后在这期间老表没有了新数据的插入，我们可以很方便将历史数据同步到新表，在部署代码，充分测试上线。看似没有任何问题是吧，最大的问题就是方案本身的问题，我们停止了服务，举个不恰当的例子，你怎么判断你的电脑有没有网，是不是打开百度或google随便搜个啥东西，从另外一个方面体现出人家的服务是多么的稳定，所以只要有其它方案，我们绝不考虑停机去干一些事情。</p>\n<p>(2)双向同步</p>\n<p>不停机我们怎么实现新老表的平滑过渡呢，我们需要先在老表插入数据的地方同步向新表插入并上线，这样入口打通了，然后是历史数据，在搞个定时任务去同步历史数据，等历史数据同步完之后，新表数据和老表就完全一致了，因为历史数据有了，并且新数据会同步向新老表插入，最后一步就是修改查询，将所有从老表查询的地方改为从新表查询，同时去掉向老表插入数据的代码上线，这样老表没有任何使用的地方，任由处置。</p>","popularPost_tmp_postPath":true,"eyeCatchImage":"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==","popularPost_tmp_gaData":{"updated":"Sun Dec 04 2022 14:56:32 GMT+0800 (中国标准时间)","title":"代码实现单表的分库分表","path":"2022/12/04/代码实现单表的分库分表/","eyeCatchImage":"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==","excerpt":"<p>线上业务上由于单表的数据量越来越大，并且随着用户的增长，表数据量的增长率可能还会增高，所以想着对单表进行分表，然后将整个分表的缘由以及分表方案的确定记录一下</p>","date":{"_isAMomentObject":true,"_i":"2022-12-04T06:38:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-12-04T06:38:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"思考总结 > 数据库优化","tags":["分库分表","性能优化"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"使用ssh登录远程服务器报错","date":"2022-12-04T06:38:00.000Z","_content":"今天使用ssh远程链接远程服务器时，突然报错了，记录一下原因\n<!--more-->\n![报错信息](https://img-blog.csdnimg.cn/20210605093631587.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70)\n\n原因是我的远程服务器进行了重置，导致本地记录的验证信息过时了。\n\n有两个办法可以解决：\n\n* 删除本地验证信息，看图我们可以知道验证信息就是/Users/wangxiaotao/.ssh/known_hosts 的known_hosts文件；执行命令 rm -rf\n  ./known_hosts将验证信息删除,或者将远程服务器对应的配置信息删除；\n* 不想改动known_hosts文件的话，可以利用 ssh-keygen -R [远程机器ip]:port 这个命令来删掉关于特定的远程机器的host信息。\n","source":"_posts/使用ssh登录远程服务器报错.md","raw":"---\ntitle: 使用ssh登录远程服务器报错\ndate: 2022-12-04 14:38\ncategories:\n- [日常踩坑] \ntags:\n- SHH\n---\n今天使用ssh远程链接远程服务器时，突然报错了，记录一下原因\n<!--more-->\n![报错信息](https://img-blog.csdnimg.cn/20210605093631587.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70)\n\n原因是我的远程服务器进行了重置，导致本地记录的验证信息过时了。\n\n有两个办法可以解决：\n\n* 删除本地验证信息，看图我们可以知道验证信息就是/Users/wangxiaotao/.ssh/known_hosts 的known_hosts文件；执行命令 rm -rf\n  ./known_hosts将验证信息删除,或者将远程服务器对应的配置信息删除；\n* 不想改动known_hosts文件的话，可以利用 ssh-keygen -R [远程机器ip]:port 这个命令来删掉关于特定的远程机器的host信息。\n","slug":"使用ssh登录远程服务器报错","published":1,"updated":"2022-12-04T06:57:36.664Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clb91t0ls000x9sjn4a4caay1","content":"<p>今天使用ssh远程链接远程服务器时，突然报错了，记录一下原因</p>\n<span id=\"more\"></span>\n<p><img src=\"https://img-blog.csdnimg.cn/20210605093631587.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70\" class=\"lazyload\" data-srcset=\"https://img-blog.csdnimg.cn/20210605093631587.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"报错信息\"></p>\n<p>原因是我的远程服务器进行了重置，导致本地记录的验证信息过时了。</p>\n<p>有两个办法可以解决：</p>\n<ul>\n<li>删除本地验证信息，看图我们可以知道验证信息就是/Users/wangxiaotao/.ssh/known_hosts 的known_hosts文件；执行命令 rm -rf<br>./known_hosts将验证信息删除,或者将远程服务器对应的配置信息删除；</li>\n<li>不想改动known_hosts文件的话，可以利用 ssh-keygen -R [远程机器ip]:port 这个命令来删掉关于特定的远程机器的host信息。</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>今天使用ssh远程链接远程服务器时，突然报错了，记录一下原因</p>","more":"<p><img src=\"https://img-blog.csdnimg.cn/20210605093631587.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70\" alt=\"报错信息\"></p>\n<p>原因是我的远程服务器进行了重置，导致本地记录的验证信息过时了。</p>\n<p>有两个办法可以解决：</p>\n<ul>\n<li>删除本地验证信息，看图我们可以知道验证信息就是/Users/wangxiaotao/.ssh/known_hosts 的known_hosts文件；执行命令 rm -rf<br>./known_hosts将验证信息删除,或者将远程服务器对应的配置信息删除；</li>\n<li>不想改动known_hosts文件的话，可以利用 ssh-keygen -R [远程机器ip]:port 这个命令来删掉关于特定的远程机器的host信息。</li>\n</ul>","popularPost_tmp_postPath":true,"eyeCatchImage":"https://img-blog.csdnimg.cn/20210605093631587.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70","popularPost_tmp_gaData":{"updated":"Sun Dec 04 2022 14:57:36 GMT+0800 (中国标准时间)","title":"使用ssh登录远程服务器报错","path":"2022/12/04/使用ssh登录远程服务器报错/","eyeCatchImage":"https://img-blog.csdnimg.cn/20210605093631587.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDI0Mzg5NA==,size_16,color_FFFFFF,t_70","excerpt":"<p>今天使用ssh远程链接远程服务器时，突然报错了，记录一下原因</p>","date":{"_isAMomentObject":true,"_i":"2022-12-04T06:38:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-12-04T06:38:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"日常踩坑","tags":["SHH"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"修改已经运行的docker容器的端口","date":"2022-12-04T06:38:00.000Z","_content":"一开始博客没有加Nginx，我把docker容器直接映射到了宿主机的80端口，后来加入了Nginx来管理静态资源、ssl等，这时候80端口被占用了，所以需要修改正在运行的docker容器映射的宿主机的端口，记录一下修改方法\n<!--more-->\n\n#### 一、删除原有容器，重新启动一个容器\n\n把原来的容器删掉，重新启动一个，完了启动修改 端口映射 -p 为新的端口。\n\n* 这里我就不演示了，因为我没用这个方法，懒得重新配置一遍....\n\n#### 二、修改原有容器配置文件中的端口映射\n\n```sh\n# 获取正在运行的dokcer容器\n[root@iZ8vb7tm9o88h6ioml28vsZ ~]# docker ps\nCONTAINER ID   IMAGE        COMMAND                  CREATED       STATUS        PORTS                                       NAMES\n77e6bfccd1cd   hexo-image   \"docker-entrypoint.s…\"   10 days ago   Up 36 hours   0.0.0.0:4000->4000/tcp, :::4000->4000/tcp   hexo-blog\n# 我们先停掉正在运行的docker容器\n[root@iZ8vb7tm9o88h6ioml28vsZ containers]# docker stop hexo-blog\n# 然后进入docker容器配置的容器列表路径，这里显示了我们运行过的容器的HASH值\n[root@iZ8vb7tm9o88h6ioml28vsZ ~]# cd /var/lib/docker/containers/\n[root@iZ8vb7tm9o88h6ioml28vsZ containers]# ll\ntotal 16\ndrwx-----x 4 root root 4096 Jun 29 22:24 0689cb3baaf4adfc9f1b7a30327080a584faebdb6af3a29ad02a9f987f419869\ndrwx-----x 4 root root 4096 Jun 29 22:24 1d0449bb8923092474efbdc6c9b65097898131105e7d5ea12809883a752fa407\ndrwx-----x 4 root root 4096 Jun 29 22:24 77e6bfccd1cd7cb85dc9548e507caf99052b80c95889304d6219ba54b894b896\ndrwx-----x 4 root root 4096 Jun 29 22:24 cf57f70841c097654c76787478a0648722ac8c9a0d9f88738495c36de4fc2ea5\n# 这时我们进入以上边查询到容器的CONTAINER ID开头的文件夹，并打开 hostconfig.json 配置文件\n[root@iZ8vb7tm9o88h6ioml28vsZ containers]# vim 77e6bfccd1cd7cb85dc9548e507caf99052b80c95889304d6219ba54b894b896/hostconfig.json\n```\n\n```json\n{\n    \"Binds\":[\n        \"/usr/hexo-blog/my-blog/:/usr/blog/my-blog/\",\n        \"/usr/hexo-blog/:/usr/blog\"\n    ],\n    \"ContainerIDFile\":\"\",\n    \"LogConfig\":{\n        \"Type\":\"json-file\",\n        \"Config\":{\n\n        }\n    },\n    \"NetworkMode\":\"default\",\n    \"PortBindings\":{\n        \"80/tcp\":[\n            {\n                \"HostIp\":\"\",\n                \"HostPort\":\"80\"\n            }\n        ]\n    },\n    \"RestartPolicy\":{\n        \"Name\":\"no\",\n        \"MaximumRetryCount\":0\n    },\n    \"AutoRemove\":false,\n    \"VolumeDriver\":\"\",\n    \"VolumesFrom\":null,\n    \"CapAdd\":null,\n    \"CapDrop\":null,\n    \"CgroupnsMode\":\"host\",\n    \"Dns\":[\n\n    ],\n    \"DnsOptions\":[\n\n    ],\n    \"DnsSearch\":[\n\n    ],\n    \"ExtraHosts\":null,\n    \"GroupAdd\":null,\n    \"IpcMode\":\"private\",\n    \"Cgroup\":\"\",\n    \"Links\":null,\n    \"OomScoreAdj\":0,\n    \"PidMode\":\"\",\n    \"Privileged\":false,\n    \"PublishAllPorts\":false,\n    \"ReadonlyRootfs\":false,\n    \"SecurityOpt\":null,\n    \"UTSMode\":\"\",\n    \"UsernsMode\":\"\",\n    \"ShmSize\":67108864,\n    \"Runtime\":\"runc\",\n    \"ConsoleSize\":[\n        0,\n        0\n    ],\n    \"Isolation\":\"\",\n    \"CpuShares\":0,\n    \"Memory\":0,\n    \"NanoCpus\":0,\n    \"CgroupParent\":\"\",\n    \"BlkioWeight\":0,\n    \"BlkioWeightDevice\":[\n\n    ],\n    \"BlkioDeviceReadBps\":null,\n    \"BlkioDeviceWriteBps\":null,\n    \"BlkioDeviceReadIOps\":null,\n    \"BlkioDeviceWriteIOps\":null,\n    \"CpuPeriod\":0,\n    \"CpuQuota\":0,\n    \"CpuRealtimePeriod\":0,\n    \"CpuRealtimeRuntime\":0,\n    \"CpusetCpus\":\"\",\n    \"CpusetMems\":\"\",\n    \"Devices\":[\n\n    ],\n    \"DeviceCgroupRules\":null,\n    \"DeviceRequests\":null,\n    \"KernelMemory\":0,\n    \"KernelMemoryTCP\":0,\n    \"MemoryReservation\":0,\n    \"MemorySwap\":0,\n    \"MemorySwappiness\":null,\n    \"OomKillDisable\":false,\n    \"PidsLimit\":null,\n    \"Ulimits\":null,\n    \"CpuCount\":0,\n    \"CpuPercent\":0,\n    \"IOMaximumIOps\":0,\n    \"IOMaximumBandwidth\":0,\n    \"MaskedPaths\":[\n        \"/proc/asound\",\n        \"/proc/acpi\",\n        \"/proc/kcore\",\n        \"/proc/keys\",\n        \"/proc/latency_stats\",\n        \"/proc/timer_list\",\n        \"/proc/timer_stats\",\n        \"/proc/sched_debug\",\n        \"/proc/scsi\",\n        \"/sys/firmware\"\n    ],\n    \"ReadonlyPaths\":[\n        \"/proc/bus\",\n        \"/proc/fs\",\n        \"/proc/irq\",\n        \"/proc/sys\",\n        \"/proc/sysrq-trigger\"\n    ]\n}\n```\n\n打开之后是个json，我们格式化，然后找到 **PortBindings**\n这个key，以我的配置为例，其中4000/tcp对应的是docker容器内部的端口，HostPort对应的是映射到宿主机的端口。这时候我们修改宿主机的端口为自己想修改的端口，然后重启docker服务，再启动容器服务就可以了。\n\n```sh\n# 重启docker服务\n[root@iZ8vb7tm9o88h6ioml28vsZ containers]# systemctl restart docker\n# 启动dokcer容器\n[root@iZ8vb7tm9o88h6ioml28vsZ containers]# docker start hexo-blog\n```\n\n#### 三、将已有的docker容器再打包成一个镜像\n\n把已经配置好或者正在运行的容器，在打包成一个新的镜像，之后通个这个新镜像，重新启动一个80端口的容器，原有容器可以删除或者停掉。\n\n```sh\n# 获取正在运行的dokcer容器\n[root@iZ8vb7tm9o88h6ioml28vsZ ~]# docker ps\nCONTAINER ID   IMAGE        COMMAND                  CREATED       STATUS        PORTS                                       NAMES\n77e6bfccd1cd   hexo-image   \"docker-entrypoint.s…\"   10 days ago   Up 36 hours   0.0.0.0:4000->4000/tcp, :::4000->4000/tcp   hexo-blog\n# 我们先停掉正在运行的docker容器\n[root@iZ8vb7tm9o88h6ioml28vsZ containers]# docker stop hexo-blog\n# 将容器打包成镜像提交，命令是 docker commit 容器名字 新镜像名字:标签\n[root@iZ8vb7tm9o88h6ioml28vsZ containers]# docker commit hexo-blog wxt-hexo-blog:1.0\nsha256:79f63a5a9f30632ed1617083166b0504f633b47d84e36694be51029883a146d4\n# 这时候我们看已经有我们新的镜像了\n[root@iZ8vb7tm9o88h6ioml28vsZ containers]# docker images\nREPOSITORY      TAG       IMAGE ID       CREATED         SIZE\nwxt-hexo-blog   1.0       79f63a5a9f30   8 seconds ago   950MB\n# 我们启动一下，映射新的80端口\ndocker run --name new-hexo-blog -p 80:80 wxt-hexo-blog:1.0\n```\n\n#### 四、总结\n\n* 第一种：方式简单，干净利落，但是如果我们之前的容器中配置很多东西，需要从头重新配置一次，就很繁琐，如果容器很轻，没有什么东西，或者我们可以很迅速的配置一个新的容器，那第一种还是相对方便的；\n* 第二种：不需要重新配置容器，操作也还是算简单，但是会短暂的停止整个dokcer服务，如果服务器内还有其他容器正在运行则也会受到影响；如果服务器内其它容器受到的影响可以忽略，那第二种是适合的；\n* 第三种：相对前两种方法，不需要重新配置容器，也不会对其它容器造成影响，但是会多很多无用（我自认为是无用）的镜像，这个也是看自己关注不关注那些镜像吧。\n","source":"_posts/修改运行中的docker容器端口.md","raw":"---\ntitle: 修改已经运行的docker容器的端口\ndate: 2022-12-04 14:38\ncategories: \n- [开发技巧]\ntags:\n- docker容器\n---\n一开始博客没有加Nginx，我把docker容器直接映射到了宿主机的80端口，后来加入了Nginx来管理静态资源、ssl等，这时候80端口被占用了，所以需要修改正在运行的docker容器映射的宿主机的端口，记录一下修改方法\n<!--more-->\n\n#### 一、删除原有容器，重新启动一个容器\n\n把原来的容器删掉，重新启动一个，完了启动修改 端口映射 -p 为新的端口。\n\n* 这里我就不演示了，因为我没用这个方法，懒得重新配置一遍....\n\n#### 二、修改原有容器配置文件中的端口映射\n\n```sh\n# 获取正在运行的dokcer容器\n[root@iZ8vb7tm9o88h6ioml28vsZ ~]# docker ps\nCONTAINER ID   IMAGE        COMMAND                  CREATED       STATUS        PORTS                                       NAMES\n77e6bfccd1cd   hexo-image   \"docker-entrypoint.s…\"   10 days ago   Up 36 hours   0.0.0.0:4000->4000/tcp, :::4000->4000/tcp   hexo-blog\n# 我们先停掉正在运行的docker容器\n[root@iZ8vb7tm9o88h6ioml28vsZ containers]# docker stop hexo-blog\n# 然后进入docker容器配置的容器列表路径，这里显示了我们运行过的容器的HASH值\n[root@iZ8vb7tm9o88h6ioml28vsZ ~]# cd /var/lib/docker/containers/\n[root@iZ8vb7tm9o88h6ioml28vsZ containers]# ll\ntotal 16\ndrwx-----x 4 root root 4096 Jun 29 22:24 0689cb3baaf4adfc9f1b7a30327080a584faebdb6af3a29ad02a9f987f419869\ndrwx-----x 4 root root 4096 Jun 29 22:24 1d0449bb8923092474efbdc6c9b65097898131105e7d5ea12809883a752fa407\ndrwx-----x 4 root root 4096 Jun 29 22:24 77e6bfccd1cd7cb85dc9548e507caf99052b80c95889304d6219ba54b894b896\ndrwx-----x 4 root root 4096 Jun 29 22:24 cf57f70841c097654c76787478a0648722ac8c9a0d9f88738495c36de4fc2ea5\n# 这时我们进入以上边查询到容器的CONTAINER ID开头的文件夹，并打开 hostconfig.json 配置文件\n[root@iZ8vb7tm9o88h6ioml28vsZ containers]# vim 77e6bfccd1cd7cb85dc9548e507caf99052b80c95889304d6219ba54b894b896/hostconfig.json\n```\n\n```json\n{\n    \"Binds\":[\n        \"/usr/hexo-blog/my-blog/:/usr/blog/my-blog/\",\n        \"/usr/hexo-blog/:/usr/blog\"\n    ],\n    \"ContainerIDFile\":\"\",\n    \"LogConfig\":{\n        \"Type\":\"json-file\",\n        \"Config\":{\n\n        }\n    },\n    \"NetworkMode\":\"default\",\n    \"PortBindings\":{\n        \"80/tcp\":[\n            {\n                \"HostIp\":\"\",\n                \"HostPort\":\"80\"\n            }\n        ]\n    },\n    \"RestartPolicy\":{\n        \"Name\":\"no\",\n        \"MaximumRetryCount\":0\n    },\n    \"AutoRemove\":false,\n    \"VolumeDriver\":\"\",\n    \"VolumesFrom\":null,\n    \"CapAdd\":null,\n    \"CapDrop\":null,\n    \"CgroupnsMode\":\"host\",\n    \"Dns\":[\n\n    ],\n    \"DnsOptions\":[\n\n    ],\n    \"DnsSearch\":[\n\n    ],\n    \"ExtraHosts\":null,\n    \"GroupAdd\":null,\n    \"IpcMode\":\"private\",\n    \"Cgroup\":\"\",\n    \"Links\":null,\n    \"OomScoreAdj\":0,\n    \"PidMode\":\"\",\n    \"Privileged\":false,\n    \"PublishAllPorts\":false,\n    \"ReadonlyRootfs\":false,\n    \"SecurityOpt\":null,\n    \"UTSMode\":\"\",\n    \"UsernsMode\":\"\",\n    \"ShmSize\":67108864,\n    \"Runtime\":\"runc\",\n    \"ConsoleSize\":[\n        0,\n        0\n    ],\n    \"Isolation\":\"\",\n    \"CpuShares\":0,\n    \"Memory\":0,\n    \"NanoCpus\":0,\n    \"CgroupParent\":\"\",\n    \"BlkioWeight\":0,\n    \"BlkioWeightDevice\":[\n\n    ],\n    \"BlkioDeviceReadBps\":null,\n    \"BlkioDeviceWriteBps\":null,\n    \"BlkioDeviceReadIOps\":null,\n    \"BlkioDeviceWriteIOps\":null,\n    \"CpuPeriod\":0,\n    \"CpuQuota\":0,\n    \"CpuRealtimePeriod\":0,\n    \"CpuRealtimeRuntime\":0,\n    \"CpusetCpus\":\"\",\n    \"CpusetMems\":\"\",\n    \"Devices\":[\n\n    ],\n    \"DeviceCgroupRules\":null,\n    \"DeviceRequests\":null,\n    \"KernelMemory\":0,\n    \"KernelMemoryTCP\":0,\n    \"MemoryReservation\":0,\n    \"MemorySwap\":0,\n    \"MemorySwappiness\":null,\n    \"OomKillDisable\":false,\n    \"PidsLimit\":null,\n    \"Ulimits\":null,\n    \"CpuCount\":0,\n    \"CpuPercent\":0,\n    \"IOMaximumIOps\":0,\n    \"IOMaximumBandwidth\":0,\n    \"MaskedPaths\":[\n        \"/proc/asound\",\n        \"/proc/acpi\",\n        \"/proc/kcore\",\n        \"/proc/keys\",\n        \"/proc/latency_stats\",\n        \"/proc/timer_list\",\n        \"/proc/timer_stats\",\n        \"/proc/sched_debug\",\n        \"/proc/scsi\",\n        \"/sys/firmware\"\n    ],\n    \"ReadonlyPaths\":[\n        \"/proc/bus\",\n        \"/proc/fs\",\n        \"/proc/irq\",\n        \"/proc/sys\",\n        \"/proc/sysrq-trigger\"\n    ]\n}\n```\n\n打开之后是个json，我们格式化，然后找到 **PortBindings**\n这个key，以我的配置为例，其中4000/tcp对应的是docker容器内部的端口，HostPort对应的是映射到宿主机的端口。这时候我们修改宿主机的端口为自己想修改的端口，然后重启docker服务，再启动容器服务就可以了。\n\n```sh\n# 重启docker服务\n[root@iZ8vb7tm9o88h6ioml28vsZ containers]# systemctl restart docker\n# 启动dokcer容器\n[root@iZ8vb7tm9o88h6ioml28vsZ containers]# docker start hexo-blog\n```\n\n#### 三、将已有的docker容器再打包成一个镜像\n\n把已经配置好或者正在运行的容器，在打包成一个新的镜像，之后通个这个新镜像，重新启动一个80端口的容器，原有容器可以删除或者停掉。\n\n```sh\n# 获取正在运行的dokcer容器\n[root@iZ8vb7tm9o88h6ioml28vsZ ~]# docker ps\nCONTAINER ID   IMAGE        COMMAND                  CREATED       STATUS        PORTS                                       NAMES\n77e6bfccd1cd   hexo-image   \"docker-entrypoint.s…\"   10 days ago   Up 36 hours   0.0.0.0:4000->4000/tcp, :::4000->4000/tcp   hexo-blog\n# 我们先停掉正在运行的docker容器\n[root@iZ8vb7tm9o88h6ioml28vsZ containers]# docker stop hexo-blog\n# 将容器打包成镜像提交，命令是 docker commit 容器名字 新镜像名字:标签\n[root@iZ8vb7tm9o88h6ioml28vsZ containers]# docker commit hexo-blog wxt-hexo-blog:1.0\nsha256:79f63a5a9f30632ed1617083166b0504f633b47d84e36694be51029883a146d4\n# 这时候我们看已经有我们新的镜像了\n[root@iZ8vb7tm9o88h6ioml28vsZ containers]# docker images\nREPOSITORY      TAG       IMAGE ID       CREATED         SIZE\nwxt-hexo-blog   1.0       79f63a5a9f30   8 seconds ago   950MB\n# 我们启动一下，映射新的80端口\ndocker run --name new-hexo-blog -p 80:80 wxt-hexo-blog:1.0\n```\n\n#### 四、总结\n\n* 第一种：方式简单，干净利落，但是如果我们之前的容器中配置很多东西，需要从头重新配置一次，就很繁琐，如果容器很轻，没有什么东西，或者我们可以很迅速的配置一个新的容器，那第一种还是相对方便的；\n* 第二种：不需要重新配置容器，操作也还是算简单，但是会短暂的停止整个dokcer服务，如果服务器内还有其他容器正在运行则也会受到影响；如果服务器内其它容器受到的影响可以忽略，那第二种是适合的；\n* 第三种：相对前两种方法，不需要重新配置容器，也不会对其它容器造成影响，但是会多很多无用（我自认为是无用）的镜像，这个也是看自己关注不关注那些镜像吧。\n","slug":"修改运行中的docker容器端口","published":1,"updated":"2022-12-04T07:04:05.471Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clb91t0lt000z9sjn49s4c7mf","content":"<p>一开始博客没有加Nginx，我把docker容器直接映射到了宿主机的80端口，后来加入了Nginx来管理静态资源、ssl等，这时候80端口被占用了，所以需要修改正在运行的docker容器映射的宿主机的端口，记录一下修改方法</p>\n<span id=\"more\"></span>\n\n<h4 id=\"一、删除原有容器，重新启动一个容器\"><a href=\"#一、删除原有容器，重新启动一个容器\" class=\"headerlink\" title=\"一、删除原有容器，重新启动一个容器\"></a>一、删除原有容器，重新启动一个容器</h4><p>把原来的容器删掉，重新启动一个，完了启动修改 端口映射 -p 为新的端口。</p>\n<ul>\n<li>这里我就不演示了，因为我没用这个方法，懒得重新配置一遍….</li>\n</ul>\n<h4 id=\"二、修改原有容器配置文件中的端口映射\"><a href=\"#二、修改原有容器配置文件中的端口映射\" class=\"headerlink\" title=\"二、修改原有容器配置文件中的端口映射\"></a>二、修改原有容器配置文件中的端口映射</h4><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 获取正在运行的dokcer容器</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ ~]<span class=\"comment\"># docker ps</span></span><br><span class=\"line\">CONTAINER ID   IMAGE        COMMAND                  CREATED       STATUS        PORTS                                       NAMES</span><br><span class=\"line\">77e6bfccd1cd   hexo-image   <span class=\"string\">&quot;docker-entrypoint.s…&quot;</span>   10 days ago   Up 36 hours   0.0.0.0:4000-&gt;4000/tcp, :::4000-&gt;4000/tcp   hexo-blog</span><br><span class=\"line\"><span class=\"comment\"># 我们先停掉正在运行的docker容器</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ containers]<span class=\"comment\"># docker stop hexo-blog</span></span><br><span class=\"line\"><span class=\"comment\"># 然后进入docker容器配置的容器列表路径，这里显示了我们运行过的容器的HASH值</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ ~]<span class=\"comment\"># cd /var/lib/docker/containers/</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ containers]<span class=\"comment\"># ll</span></span><br><span class=\"line\">total 16</span><br><span class=\"line\">drwx-----x 4 root root 4096 Jun 29 22:24 0689cb3baaf4adfc9f1b7a30327080a584faebdb6af3a29ad02a9f987f419869</span><br><span class=\"line\">drwx-----x 4 root root 4096 Jun 29 22:24 1d0449bb8923092474efbdc6c9b65097898131105e7d5ea12809883a752fa407</span><br><span class=\"line\">drwx-----x 4 root root 4096 Jun 29 22:24 77e6bfccd1cd7cb85dc9548e507caf99052b80c95889304d6219ba54b894b896</span><br><span class=\"line\">drwx-----x 4 root root 4096 Jun 29 22:24 cf57f70841c097654c76787478a0648722ac8c9a0d9f88738495c36de4fc2ea5</span><br><span class=\"line\"><span class=\"comment\"># 这时我们进入以上边查询到容器的CONTAINER ID开头的文件夹，并打开 hostconfig.json 配置文件</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ containers]<span class=\"comment\"># vim 77e6bfccd1cd7cb85dc9548e507caf99052b80c95889304d6219ba54b894b896/hostconfig.json</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Binds&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/usr/hexo-blog/my-blog/:/usr/blog/my-blog/&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/usr/hexo-blog/:/usr/blog&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ContainerIDFile&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;LogConfig&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;Type&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;json-file&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;Config&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;NetworkMode&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;default&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PortBindings&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;80/tcp&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;HostIp&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;HostPort&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;80&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">        <span class=\"punctuation\">]</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;RestartPolicy&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;Name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;no&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;MaximumRetryCount&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;AutoRemove&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;VolumeDriver&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;VolumesFrom&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CapAdd&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CapDrop&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CgroupnsMode&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;host&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Dns&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DnsOptions&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DnsSearch&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ExtraHosts&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;GroupAdd&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IpcMode&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;private&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Cgroup&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Links&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;OomScoreAdj&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PidMode&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Privileged&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PublishAllPorts&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ReadonlyRootfs&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SecurityOpt&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UTSMode&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UsernsMode&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ShmSize&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">67108864</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Runtime&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;runc&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ConsoleSize&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Isolation&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CpuShares&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Memory&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;NanoCpus&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CgroupParent&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlkioWeight&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlkioWeightDevice&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlkioDeviceReadBps&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlkioDeviceWriteBps&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlkioDeviceReadIOps&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlkioDeviceWriteIOps&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CpuPeriod&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CpuQuota&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CpuRealtimePeriod&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CpuRealtimeRuntime&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CpusetCpus&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CpusetMems&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Devices&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DeviceCgroupRules&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DeviceRequests&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;KernelMemory&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;KernelMemoryTCP&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MemoryReservation&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MemorySwap&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MemorySwappiness&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;OomKillDisable&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PidsLimit&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Ulimits&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CpuCount&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CpuPercent&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IOMaximumIOps&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IOMaximumBandwidth&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MaskedPaths&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/asound&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/acpi&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/kcore&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/keys&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/latency_stats&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/timer_list&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/timer_stats&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/sched_debug&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/scsi&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/sys/firmware&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ReadonlyPaths&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/bus&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/fs&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/irq&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/sys&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/sysrq-trigger&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>打开之后是个json，我们格式化，然后找到 <strong>PortBindings</strong><br>这个key，以我的配置为例，其中4000/tcp对应的是docker容器内部的端口，HostPort对应的是映射到宿主机的端口。这时候我们修改宿主机的端口为自己想修改的端口，然后重启docker服务，再启动容器服务就可以了。</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 重启docker服务</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ containers]<span class=\"comment\"># systemctl restart docker</span></span><br><span class=\"line\"><span class=\"comment\"># 启动dokcer容器</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ containers]<span class=\"comment\"># docker start hexo-blog</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"三、将已有的docker容器再打包成一个镜像\"><a href=\"#三、将已有的docker容器再打包成一个镜像\" class=\"headerlink\" title=\"三、将已有的docker容器再打包成一个镜像\"></a>三、将已有的docker容器再打包成一个镜像</h4><p>把已经配置好或者正在运行的容器，在打包成一个新的镜像，之后通个这个新镜像，重新启动一个80端口的容器，原有容器可以删除或者停掉。</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 获取正在运行的dokcer容器</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ ~]<span class=\"comment\"># docker ps</span></span><br><span class=\"line\">CONTAINER ID   IMAGE        COMMAND                  CREATED       STATUS        PORTS                                       NAMES</span><br><span class=\"line\">77e6bfccd1cd   hexo-image   <span class=\"string\">&quot;docker-entrypoint.s…&quot;</span>   10 days ago   Up 36 hours   0.0.0.0:4000-&gt;4000/tcp, :::4000-&gt;4000/tcp   hexo-blog</span><br><span class=\"line\"><span class=\"comment\"># 我们先停掉正在运行的docker容器</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ containers]<span class=\"comment\"># docker stop hexo-blog</span></span><br><span class=\"line\"><span class=\"comment\"># 将容器打包成镜像提交，命令是 docker commit 容器名字 新镜像名字:标签</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ containers]<span class=\"comment\"># docker commit hexo-blog wxt-hexo-blog:1.0</span></span><br><span class=\"line\">sha256:79f63a5a9f30632ed1617083166b0504f633b47d84e36694be51029883a146d4</span><br><span class=\"line\"><span class=\"comment\"># 这时候我们看已经有我们新的镜像了</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ containers]<span class=\"comment\"># docker images</span></span><br><span class=\"line\">REPOSITORY      TAG       IMAGE ID       CREATED         SIZE</span><br><span class=\"line\">wxt-hexo-blog   1.0       79f63a5a9f30   8 seconds ago   950MB</span><br><span class=\"line\"><span class=\"comment\"># 我们启动一下，映射新的80端口</span></span><br><span class=\"line\">docker run --name new-hexo-blog -p 80:80 wxt-hexo-blog:1.0</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"四、总结\"><a href=\"#四、总结\" class=\"headerlink\" title=\"四、总结\"></a>四、总结</h4><ul>\n<li>第一种：方式简单，干净利落，但是如果我们之前的容器中配置很多东西，需要从头重新配置一次，就很繁琐，如果容器很轻，没有什么东西，或者我们可以很迅速的配置一个新的容器，那第一种还是相对方便的；</li>\n<li>第二种：不需要重新配置容器，操作也还是算简单，但是会短暂的停止整个dokcer服务，如果服务器内还有其他容器正在运行则也会受到影响；如果服务器内其它容器受到的影响可以忽略，那第二种是适合的；</li>\n<li>第三种：相对前两种方法，不需要重新配置容器，也不会对其它容器造成影响，但是会多很多无用（我自认为是无用）的镜像，这个也是看自己关注不关注那些镜像吧。</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>一开始博客没有加Nginx，我把docker容器直接映射到了宿主机的80端口，后来加入了Nginx来管理静态资源、ssl等，这时候80端口被占用了，所以需要修改正在运行的docker容器映射的宿主机的端口，记录一下修改方法</p>","more":"<h4 id=\"一、删除原有容器，重新启动一个容器\"><a href=\"#一、删除原有容器，重新启动一个容器\" class=\"headerlink\" title=\"一、删除原有容器，重新启动一个容器\"></a>一、删除原有容器，重新启动一个容器</h4><p>把原来的容器删掉，重新启动一个，完了启动修改 端口映射 -p 为新的端口。</p>\n<ul>\n<li>这里我就不演示了，因为我没用这个方法，懒得重新配置一遍….</li>\n</ul>\n<h4 id=\"二、修改原有容器配置文件中的端口映射\"><a href=\"#二、修改原有容器配置文件中的端口映射\" class=\"headerlink\" title=\"二、修改原有容器配置文件中的端口映射\"></a>二、修改原有容器配置文件中的端口映射</h4><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 获取正在运行的dokcer容器</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ ~]<span class=\"comment\"># docker ps</span></span><br><span class=\"line\">CONTAINER ID   IMAGE        COMMAND                  CREATED       STATUS        PORTS                                       NAMES</span><br><span class=\"line\">77e6bfccd1cd   hexo-image   <span class=\"string\">&quot;docker-entrypoint.s…&quot;</span>   10 days ago   Up 36 hours   0.0.0.0:4000-&gt;4000/tcp, :::4000-&gt;4000/tcp   hexo-blog</span><br><span class=\"line\"><span class=\"comment\"># 我们先停掉正在运行的docker容器</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ containers]<span class=\"comment\"># docker stop hexo-blog</span></span><br><span class=\"line\"><span class=\"comment\"># 然后进入docker容器配置的容器列表路径，这里显示了我们运行过的容器的HASH值</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ ~]<span class=\"comment\"># cd /var/lib/docker/containers/</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ containers]<span class=\"comment\"># ll</span></span><br><span class=\"line\">total 16</span><br><span class=\"line\">drwx-----x 4 root root 4096 Jun 29 22:24 0689cb3baaf4adfc9f1b7a30327080a584faebdb6af3a29ad02a9f987f419869</span><br><span class=\"line\">drwx-----x 4 root root 4096 Jun 29 22:24 1d0449bb8923092474efbdc6c9b65097898131105e7d5ea12809883a752fa407</span><br><span class=\"line\">drwx-----x 4 root root 4096 Jun 29 22:24 77e6bfccd1cd7cb85dc9548e507caf99052b80c95889304d6219ba54b894b896</span><br><span class=\"line\">drwx-----x 4 root root 4096 Jun 29 22:24 cf57f70841c097654c76787478a0648722ac8c9a0d9f88738495c36de4fc2ea5</span><br><span class=\"line\"><span class=\"comment\"># 这时我们进入以上边查询到容器的CONTAINER ID开头的文件夹，并打开 hostconfig.json 配置文件</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ containers]<span class=\"comment\"># vim 77e6bfccd1cd7cb85dc9548e507caf99052b80c95889304d6219ba54b894b896/hostconfig.json</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Binds&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/usr/hexo-blog/my-blog/:/usr/blog/my-blog/&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/usr/hexo-blog/:/usr/blog&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ContainerIDFile&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;LogConfig&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;Type&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;json-file&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;Config&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;NetworkMode&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;default&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PortBindings&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;80/tcp&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;HostIp&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">                <span class=\"attr\">&quot;HostPort&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;80&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">        <span class=\"punctuation\">]</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;RestartPolicy&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;Name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;no&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;MaximumRetryCount&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;AutoRemove&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;VolumeDriver&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;VolumesFrom&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CapAdd&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CapDrop&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CgroupnsMode&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;host&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Dns&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DnsOptions&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DnsSearch&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ExtraHosts&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;GroupAdd&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IpcMode&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;private&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Cgroup&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Links&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;OomScoreAdj&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PidMode&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Privileged&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PublishAllPorts&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ReadonlyRootfs&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SecurityOpt&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UTSMode&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UsernsMode&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ShmSize&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">67108864</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Runtime&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;runc&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ConsoleSize&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Isolation&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CpuShares&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Memory&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;NanoCpus&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CgroupParent&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlkioWeight&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlkioWeightDevice&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlkioDeviceReadBps&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlkioDeviceWriteBps&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlkioDeviceReadIOps&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlkioDeviceWriteIOps&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CpuPeriod&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CpuQuota&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CpuRealtimePeriod&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CpuRealtimeRuntime&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CpusetCpus&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CpusetMems&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Devices&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DeviceCgroupRules&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DeviceRequests&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;KernelMemory&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;KernelMemoryTCP&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MemoryReservation&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MemorySwap&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MemorySwappiness&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;OomKillDisable&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PidsLimit&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Ulimits&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CpuCount&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CpuPercent&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IOMaximumIOps&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IOMaximumBandwidth&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MaskedPaths&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/asound&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/acpi&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/kcore&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/keys&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/latency_stats&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/timer_list&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/timer_stats&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/sched_debug&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/scsi&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/sys/firmware&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ReadonlyPaths&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/bus&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/fs&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/irq&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/sys&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"string\">&quot;/proc/sysrq-trigger&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>打开之后是个json，我们格式化，然后找到 <strong>PortBindings</strong><br>这个key，以我的配置为例，其中4000/tcp对应的是docker容器内部的端口，HostPort对应的是映射到宿主机的端口。这时候我们修改宿主机的端口为自己想修改的端口，然后重启docker服务，再启动容器服务就可以了。</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 重启docker服务</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ containers]<span class=\"comment\"># systemctl restart docker</span></span><br><span class=\"line\"><span class=\"comment\"># 启动dokcer容器</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ containers]<span class=\"comment\"># docker start hexo-blog</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"三、将已有的docker容器再打包成一个镜像\"><a href=\"#三、将已有的docker容器再打包成一个镜像\" class=\"headerlink\" title=\"三、将已有的docker容器再打包成一个镜像\"></a>三、将已有的docker容器再打包成一个镜像</h4><p>把已经配置好或者正在运行的容器，在打包成一个新的镜像，之后通个这个新镜像，重新启动一个80端口的容器，原有容器可以删除或者停掉。</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 获取正在运行的dokcer容器</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ ~]<span class=\"comment\"># docker ps</span></span><br><span class=\"line\">CONTAINER ID   IMAGE        COMMAND                  CREATED       STATUS        PORTS                                       NAMES</span><br><span class=\"line\">77e6bfccd1cd   hexo-image   <span class=\"string\">&quot;docker-entrypoint.s…&quot;</span>   10 days ago   Up 36 hours   0.0.0.0:4000-&gt;4000/tcp, :::4000-&gt;4000/tcp   hexo-blog</span><br><span class=\"line\"><span class=\"comment\"># 我们先停掉正在运行的docker容器</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ containers]<span class=\"comment\"># docker stop hexo-blog</span></span><br><span class=\"line\"><span class=\"comment\"># 将容器打包成镜像提交，命令是 docker commit 容器名字 新镜像名字:标签</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ containers]<span class=\"comment\"># docker commit hexo-blog wxt-hexo-blog:1.0</span></span><br><span class=\"line\">sha256:79f63a5a9f30632ed1617083166b0504f633b47d84e36694be51029883a146d4</span><br><span class=\"line\"><span class=\"comment\"># 这时候我们看已经有我们新的镜像了</span></span><br><span class=\"line\">[root@iZ8vb7tm9o88h6ioml28vsZ containers]<span class=\"comment\"># docker images</span></span><br><span class=\"line\">REPOSITORY      TAG       IMAGE ID       CREATED         SIZE</span><br><span class=\"line\">wxt-hexo-blog   1.0       79f63a5a9f30   8 seconds ago   950MB</span><br><span class=\"line\"><span class=\"comment\"># 我们启动一下，映射新的80端口</span></span><br><span class=\"line\">docker run --name new-hexo-blog -p 80:80 wxt-hexo-blog:1.0</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"四、总结\"><a href=\"#四、总结\" class=\"headerlink\" title=\"四、总结\"></a>四、总结</h4><ul>\n<li>第一种：方式简单，干净利落，但是如果我们之前的容器中配置很多东西，需要从头重新配置一次，就很繁琐，如果容器很轻，没有什么东西，或者我们可以很迅速的配置一个新的容器，那第一种还是相对方便的；</li>\n<li>第二种：不需要重新配置容器，操作也还是算简单，但是会短暂的停止整个dokcer服务，如果服务器内还有其他容器正在运行则也会受到影响；如果服务器内其它容器受到的影响可以忽略，那第二种是适合的；</li>\n<li>第三种：相对前两种方法，不需要重新配置容器，也不会对其它容器造成影响，但是会多很多无用（我自认为是无用）的镜像，这个也是看自己关注不关注那些镜像吧。</li>\n</ul>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sun Dec 04 2022 15:04:05 GMT+0800 (中国标准时间)","title":"修改已经运行的docker容器的端口","path":"2022/12/04/修改运行中的docker容器端口/","eyeCatchImage":null,"excerpt":"<p>一开始博客没有加Nginx，我把docker容器直接映射到了宿主机的80端口，后来加入了Nginx来管理静态资源、ssl等，这时候80端口被占用了，所以需要修改正在运行的docker容器映射的宿主机的端口，记录一下修改方法</p>","date":{"_isAMomentObject":true,"_i":"2022-12-04T06:38:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-12-04T06:38:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"开发技巧","tags":["docker容器"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"数据库连接参数allowMultiQueries的作用","date":"2022-12-04T06:38:00.000Z","_content":"如上，今天有个同事写了一条sql，先不管sql的业务逻辑和可用性，在本地执行没有问题，部署到QA环境报错，原因是本地数据库连接时设置了allowMultiQueries=true，但是QA环境没有设置，那默认是false。记录一下 allowMultiQueries 参数的作用\n<!--more-->\n~~~ mysql\n <delete id=\"delete\">\n        <foreach collection=\"list\" item=\"item\" index=\"index\" separator=\";\" >\n            delete from xxxx_table\n            where gid = #{item.gId} and pid = #{item.pId}\n        </foreach>\n    </delete>\n~~~\n\n如上，今天有个同事写了一条sql，先不管sql的业务逻辑和可用性，在本地执行没有问题，部署到QA环境报错，大概意思就是sql在where gid = #{item.gId} 执行语法有问题。\n\n##### 问题原因：\n\n本地数据库连接时设置了allowMultiQueries=true，但是QA环境没有设置，那默认是false。\n\n##### allowMultiQueries=true的作用\n\n* 可以在sql语句后携带分号，实现多语句执行。\n\n* 可以执行批处理，同时发出多个SQL语句。\n\n将QA环境的数据库连接加上这个属性就可以了。\n","source":"_posts/数据库连接参数allowMultiQueries的作用.md","raw":"---\ntitle: 数据库连接参数allowMultiQueries的作用\ndate: 2022-12-04 14:38\ncategories: \n- [日常踩坑]\ntags:\n- Mysql\n- 数据库\n---\n如上，今天有个同事写了一条sql，先不管sql的业务逻辑和可用性，在本地执行没有问题，部署到QA环境报错，原因是本地数据库连接时设置了allowMultiQueries=true，但是QA环境没有设置，那默认是false。记录一下 allowMultiQueries 参数的作用\n<!--more-->\n~~~ mysql\n <delete id=\"delete\">\n        <foreach collection=\"list\" item=\"item\" index=\"index\" separator=\";\" >\n            delete from xxxx_table\n            where gid = #{item.gId} and pid = #{item.pId}\n        </foreach>\n    </delete>\n~~~\n\n如上，今天有个同事写了一条sql，先不管sql的业务逻辑和可用性，在本地执行没有问题，部署到QA环境报错，大概意思就是sql在where gid = #{item.gId} 执行语法有问题。\n\n##### 问题原因：\n\n本地数据库连接时设置了allowMultiQueries=true，但是QA环境没有设置，那默认是false。\n\n##### allowMultiQueries=true的作用\n\n* 可以在sql语句后携带分号，实现多语句执行。\n\n* 可以执行批处理，同时发出多个SQL语句。\n\n将QA环境的数据库连接加上这个属性就可以了。\n","slug":"数据库连接参数allowMultiQueries的作用","published":1,"updated":"2022-12-04T07:00:47.962Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clb91t0lu00149sjn99o61i9z","content":"<p>如上，今天有个同事写了一条sql，先不管sql的业务逻辑和可用性，在本地执行没有问题，部署到QA环境报错，原因是本地数据库连接时设置了allowMultiQueries=true，但是QA环境没有设置，那默认是false。记录一下 allowMultiQueries 参数的作用</p>\n<span id=\"more\"></span>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;delete id=&quot;delete&quot;&gt;</span><br><span class=\"line\">       &lt;foreach collection=&quot;list&quot; item=&quot;item&quot; index=&quot;index&quot; separator=&quot;;&quot; &gt;</span><br><span class=\"line\">           delete from xxxx_table</span><br><span class=\"line\">           where gid = #&#123;item.gId&#125; and pid = #&#123;item.pId&#125;</span><br><span class=\"line\">       &lt;/foreach&gt;</span><br><span class=\"line\">   &lt;/delete&gt;</span><br></pre></td></tr></table></figure>\n\n<p>如上，今天有个同事写了一条sql，先不管sql的业务逻辑和可用性，在本地执行没有问题，部署到QA环境报错，大概意思就是sql在where gid = #{item.gId} 执行语法有问题。</p>\n<h5 id=\"问题原因：\"><a href=\"#问题原因：\" class=\"headerlink\" title=\"问题原因：\"></a>问题原因：</h5><p>本地数据库连接时设置了allowMultiQueries=true，但是QA环境没有设置，那默认是false。</p>\n<h5 id=\"allowMultiQueries-true的作用\"><a href=\"#allowMultiQueries-true的作用\" class=\"headerlink\" title=\"allowMultiQueries=true的作用\"></a>allowMultiQueries=true的作用</h5><ul>\n<li><p>可以在sql语句后携带分号，实现多语句执行。</p>\n</li>\n<li><p>可以执行批处理，同时发出多个SQL语句。</p>\n</li>\n</ul>\n<p>将QA环境的数据库连接加上这个属性就可以了。</p>\n","site":{"data":{}},"excerpt":"<p>如上，今天有个同事写了一条sql，先不管sql的业务逻辑和可用性，在本地执行没有问题，部署到QA环境报错，原因是本地数据库连接时设置了allowMultiQueries=true，但是QA环境没有设置，那默认是false。记录一下 allowMultiQueries 参数的作用</p>","more":"<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;delete id=&quot;delete&quot;&gt;</span><br><span class=\"line\">       &lt;foreach collection=&quot;list&quot; item=&quot;item&quot; index=&quot;index&quot; separator=&quot;;&quot; &gt;</span><br><span class=\"line\">           delete from xxxx_table</span><br><span class=\"line\">           where gid = #&#123;item.gId&#125; and pid = #&#123;item.pId&#125;</span><br><span class=\"line\">       &lt;/foreach&gt;</span><br><span class=\"line\">   &lt;/delete&gt;</span><br></pre></td></tr></table></figure>\n\n<p>如上，今天有个同事写了一条sql，先不管sql的业务逻辑和可用性，在本地执行没有问题，部署到QA环境报错，大概意思就是sql在where gid = #{item.gId} 执行语法有问题。</p>\n<h5 id=\"问题原因：\"><a href=\"#问题原因：\" class=\"headerlink\" title=\"问题原因：\"></a>问题原因：</h5><p>本地数据库连接时设置了allowMultiQueries=true，但是QA环境没有设置，那默认是false。</p>\n<h5 id=\"allowMultiQueries-true的作用\"><a href=\"#allowMultiQueries-true的作用\" class=\"headerlink\" title=\"allowMultiQueries=true的作用\"></a>allowMultiQueries=true的作用</h5><ul>\n<li><p>可以在sql语句后携带分号，实现多语句执行。</p>\n</li>\n<li><p>可以执行批处理，同时发出多个SQL语句。</p>\n</li>\n</ul>\n<p>将QA环境的数据库连接加上这个属性就可以了。</p>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sun Dec 04 2022 15:00:47 GMT+0800 (中国标准时间)","title":"数据库连接参数allowMultiQueries的作用","path":"2022/12/04/数据库连接参数allowMultiQueries的作用/","eyeCatchImage":null,"excerpt":"<p>如上，今天有个同事写了一条sql，先不管sql的业务逻辑和可用性，在本地执行没有问题，部署到QA环境报错，原因是本地数据库连接时设置了allowMultiQueries=true，但是QA环境没有设置，那默认是false。记录一下 allowMultiQueries 参数的作用</p>","date":{"_isAMomentObject":true,"_i":"2022-12-04T06:38:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-12-04T06:38:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"日常踩坑","tags":["Mysql","数据库"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"填上IntegerCache的坑","date":"2022-12-04T06:38:00.000Z","_content":"如下代码，本地跑程序都没问题，一到线上就不行，原因就是IntegerCache的问题，比较两个Integer时，本地数据少，数值也小，正好都是true，正式数据多，可能就因为IntegerCache的问题导致该是true的为false了，导致程序的执行出错。\n<!--more-->\n\n~~~java\n//......\nInteger a = 200;\nInteger b = 200;\nif(a == b){\n//......\n}\n//......\n~~~\n\n我们直接看Integer类的源码：\n\n```java\nprivate static class IntegerCache {\n        static final int low = -128;\n        static final int high;\n        static final Integer cache[];\n\n        static {\n            // high value may be configured by property\n            int h = 127;\n            String integerCacheHighPropValue =\n                sun.misc.VM.getSavedProperty(\"java.lang.Integer.IntegerCache.high\");\n            if (integerCacheHighPropValue != null) {\n                int i = parseInt(integerCacheHighPropValue);\n                i = Math.max(i, 127);\n                // Maximum array size is Integer.MAX_VALUE\n                h = Math.min(i, Integer.MAX_VALUE - (-low) -1);\n            }\n            high = h;\n\n            cache = new Integer[(high - low) + 1];\n            int j = low;\n            for(int k = 0; k < cache.length; k++)\n                cache[k] = new Integer(j++);\n        }\n\n        private IntegerCache() {}\n}\n```\n\n可以看到，Integer内部维护着IntegerCache的一个内部类，我们分析一下这个IntegerCache,它维护着两个静态int常量，和一个静态的Integer数组，然后静态块里初始化了high值和cache数组，并且将low到high中的数值add到了cache中，并且可以看到low值是常量-128,high值我们是可以通过配置文件配置的，也就是说我们可以根据jvm自行修改IntegerCache的阈值(\n最大值)，只是看IntegerCache的话发现很简单，接下来我们结合Integer的几个方法在分析一下：\n\nInteger的构造方法：\n\n```java\npublic Integer(int value) {\n        this.value = value;\n}\n```\n\nInteger的parstInt方法：\n\n```java\npublic static Integer valueOf(int i) {\n        assert IntegerCache.high >= 127;\n        if (i >= IntegerCache.low && i <= IntegerCache.high)\n            return IntegerCache.cache[i + (-IntegerCache.low)];\n        return new Integer(i);\n}\n```\n\nInteger的parstInt方法：\n\n```java\npublic static int parseInt(String s, int radix) throws NumberFormatException {\n        /*\n         * WARNING: This method may be invoked early during VM initialization\n         * before IntegerCache is initialized. Care must be taken to not use\n         * the valueOf method.\n         */\n\n        if (s == null) {\n            throw new NumberFormatException(\"null\");\n        }\n\n        if (radix < Character.MIN_RADIX) {\n            throw new NumberFormatException(\"radix \" + radix +\n                                            \" less than Character.MIN_RADIX\");\n        }\n\n        if (radix > Character.MAX_RADIX) {\n            throw new NumberFormatException(\"radix \" + radix +\n                                            \" greater than Character.MAX_RADIX\");\n        }\n\n        int result = 0;\n        boolean negative = false;\n        int i = 0, len = s.length();\n        int limit = -Integer.MAX_VALUE;\n        int multmin;\n        int digit;\n\n        if (len > 0) {\n            char firstChar = s.charAt(0);\n            if (firstChar < '0') { // Possible leading \"+\" or \"-\"\n                if (firstChar == '-') {\n                    negative = true;\n                    limit = Integer.MIN_VALUE;\n                } else if (firstChar != '+')\n                    throw NumberFormatException.forInputString(s);\n\n                if (len == 1) // Cannot have lone \"+\" or \"-\"\n                    throw NumberFormatException.forInputString(s);\n                i++;\n            }\n            multmin = limit / radix;\n            while (i < len) {\n                // Accumulating negatively avoids surprises near MAX_VALUE\n                digit = Character.digit(s.charAt(i++),radix);\n                if (digit < 0) {\n                    throw NumberFormatException.forInputString(s);\n                }\n                if (result < multmin) {\n                    throw NumberFormatException.forInputString(s);\n                }\n                result *= radix;\n                if (result < limit + digit) {\n                    throw NumberFormatException.forInputString(s);\n                }\n                result -= digit;\n            }\n        } else {\n            throw NumberFormatException.forInputString(s);\n        }\n        return negative ? result : -result;\n}\n```\n\n可以看到，通过Integer的构造方法创建Integer对象时，并不会跟IntegerCache扯上关系，也就是说创建多少个都是新对象，比较的话都是false，因为他们的地址值都不一样；parseInt方法返回的是int基本类型，所以跟IntegerCache也没有关系；我们再来看一下valueOf方法，在给定的IntegerCache的阈值范围内，Integer对象都是从cache数组中取到的，而内部类都是懒加载，在使用时加载内部类，并且创建阈值之内的所有Integer对象并存入cache中，cache是静态常量数组，由常量池维护着，cache被所有的Integer对象共享，所以只要是比较cache阈值之内的两个Integer的结果都是true，因为本身他们就是同一个对象。(\nps:Integer a = 1; 默认调用的是valueOf方法)。\n\n到此为止，我们应该对IntegerCache有了一定的了解，那么做点习题巩固一下：\n\n```java\nInteger x = 1;\nInteger y = 1;\nSystem.out.println(String.format(\"1:%s\",x == y));// 1\nx = 127;\ny = 127;\nSystem.out.println(String.format(\"2:%s\",x == y));// 2\nx = 128;\ny = 128;\nSystem.out.println(String.format(\"3:%s\",x == y));// 3\nx = new Integer(1);\ny = new Integer(1);\nSystem.out.println(String.format(\"4:%s\",x == y));// 4\nx = Integer.parseInt(\"127\");\ny = Integer.parseInt(\"127\");\nSystem.out.println(String.format(\"5:%s\",x == y));// 5\nx = Integer.parseInt(\"128\");\ny = Integer.parseInt(\"128\");\nSystem.out.println(String.format(\"6:%s\",x == y));// 6\nx = new Integer(1);\nSystem.out.println(String.format(\"7:%s\",x == y));// 7\nx = new Integer(128);\nSystem.out.println(String.format(\"8:%s\",x == y));// 8\n```\n\n结果：\n\n1:true 2:true 3:false 4:false 5:true 6:false 7:false 8:false\n\n如果你都做对了，那么你对IntegerCache已经算是过关了，^_^！！！这里在说一下x = Integer.parseInt(\"127\")和y = Integer.parseInt(\"127\")这两个比较，因为parstInt()\n方法返回的是int基本类型,自动装箱，就变成了Integer x = 127;调用valueOf方法,所以判断结果和直接调用valueOf方法是一样的。\n\n续：下边输出结果是什么\n\n```java\n    @Test\n    public void test() {\n        Integer x = 1;\n        Integer y = 1;\n        System.out.println(x.equals(y));\n    }\n```\n\n上边x和y都是各自创建了一个新的Integer对象，两个引用对象去equals的话，一般是比较地址值，返回应该是false，但是像Integer和String这种类，都重写了equals方法，Integer的equals实际就是两个int基本类型的值比较，所以返回的是true。如下：\n\n```java\n    /**\n     * Compares this object to the specified object.  The result is\n     * {@code true} if and only if the argument is not\n     * {@code null} and is an {@code Integer} object that\n     * contains the same {@code int} value as this object.\n     *\n     * @param   obj   the object to compare with.\n     * @return  {@code true} if the objects are the same;\n     *          {@code false} otherwise.\n     */\n    public boolean equals(Object obj) {\n        if (obj instanceof Integer) {\n            return value == ((Integer)obj).intValue();\n        }\n        return false;\n    }\n```\n\n另外，除了Integer，向Long、Double等包装类，都有缓存区的操作，所以在使用两个包装类进行相等判断时需要注意，最好使用equals方法，引用类判断是否相等就应该使用equals方法，然后重写equals实现我们想要的相等规则。使用包装类型和基本类型做判断则不需要，会自动拆箱。\n","source":"_posts/填上IntegerCache的坑.md","raw":"---\ntitle: 填上IntegerCache的坑\ndate: 2022-12-04 14:38\ncategories:\n- [日常踩坑]\ntags:\n- Integer\n- IntegerCache\n---\n如下代码，本地跑程序都没问题，一到线上就不行，原因就是IntegerCache的问题，比较两个Integer时，本地数据少，数值也小，正好都是true，正式数据多，可能就因为IntegerCache的问题导致该是true的为false了，导致程序的执行出错。\n<!--more-->\n\n~~~java\n//......\nInteger a = 200;\nInteger b = 200;\nif(a == b){\n//......\n}\n//......\n~~~\n\n我们直接看Integer类的源码：\n\n```java\nprivate static class IntegerCache {\n        static final int low = -128;\n        static final int high;\n        static final Integer cache[];\n\n        static {\n            // high value may be configured by property\n            int h = 127;\n            String integerCacheHighPropValue =\n                sun.misc.VM.getSavedProperty(\"java.lang.Integer.IntegerCache.high\");\n            if (integerCacheHighPropValue != null) {\n                int i = parseInt(integerCacheHighPropValue);\n                i = Math.max(i, 127);\n                // Maximum array size is Integer.MAX_VALUE\n                h = Math.min(i, Integer.MAX_VALUE - (-low) -1);\n            }\n            high = h;\n\n            cache = new Integer[(high - low) + 1];\n            int j = low;\n            for(int k = 0; k < cache.length; k++)\n                cache[k] = new Integer(j++);\n        }\n\n        private IntegerCache() {}\n}\n```\n\n可以看到，Integer内部维护着IntegerCache的一个内部类，我们分析一下这个IntegerCache,它维护着两个静态int常量，和一个静态的Integer数组，然后静态块里初始化了high值和cache数组，并且将low到high中的数值add到了cache中，并且可以看到low值是常量-128,high值我们是可以通过配置文件配置的，也就是说我们可以根据jvm自行修改IntegerCache的阈值(\n最大值)，只是看IntegerCache的话发现很简单，接下来我们结合Integer的几个方法在分析一下：\n\nInteger的构造方法：\n\n```java\npublic Integer(int value) {\n        this.value = value;\n}\n```\n\nInteger的parstInt方法：\n\n```java\npublic static Integer valueOf(int i) {\n        assert IntegerCache.high >= 127;\n        if (i >= IntegerCache.low && i <= IntegerCache.high)\n            return IntegerCache.cache[i + (-IntegerCache.low)];\n        return new Integer(i);\n}\n```\n\nInteger的parstInt方法：\n\n```java\npublic static int parseInt(String s, int radix) throws NumberFormatException {\n        /*\n         * WARNING: This method may be invoked early during VM initialization\n         * before IntegerCache is initialized. Care must be taken to not use\n         * the valueOf method.\n         */\n\n        if (s == null) {\n            throw new NumberFormatException(\"null\");\n        }\n\n        if (radix < Character.MIN_RADIX) {\n            throw new NumberFormatException(\"radix \" + radix +\n                                            \" less than Character.MIN_RADIX\");\n        }\n\n        if (radix > Character.MAX_RADIX) {\n            throw new NumberFormatException(\"radix \" + radix +\n                                            \" greater than Character.MAX_RADIX\");\n        }\n\n        int result = 0;\n        boolean negative = false;\n        int i = 0, len = s.length();\n        int limit = -Integer.MAX_VALUE;\n        int multmin;\n        int digit;\n\n        if (len > 0) {\n            char firstChar = s.charAt(0);\n            if (firstChar < '0') { // Possible leading \"+\" or \"-\"\n                if (firstChar == '-') {\n                    negative = true;\n                    limit = Integer.MIN_VALUE;\n                } else if (firstChar != '+')\n                    throw NumberFormatException.forInputString(s);\n\n                if (len == 1) // Cannot have lone \"+\" or \"-\"\n                    throw NumberFormatException.forInputString(s);\n                i++;\n            }\n            multmin = limit / radix;\n            while (i < len) {\n                // Accumulating negatively avoids surprises near MAX_VALUE\n                digit = Character.digit(s.charAt(i++),radix);\n                if (digit < 0) {\n                    throw NumberFormatException.forInputString(s);\n                }\n                if (result < multmin) {\n                    throw NumberFormatException.forInputString(s);\n                }\n                result *= radix;\n                if (result < limit + digit) {\n                    throw NumberFormatException.forInputString(s);\n                }\n                result -= digit;\n            }\n        } else {\n            throw NumberFormatException.forInputString(s);\n        }\n        return negative ? result : -result;\n}\n```\n\n可以看到，通过Integer的构造方法创建Integer对象时，并不会跟IntegerCache扯上关系，也就是说创建多少个都是新对象，比较的话都是false，因为他们的地址值都不一样；parseInt方法返回的是int基本类型，所以跟IntegerCache也没有关系；我们再来看一下valueOf方法，在给定的IntegerCache的阈值范围内，Integer对象都是从cache数组中取到的，而内部类都是懒加载，在使用时加载内部类，并且创建阈值之内的所有Integer对象并存入cache中，cache是静态常量数组，由常量池维护着，cache被所有的Integer对象共享，所以只要是比较cache阈值之内的两个Integer的结果都是true，因为本身他们就是同一个对象。(\nps:Integer a = 1; 默认调用的是valueOf方法)。\n\n到此为止，我们应该对IntegerCache有了一定的了解，那么做点习题巩固一下：\n\n```java\nInteger x = 1;\nInteger y = 1;\nSystem.out.println(String.format(\"1:%s\",x == y));// 1\nx = 127;\ny = 127;\nSystem.out.println(String.format(\"2:%s\",x == y));// 2\nx = 128;\ny = 128;\nSystem.out.println(String.format(\"3:%s\",x == y));// 3\nx = new Integer(1);\ny = new Integer(1);\nSystem.out.println(String.format(\"4:%s\",x == y));// 4\nx = Integer.parseInt(\"127\");\ny = Integer.parseInt(\"127\");\nSystem.out.println(String.format(\"5:%s\",x == y));// 5\nx = Integer.parseInt(\"128\");\ny = Integer.parseInt(\"128\");\nSystem.out.println(String.format(\"6:%s\",x == y));// 6\nx = new Integer(1);\nSystem.out.println(String.format(\"7:%s\",x == y));// 7\nx = new Integer(128);\nSystem.out.println(String.format(\"8:%s\",x == y));// 8\n```\n\n结果：\n\n1:true 2:true 3:false 4:false 5:true 6:false 7:false 8:false\n\n如果你都做对了，那么你对IntegerCache已经算是过关了，^_^！！！这里在说一下x = Integer.parseInt(\"127\")和y = Integer.parseInt(\"127\")这两个比较，因为parstInt()\n方法返回的是int基本类型,自动装箱，就变成了Integer x = 127;调用valueOf方法,所以判断结果和直接调用valueOf方法是一样的。\n\n续：下边输出结果是什么\n\n```java\n    @Test\n    public void test() {\n        Integer x = 1;\n        Integer y = 1;\n        System.out.println(x.equals(y));\n    }\n```\n\n上边x和y都是各自创建了一个新的Integer对象，两个引用对象去equals的话，一般是比较地址值，返回应该是false，但是像Integer和String这种类，都重写了equals方法，Integer的equals实际就是两个int基本类型的值比较，所以返回的是true。如下：\n\n```java\n    /**\n     * Compares this object to the specified object.  The result is\n     * {@code true} if and only if the argument is not\n     * {@code null} and is an {@code Integer} object that\n     * contains the same {@code int} value as this object.\n     *\n     * @param   obj   the object to compare with.\n     * @return  {@code true} if the objects are the same;\n     *          {@code false} otherwise.\n     */\n    public boolean equals(Object obj) {\n        if (obj instanceof Integer) {\n            return value == ((Integer)obj).intValue();\n        }\n        return false;\n    }\n```\n\n另外，除了Integer，向Long、Double等包装类，都有缓存区的操作，所以在使用两个包装类进行相等判断时需要注意，最好使用equals方法，引用类判断是否相等就应该使用equals方法，然后重写equals实现我们想要的相等规则。使用包装类型和基本类型做判断则不需要，会自动拆箱。\n","slug":"填上IntegerCache的坑","published":1,"updated":"2022-12-04T07:01:59.706Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clb91t0lv00159sjncyh2hhfy","content":"<p>如下代码，本地跑程序都没问题，一到线上就不行，原因就是IntegerCache的问题，比较两个Integer时，本地数据少，数值也小，正好都是true，正式数据多，可能就因为IntegerCache的问题导致该是true的为false了，导致程序的执行出错。</p>\n<span id=\"more\"></span>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//......</span></span><br><span class=\"line\"><span class=\"type\">Integer</span> <span class=\"variable\">a</span> <span class=\"operator\">=</span> <span class=\"number\">200</span>;</span><br><span class=\"line\"><span class=\"type\">Integer</span> <span class=\"variable\">b</span> <span class=\"operator\">=</span> <span class=\"number\">200</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(a == b)&#123;</span><br><span class=\"line\"><span class=\"comment\">//......</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//......</span></span><br></pre></td></tr></table></figure>\n\n<p>我们直接看Integer类的源码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">IntegerCache</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">low</span> <span class=\"operator\">=</span> -<span class=\"number\">128</span>;</span><br><span class=\"line\">        <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> high;</span><br><span class=\"line\">        <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Integer cache[];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// high value may be configured by property</span></span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">h</span> <span class=\"operator\">=</span> <span class=\"number\">127</span>;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">integerCacheHighPropValue</span> <span class=\"operator\">=</span></span><br><span class=\"line\">                sun.misc.VM.getSavedProperty(<span class=\"string\">&quot;java.lang.Integer.IntegerCache.high&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (integerCacheHighPropValue != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> parseInt(integerCacheHighPropValue);</span><br><span class=\"line\">                i = Math.max(i, <span class=\"number\">127</span>);</span><br><span class=\"line\">                <span class=\"comment\">// Maximum array size is Integer.MAX_VALUE</span></span><br><span class=\"line\">                h = Math.min(i, Integer.MAX_VALUE - (-low) -<span class=\"number\">1</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            high = h;</span><br><span class=\"line\"></span><br><span class=\"line\">            cache = <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>[(high - low) + <span class=\"number\">1</span>];</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> low;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"type\">int</span> <span class=\"variable\">k</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; k &lt; cache.length; k++)</span><br><span class=\"line\">                cache[k] = <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(j++);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"title function_\">IntegerCache</span><span class=\"params\">()</span> &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，Integer内部维护着IntegerCache的一个内部类，我们分析一下这个IntegerCache,它维护着两个静态int常量，和一个静态的Integer数组，然后静态块里初始化了high值和cache数组，并且将low到high中的数值add到了cache中，并且可以看到low值是常量-128,high值我们是可以通过配置文件配置的，也就是说我们可以根据jvm自行修改IntegerCache的阈值(<br>最大值)，只是看IntegerCache的话发现很简单，接下来我们结合Integer的几个方法在分析一下：</p>\n<p>Integer的构造方法：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">Integer</span><span class=\"params\">(<span class=\"type\">int</span> value)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.value = value;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Integer的parstInt方法：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Integer <span class=\"title function_\">valueOf</span><span class=\"params\">(<span class=\"type\">int</span> i)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">assert</span> IntegerCache.high &gt;= <span class=\"number\">127</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> IntegerCache.cache[i + (-IntegerCache.low)];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(i);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Integer的parstInt方法：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">parseInt</span><span class=\"params\">(String s, <span class=\"type\">int</span> radix)</span> <span class=\"keyword\">throws</span> NumberFormatException &#123;</span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">         * WARNING: This method may be invoked early during VM initialization</span></span><br><span class=\"line\"><span class=\"comment\">         * before IntegerCache is initialized. Care must be taken to not use</span></span><br><span class=\"line\"><span class=\"comment\">         * the valueOf method.</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (s == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NumberFormatException</span>(<span class=\"string\">&quot;null&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (radix &lt; Character.MIN_RADIX) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NumberFormatException</span>(<span class=\"string\">&quot;radix &quot;</span> + radix +</span><br><span class=\"line\">                                            <span class=\"string\">&quot; less than Character.MIN_RADIX&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (radix &gt; Character.MAX_RADIX) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NumberFormatException</span>(<span class=\"string\">&quot;radix &quot;</span> + radix +</span><br><span class=\"line\">                                            <span class=\"string\">&quot; greater than Character.MAX_RADIX&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">negative</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>, len = s.length();</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">limit</span> <span class=\"operator\">=</span> -Integer.MAX_VALUE;</span><br><span class=\"line\">        <span class=\"type\">int</span> multmin;</span><br><span class=\"line\">        <span class=\"type\">int</span> digit;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (len &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">char</span> <span class=\"variable\">firstChar</span> <span class=\"operator\">=</span> s.charAt(<span class=\"number\">0</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (firstChar &lt; <span class=\"string\">&#x27;0&#x27;</span>) &#123; <span class=\"comment\">// Possible leading &quot;+&quot; or &quot;-&quot;</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (firstChar == <span class=\"string\">&#x27;-&#x27;</span>) &#123;</span><br><span class=\"line\">                    negative = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    limit = Integer.MIN_VALUE;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (firstChar != <span class=\"string\">&#x27;+&#x27;</span>)</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> NumberFormatException.forInputString(s);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (len == <span class=\"number\">1</span>) <span class=\"comment\">// Cannot have lone &quot;+&quot; or &quot;-&quot;</span></span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> NumberFormatException.forInputString(s);</span><br><span class=\"line\">                i++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            multmin = limit / radix;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (i &lt; len) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// Accumulating negatively avoids surprises near MAX_VALUE</span></span><br><span class=\"line\">                digit = Character.digit(s.charAt(i++),radix);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (digit &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> NumberFormatException.forInputString(s);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (result &lt; multmin) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> NumberFormatException.forInputString(s);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                result *= radix;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (result &lt; limit + digit) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> NumberFormatException.forInputString(s);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                result -= digit;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> NumberFormatException.forInputString(s);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> negative ? result : -result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，通过Integer的构造方法创建Integer对象时，并不会跟IntegerCache扯上关系，也就是说创建多少个都是新对象，比较的话都是false，因为他们的地址值都不一样；parseInt方法返回的是int基本类型，所以跟IntegerCache也没有关系；我们再来看一下valueOf方法，在给定的IntegerCache的阈值范围内，Integer对象都是从cache数组中取到的，而内部类都是懒加载，在使用时加载内部类，并且创建阈值之内的所有Integer对象并存入cache中，cache是静态常量数组，由常量池维护着，cache被所有的Integer对象共享，所以只要是比较cache阈值之内的两个Integer的结果都是true，因为本身他们就是同一个对象。(<br>ps:Integer a = 1; 默认调用的是valueOf方法)。</p>\n<p>到此为止，我们应该对IntegerCache有了一定的了解，那么做点习题巩固一下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">Integer</span> <span class=\"variable\">x</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"type\">Integer</span> <span class=\"variable\">y</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">System.out.println(String.format(<span class=\"string\">&quot;1:%s&quot;</span>,x == y));<span class=\"comment\">// 1</span></span><br><span class=\"line\">x = <span class=\"number\">127</span>;</span><br><span class=\"line\">y = <span class=\"number\">127</span>;</span><br><span class=\"line\">System.out.println(String.format(<span class=\"string\">&quot;2:%s&quot;</span>,x == y));<span class=\"comment\">// 2</span></span><br><span class=\"line\">x = <span class=\"number\">128</span>;</span><br><span class=\"line\">y = <span class=\"number\">128</span>;</span><br><span class=\"line\">System.out.println(String.format(<span class=\"string\">&quot;3:%s&quot;</span>,x == y));<span class=\"comment\">// 3</span></span><br><span class=\"line\">x = <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">y = <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">System.out.println(String.format(<span class=\"string\">&quot;4:%s&quot;</span>,x == y));<span class=\"comment\">// 4</span></span><br><span class=\"line\">x = Integer.parseInt(<span class=\"string\">&quot;127&quot;</span>);</span><br><span class=\"line\">y = Integer.parseInt(<span class=\"string\">&quot;127&quot;</span>);</span><br><span class=\"line\">System.out.println(String.format(<span class=\"string\">&quot;5:%s&quot;</span>,x == y));<span class=\"comment\">// 5</span></span><br><span class=\"line\">x = Integer.parseInt(<span class=\"string\">&quot;128&quot;</span>);</span><br><span class=\"line\">y = Integer.parseInt(<span class=\"string\">&quot;128&quot;</span>);</span><br><span class=\"line\">System.out.println(String.format(<span class=\"string\">&quot;6:%s&quot;</span>,x == y));<span class=\"comment\">// 6</span></span><br><span class=\"line\">x = <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">System.out.println(String.format(<span class=\"string\">&quot;7:%s&quot;</span>,x == y));<span class=\"comment\">// 7</span></span><br><span class=\"line\">x = <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">128</span>);</span><br><span class=\"line\">System.out.println(String.format(<span class=\"string\">&quot;8:%s&quot;</span>,x == y));<span class=\"comment\">// 8</span></span><br></pre></td></tr></table></figure>\n\n<p>结果：</p>\n<p>1:true 2:true 3:false 4:false 5:true 6:false 7:false 8:false</p>\n<p>如果你都做对了，那么你对IntegerCache已经算是过关了，^_^！！！这里在说一下x = Integer.parseInt(“127”)和y = Integer.parseInt(“127”)这两个比较，因为parstInt()<br>方法返回的是int基本类型,自动装箱，就变成了Integer x = 127;调用valueOf方法,所以判断结果和直接调用valueOf方法是一样的。</p>\n<p>续：下边输出结果是什么</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">test</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">x</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">y</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    System.out.println(x.equals(y));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上边x和y都是各自创建了一个新的Integer对象，两个引用对象去equals的话，一般是比较地址值，返回应该是false，但是像Integer和String这种类，都重写了equals方法，Integer的equals实际就是两个int基本类型的值比较，所以返回的是true。如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Compares this object to the specified object.  The result is</span></span><br><span class=\"line\"><span class=\"comment\"> * &#123;<span class=\"doctag\">@code</span> true&#125; if and only if the argument is not</span></span><br><span class=\"line\"><span class=\"comment\"> * &#123;<span class=\"doctag\">@code</span> null&#125; and is an &#123;<span class=\"doctag\">@code</span> Integer&#125; object that</span></span><br><span class=\"line\"><span class=\"comment\"> * contains the same &#123;<span class=\"doctag\">@code</span> int&#125; value as this object.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>   obj   the object to compare with.</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span>  &#123;<span class=\"doctag\">@code</span> true&#125; if the objects are the same;</span></span><br><span class=\"line\"><span class=\"comment\"> *          &#123;<span class=\"doctag\">@code</span> false&#125; otherwise.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">equals</span><span class=\"params\">(Object obj)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (obj <span class=\"keyword\">instanceof</span> Integer) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> value == ((Integer)obj).intValue();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>另外，除了Integer，向Long、Double等包装类，都有缓存区的操作，所以在使用两个包装类进行相等判断时需要注意，最好使用equals方法，引用类判断是否相等就应该使用equals方法，然后重写equals实现我们想要的相等规则。使用包装类型和基本类型做判断则不需要，会自动拆箱。</p>\n","site":{"data":{}},"excerpt":"<p>如下代码，本地跑程序都没问题，一到线上就不行，原因就是IntegerCache的问题，比较两个Integer时，本地数据少，数值也小，正好都是true，正式数据多，可能就因为IntegerCache的问题导致该是true的为false了，导致程序的执行出错。</p>","more":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//......</span></span><br><span class=\"line\"><span class=\"type\">Integer</span> <span class=\"variable\">a</span> <span class=\"operator\">=</span> <span class=\"number\">200</span>;</span><br><span class=\"line\"><span class=\"type\">Integer</span> <span class=\"variable\">b</span> <span class=\"operator\">=</span> <span class=\"number\">200</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(a == b)&#123;</span><br><span class=\"line\"><span class=\"comment\">//......</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//......</span></span><br></pre></td></tr></table></figure>\n\n<p>我们直接看Integer类的源码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">IntegerCache</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">low</span> <span class=\"operator\">=</span> -<span class=\"number\">128</span>;</span><br><span class=\"line\">        <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> high;</span><br><span class=\"line\">        <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Integer cache[];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// high value may be configured by property</span></span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">h</span> <span class=\"operator\">=</span> <span class=\"number\">127</span>;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">integerCacheHighPropValue</span> <span class=\"operator\">=</span></span><br><span class=\"line\">                sun.misc.VM.getSavedProperty(<span class=\"string\">&quot;java.lang.Integer.IntegerCache.high&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (integerCacheHighPropValue != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> parseInt(integerCacheHighPropValue);</span><br><span class=\"line\">                i = Math.max(i, <span class=\"number\">127</span>);</span><br><span class=\"line\">                <span class=\"comment\">// Maximum array size is Integer.MAX_VALUE</span></span><br><span class=\"line\">                h = Math.min(i, Integer.MAX_VALUE - (-low) -<span class=\"number\">1</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            high = h;</span><br><span class=\"line\"></span><br><span class=\"line\">            cache = <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>[(high - low) + <span class=\"number\">1</span>];</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> low;</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"type\">int</span> <span class=\"variable\">k</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; k &lt; cache.length; k++)</span><br><span class=\"line\">                cache[k] = <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(j++);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"title function_\">IntegerCache</span><span class=\"params\">()</span> &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，Integer内部维护着IntegerCache的一个内部类，我们分析一下这个IntegerCache,它维护着两个静态int常量，和一个静态的Integer数组，然后静态块里初始化了high值和cache数组，并且将low到high中的数值add到了cache中，并且可以看到low值是常量-128,high值我们是可以通过配置文件配置的，也就是说我们可以根据jvm自行修改IntegerCache的阈值(<br>最大值)，只是看IntegerCache的话发现很简单，接下来我们结合Integer的几个方法在分析一下：</p>\n<p>Integer的构造方法：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">Integer</span><span class=\"params\">(<span class=\"type\">int</span> value)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.value = value;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Integer的parstInt方法：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Integer <span class=\"title function_\">valueOf</span><span class=\"params\">(<span class=\"type\">int</span> i)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">assert</span> IntegerCache.high &gt;= <span class=\"number\">127</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> IntegerCache.cache[i + (-IntegerCache.low)];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(i);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Integer的parstInt方法：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">parseInt</span><span class=\"params\">(String s, <span class=\"type\">int</span> radix)</span> <span class=\"keyword\">throws</span> NumberFormatException &#123;</span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">         * WARNING: This method may be invoked early during VM initialization</span></span><br><span class=\"line\"><span class=\"comment\">         * before IntegerCache is initialized. Care must be taken to not use</span></span><br><span class=\"line\"><span class=\"comment\">         * the valueOf method.</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (s == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NumberFormatException</span>(<span class=\"string\">&quot;null&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (radix &lt; Character.MIN_RADIX) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NumberFormatException</span>(<span class=\"string\">&quot;radix &quot;</span> + radix +</span><br><span class=\"line\">                                            <span class=\"string\">&quot; less than Character.MIN_RADIX&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (radix &gt; Character.MAX_RADIX) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">NumberFormatException</span>(<span class=\"string\">&quot;radix &quot;</span> + radix +</span><br><span class=\"line\">                                            <span class=\"string\">&quot; greater than Character.MAX_RADIX&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">negative</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>, len = s.length();</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">limit</span> <span class=\"operator\">=</span> -Integer.MAX_VALUE;</span><br><span class=\"line\">        <span class=\"type\">int</span> multmin;</span><br><span class=\"line\">        <span class=\"type\">int</span> digit;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (len &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">char</span> <span class=\"variable\">firstChar</span> <span class=\"operator\">=</span> s.charAt(<span class=\"number\">0</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (firstChar &lt; <span class=\"string\">&#x27;0&#x27;</span>) &#123; <span class=\"comment\">// Possible leading &quot;+&quot; or &quot;-&quot;</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (firstChar == <span class=\"string\">&#x27;-&#x27;</span>) &#123;</span><br><span class=\"line\">                    negative = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                    limit = Integer.MIN_VALUE;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (firstChar != <span class=\"string\">&#x27;+&#x27;</span>)</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> NumberFormatException.forInputString(s);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (len == <span class=\"number\">1</span>) <span class=\"comment\">// Cannot have lone &quot;+&quot; or &quot;-&quot;</span></span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> NumberFormatException.forInputString(s);</span><br><span class=\"line\">                i++;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            multmin = limit / radix;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (i &lt; len) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// Accumulating negatively avoids surprises near MAX_VALUE</span></span><br><span class=\"line\">                digit = Character.digit(s.charAt(i++),radix);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (digit &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> NumberFormatException.forInputString(s);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (result &lt; multmin) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> NumberFormatException.forInputString(s);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                result *= radix;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (result &lt; limit + digit) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">throw</span> NumberFormatException.forInputString(s);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                result -= digit;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> NumberFormatException.forInputString(s);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> negative ? result : -result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可以看到，通过Integer的构造方法创建Integer对象时，并不会跟IntegerCache扯上关系，也就是说创建多少个都是新对象，比较的话都是false，因为他们的地址值都不一样；parseInt方法返回的是int基本类型，所以跟IntegerCache也没有关系；我们再来看一下valueOf方法，在给定的IntegerCache的阈值范围内，Integer对象都是从cache数组中取到的，而内部类都是懒加载，在使用时加载内部类，并且创建阈值之内的所有Integer对象并存入cache中，cache是静态常量数组，由常量池维护着，cache被所有的Integer对象共享，所以只要是比较cache阈值之内的两个Integer的结果都是true，因为本身他们就是同一个对象。(<br>ps:Integer a = 1; 默认调用的是valueOf方法)。</p>\n<p>到此为止，我们应该对IntegerCache有了一定的了解，那么做点习题巩固一下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">Integer</span> <span class=\"variable\">x</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"type\">Integer</span> <span class=\"variable\">y</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">System.out.println(String.format(<span class=\"string\">&quot;1:%s&quot;</span>,x == y));<span class=\"comment\">// 1</span></span><br><span class=\"line\">x = <span class=\"number\">127</span>;</span><br><span class=\"line\">y = <span class=\"number\">127</span>;</span><br><span class=\"line\">System.out.println(String.format(<span class=\"string\">&quot;2:%s&quot;</span>,x == y));<span class=\"comment\">// 2</span></span><br><span class=\"line\">x = <span class=\"number\">128</span>;</span><br><span class=\"line\">y = <span class=\"number\">128</span>;</span><br><span class=\"line\">System.out.println(String.format(<span class=\"string\">&quot;3:%s&quot;</span>,x == y));<span class=\"comment\">// 3</span></span><br><span class=\"line\">x = <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">y = <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">System.out.println(String.format(<span class=\"string\">&quot;4:%s&quot;</span>,x == y));<span class=\"comment\">// 4</span></span><br><span class=\"line\">x = Integer.parseInt(<span class=\"string\">&quot;127&quot;</span>);</span><br><span class=\"line\">y = Integer.parseInt(<span class=\"string\">&quot;127&quot;</span>);</span><br><span class=\"line\">System.out.println(String.format(<span class=\"string\">&quot;5:%s&quot;</span>,x == y));<span class=\"comment\">// 5</span></span><br><span class=\"line\">x = Integer.parseInt(<span class=\"string\">&quot;128&quot;</span>);</span><br><span class=\"line\">y = Integer.parseInt(<span class=\"string\">&quot;128&quot;</span>);</span><br><span class=\"line\">System.out.println(String.format(<span class=\"string\">&quot;6:%s&quot;</span>,x == y));<span class=\"comment\">// 6</span></span><br><span class=\"line\">x = <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">System.out.println(String.format(<span class=\"string\">&quot;7:%s&quot;</span>,x == y));<span class=\"comment\">// 7</span></span><br><span class=\"line\">x = <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">128</span>);</span><br><span class=\"line\">System.out.println(String.format(<span class=\"string\">&quot;8:%s&quot;</span>,x == y));<span class=\"comment\">// 8</span></span><br></pre></td></tr></table></figure>\n\n<p>结果：</p>\n<p>1:true 2:true 3:false 4:false 5:true 6:false 7:false 8:false</p>\n<p>如果你都做对了，那么你对IntegerCache已经算是过关了，^_^！！！这里在说一下x = Integer.parseInt(“127”)和y = Integer.parseInt(“127”)这两个比较，因为parstInt()<br>方法返回的是int基本类型,自动装箱，就变成了Integer x = 127;调用valueOf方法,所以判断结果和直接调用valueOf方法是一样的。</p>\n<p>续：下边输出结果是什么</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">test</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">x</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"type\">Integer</span> <span class=\"variable\">y</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">    System.out.println(x.equals(y));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>上边x和y都是各自创建了一个新的Integer对象，两个引用对象去equals的话，一般是比较地址值，返回应该是false，但是像Integer和String这种类，都重写了equals方法，Integer的equals实际就是两个int基本类型的值比较，所以返回的是true。如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Compares this object to the specified object.  The result is</span></span><br><span class=\"line\"><span class=\"comment\"> * &#123;<span class=\"doctag\">@code</span> true&#125; if and only if the argument is not</span></span><br><span class=\"line\"><span class=\"comment\"> * &#123;<span class=\"doctag\">@code</span> null&#125; and is an &#123;<span class=\"doctag\">@code</span> Integer&#125; object that</span></span><br><span class=\"line\"><span class=\"comment\"> * contains the same &#123;<span class=\"doctag\">@code</span> int&#125; value as this object.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span>   obj   the object to compare with.</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span>  &#123;<span class=\"doctag\">@code</span> true&#125; if the objects are the same;</span></span><br><span class=\"line\"><span class=\"comment\"> *          &#123;<span class=\"doctag\">@code</span> false&#125; otherwise.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">equals</span><span class=\"params\">(Object obj)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (obj <span class=\"keyword\">instanceof</span> Integer) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> value == ((Integer)obj).intValue();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>另外，除了Integer，向Long、Double等包装类，都有缓存区的操作，所以在使用两个包装类进行相等判断时需要注意，最好使用equals方法，引用类判断是否相等就应该使用equals方法，然后重写equals实现我们想要的相等规则。使用包装类型和基本类型做判断则不需要，会自动拆箱。</p>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sun Dec 04 2022 15:01:59 GMT+0800 (中国标准时间)","title":"填上IntegerCache的坑","path":"2022/12/04/填上IntegerCache的坑/","eyeCatchImage":null,"excerpt":"<p>如下代码，本地跑程序都没问题，一到线上就不行，原因就是IntegerCache的问题，比较两个Integer时，本地数据少，数值也小，正好都是true，正式数据多，可能就因为IntegerCache的问题导致该是true的为false了，导致程序的执行出错。</p>","date":{"_isAMomentObject":true,"_i":"2022-12-04T06:38:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-12-04T06:38:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"日常踩坑","tags":["Integer","IntegerCache"],"internalLinks":[],"keywords":[],"keywordsLength":0}},{"title":"给前端返回long类型造成精度损失","date":"2022-12-04T06:38:00.000Z","_content":"今天同事遇到一个问题，后端给前端返回一个long类型的参数列表，前端使用\n<!-- more -->\n\n### 原因\n\nJS的基础类型Number，遵循 [IEEE 754](https://en.wikipedia.org/wiki/IEEE_floating_point) 规范，采用双精度存储（double precision），占用 64 bit。如图\n\n![img](https://images2015.cnblogs.com/blog/114013/201511/114013-20151106171603555-975142832.png)\n\n意义\n\n- 1位用来表示符号位\n- 11位用来表示指数\n- 52位表示尾数\n\n浮点数，比如\n\n```\n`0.1 >> 0.0001 1001 1001 1001…（1001无限循环）``0.2 >> 0.0011 0011 0011 0011…（0011无限循环）`\n```\n\n此时只能模仿十进制进行四舍五入了，但是二进制只有 0 和 1 两个，于是变为 0 舍 1 入。这即是计算机中部分浮点数运算时出现误差，丢失精度的根本原因。\n\n大整数的精度丢失和浮点数本质上是一样的，尾数位最大是 52 位，因此 JS 中能精准表示的最大整数是 Math.pow(2, 53)，十进制即 9007199254740992。\n\n大于 9007199254740992 的可能会丢失精度\n\n### 解决办法\n\n#### 1、使用ToStringSerializer的注解，让系统序列化\n\n时，保留相关精度\n\n```java\n@JsonSerialize(using=ToStringSerializer.class)\nprivate Long createdBy;\n\n\nFastJson 注解\n@JSONField(serializeUsing= ToStringSerializer.class)\n```\n\n> 上述方法需要在每个对象都配上该注解，此方法过于繁锁。\n\n#### 2、使用全局配置，将转换时实现自动ToStringSerializer序列化\n\n```java\nOverride\npublic void configureMessageConverters(List<HttpMessageConverter<?>> converters) {\n    MappingJackson2HttpMessageConverter jackson2HttpMessageConverter = new MappingJackson2HttpMessageConverter();\n\n    ObjectMapper objectMapper = new ObjectMapper();\n    /**\n     * 序列换成json时,将所有的long变成string\n     * 因为js中得数字类型不能包含所有的java long值\n     */\n    SimpleModule simpleModule = new SimpleModule();\n    simpleModule.addSerializer(Long.class, ToStringSerializer.instance);\n    simpleModule.addSerializer(Long.TYPE, ToStringSerializer.instance);\n    objectMapper.registerModule(simpleModule);\n\n    jackson2HttpMessageConverter.setObjectMapper(objectMapper);\n    converters.add(jackson2HttpMessageConverter);\n```\n\n> 项目中很多时候都会用到json，常用的有fastjson，Jackson等等这些，有时候为了统一，我们通常就会约定使用某一种。当然，有时候项目中也可能会统一约定使用了fastjson，然而Spring MVC中默认是使用了Jackson的\n\n在Spring Boot中将Jackson替换为fastjson一般会有两种方式：\n\n第一种：\n\n```java\n@Configuration\npublic class WebConfig extends WebMvcConfigurerAdapter {\n\n    @Bean\n    public HttpMessageConverters fastJsonHttpMessageConverter() {\n        return new HttpMessageConverters(new FastJsonHttpMessageConverter());\n    }\n}\n```\n\n第二种：\n\n```java\n@Configuration\npublic class WebConfig extends WebMvcConfigurerAdapter {\n\n    @Override\n    public void configureMessageConverters(List<HttpMessageConverter<?>> converters) {\n        FastJsonHttpMessageConverter fastConverter = \n        new FastJsonHttpMessageConverter();\n\n        FastJsonConfig fastJsonConfig = new FastJsonConfig();\n        fastJsonConfig.setSerializerFeatures(SerializerFeature.PrettyFormat);\n        fastConverter.setFastJsonConfig(fastJsonConfig);\n        converters.add(fastConverter);\n    }\n}\n```\n\n替换成fastjson之后，对于精度丢失问题，我们可以这么去做：\n\n```java\n@Configuration\npublic class WebConfig extends WebMvcConfigurerAdapter {\n\n    @Override\n    public void configureMessageConverters(List<HttpMessageConverter<?>> converters) {\n        FastJsonHttpMessageConverter fastConverter = \n        new FastJsonHttpMessageConverter();\n\n        FastJsonConfig fastJsonConfig = new FastJsonConfig();\n        SerializeConfig serializeConfig = SerializeConfig.globalInstance;\n        serializeConfig.put(BigInteger.class, ToStringSerializer.instance);\n        serializeConfig.put(Long.class, ToStringSerializer.instance);\n        serializeConfig.put(Long.TYPE, ToStringSerializer.instance);\n        fastJsonConfig.setSerializeConfig(serializeConfig);\n        fastConverter.setFastJsonConfig(fastJsonConfig);\n        converters.add(fastConverter);\n    }\n}\n```\n\n### 总结\n\n吃一堑长一智，需要精度准确的比如浮点数或者长整形最好给前端返回string类型\n","source":"_posts/给前端返回long类型造成精度损失.md","raw":"---\ntitle: 给前端返回long类型造成精度损失\ndate: 2022-12-04 14:38\ncategories: \n- [日常踩坑]\ntags:\n- js类型\n---\n今天同事遇到一个问题，后端给前端返回一个long类型的参数列表，前端使用\n<!-- more -->\n\n### 原因\n\nJS的基础类型Number，遵循 [IEEE 754](https://en.wikipedia.org/wiki/IEEE_floating_point) 规范，采用双精度存储（double precision），占用 64 bit。如图\n\n![img](https://images2015.cnblogs.com/blog/114013/201511/114013-20151106171603555-975142832.png)\n\n意义\n\n- 1位用来表示符号位\n- 11位用来表示指数\n- 52位表示尾数\n\n浮点数，比如\n\n```\n`0.1 >> 0.0001 1001 1001 1001…（1001无限循环）``0.2 >> 0.0011 0011 0011 0011…（0011无限循环）`\n```\n\n此时只能模仿十进制进行四舍五入了，但是二进制只有 0 和 1 两个，于是变为 0 舍 1 入。这即是计算机中部分浮点数运算时出现误差，丢失精度的根本原因。\n\n大整数的精度丢失和浮点数本质上是一样的，尾数位最大是 52 位，因此 JS 中能精准表示的最大整数是 Math.pow(2, 53)，十进制即 9007199254740992。\n\n大于 9007199254740992 的可能会丢失精度\n\n### 解决办法\n\n#### 1、使用ToStringSerializer的注解，让系统序列化\n\n时，保留相关精度\n\n```java\n@JsonSerialize(using=ToStringSerializer.class)\nprivate Long createdBy;\n\n\nFastJson 注解\n@JSONField(serializeUsing= ToStringSerializer.class)\n```\n\n> 上述方法需要在每个对象都配上该注解，此方法过于繁锁。\n\n#### 2、使用全局配置，将转换时实现自动ToStringSerializer序列化\n\n```java\nOverride\npublic void configureMessageConverters(List<HttpMessageConverter<?>> converters) {\n    MappingJackson2HttpMessageConverter jackson2HttpMessageConverter = new MappingJackson2HttpMessageConverter();\n\n    ObjectMapper objectMapper = new ObjectMapper();\n    /**\n     * 序列换成json时,将所有的long变成string\n     * 因为js中得数字类型不能包含所有的java long值\n     */\n    SimpleModule simpleModule = new SimpleModule();\n    simpleModule.addSerializer(Long.class, ToStringSerializer.instance);\n    simpleModule.addSerializer(Long.TYPE, ToStringSerializer.instance);\n    objectMapper.registerModule(simpleModule);\n\n    jackson2HttpMessageConverter.setObjectMapper(objectMapper);\n    converters.add(jackson2HttpMessageConverter);\n```\n\n> 项目中很多时候都会用到json，常用的有fastjson，Jackson等等这些，有时候为了统一，我们通常就会约定使用某一种。当然，有时候项目中也可能会统一约定使用了fastjson，然而Spring MVC中默认是使用了Jackson的\n\n在Spring Boot中将Jackson替换为fastjson一般会有两种方式：\n\n第一种：\n\n```java\n@Configuration\npublic class WebConfig extends WebMvcConfigurerAdapter {\n\n    @Bean\n    public HttpMessageConverters fastJsonHttpMessageConverter() {\n        return new HttpMessageConverters(new FastJsonHttpMessageConverter());\n    }\n}\n```\n\n第二种：\n\n```java\n@Configuration\npublic class WebConfig extends WebMvcConfigurerAdapter {\n\n    @Override\n    public void configureMessageConverters(List<HttpMessageConverter<?>> converters) {\n        FastJsonHttpMessageConverter fastConverter = \n        new FastJsonHttpMessageConverter();\n\n        FastJsonConfig fastJsonConfig = new FastJsonConfig();\n        fastJsonConfig.setSerializerFeatures(SerializerFeature.PrettyFormat);\n        fastConverter.setFastJsonConfig(fastJsonConfig);\n        converters.add(fastConverter);\n    }\n}\n```\n\n替换成fastjson之后，对于精度丢失问题，我们可以这么去做：\n\n```java\n@Configuration\npublic class WebConfig extends WebMvcConfigurerAdapter {\n\n    @Override\n    public void configureMessageConverters(List<HttpMessageConverter<?>> converters) {\n        FastJsonHttpMessageConverter fastConverter = \n        new FastJsonHttpMessageConverter();\n\n        FastJsonConfig fastJsonConfig = new FastJsonConfig();\n        SerializeConfig serializeConfig = SerializeConfig.globalInstance;\n        serializeConfig.put(BigInteger.class, ToStringSerializer.instance);\n        serializeConfig.put(Long.class, ToStringSerializer.instance);\n        serializeConfig.put(Long.TYPE, ToStringSerializer.instance);\n        fastJsonConfig.setSerializeConfig(serializeConfig);\n        fastConverter.setFastJsonConfig(fastJsonConfig);\n        converters.add(fastConverter);\n    }\n}\n```\n\n### 总结\n\n吃一堑长一智，需要精度准确的比如浮点数或者长整形最好给前端返回string类型\n","slug":"给前端返回long类型造成精度损失","published":1,"updated":"2022-12-04T06:55:57.489Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clb91t0lw00189sjn3m9z2kfu","content":"<p>今天同事遇到一个问题，后端给前端返回一个long类型的参数列表，前端使用</p>\n<span id=\"more\"></span>\n\n<h3 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a>原因</h3><p>JS的基础类型Number，遵循 <a href=\"https://en.wikipedia.org/wiki/IEEE_floating_point\">IEEE 754</a> 规范，采用双精度存储（double precision），占用 64 bit。如图</p>\n<p><img src=\"https://images2015.cnblogs.com/blog/114013/201511/114013-20151106171603555-975142832.png\" class=\"lazyload\" data-srcset=\"https://images2015.cnblogs.com/blog/114013/201511/114013-20151106171603555-975142832.png\" srcset=\"data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\" alt=\"img\"></p>\n<p>意义</p>\n<ul>\n<li>1位用来表示符号位</li>\n<li>11位用来表示指数</li>\n<li>52位表示尾数</li>\n</ul>\n<p>浮点数，比如</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">`0.1 &gt;&gt; 0.0001 1001 1001 1001…（1001无限循环）``0.2 &gt;&gt; 0.0011 0011 0011 0011…（0011无限循环）`</span><br></pre></td></tr></table></figure>\n\n<p>此时只能模仿十进制进行四舍五入了，但是二进制只有 0 和 1 两个，于是变为 0 舍 1 入。这即是计算机中部分浮点数运算时出现误差，丢失精度的根本原因。</p>\n<p>大整数的精度丢失和浮点数本质上是一样的，尾数位最大是 52 位，因此 JS 中能精准表示的最大整数是 Math.pow(2, 53)，十进制即 9007199254740992。</p>\n<p>大于 9007199254740992 的可能会丢失精度</p>\n<h3 id=\"解决办法\"><a href=\"#解决办法\" class=\"headerlink\" title=\"解决办法\"></a>解决办法</h3><h4 id=\"1、使用ToStringSerializer的注解，让系统序列化\"><a href=\"#1、使用ToStringSerializer的注解，让系统序列化\" class=\"headerlink\" title=\"1、使用ToStringSerializer的注解，让系统序列化\"></a>1、使用ToStringSerializer的注解，让系统序列化</h4><p>时，保留相关精度</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@JsonSerialize(using=ToStringSerializer.class)</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> Long createdBy;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">FastJson 注解</span><br><span class=\"line\"><span class=\"meta\">@JSONField(serializeUsing= ToStringSerializer.class)</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>上述方法需要在每个对象都配上该注解，此方法过于繁锁。</p>\n</blockquote>\n<h4 id=\"2、使用全局配置，将转换时实现自动ToStringSerializer序列化\"><a href=\"#2、使用全局配置，将转换时实现自动ToStringSerializer序列化\" class=\"headerlink\" title=\"2、使用全局配置，将转换时实现自动ToStringSerializer序列化\"></a>2、使用全局配置，将转换时实现自动ToStringSerializer序列化</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Override</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">configureMessageConverters</span><span class=\"params\">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">MappingJackson2HttpMessageConverter</span> <span class=\"variable\">jackson2HttpMessageConverter</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MappingJackson2HttpMessageConverter</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">ObjectMapper</span> <span class=\"variable\">objectMapper</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 序列换成json时,将所有的long变成string</span></span><br><span class=\"line\"><span class=\"comment\">     * 因为js中得数字类型不能包含所有的java long值</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"type\">SimpleModule</span> <span class=\"variable\">simpleModule</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleModule</span>();</span><br><span class=\"line\">    simpleModule.addSerializer(Long.class, ToStringSerializer.instance);</span><br><span class=\"line\">    simpleModule.addSerializer(Long.TYPE, ToStringSerializer.instance);</span><br><span class=\"line\">    objectMapper.registerModule(simpleModule);</span><br><span class=\"line\"></span><br><span class=\"line\">    jackson2HttpMessageConverter.setObjectMapper(objectMapper);</span><br><span class=\"line\">    converters.add(jackson2HttpMessageConverter);</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>项目中很多时候都会用到json，常用的有fastjson，Jackson等等这些，有时候为了统一，我们通常就会约定使用某一种。当然，有时候项目中也可能会统一约定使用了fastjson，然而Spring MVC中默认是使用了Jackson的</p>\n</blockquote>\n<p>在Spring Boot中将Jackson替换为fastjson一般会有两种方式：</p>\n<p>第一种：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WebConfig</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WebMvcConfigurerAdapter</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> HttpMessageConverters <span class=\"title function_\">fastJsonHttpMessageConverter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">HttpMessageConverters</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">FastJsonHttpMessageConverter</span>());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>第二种：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WebConfig</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WebMvcConfigurerAdapter</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">configureMessageConverters</span><span class=\"params\">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">FastJsonHttpMessageConverter</span> <span class=\"variable\">fastConverter</span> <span class=\"operator\">=</span> </span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">FastJsonHttpMessageConverter</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">FastJsonConfig</span> <span class=\"variable\">fastJsonConfig</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">FastJsonConfig</span>();</span><br><span class=\"line\">        fastJsonConfig.setSerializerFeatures(SerializerFeature.PrettyFormat);</span><br><span class=\"line\">        fastConverter.setFastJsonConfig(fastJsonConfig);</span><br><span class=\"line\">        converters.add(fastConverter);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>替换成fastjson之后，对于精度丢失问题，我们可以这么去做：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WebConfig</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WebMvcConfigurerAdapter</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">configureMessageConverters</span><span class=\"params\">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">FastJsonHttpMessageConverter</span> <span class=\"variable\">fastConverter</span> <span class=\"operator\">=</span> </span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">FastJsonHttpMessageConverter</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">FastJsonConfig</span> <span class=\"variable\">fastJsonConfig</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">FastJsonConfig</span>();</span><br><span class=\"line\">        <span class=\"type\">SerializeConfig</span> <span class=\"variable\">serializeConfig</span> <span class=\"operator\">=</span> SerializeConfig.globalInstance;</span><br><span class=\"line\">        serializeConfig.put(BigInteger.class, ToStringSerializer.instance);</span><br><span class=\"line\">        serializeConfig.put(Long.class, ToStringSerializer.instance);</span><br><span class=\"line\">        serializeConfig.put(Long.TYPE, ToStringSerializer.instance);</span><br><span class=\"line\">        fastJsonConfig.setSerializeConfig(serializeConfig);</span><br><span class=\"line\">        fastConverter.setFastJsonConfig(fastJsonConfig);</span><br><span class=\"line\">        converters.add(fastConverter);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>吃一堑长一智，需要精度准确的比如浮点数或者长整形最好给前端返回string类型</p>\n","site":{"data":{}},"excerpt":"<p>今天同事遇到一个问题，后端给前端返回一个long类型的参数列表，前端使用</p>","more":"<h3 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a>原因</h3><p>JS的基础类型Number，遵循 <a href=\"https://en.wikipedia.org/wiki/IEEE_floating_point\">IEEE 754</a> 规范，采用双精度存储（double precision），占用 64 bit。如图</p>\n<p><img src=\"https://images2015.cnblogs.com/blog/114013/201511/114013-20151106171603555-975142832.png\" alt=\"img\"></p>\n<p>意义</p>\n<ul>\n<li>1位用来表示符号位</li>\n<li>11位用来表示指数</li>\n<li>52位表示尾数</li>\n</ul>\n<p>浮点数，比如</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">`0.1 &gt;&gt; 0.0001 1001 1001 1001…（1001无限循环）``0.2 &gt;&gt; 0.0011 0011 0011 0011…（0011无限循环）`</span><br></pre></td></tr></table></figure>\n\n<p>此时只能模仿十进制进行四舍五入了，但是二进制只有 0 和 1 两个，于是变为 0 舍 1 入。这即是计算机中部分浮点数运算时出现误差，丢失精度的根本原因。</p>\n<p>大整数的精度丢失和浮点数本质上是一样的，尾数位最大是 52 位，因此 JS 中能精准表示的最大整数是 Math.pow(2, 53)，十进制即 9007199254740992。</p>\n<p>大于 9007199254740992 的可能会丢失精度</p>\n<h3 id=\"解决办法\"><a href=\"#解决办法\" class=\"headerlink\" title=\"解决办法\"></a>解决办法</h3><h4 id=\"1、使用ToStringSerializer的注解，让系统序列化\"><a href=\"#1、使用ToStringSerializer的注解，让系统序列化\" class=\"headerlink\" title=\"1、使用ToStringSerializer的注解，让系统序列化\"></a>1、使用ToStringSerializer的注解，让系统序列化</h4><p>时，保留相关精度</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@JsonSerialize(using=ToStringSerializer.class)</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> Long createdBy;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">FastJson 注解</span><br><span class=\"line\"><span class=\"meta\">@JSONField(serializeUsing= ToStringSerializer.class)</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>上述方法需要在每个对象都配上该注解，此方法过于繁锁。</p>\n</blockquote>\n<h4 id=\"2、使用全局配置，将转换时实现自动ToStringSerializer序列化\"><a href=\"#2、使用全局配置，将转换时实现自动ToStringSerializer序列化\" class=\"headerlink\" title=\"2、使用全局配置，将转换时实现自动ToStringSerializer序列化\"></a>2、使用全局配置，将转换时实现自动ToStringSerializer序列化</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Override</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">configureMessageConverters</span><span class=\"params\">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">MappingJackson2HttpMessageConverter</span> <span class=\"variable\">jackson2HttpMessageConverter</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MappingJackson2HttpMessageConverter</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">ObjectMapper</span> <span class=\"variable\">objectMapper</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 序列换成json时,将所有的long变成string</span></span><br><span class=\"line\"><span class=\"comment\">     * 因为js中得数字类型不能包含所有的java long值</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"type\">SimpleModule</span> <span class=\"variable\">simpleModule</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleModule</span>();</span><br><span class=\"line\">    simpleModule.addSerializer(Long.class, ToStringSerializer.instance);</span><br><span class=\"line\">    simpleModule.addSerializer(Long.TYPE, ToStringSerializer.instance);</span><br><span class=\"line\">    objectMapper.registerModule(simpleModule);</span><br><span class=\"line\"></span><br><span class=\"line\">    jackson2HttpMessageConverter.setObjectMapper(objectMapper);</span><br><span class=\"line\">    converters.add(jackson2HttpMessageConverter);</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>项目中很多时候都会用到json，常用的有fastjson，Jackson等等这些，有时候为了统一，我们通常就会约定使用某一种。当然，有时候项目中也可能会统一约定使用了fastjson，然而Spring MVC中默认是使用了Jackson的</p>\n</blockquote>\n<p>在Spring Boot中将Jackson替换为fastjson一般会有两种方式：</p>\n<p>第一种：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WebConfig</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WebMvcConfigurerAdapter</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> HttpMessageConverters <span class=\"title function_\">fastJsonHttpMessageConverter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">HttpMessageConverters</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">FastJsonHttpMessageConverter</span>());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>第二种：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WebConfig</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WebMvcConfigurerAdapter</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">configureMessageConverters</span><span class=\"params\">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">FastJsonHttpMessageConverter</span> <span class=\"variable\">fastConverter</span> <span class=\"operator\">=</span> </span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">FastJsonHttpMessageConverter</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">FastJsonConfig</span> <span class=\"variable\">fastJsonConfig</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">FastJsonConfig</span>();</span><br><span class=\"line\">        fastJsonConfig.setSerializerFeatures(SerializerFeature.PrettyFormat);</span><br><span class=\"line\">        fastConverter.setFastJsonConfig(fastJsonConfig);</span><br><span class=\"line\">        converters.add(fastConverter);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>替换成fastjson之后，对于精度丢失问题，我们可以这么去做：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WebConfig</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WebMvcConfigurerAdapter</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">configureMessageConverters</span><span class=\"params\">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">FastJsonHttpMessageConverter</span> <span class=\"variable\">fastConverter</span> <span class=\"operator\">=</span> </span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">FastJsonHttpMessageConverter</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">FastJsonConfig</span> <span class=\"variable\">fastJsonConfig</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">FastJsonConfig</span>();</span><br><span class=\"line\">        <span class=\"type\">SerializeConfig</span> <span class=\"variable\">serializeConfig</span> <span class=\"operator\">=</span> SerializeConfig.globalInstance;</span><br><span class=\"line\">        serializeConfig.put(BigInteger.class, ToStringSerializer.instance);</span><br><span class=\"line\">        serializeConfig.put(Long.class, ToStringSerializer.instance);</span><br><span class=\"line\">        serializeConfig.put(Long.TYPE, ToStringSerializer.instance);</span><br><span class=\"line\">        fastJsonConfig.setSerializeConfig(serializeConfig);</span><br><span class=\"line\">        fastConverter.setFastJsonConfig(fastJsonConfig);</span><br><span class=\"line\">        converters.add(fastConverter);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>吃一堑长一智，需要精度准确的比如浮点数或者长整形最好给前端返回string类型</p>","popularPost_tmp_postPath":true,"eyeCatchImage":"https://images2015.cnblogs.com/blog/114013/201511/114013-20151106171603555-975142832.png","popularPost_tmp_gaData":{"updated":"Sun Dec 04 2022 14:55:57 GMT+0800 (中国标准时间)","title":"给前端返回long类型造成精度损失","path":"2022/12/04/给前端返回long类型造成精度损失/","eyeCatchImage":"https://images2015.cnblogs.com/blog/114013/201511/114013-20151106171603555-975142832.png","excerpt":"<p>今天同事遇到一个问题，后端给前端返回一个long类型的参数列表，前端使用</p>","date":{"_isAMomentObject":true,"_i":"2022-12-04T06:38:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-12-04T06:38:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"日常踩坑","tags":["js类型"],"internalLinks":[],"keywords":[],"keywordsLength":0}}],"PostAsset":[],"PostCategory":[{"post_id":"clb91t0l200019sjnb3z870x5","category_id":"clb91t0lc00079sjn4oqi4tsx","_id":"clb91t0lm000m9sjn23l0dd7z"},{"post_id":"clb91t0l700039sjn4gjd0a4a","category_id":"clb91t0lg000d9sjn505423wp","_id":"clb91t0lo000r9sjn3lycgv4p"},{"post_id":"clb91t0le00099sjn7ojx2bwb","category_id":"clb91t0ln000p9sjn6xi87ben","_id":"clb91t0lu00139sjnfsol1sqe"},{"post_id":"clb91t0ls000x9sjn4a4caay1","category_id":"clb91t0lg000d9sjn505423wp","_id":"clb91t0lx00199sjn2e6u6ltn"},{"post_id":"clb91t0lf000b9sjn32gug5ne","category_id":"clb91t0ls000v9sjn1jjfhcsi","_id":"clb91t0lx001a9sjnc50a6i4d"},{"post_id":"clb91t0lt000z9sjn49s4c7mf","category_id":"clb91t0lc00079sjn4oqi4tsx","_id":"clb91t0ly001d9sjnbazab1ed"},{"post_id":"clb91t0lu00149sjn99o61i9z","category_id":"clb91t0lg000d9sjn505423wp","_id":"clb91t0ly001f9sjnecg72iqr"},{"post_id":"clb91t0li000g9sjnep556msb","category_id":"clb91t0lu00119sjng5g92kig","_id":"clb91t0lz001i9sjn2lsma97y"},{"post_id":"clb91t0lv00159sjncyh2hhfy","category_id":"clb91t0lg000d9sjn505423wp","_id":"clb91t0lz001l9sjn115rc9z6"},{"post_id":"clb91t0lw00189sjn3m9z2kfu","category_id":"clb91t0lg000d9sjn505423wp","_id":"clb91t0m0001m9sjn1yzogqwy"},{"post_id":"clb91t0ll000l9sjnhfdv3i4m","category_id":"clb91t0ll000k9sjn8mozhx3r","_id":"clb91t0m1001q9sjn77po5t4i"},{"post_id":"clb91t0ll000l9sjnhfdv3i4m","category_id":"clb91t0lw00179sjn2rh45qk8","_id":"clb91t0m1001s9sjn52e7honu"},{"post_id":"clb91t0lc00069sjn0gx49mzp","category_id":"clb91t0ll000k9sjn8mozhx3r","_id":"clb91t0m2001v9sjn5zcs9w1m"},{"post_id":"clb91t0lc00069sjn0gx49mzp","category_id":"clb91t0ly001c9sjn4b001038","_id":"clb91t0m2001w9sjnb8jbecdc"},{"post_id":"clb91t0lm000n9sjn2jog555o","category_id":"clb91t0lz001j9sjn3uhk41ke","_id":"clb91t0m3001z9sjn20st928n"},{"post_id":"clb91t0lo000q9sjnh7nq8eyk","category_id":"clb91t0lz001j9sjn3uhk41ke","_id":"clb91t0m300209sjn89ca365m"},{"post_id":"clb91t0lo000s9sjngyave15o","category_id":"clb91t0lz001j9sjn3uhk41ke","_id":"clb91t0m300229sjn13wz1qks"},{"post_id":"clb91t0lr000u9sjncjemeotc","category_id":"clb91t0ll000k9sjn8mozhx3r","_id":"clb91t0m400269sjn2eow8of0"},{"post_id":"clb91t0lr000u9sjncjemeotc","category_id":"clb91t0m2001x9sjn4gnebpp7","_id":"clb91t0m400289sjn1i3e8scz"}],"PostTag":[{"post_id":"clb91t0l200019sjnb3z870x5","tag_id":"clb91t0la00049sjnggb418ac","_id":"clb91t0lh000e9sjn7n4ibwac"},{"post_id":"clb91t0l700039sjn4gjd0a4a","tag_id":"clb91t0lg000c9sjn27owehmm","_id":"clb91t0ls000w9sjndvgi1wta"},{"post_id":"clb91t0l700039sjn4gjd0a4a","tag_id":"clb91t0lk000j9sjnfbcg0g0l","_id":"clb91t0lt000y9sjnh5229zwb"},{"post_id":"clb91t0l700039sjn4gjd0a4a","tag_id":"clb91t0ln000o9sjngotj5kxs","_id":"clb91t0lu00129sjnavv68r34"},{"post_id":"clb91t0lc00069sjn0gx49mzp","tag_id":"clb91t0lr000t9sjn2st1fm7v","_id":"clb91t0ly001e9sjn1f5e9iz8"},{"post_id":"clb91t0lc00069sjn0gx49mzp","tag_id":"clb91t0lu00109sjneocgdlyg","_id":"clb91t0ly001g9sjnf0vpfci2"},{"post_id":"clb91t0lc00069sjn0gx49mzp","tag_id":"clb91t0lw00169sjnangc2x4o","_id":"clb91t0lz001k9sjng6p2633d"},{"post_id":"clb91t0le00099sjn7ojx2bwb","tag_id":"clb91t0lx001b9sjne1fl9qy2","_id":"clb91t0m1001p9sjn8akh3ff2"},{"post_id":"clb91t0le00099sjn7ojx2bwb","tag_id":"clb91t0lz001h9sjn6gz03alq","_id":"clb91t0m1001r9sjngnykdxhj"},{"post_id":"clb91t0lf000b9sjn32gug5ne","tag_id":"clb91t0m0001n9sjnhi26euok","_id":"clb91t0m400239sjn0hx0amd2"},{"post_id":"clb91t0lf000b9sjn32gug5ne","tag_id":"clb91t0m2001u9sjn7obv00c7","_id":"clb91t0m400249sjnbklt66aa"},{"post_id":"clb91t0lf000b9sjn32gug5ne","tag_id":"clb91t0m3001y9sjn4x1mcbiy","_id":"clb91t0m400279sjngwuw3zqv"},{"post_id":"clb91t0li000g9sjnep556msb","tag_id":"clb91t0m300219sjn2waf222v","_id":"clb91t0m400299sjncowadwzr"},{"post_id":"clb91t0ll000l9sjnhfdv3i4m","tag_id":"clb91t0m400259sjncz8m25bj","_id":"clb91t0m5002d9sjn72xy0tuf"},{"post_id":"clb91t0ll000l9sjnhfdv3i4m","tag_id":"clb91t0m4002a9sjnc9uif6pq","_id":"clb91t0m5002e9sjn0dx02vlf"},{"post_id":"clb91t0ll000l9sjnhfdv3i4m","tag_id":"clb91t0m5002b9sjneaxe4qut","_id":"clb91t0m5002g9sjndsb1a1fh"},{"post_id":"clb91t0lm000n9sjn2jog555o","tag_id":"clb91t0m5002c9sjn6owf4pf0","_id":"clb91t0m6002j9sjngvc79ryj"},{"post_id":"clb91t0lm000n9sjn2jog555o","tag_id":"clb91t0m5002f9sjn2hz9cr06","_id":"clb91t0m6002k9sjn9tic916l"},{"post_id":"clb91t0lm000n9sjn2jog555o","tag_id":"clb91t0m5002h9sjn69ob4yql","_id":"clb91t0m6002m9sjncnko0apw"},{"post_id":"clb91t0lo000q9sjnh7nq8eyk","tag_id":"clb91t0m5002i9sjnd2mne7l4","_id":"clb91t0m6002o9sjnca9l08cg"},{"post_id":"clb91t0lo000q9sjnh7nq8eyk","tag_id":"clb91t0m6002l9sjn49t7dckp","_id":"clb91t0m6002p9sjn2zr35u8l"},{"post_id":"clb91t0lo000s9sjngyave15o","tag_id":"clb91t0m6002n9sjn9qpr4vbz","_id":"clb91t0m7002s9sjnhcc874zl"},{"post_id":"clb91t0lo000s9sjngyave15o","tag_id":"clb91t0m6002q9sjn117y8oz2","_id":"clb91t0m7002t9sjn63wz9vfr"},{"post_id":"clb91t0lr000u9sjncjemeotc","tag_id":"clb91t0m7002r9sjnbe5276ce","_id":"clb91t0m7002w9sjnhpgl7bt3"},{"post_id":"clb91t0lr000u9sjncjemeotc","tag_id":"clb91t0m7002u9sjn7j4khs8t","_id":"clb91t0m8002x9sjn3m219f7v"},{"post_id":"clb91t0ls000x9sjn4a4caay1","tag_id":"clb91t0m7002v9sjn1ybo2g4z","_id":"clb91t0m8002z9sjn7iciev0f"},{"post_id":"clb91t0lt000z9sjn49s4c7mf","tag_id":"clb91t0m8002y9sjnhzop2rph","_id":"clb91t0m800319sjn9d7w6e4x"},{"post_id":"clb91t0lu00149sjn99o61i9z","tag_id":"clb91t0lu00109sjneocgdlyg","_id":"clb91t0m800339sjnf7h6fxkm"},{"post_id":"clb91t0lu00149sjn99o61i9z","tag_id":"clb91t0m800309sjn5i082c41","_id":"clb91t0m800349sjneuc516ec"},{"post_id":"clb91t0lv00159sjncyh2hhfy","tag_id":"clb91t0m800329sjnfpgua8zz","_id":"clb91t0m900379sjn2lt96jpn"},{"post_id":"clb91t0lv00159sjncyh2hhfy","tag_id":"clb91t0m900359sjnh24vfjq0","_id":"clb91t0m900389sjnajhheq7n"},{"post_id":"clb91t0lw00189sjn3m9z2kfu","tag_id":"clb91t0m900369sjn1wl2ffp7","_id":"clb91t0m900399sjn3y0kbqy3"}],"Tag":[{"name":"日常开发","_id":"clb91t0la00049sjnggb418ac"},{"name":"Arrays","_id":"clb91t0lg000c9sjn27owehmm"},{"name":"视图","_id":"clb91t0lk000j9sjnfbcg0g0l"},{"name":"踩坑","_id":"clb91t0ln000o9sjngotj5kxs"},{"name":"InnoDB索引","_id":"clb91t0lr000t9sjn2st1fm7v"},{"name":"Mysql","_id":"clb91t0lu00109sjneocgdlyg"},{"name":"数据结构","_id":"clb91t0lw00169sjnangc2x4o"},{"name":"jdk按照","_id":"clb91t0lx001b9sjne1fl9qy2"},{"name":"centos","_id":"clb91t0lz001h9sjn6gz03alq"},{"name":"Swagger","_id":"clb91t0m0001n9sjnhi26euok"},{"name":"springboot","_id":"clb91t0m2001u9sjn7obv00c7"},{"name":"接口文档","_id":"clb91t0m3001y9sjn4x1mcbiy"},{"name":"破解软件","_id":"clb91t0m300219sjn2waf222v"},{"name":"设计模式","_id":"clb91t0m400259sjncz8m25bj"},{"name":"源码","_id":"clb91t0m4002a9sjnc9uif6pq"},{"name":"AOP","_id":"clb91t0m5002b9sjneaxe4qut"},{"name":"bat","_id":"clb91t0m5002c9sjn6owf4pf0"},{"name":"脚本","_id":"clb91t0m5002f9sjn2hz9cr06"},{"name":"便捷开发","_id":"clb91t0m5002h9sjn69ob4yql"},{"name":"shell","_id":"clb91t0m5002i9sjnd2mne7l4"},{"name":"git branch","_id":"clb91t0m6002l9sjn49t7dckp"},{"name":"实用功能","_id":"clb91t0m6002n9sjn9qpr4vbz"},{"name":"Chrome插件","_id":"clb91t0m6002q9sjn117y8oz2"},{"name":"分库分表","_id":"clb91t0m7002r9sjnbe5276ce"},{"name":"性能优化","_id":"clb91t0m7002u9sjn7j4khs8t"},{"name":"SHH","_id":"clb91t0m7002v9sjn1ybo2g4z"},{"name":"docker容器","_id":"clb91t0m8002y9sjnhzop2rph"},{"name":"数据库","_id":"clb91t0m800309sjn5i082c41"},{"name":"Integer","_id":"clb91t0m800329sjnfpgua8zz"},{"name":"IntegerCache","_id":"clb91t0m900359sjnh24vfjq0"},{"name":"js类型","_id":"clb91t0m900369sjn1wl2ffp7"}]}}